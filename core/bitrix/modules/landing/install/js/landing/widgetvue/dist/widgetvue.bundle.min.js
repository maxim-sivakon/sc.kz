this.BX=this.BX||{};(function(e,t,s,a,i,l){"use strict";async function r(e,t={}){let s=await i.Backend.getInstance().action("RepoWidget::fetchData",{blockId:e,params:t}).catch((e=>{console.error("Fetch error",e)}));try{s=JSON.parse(s);if(s["error"]){console.error("Fetch data error: data failed",s["error"]);s={}}}catch(e){console.error("Fetch data error: json parse error");s={}}return s}const n=5e3;const o={props:{defaultData:{type:Object,default:null},blockId:{type:Number,required:true},appId:{type:Number,default:0},fetchable:{type:Boolean,default:false},clickable:{type:Boolean,default:false}},data(){return{isFetching:false}},methods:{fetch(e={}){if(!this.clickable||this.isFetching){console.warn("Events is disabled now");return}if(this.appId<=0||!this.fetchable){console.warn("If you want fetch external data in widget - you must add application and handler");return}this.isFetching=true;this.$bitrix.eventEmitter.emit("landing:widgetvue:startContentLoad");const t=setTimeout((()=>{this.$bitrix.eventEmitter.emit("landing:widgetvue:onMessage",{message:l.Loc.getMessage("LANDING_WIDGETVUE_LOADER_TOO_LONG")});this.$bitrix.eventEmitter.emit("landing:widgetvue:endContentLoad")}),n);r(this.blockId,e).then((e=>{clearTimeout(t);this.$bitrix.eventEmitter.emit("landing:widgetvue:endContentLoad");this.$bitrix.eventEmitter.emit("landing:widgetvue:onHideMessage");this.isFetching=false;if(e&&Object.keys(e).length>0){for(let t in e){if(this[t]!==undefined){this[t]=e[t]}}}}))},openApplication(e={}){if(!this.clickable||this.isFetching){console.info("Events is disabled now");return}if(this.appId<=0){console.warn("If you want fetch external data in widget - you must add application and handler");return}BX.rest.AppLayout.openApplication(this.appId,e)},openPath(e){if(!this.clickable||this.isFetching){console.info("Events is disabled now");return}const t=new URL(e,window.location.origin);if(t.origin===window.location.origin){window.open(t.href,"_blank")}}},async setup(e){if(e.appId<=0||!e.fetchable){console.info("If you want fetch external data in widget - you must add application and handler");return}const t={};if(e.defaultData!==null&&Object.keys(e.defaultData).length>0){for(let s in e.defaultData){t[s]=a.ref(e.defaultData[s])}r(e.blockId).then((e=>{if(e&&l.Type.isObject(e)){for(let s in e){if(t[s]){t[s].value=e[s]}}}}))}else{const s=await r(e.blockId);for(let e in s){t[e]=a.ref(s[e])}}return t}};const d={props:{message:{type:String,default:l.Loc.getMessage("LANDING_WIDGETVUE_LOADER_DEFAULT_MESSAGE")},link:{type:String,default:null},linkText:{type:String,default:l.Loc.getMessage("LANDING_WIDGETVUE_ERROR_DEFAULT_LINK_TEXT")}},template:`\n\t\t<div class="w-loader">\n\t\t\t<div class="w-loader-icon"></div>\n\t\t\t<div class="w-loader-text">\n\t\t\t\t<div>{{message}}</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const c={props:{message:{type:String,default:l.Loc.getMessage("LANDING_WIDGETVUE_ERROR_DEFAULT_MESSAGE")},link:{type:String,default:null},linkText:{type:String,default:l.Loc.getMessage("LANDING_WIDGETVUE_ERROR_DEFAULT_LINK_TEXT")}},template:`\n\t\t<div class="w-error">\n\t\t\t<div class="w-loader-icon --error"></div>\n\t\t\t<div class="w-error-text">\n\t\t\t\t<div>{{message}}</div>\n\t\t\t\t<a class="w-loader-link" :href="link">linkText: link</a>\t\n\t\t\t</div>\n\t\t</div>\n\t`};var b=babelHelpers.classPrivateFieldLooseKey("rootNode");var h=babelHelpers.classPrivateFieldLooseKey("data");var u=babelHelpers.classPrivateFieldLooseKey("blockId");var p=babelHelpers.classPrivateFieldLooseKey("appId");var v=babelHelpers.classPrivateFieldLooseKey("fetchable");var g=babelHelpers.classPrivateFieldLooseKey("clickable");var f=babelHelpers.classPrivateFieldLooseKey("allowedByTariff");var L=babelHelpers.classPrivateFieldLooseKey("application");var w=babelHelpers.classPrivateFieldLooseKey("contentTemplate");var m=babelHelpers.classPrivateFieldLooseKey("createApp");class E{constructor(e){Object.defineProperty(this,m,{value:y});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,w,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,b)[b]=l.Type.isString(e.rootNode)?document.querySelector(e.rootNode):null;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=l.Type.isObject(e.data)?e.data:null;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.blockId?l.Text.toNumber(e.blockId):0;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e.appId?l.Text.toNumber(e.appId):0;babelHelpers.classPrivateFieldLooseBase(this,w)[w]=l.Runtime.clone(o);babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.fetchable||false;const t=l.Type.isFunction(BX.Landing.getMode)&&BX.Landing.getMode()==="edit";babelHelpers.classPrivateFieldLooseBase(this,g)[g]=!t;babelHelpers.classPrivateFieldLooseBase(this,f)[f]=babelHelpers.classPrivateFieldLooseBase(this,p)[p]&&l.Type.isBoolean(e.allowedByTariff)?e.allowedByTariff:true}mount(){if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]>0&&babelHelpers.classPrivateFieldLooseBase(this,b)[b]&&!E.runningAppNodes.has(babelHelpers.classPrivateFieldLooseBase(this,b)[b])){this.loader=new s.Loader({target:babelHelpers.classPrivateFieldLooseBase(this,b)[b]});babelHelpers.classPrivateFieldLooseBase(this,w)[w].template=babelHelpers.classPrivateFieldLooseBase(this,b)[b].innerHTML||"";babelHelpers.classPrivateFieldLooseBase(this,m)[m]();E.runningAppNodes.add(babelHelpers.classPrivateFieldLooseBase(this,b)[b])}}showLoader(){this.loader.show()}hideLoader(){this.loader.hide()}}function y(){const e=this;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=a.BitrixVue.createApp({name:"BX widget "+babelHelpers.classPrivateFieldLooseBase(this,u)[u],components:{Message:d,Error:c,Content:babelHelpers.classPrivateFieldLooseBase(this,w)[w]},props:{defaultData:{type:Object,default:null},allowedByTariff:{type:Boolean,default:true}},data(){return{message:null,error:null}},created(){this.$bitrix.eventEmitter.subscribe("landing:widgetvue:startContentLoad",this.onShowLoader);this.$bitrix.eventEmitter.subscribe("landing:widgetvue:endContentLoad",this.onHideLoader);this.$bitrix.eventEmitter.subscribe("landing:widgetvue:onMessage",this.onShowMessage);this.$bitrix.eventEmitter.subscribe("landing:widgetvue:onHideMessage",this.onHideMessage);this.$bitrix.eventEmitter.subscribe("landing:widgetvue:onError",this.onShowError)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe("landing:widgetvue:startContentLoad",this.onShowLoader);this.$bitrix.eventEmitter.unsubscribe("landing:widgetvue:endContentLoad",this.onHideLoader);this.$bitrix.eventEmitter.unsubscribe("landing:widgetvue:onMessage",this.onShowMessage);this.$bitrix.eventEmitter.unsubscribe("landing:widgetvue:onHideMessage",this.onHideMessage);this.$bitrix.eventEmitter.unsubscribe("landing:widgetvue:onError",this.onShowError)},methods:{onShowLoader(){this.$bitrix.Application.get().showLoader()},onHideLoader(){this.$bitrix.Application.get().hideLoader()},onShowMessage(e){var t;const s=((t=e.getData())==null?void 0:t.message)||null;this.message={message:s}},onHideMessage(){this.message=null},onShowError(e){var t;const s=((t=e.getData())==null?void 0:t.message)||null;this.error={message:s}}},beforeCreate(){this.$bitrix.Application.set(e)},template:`\n\t\t\t\t<Error\n\t\t\t\t\tv-if="!allowedByTariff"\n\t\t\t\t\tmessage="${l.Loc.getMessage("LANDING_WIDGETVUE_ERROR_PAYMENT")}"\n\t\t\t\t>\n\t\t\t\t</Error>\n\n\t\t\t\t<Suspense v-else>\n\t\t\t\t\t<template #default>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Error\n\t\t\t\t\t\t\t\tv-show="error !== null"\n\t\t\t\t\t\t\t\tv-bind="error && error.message !== null ? { \n\t\t\t\t\t\t\t\t\tmessage: error.message \n\t\t\t\t\t\t\t\t} : {}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Message\n\t\t\t\t\t\t\t\tv-show="message !== null"\n\t\t\t\t\t\t\t\tv-bind="message && message.message !== null ? { \n\t\t\t\t\t\t\t\t\tmessage: message.message \n\t\t\t\t\t\t\t\t} : {}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Content\n\t\t\t\t\t\t\t\tv-show="message === null && error === null"\n\n\t\t\t\t\t\t\t\t:defaultData="defaultData"\n\t\t\t\t\t\t\t\t:blockId=${babelHelpers.classPrivateFieldLooseBase(this,u)[u]}\n\t\t\t\t\t\t\t\t:appId="${babelHelpers.classPrivateFieldLooseBase(this,p)[p]}"\n\t\t\t\t\t\t\t\t:fetchable=${babelHelpers.classPrivateFieldLooseBase(this,v)[v]}\n\t\t\t\t\t\t\t\t:clickable=${babelHelpers.classPrivateFieldLooseBase(this,g)[g]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #fallback>\n\t\t\t\t\t\t<Message\n\t\t\t\t\t\t\tmessage="${l.Loc.getMessage("LANDING_WIDGETVUE_LOADER_DEFAULT_MESSAGE")}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</Suspense>\n\t\t\t`},{defaultData:babelHelpers.classPrivateFieldLooseBase(this,h)[h],allowedByTariff:babelHelpers.classPrivateFieldLooseBase(this,f)[f]});babelHelpers.classPrivateFieldLooseBase(this,L)[L].mount(babelHelpers.classPrivateFieldLooseBase(this,b)[b])}E.runningAppNodes=new Set;e.WidgetVue=E})(this.BX.Landing=this.BX.Landing||{},BX.Event,BX,BX.Vue3,BX.Landing,BX);
//# sourceMappingURL=widgetvue.bundle.map.js