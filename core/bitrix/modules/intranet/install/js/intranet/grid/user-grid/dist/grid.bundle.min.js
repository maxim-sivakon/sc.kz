this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,t,i,n,a,r,s,l,o){"use strict";function d(e,t,i){c(e,t);t.set(e,i)}function c(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var u=new WeakMap;var T=new WeakMap;var p=function(){function e(t){var i;babelHelpers.classCallCheck(this,e);d(this,u,{writable:true,value:void 0});d(this,T,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,u,t.fieldId);babelHelpers.classPrivateFieldSet(this,T,(i=t.gridId)!==null&&i!==void 0?i:null)}babelHelpers.createClass(e,[{key:"getGridId",value:function e(){return babelHelpers.classPrivateFieldGet(this,T)}},{key:"getFieldId",value:function e(){return babelHelpers.classPrivateFieldGet(this,u)}},{key:"getGrid",value:function e(){var t;var i=null;if(babelHelpers.classPrivateFieldGet(this,T)){i=BX.Main.gridManager.getById(babelHelpers.classPrivateFieldGet(this,T))}return(t=i)===null||t===void 0?void 0:t.instance}},{key:"getFieldNode",value:function e(){return document.getElementById(this.getFieldId())}},{key:"appendToFieldNode",value:function e(t){s.Dom.append(t,this.getFieldNode())}}]);return e}();var v;var g=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){s.Dom.addClass(this.getFieldNode(),"user-grid_user-photo");if(t.photoUrl){s.Dom.style(this.getFieldNode(),{"background-image":'url("'.concat(t.photoUrl,'")')})}else{var i=t.isInvited||!t.isConfirmed&&t.isInvited?"--person-clock":"--person";var n=s.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-icon-set ','" style="--ui-icon-set__icon-size: 35px; --ui-icon-set__icon-color: #fff;"></div>\n\t\t\t'])),i);s.Dom.append(n,this.getFieldNode())}}}]);return t}(p);var I,b,_,f,h,E;function N(e,t){L(e,t);t.add(e)}function L(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function m(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var A=new WeakSet;var C=new WeakSet;var R=new WeakSet;var S=new WeakSet;var O=new WeakSet;var y=new WeakSet;var B=new WeakSet;var H=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++){a[r]=arguments[r]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));N(babelHelpers.assertThisInitialized(i),B);N(babelHelpers.assertThisInitialized(i),y);N(babelHelpers.assertThisInitialized(i),O);N(babelHelpers.assertThisInitialized(i),S);N(babelHelpers.assertThisInitialized(i),R);N(babelHelpers.assertThisInitialized(i),C);N(babelHelpers.assertThisInitialized(i),A);return i}babelHelpers.createClass(t,[{key:"render",value:function e(t){var i=s.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="user-grid_full-name-container">',"</div>\n\t\t"])),m(this,A,w).call(this,t.fullName,t.profileLink));if(t.position){s.Dom.append(m(this,S,U).call(this,s.Text.encode(t.position)),i)}if(!t.isInvited&&t.isConfirmed){if(t.isIntegrator){s.Dom.append(m(this,O,D).call(this),i)}else if(t.isAdmin){s.Dom.append(m(this,y,F).call(this),i)}else if(t.isExtranet){s.Dom.append(m(this,B,X).call(this),i)}}else if(t.isInvited&&!t.isConfirmed){s.Dom.append(m(this,R,k).call(this),i)}else if(t.isInvited){s.Dom.append(m(this,C,M).call(this),i)}this.appendToFieldNode(i)}}]);return t}(p);function w(e,t){return s.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['<a class="user-grid_full-name-label" href="','">',"</a>"])),t,e)}function M(){var e=new t.Label({text:s.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INVITATION_NOT_ACCEPTED"),color:t.LabelColor.LIGHT_BLUE,fill:true,size:t.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function k(){var e=new t.Label({text:s.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_NOT_CONFIRMED"),color:t.LabelColor.YELLOW,fill:true,size:t.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function U(e){return s.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['<div class="user-grid_position-label">',"</div>"])),e)}function D(){return s.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --integrator">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),s.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INTEGRATOR"))}function F(){return s.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --admin">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),s.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADMIN"))}function X(){return s.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="user-grid_role-label --extranet">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),s.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_EXTRANET"))}var P,z;var x=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){var i=s.Text.getRandom(6);var n=s.Text.getRandom(6);this.appendToFieldNode(s.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['<span id="','"></span>'])),i));this.appendToFieldNode(s.Tag.render(z||(z=babelHelpers.taggedTemplateLiteral(['<span class="user-grid_full-name-wrapper" id="','"></span>'])),n));new g({fieldId:i}).render(t);new H({fieldId:n}).render(t);s.Dom.addClass(this.getFieldNode(),"user-grid_employee-card-container")}}]);return t}(p);function W(e,t,i){G(e,t);t.set(e,i)}function G(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var V=new WeakMap;var j=function(){function e(t){var i;babelHelpers.classCallCheck(this,e);W(this,V,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,V,(i=BX.Main.gridManager.getById(t))===null||i===void 0?void 0:i.instance)}babelHelpers.createClass(e,[{key:"getGrid",value:function e(){return babelHelpers.classPrivateFieldGet(this,V)}},{key:"confirmAction",value:function e(t){var i=this;if(t.userId){this.confirmUser(t.isAccept?"confirm":"decline",(function(){var e=babelHelpers.classPrivateFieldGet(i,V).getRows().getById(t.userId);e===null||e===void 0?void 0:e.stateLoad();BX.ajax.runAction("intranet.controller.invite.confirmUserRequest",{data:{userId:t.userId,isAccept:t.isAccept?"Y":"N"}}).then((function(t){e===null||e===void 0?void 0:e.update()}))["catch"]((function(n){e===null||e===void 0?void 0:e.stateUnload();if(!t.isAccept){i.activityAction({userId:t.userId,action:"deactivateInvited"})}}))}))}}},{key:"activityAction",value:function e(t){var i,n,a=this;var r=(i=t.userId)!==null&&i!==void 0?i:null;var s=(n=t.action)!==null&&n!==void 0?n:null;if(r){this.confirmUser(s,(function(){var e=babelHelpers.classPrivateFieldGet(a,V).getRows().getById(t.userId);e===null||e===void 0?void 0:e.stateLoad();BX.ajax.runComponentAction("bitrix:intranet.user.list","setActivity",{mode:"class",data:{params:{userId:r,action:s}}}).then((function(){e===null||e===void 0?void 0:e.update()}))["catch"]((function(t){e===null||e===void 0?void 0:e.stateUnload();if(BX.type.isNotEmptyObject(t)&&BX.type.isArray(t.errors)&&s==="delete"){return a.activityAction({action:"deactivateInvited",userId:r})}}))}))}}},{key:"confirmUser",value:function e(t,n){var a,r;i.MessageBox.show({title:(a=this.getConfirmTitle(t))!==null&&a!==void 0?a:"",message:(r=this.getConfirmMessage(t))!==null&&r!==void 0?r:"",buttons:i.MessageBoxButtons.YES_CANCEL,yesCaption:this.getConfirmButtonText(t),onYes:function e(t){n();t.close()}})}},{key:"getConfirmTitle",value:function e(t){switch(t){case"restore":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_TITLE");case"confirm":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_TITLE");case"delete":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_TITLE");case"deactivate":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_TITLE");case"deactivateInvited":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_TITLE");case"decline":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_TITLE");default:return""}}},{key:"getConfirmMessage",value:function e(t){switch(t){case"restore":case"confirm":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_MESSAGE");case"delete":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_MESSAGE");case"deactivate":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_MESSAGE");case"deactivateInvited":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_MESSAGE");case"decline":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_MESSAGE");default:return""}}},{key:"getConfirmButtonText",value:function e(t){switch(t){case"restore":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_BUTTON");case"confirm":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_BUTTON");case"delete":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_BUTTON");case"deactivate":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_BUTTON");case"deactivateInvited":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON");case"decline":return s.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_BUTTON");default:return null}}}],[{key:"getInstance",value:function t(i){if(!this.instances[i]){this.instances[i]=new e(i)}return this.instances[i]}},{key:"setSort",value:function e(t){var i;var n=(i=BX.Main.gridManager.getById(t.gridId))===null||i===void 0?void 0:i.instance;if(s.Type.isObject(n)){n.tableFade();n.getUserOptions().setSort(t.sortBy,t.order,(function(){n.reload()}))}}},{key:"setFilter",value:function e(t){var i;var n=(i=BX.Main.gridManager.getById(t.gridId))===null||i===void 0?void 0:i.instance;var a=BX.Main.filterManager.getById(t.gridId);if(s.Type.isObject(n)&&s.Type.isObject(a)){a.getApi().extendFilter(t.filter)}}},{key:"reinviteCloudAction",value:function e(t){return BX.ajax.runAction("intranet.invite.reinviteWithChangeContact",{data:t}).then((function(e){if(e.data.result){var t=new BX.PopupWindow({content:"<p>".concat(s.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS"),"</p>"),autoHide:true});t.show()}return e}),(function(e){var t=e.errors.map((function(e){return e.message}));n.ErrorCollection.showSystemError(t.join("<br>"));return e}))}},{key:"reinviteAction",value:function e(t,i){return BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:t,extranet:i?"Y":"N"}}}).then((function(e){if(e.data.result){var t=new BX.PopupWindow({content:"<p>".concat(s.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS"),"</p>"),autoHide:true});t.show()}return e}))}}]);return e}();babelHelpers.defineProperty(j,"instances",[]);var J;function Y(e,t){q(e,t);t.add(e)}function q(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function K(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Q=new WeakSet;var Z=new WeakSet;var $=new WeakSet;var ee=new WeakSet;var te=new WeakSet;var ie=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++){a[r]=arguments[r]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(a)));Y(babelHelpers.assertThisInitialized(i),te);Y(babelHelpers.assertThisInitialized(i),ee);Y(babelHelpers.assertThisInitialized(i),$);Y(babelHelpers.assertThisInitialized(i),Z);Y(babelHelpers.assertThisInitialized(i),Q);return i}babelHelpers.createClass(t,[{key:"render",value:function e(t){var i,n=this;var a="";var r="";switch((i=t.action)!==null&&i!==void 0?i:"invite"){case"accept":a=s.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_ACCEPT_ENTER");r=BX.UI.Button.Color.PRIMARY;break;case"invite":default:a=s.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_INVITE_AGAIN");r=BX.UI.Button.Color.LIGHT_BORDER;break}var l=s.Tag.render(J||(J=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-counter user-grid_invitation-counter">\n\t\t\t\t<div class="ui-counter-inner">1</div>\n\t\t\t</div>\n\t\t'])));s.Dom.append(l,this.getFieldNode());var o=new BX.UI.Button({text:a,color:r,noCaps:true,size:BX.UI.Button.Size.EXTRA_SMALL,tag:BX.UI.Button.Tag.INPUT,round:true,onclick:function e(){K(n,Z,ae).call(n,t,o)}});o.renderTo(this.getFieldNode())}}]);return t}(p);function ne(e){var t;var i=(t=j.getInstance(this.gridId).getGrid())===null||t===void 0?void 0:t.getRows().getById(this.userId);i===null||i===void 0?void 0:i.stateLoad();j.reinviteCloudAction(e).then((function(e){i===null||i===void 0?void 0:i.update();i===null||i===void 0?void 0:i.stateUnload()}))}function ae(e,t){if(!e.enabled){var i=BX.PopupWindowManager.create("intranet-user-grid-invitation-disabled",null,{darkMode:true,content:s.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_DISABLED"),closeByEsc:true,angle:true,offsetLeft:40,maxWidth:300,overlay:false,autoHide:true});i.setBindElement(t.getContainer());i.show()}else{K(this,$,re).call(this,e.action).call(this,e,t)}}function re(e){switch(e){case"accept":return K(this,te,le);break;case"invite":return K(this,ee,se);default:return K(this,ee,se);break}}function se(e,t){if(e.isCloud===true){var i,n;var a=new r.ReinvitePopup({userId:e.userId,transport:K(this,Q,ne).bind(e),formType:e.email?r.FormType.EMAIL:r.FormType.PHONE,bindElement:t.getContainer(),inputValue:(i=(n=e.email)!==null&&n!==void 0?n:e.phoneNumber)!==null&&i!==void 0?i:""});a.getPopup().setBindElement(t.getContainer());a.show()}else{t.setWaiting(true);j.reinviteAction(e.userId,e.isExtranet).then((function(){t.setWaiting(false)}))}}function le(e,t){j.getInstance(e.gridId).confirmAction({isAccept:true,userId:e.userId})}var oe,de,ce;var ue=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(t){var i=this;s.Dom.addClass(this.getFieldNode(),"user-grid_department-container");if(t.departments.length===0&&t.canEdit){return;var n=function e(){var t=new o.Dialog({width:300,height:300,targetNode:a,compactView:true,multiple:false,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});t.show()};var a=s.Tag.render(oe||(oe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="user-grid_department-btn" onclick="','">\n\t\t\t\t\t<div class="user-grid_department-icon-container">\n\t\t\t\t\t\t<div class="ui-icon-set --plus-30" style="--ui-icon-set__icon-size: 18px; --ui-icon-set__icon-color: #2fc6f6;"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="user-grid_department-name-container">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),n,s.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADD_DEPARTMENT"));this.appendToFieldNode(a)}else{Object.values(t.departments).forEach((function(e){var n=e.id===t.selectedDepartment;var a=function t(){j.setFilter({gridId:i.getGridId(),filter:{DEPARTMENT:n?"":e.id,DEPARTMENT_label:n?"":e.name}})};var r=s.Tag.render(de||(de=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="user-grid_department-btn ','"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class="user-grid_department-name-container">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),n?"--selected":"",a,e.name);if(n){s.Dom.append(s.Tag.render(ce||(ce=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<div class="user-grid_department-btn-remove ui-icon-set --cross-60"></div>\n\t\t\t\t\t']))),r)}i.appendToFieldNode(r)}))}}}]);return t}(p);e.BaseField=p;e.PhotoField=g;e.FullNameField=H;e.EmployeeField=x;e.ActivityField=ie;e.DepartmentField=ue;e.GridManager=j})(this.BX.Intranet.UserList=this.BX.Intranet.UserList||{},BX.UI,BX.UI.Dialogs,BX.UI.FormElements,BX.UI,BX.Intranet.Reinvite,BX,BX,BX.UI.EntitySelector);
//# sourceMappingURL=grid.bundle.map.js