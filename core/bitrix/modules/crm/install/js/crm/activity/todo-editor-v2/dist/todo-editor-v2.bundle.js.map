{"version":3,"file":"todo-editor-v2.bundle.js","sources":["../src/analytics.js","../src/components/block/address/input-popup.js","../src/components/block/address/address.js","../src/components/block/calendar/location-selector.js","../src/components/block/calendar/calendar.js","../src/components/block/client.js","../src/components/block/file/file.js","../src/components/block/link/input-popup.js","../src/components/block/link/link.js","../src/components/block-factory.js","../src/components/color-selector/todo-editor-color-selector.js","../src/components/todo-editor-ping-selector.js","../src/components/todo-editor-responsible-user-selector.js","../src/components/todo-editor.js","../src/actions-popup.js","../src/enums/border-color.js","../src/todo-editor.js"],"sourcesContent":["import { Extension, Type } from 'main.core';\nimport type { SettingsCollection } from 'main.core.collections';\nimport type { AnalyticsOptions } from 'ui.analytics';\nimport { sendData as sendAnalyticsData } from 'ui.analytics';\n\nexport const EventIds = Object.freeze({\n\tactivityTouch: 'activity_touch',\n\tactivityAdd: 'activity_add',\n\tactivityComplete: 'activity_complete',\n});\n\ntype EventIdsType = EventIds.activityTouch | EventIds.activityAdd | EventIds.activityComplete;\n\nexport const Section = Object.freeze({\n\tlead: 'lead_section',\n\tdeal: 'deal_section',\n\tquote: 'quote_section',\n\tcontact: 'contact_section',\n\tcompany: 'company_section',\n\tdynamic: 'dynamic_section',\n\tsmartInvoice: 'smart_invoice',\n\tcustom: 'custom_section',\n\tmyCompany: 'my_company_section',\n\tsmartDocument: 'smart_document_contact_section',\n\tcatalogContact: 'catalog_contractor_contact_section',\n\tcatalogCompany: 'catalog_contractor_company_section',\n});\n\nexport type SectionIdType = Section.lead | Section.deal | Section.contact\n\t| Section.company | Section.dynamic | Section.custom\n\t| Section.myCompany | Section.smartDocument | Section.catalogContact\n\t| Section.catalogCompany\n;\n\nexport const SubSection = Object.freeze({\n\tlist: 'list',\n\tkanban: 'kanban',\n\tactivities: 'activities',\n\tdeadlines: 'deadlines',\n\tdetails: 'details',\n\tnotificationPopup: 'notification_popup',\n\tkanbanDropzone: 'kanban_dropzone',\n});\n\nexport type SubSectionIdType = SubSection.list | SubSection.kanban | SubSection.activities\n\t| SubSection.deadlines | SubSection.details | SubSection.notificationPopup\n;\n\nexport const CrmMode = Object.freeze({\n\tsimple: 'crmMode_simple',\n\tclassic: 'crmMode_classic',\n});\n\nexport type CrmModeIdType = CrmMode.simple | CrmMode.classic;\n\nexport const ElementIds = Object.freeze({\n\tcolorSettings: 'color_settings',\n\tdescription: 'description',\n\ttitle: 'title',\n\tresponsibleUserId: 'responsible_user_id',\n\tdeadline: 'deadline',\n\tpingSettings: 'ping_settings',\n\taddBlock: 'add_block',\n\tcreateButton: 'create_button',\n\tcancelButton: 'cancel_button',\n\tskipPeriodButton: 'skip_period_button',\n\tautoFromActivityViewMode: 'auto_from_activity_view_mode',\n\tcomplexButton: 'complete_button',\n\tcheckbox: 'checkbox',\n});\n\nexport type ElementIdsType = ElementIds.colorSettings | ElementIds.description | ElementIds.title | ElementIds.responsibleUserId\n\t| ElementIds.deadlines | ElementIds.pingSettings | ElementIds.addBlock | ElementIds.createButton | ElementIds.cancelButton\n\t| ElementIds.skipPeriodButton | ElementIds.autoFromActivityViewMode | ElementIds.complexButton | ElementIds.checkbox\n;\n\nexport type AnalyticParams = {\n\tevent: EventIdsType;\n\tsection: SectionIdType;\n\tsubSection: SubSectionIdType;\n\telement: ElementIdsType;\n\n\tcrmMode: string;\n\tpingSettings?: string;\n\tcolorId?: string;\n\tblockTypes?: string;\n\tnotificationSkipPeriod?: string;\n};\n\nexport type ToDoEditorData = {\n\tanalyticSection?: string;\n\tanalyticSubSection: string;\n}\n\nexport class Analytics\n{\n\t#tool: string = 'crm';\n\t#category: string = 'activity_operations';\n\t#event: EventIdsType;\n\t#type: string = 'todo_activity';\n\t#section: SectionIdType;\n\t#subSection: SubSectionIdType;\n\t#element: ElementIdsType;\n\n\t#crmMode: string;\n\t#pingSettings: string;\n\t#colorId: string;\n\t#blockTypes: string;\n\t#notificationSkipPeriod: string;\n\n\t#extensionSettings: ?SettingsCollection = null;\n\n\tstatic createFromToDoEditorData(data: ToDoEditorData): Analytics\n\t{\n\t\tconst { analyticSection: section, analyticSubSection: subSection } = data;\n\n\t\treturn new Analytics(section, subSection);\n\t}\n\n\tconstructor(section: SectionIdType, subSection: SubSectionIdType)\n\t{\n\t\tthis.#extensionSettings = Extension.getSettings('crm.activity.todo-editor-v2');\n\n\t\tthis.#section = section;\n\t\tthis.#subSection = subSection;\n\t\tthis.#crmMode = this.#getCrmMode();\n\t}\n\n\t#getCrmMode(): string\n\t{\n\t\treturn `crmMode_${this.#extensionSettings.get('crmMode', '').toLowerCase()}`;\n\t}\n\n\tsetEvent(event: EventIdsType): Analytics\n\t{\n\t\tthis.#event = event;\n\n\t\treturn this;\n\t}\n\n\tsetSubSection(subSection: SubSectionIdType): Analytics\n\t{\n\t\tthis.#subSection = subSection;\n\n\t\treturn this;\n\t}\n\n\tsetPingSettings(pingSettings: ?string): Analytics\n\t{\n\t\tthis.#pingSettings = pingSettings;\n\n\t\treturn this;\n\t}\n\n\tsetColorId(colorId: ?string): Analytics\n\t{\n\t\tthis.#colorId = colorId;\n\n\t\treturn this;\n\t}\n\n\tsetBlockTypes(blockTypes: ?string[]): Analytics\n\t{\n\t\tthis.#blockTypes = blockTypes;\n\n\t\treturn this;\n\t}\n\n\tsetNotificationSkipPeriod(notificationSkipPeriod: ?string): Analytics\n\t{\n\t\tthis.#notificationSkipPeriod = notificationSkipPeriod;\n\n\t\treturn this;\n\t}\n\n\tsetElement(element: ElementIdsType): Analytics\n\t{\n\t\tthis.#element = element;\n\n\t\treturn this;\n\t}\n\n\tsend(): void\n\t{\n\t\tconst data = this.getData();\n\t\tif (this.#validate(data))\n\t\t{\n\t\t\tsendAnalyticsData(data);\n\t\t}\n\t}\n\n\tgetData(): AnalyticsOptions\n\t{\n\t\tconst data = {\n\t\t\ttool: this.#tool,\n\t\t\tcategory: this.#category,\n\t\t\tevent: this.#event,\n\t\t\ttype: this.#type,\n\t\t\tc_section: this.#section,\n\t\t\tc_sub_section: this.#subSection,\n\t\t\tc_element: this.#element,\n\t\t\tp1: this.#crmMode,\n\t\t};\n\n\t\tif (Type.isStringFilled(this.#pingSettings))\n\t\t{\n\t\t\tdata.p2 = 'ping_custom';\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#colorId))\n\t\t{\n\t\t\tdata.p3 = 'color_custom';\n\t\t}\n\n\t\tif (Type.isArrayFilled(this.#blockTypes))\n\t\t{\n\t\t\tdata.p4 = 'addBlock';\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#notificationSkipPeriod))\n\t\t{\n\t\t\tif (this.#notificationSkipPeriod === 'forever')\n\t\t\t{\n\t\t\t\tdata.p5 = 'skipPeriod_custom';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdata.p5 = 'skipPeriod_forever';\n\t\t\t}\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t#validate(data: AnalyticsOptions): boolean\n\t{\n\t\tlet isValid = true;\n\t\tObject.keys(data).forEach((key) => {\n\t\t\tif (Type.isNil(data[key]))\n\t\t\t{\n\t\t\t\tisValid = false;\n\t\t\t}\n\t\t});\n\n\t\treturn isValid;\n\t}\n}\n","import { Address, ControlMode } from 'location.core';\nimport { Factory } from 'location.widget';\nimport { Tag, Text, Type } from 'main.core';\nimport { Popup } from 'main.popup';\n\nexport class InputPopup\n{\n\t#popup: Popup = null;\n\t#bindElement: HTMLElement = null;\n\t#title: string = null;\n\t#buttonTitle: string = null;\n\t#onSubmit: Function = null;\n\t#address: Object = null;\n\t#addressFormatted: string = '';\n\t#addressWidget: Object = null;\n\t#searchInput: HTMLElement = null;\n\t#detailsContainer: HTMLElement = null;\n\t#addressContainer: HTMLElement = null;\n\n\tconstructor(params: Object)\n\t{\n\t\tthis.#bindElement = params.bindElement;\n\t\tthis.#title = params.title;\n\t\tthis.#buttonTitle = params.buttonTitle || 'OK';\n\t\tthis.#address = Type.isStringFilled(params.addressJson) ? new Address(JSON.parse(params.addressJson)) : null;\n\t\tthis.#addressFormatted = Type.isStringFilled(params.addressFormatted) ? params.addressFormatted : null;\n\n\t\tthis.#onSubmit = params.onSubmit;\n\t\tthis.onClickHandler = this.onClickHandler.bind(this);\n\t\tthis.onKeyUpHandler = this.onKeyUpHandler.bind(this);\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup().show();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#searchInput.focus();\n\t\t});\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tthis.#popup.destroy();\n\t\t}\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\tid: `crm-todo-address-input-popup-${Text.getRandom()}`,\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tdraggable: false,\n\t\t\t\twidth: 466,\n\t\t\t\tpadding: 0,\n\t\t\t\tevents: {\n\t\t\t\t\tonFirstShow: () => {\n\t\t\t\t\t\tthis.initAddress();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tthis.#searchInput = Tag.render`\n\t\t\t<input \n\t\t\t\ttype=\"text\" \n\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox crm-activity__todo-editor-v2_block-popup-address-input-container\" \n\t\t\t\tvalue=\"${this.#addressFormatted}\" \n\t\t\t>\n\t\t`;\n\t\tthis.#detailsContainer = Tag.render`<div class=\"location-fields-control-block\"></div>`;\n\t\tthis.#addressContainer = Tag.render`<div></div>`;\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-wrapper --address\">\n\t\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-title\">\n\t\t\t\t\t\t${Text.encode(this.#title)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-content\">\n\t\t\t\t\t\t${this.#searchInput}\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tonclick=\"${this.onClickHandler}\" \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Text.encode(this.#buttonTitle)}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#detailsContainer}\n\t\t\t\t\t${this.#addressContainer}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tinitAddress()\n\t{\n\t\tconst widgetFactory = new Factory();\n\n\t\tthis.#addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: this.#address,\n\t\t\tmode: ControlMode.edit,\n\t\t});\n\n\t\tthis.#addressWidget.subscribeOnAddressChangedEvent((event) => {\n\t\t\tconst data = event.getData();\n\n\t\t\tthis.#address = Type.isObject(data.address) ? data.address : null;\n\t\t});\n\n\t\tconst addressWidgetParams = {\n\t\t\tmode: ControlMode.edit,\n\t\t\tinputNode: this.#searchInput,\n\t\t\tmapBindElement: this.#searchInput,\n\t\t\tfieldsContainer: this.#detailsContainer,\n\t\t\tcontrolWrapper: this.#addressContainer,\n\t\t};\n\n\t\tthis.#addressWidget.render(addressWidgetParams);\n\t\tthis.#setFocus();\n\t}\n\n\t#setFocus(): void\n\t{\n\t\tthis.#searchInput.focus();\n\t}\n\n\tonClickHandler(): void\n\t{\n\t\tthis.#getPopup().close();\n\t\tthis.#onSubmit(this.#address);\n\t}\n\n\tonKeyUpHandler(event): void\n\t{\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tthis.onClickHandler();\n\t\t}\n\t}\n}\n","import { Address, Format } from 'location.core';\nimport { Loc, Text, Type } from 'main.core';\nimport { InputPopup } from './input-popup';\n\nexport const TodoEditorBlocksAddress = {\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst data = {\n\t\t\taddress: null,\n\t\t\taddressFormatted: null,\n\t\t\taddressJson: null,\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted(): void\n\t{\n\t\tif (this.isFocused)\n\t\t{\n\t\t\tvoid this.$nextTick(this.onShowAddressPopup);\n\t\t}\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.inputPopup?.destroy();\n\t},\n\n\tmethods: {\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'address';\n\t\t},\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tthis.format = new Format(JSON.parse(Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_FORMAT')));\n\n\t\t\tconst { filledValues, format } = this;\n\t\t\tlet addressInstance = null;\n\n\t\t\tif (Type.isStringFilled(filledValues?.addressFormatted))\n\t\t\t{\n\t\t\t\taddressInstance = new Address({\n\t\t\t\t\tlanguageId: format.languageId,\n\t\t\t\t});\n\n\t\t\t\taddressInstance.setFieldValue(format.fieldForUnRecognized, filledValues.addressFormatted);\n\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.address = addressInstance;\n\t\t\t\tdata.addressFormatted = addressInstance?.toString(format).replaceAll('<br />', ', ');;\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(filledValues?.addressJson))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.addressJson = filledValues.addressJson;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.addressJson = addressInstance?.toJson();\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\tconst { addressFormatted, addressJson } = this;\n\n\t\t\treturn {\n\t\t\t\taddressFormatted,\n\t\t\t\taddress: addressJson,\n\t\t\t};\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { addressFormatted, addressJson } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\taddressFormatted,\n\t\t\t\taddressJson,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t\tonShowAddressPopup(): void\n\t\t{\n\t\t\tif (Type.isNil(this.inputPopup))\n\t\t\t{\n\t\t\t\tthis.inputPopup = new InputPopup({\n\t\t\t\t\tbindElement: this.$refs.address,\n\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_BLOCK_POPUP_TITLE'),\n\t\t\t\t\taddressFormatted: this.addressFormatted ?? '',\n\t\t\t\t\taddressJson: this.addressJson ?? '',\n\t\t\t\t\tformat: this.format,\n\t\t\t\t\tonSubmit: (value: string) => {\n\t\t\t\t\t\tthis.setAddress(value);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.inputPopup.show();\n\t\t},\n\t\tsetAddress(address: Address): void\n\t\t{\n\t\t\tthis.address = address;\n\n\t\t\tif (Type.isObject(address))\n\t\t\t{\n\t\t\t\tthis.addressJson = address.toJson();\n\t\t\t\tthis.addressFormatted = address.toString(this.format).replaceAll('<br />', ', ');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.addressJson = '';\n\t\t\t\tthis.addressFormatted = '';\n\t\t\t}\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tactionTitle(): string\n\t\t{\n\t\t\treturn this.hasAddress ? this.changeTitle : this.addTitle;\n\t\t},\n\t\tchangeTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\taddTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_BLOCK_ADD_ACTION');\n\t\t},\n\t\thasAddress(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.addressFormatted);\n\t\t},\n\t\tpreparedAddress(): string\n\t\t{\n\t\t\treturn Type.isStringFilled(this.addressFormatted) ? this.addressFormatted : '';\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'address',\n\t\t\tthis.emitUpdateFilledValues,\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\n\t\tthis.$watch('addressFormatted', this.emitUpdateFilledValues);\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_block-header --address\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span \n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-data\"\n\t\t\t\tv-html=\"preparedAddress\"\n\t\t\t>\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\t@click=\"onShowAddressPopup\"\n\t\t\t\tref=\"address\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ actionTitle }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t`,\n};\n","import { ajax as Ajax, Extension, Type } from 'main.core';\nimport { Dialog } from 'ui.entity-selector';\nimport { FeaturePromotersRegistry } from 'ui.info-helper';\n\nconst DEFAULT_TAB_ID = 'location';\n\nexport const LocationSelector = {\n\tprops: {\n\t\tlocationId: {\n\t\t\ttype: Number,\n\t\t},\n\t\tforceShowLocationSelectorDialog: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'change',\n\t\t'close',\n\t],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tlocations: null,\n\t\t};\n\t},\n\n\tasync mounted()\n\t{\n\t\tthis.locations = await this.fetchRoomsManagerData();\n\n\t\tif (this.forceShowLocationSelectorDialog)\n\t\t{\n\t\t\tthis.showLocationSelectorDialog();\n\t\t}\n\t},\n\n\tmethods: {\n\t\tshowLocationSelectorDialog(): void\n\t\t{\n\t\t\tif (!this.isLocationFeatureEnabled())\n\t\t\t{\n\t\t\t\tFeaturePromotersRegistry.getPromoter({ featureId: 'calendar_location' }).show();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.getLocationSelectorDialog()?.show();\n\t\t\t}, 5);\n\t\t},\n\t\tisLocationFeatureEnabled(): boolean\n\t\t{\n\t\t\treturn Extension.getSettings('crm.activity.todo-editor-v2').get('locationFeatureEnabled');\n\t\t},\n\t\tgetLocationSelectorDialog(): ?Dialog\n\t\t{\n\t\t\tif (this.locations === null)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (Type.isNil(this.locationSelectorDialog))\n\t\t\t{\n\t\t\t\tconst tabs = [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: DEFAULT_TAB_ID,\n\t\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_ROOMS_ENTITY_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t];\n\n\t\t\t\tconst items = [];\n\n\t\t\t\tthis.locations.rooms?.forEach((room) => {\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tid: room.ID,\n\t\t\t\t\t\ttitle: room.NAME,\n\t\t\t\t\t\tsubtitle: this.getCapacityTitle(room.CAPACITY ?? null),\n\t\t\t\t\t\tentityId: DEFAULT_TAB_ID,\n\t\t\t\t\t\ttabs: DEFAULT_TAB_ID,\n\t\t\t\t\t\tavatarOptions: {\n\t\t\t\t\t\t\tbgColor: room.COLOR,\n\t\t\t\t\t\t\tbgSize: '22px',\n\t\t\t\t\t\t\tbgImage: 'none',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcustomData: {\n\t\t\t\t\t\t\tlocationId: room.LOCATION_ID,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.locationSelectorDialog = new Dialog({\n\t\t\t\t\tid: 'todo-editor-calendar-room-selector-dialog',\n\t\t\t\t\ttargetNode: this.$refs.locationSelector,\n\t\t\t\t\tcontext: 'CRM_ACTIVITY_TODO_CALENDAR_ROOM',\n\t\t\t\t\tmultiple: false,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: true,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 450,\n\t\t\t\t\theight: 300,\n\t\t\t\t\tzIndex: 2500,\n\t\t\t\t\titems,\n\t\t\t\t\ttabs,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': this.onSelectLocation,\n\t\t\t\t\t\t'Item:onDeselect': this.onDeselectLocation,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.locationSelectorDialog;\n\t\t},\n\t\tgetCapacityTitle(value: ?number): string\n\t\t{\n\t\t\tif (Type.isNil(value) || value <= 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage(\n\t\t\t\t'CRM_ACTIVITY_TODO_CALENDAR_BLOCK_ROOMS_CAPACITY',\n\t\t\t\t{ '#CAPACITY_VALUE#': value },\n\t\t\t);\n\t\t},\n\t\tasync fetchRoomsManagerData(): Object\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tAjax\n\t\t\t\t\t.runAction('calendar.api.locationajax.getRoomsManagerData')\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((errors) => {\n\t\t\t\t\t\tconsole.log(errors);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t},\n\t\tonSelectLocation({ data }): void\n\t\t{\n\t\t\tthis.emitChangeEvent('select', data.item);\n\t\t},\n\t\tonDeselectLocation({ data }): void\n\t\t{\n\t\t\tthis.emitChangeEvent('deselect', data.item);\n\t\t},\n\t\temitChangeEvent(action: string, item: ?Object = null): void\n\t\t{\n\t\t\tthis.$emit('change', {\n\t\t\t\taction,\n\t\t\t\tid: Number(item?.id),\n\t\t\t});\n\t\t},\n\t\tgetLocationById(id: number): ?Object\n\t\t{\n\t\t\treturn (this.locations.rooms.find((location) => Number(location.ID) === id) ?? null);\n\t\t},\n\t},\n\tcomputed: {\n\t\tblockTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_ROOMS_TITLE');\n\t\t},\n\t\tlocationsListTitle(): string\n\t\t{\n\t\t\tif (Type.isNil(this.locationId))\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_ROOMS_LIST');\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CLIENT_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\tselectedLocationTitle(): string\n\t\t{\n\t\t\tconst location = this.getLocationById(this.locationId);\n\t\t\tif (!location)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn location.NAME;\n\t\t},\n\t\thasSelectedLocation(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.locationId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"locations\" class=\"crm-activity__todo-editor-v2_block-header\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon --calendar-room\"\n\t\t\t></span>\n\t\t\t<span>\n\t\t\t\t{{ blockTitle }}\n\t\t\t</span>\n\t\t\t<span \n\t\t\t\tv-if=\"hasSelectedLocation\" \n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-data\"\n\t\t\t>\n\t\t\t\t{{ selectedLocationTitle }}\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tref=\"locationSelector\"\n\t\t\t\t@click=\"showLocationSelectorDialog\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ locationsListTitle }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close')\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t\t<div v-else class=\"crm-activity__todo-editor-v2_block-header --skeleton\"></div>\n\t`,\n};\n","import { Planner } from 'calendar.planner';\nimport 'ui.design-tokens';\nimport { ajax as Ajax, Text, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { DateTimeFormat, Timezone } from 'main.date';\nimport { Dialog } from 'ui.entity-selector';\nimport type { BlockSettings } from '../../../todo-editor';\nimport { Events } from '../../todo-editor';\nimport { LocationSelector } from './location-selector';\n\nexport const TodoEditorBlocksCalendar = {\n\tcomponents: {\n\t\tLocationSelector,\n\t},\n\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst ownerId = this.settings.ownerId || this.context.ownerId;\n\n\t\tconst selectedUserIds: Set<number> = new Set();\n\t\tselectedUserIds.add(ownerId);\n\n\t\tconst timestamp = (this.settings.from || Timezone.UserTime.getTimestamp()) * 1000;\n\t\tconst millisecondsInFiveMinutes = 5 * 60 * 1000;\n\n\t\t// round timestamp to 5 minutes\n\t\tconst from = Math.ceil(timestamp / millisecondsInFiveMinutes) * millisecondsInFiveMinutes;\n\n\t\tconst duration = Number(this.settings.duration ?? 60 * 60) * 1000;\n\t\tconst to = from + duration;\n\n\t\tconst data = {\n\t\t\tselectedUserIds,\n\t\t\tfrom,\n\t\t\tto,\n\t\t\tduration,\n\t\t\tplannerInstance: null,\n\t\t\tshowLocation: this.settings.showLocation ?? false,\n\t\t\tlocationId: null,\n\t\t\ttimezoneName: this.settings.timezoneName,\n\t\t\townerId,\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_DEADLINE_CHANGE, this.onDeadlineChange);\n\n\t\tthis.showPlanner();\n\n\t\tthis.getPlanner().selector.subscribe('onChange', this.handlePlannerSelectorChanges.bind(this));\n\n\t\tconst userIds = this.selectedUsersIdsArray;\n\t\tconst data = this.prepareUpdatePlannerData(userIds);\n\t\tthis.updatePlanner(userIds, data);\n\n\t\tif (this.settings.showUserSelector && this.isFocused)\n\t\t{\n\t\t\tthis.showUserSelectorDialog();\n\t\t}\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tthis.$Bitrix.eventEmitter.unsubscribe(Events.EVENT_DEADLINE_CHANGE, this.onDeadlineChange);\n\t},\n\n\tmethods: {\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tconst { filledValues } = this;\n\n\t\t\tif (Type.isObject(filledValues))\n\t\t\t{\n\t\t\t\tif (Type.isObject(filledValues.attendeesEntityList))\n\t\t\t\t{\n\t\t\t\t\tObject\n\t\t\t\t\t\t.values(filledValues.attendeesEntityList)\n\t\t\t\t\t\t.filter(({ entityId }) => entityId === 'user')\n\t\t\t\t\t\t.forEach(({ id }) => data.selectedUserIds.add(id))\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isStringFilled(filledValues.location))\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tdata.showLocation = true;\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tdata.locationId = Number(filledValues.location.split('_')[1]); //calendar_7_123, need 7 as id\n\t\t\t\t}\n\n\t\t\t\tif (Type.isObject(filledValues.selectedUserIds))\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tdata.selectedUserIds = filledValues.selectedUserIds;\n\t\t\t\t}\n\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.from = Number(filledValues.from);\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.to = Number(filledValues.to);\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.duration = Number(filledValues.duration);\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.timezoneName = filledValues.timezoneFrom;\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.ownerId = filledValues.ownerId;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'calendar';\n\t\t},\n\t\tshowPlanner(): void\n\t\t{\n\t\t\tthis.getPlanner().show();\n\t\t},\n\t\tgetPlanner(): Planner\n\t\t{\n\t\t\tif (this.plannerInstance === null)\n\t\t\t{\n\t\t\t\tthis.plannerInstance = new Planner({\n\t\t\t\t\twrap: this.$refs.plannerContainer,\n\t\t\t\t\tcompactMode: false,\n\t\t\t\t\tshowEntryName: false,\n\t\t\t\t\tminWidth: 770,\n\t\t\t\t\tminHeight: 104,\n\t\t\t\t\theight: 104,\n\t\t\t\t\twidth: 770,\n\t\t\t\t\tentryTimezone: this.timezoneName,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.plannerInstance;\n\t\t},\n\t\tprepareUpdatePlannerData(newUserIds: number[], oldUserIds: number[] = []): Object\n\t\t{\n\t\t\tconst location = (this.locationId ? this.location : '');\n\n\t\t\tconst data = {\n\t\t\t\townerId: this.ownerId,\n\t\t\t\ttype: 'user',\n\t\t\t\tentityList: [],\n\t\t\t\tdateFrom: this.getFormattedDate('beforeOneWeek'),\n\t\t\t\tdateTo: this.getFormattedDate('afterTwoWeeks'),\n\t\t\t\ttimezone: this.timezoneName,\n\t\t\t\tlocation,\n\t\t\t\tentries: false,\n\t\t\t\tprevUserList: oldUserIds,\n\t\t\t\tskipFeatureCheck: 'Y',\n\t\t\t};\n\n\t\t\tnewUserIds.forEach((userId) => {\n\t\t\t\tdata.entityList.push({\n\t\t\t\t\tentityId: 'user',\n\t\t\t\t\tid: userId,\n\t\t\t\t\tentityType: 'employee',\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\t\tupdatePlanner(userIds: number[], data: Object): void\n\t\t{\n\t\t\tthis.getPlanner().showLoader();\n\n\t\t\tAjax\n\t\t\t\t.runAction('calendar.api.calendarajax.updatePlanner', { data })\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst accessibility = {};\n\t\t\t\t\t\tuserIds.forEach((userId) => {\n\t\t\t\t\t\t\tif (response.data.accessibility[userId])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\taccessibility[userId] = response.data.accessibility[userId];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\taccessibility[userId] = [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (this.locationId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst roomId = `room_${this.locationId}`;\n\t\t\t\t\t\t\taccessibility[roomId] = response.data.accessibility[roomId];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.getPlanner().hideLoader();\n\t\t\t\t\t\tthis.getPlanner().update(response.data.entries, accessibility);\n\n\t\t\t\t\t\tthis.onDataUpdate();\n\n\t\t\t\t\t\t// @todo check this\n\t\t\t\t\t\t// this.plannerInstance.updateSelector(\n\t\t\t\t\t\t// \tUtil.adjustDateForTimezoneOffset(\n\t\t\t\t\t\t// \t\ttestData.entry.from,\n\t\t\t\t\t\t// \t\ttestData.entry.userTimezoneOffsetFrom,\n\t\t\t\t\t\t// \t\ttestData.entry.fullDay),\n\t\t\t\t\t\t// \tUtil.adjustDateForTimezoneOffset(\n\t\t\t\t\t\t// \t\ttestData.entry.to,\n\t\t\t\t\t\t// \t\ttestData.entry.userTimezoneOffsetTo,\n\t\t\t\t\t\t// \t\ttestData.entry.fullDay\n\t\t\t\t\t\t// \t),\n\t\t\t\t\t\t// \ttestData.entry.fullDay\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// );\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconsole.error(response);\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.catch((errors) => {\n\t\t\t\t\tconsole.error(errors);\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tonDataUpdate(): void\n\t\t{\n\t\t\tthis.updatePlannerSelector();\n\n\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_CALENDAR_CHANGE, {\n\t\t\t\tfrom: this.from,\n\t\t\t\tto: this.from + this.duration,\n\t\t\t});\n\n\t\t\tthis.emitUpdateFilledValues();\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { to, from, duration, location, selectedUserIds, ownerId } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\tto,\n\t\t\t\tfrom,\n\t\t\t\tduration,\n\t\t\t\tlocation,\n\t\t\t\tselectedUserIds,\n\t\t\t\townerId,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t\tupdatePlannerSelector(): void\n\t\t{\n\t\t\tconst dateFrom = this.createDateInstance(this.from);\n\t\t\tconst dateTo = this.createDateInstance(this.from + this.duration);\n\n\t\t\tthis.getPlanner().updateSelector(dateFrom, dateTo);\n\t\t},\n\t\tcreateDateInstance(timestamp: number | null = null, startOfDay: boolean = false): Date\n\t\t{\n\t\t\tif (!timestamp)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\ttimestamp = Date.now();\n\t\t\t}\n\n\t\t\tconst date = new Date(timestamp);\n\t\t\tif (startOfDay)\n\t\t\t{\n\t\t\t\tdate.setHours(0, 0, 0, 0);\n\t\t\t}\n\n\t\t\treturn date;\n\t\t},\n\t\tgetFormattedDate(id: string): string\n\t\t{\n\t\t\treturn this.getFormattedValue(id, DateTimeFormat.getFormat('SHORT_DATE_FORMAT'));\n\t\t},\n\t\tgetFormattedValue(id: string, format: string): string\n\t\t{\n\t\t\tlet timestamp = 0;\n\n\t\t\tswitch (id)\n\t\t\t{\n\t\t\t\tcase 'beforeOneWeek':\n\t\t\t\t{\n\t\t\t\t\ttimestamp = this.from - 8 * 24 * 60 * 60 * 1000;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'from':\n\t\t\t\t{\n\t\t\t\t\ttimestamp = this.from;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'to':\n\t\t\t\t{\n\t\t\t\t\ttimestamp = this.from + this.duration;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'afterTwoWeeks':\n\t\t\t\t{\n\t\t\t\t\ttimestamp = this.from + 14 * 24 * 60 * 60 * 1000;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t\ttimestamp = 0;\n\t\t\t}\n\n\t\t\treturn DateTimeFormat.format(format, timestamp / 1000);\n\t\t},\n\t\tshowUserSelectorDialog(): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.getUserSelectorDialog().show();\n\t\t\t}, 5);\n\t\t},\n\t\tgetUserSelectorDialog(): Dialog\n\t\t{\n\t\t\tif (Type.isNil(this.userSelectorDialog))\n\t\t\t{\n\t\t\t\tconst preselectedItems = [];\n\t\t\t\tthis.selectedUsersIdsArray.forEach((id) => {\n\t\t\t\t\tpreselectedItems.push(['user', id]);\n\t\t\t\t});\n\n\t\t\t\tconst undeselectedItems = [\n\t\t\t\t\t['user', this.context.userId],\n\t\t\t\t];\n\n\t\t\t\tthis.userSelectorDialog = new Dialog({\n\t\t\t\t\tid: 'todo-editor-calendar-user-selector-dialog',\n\t\t\t\t\ttargetNode: this.$refs.userSelector,\n\t\t\t\t\tcontext: 'CRM_ACTIVITY_TODO_CALENDAR_RESPONSIBLE_USER',\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: true,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 450,\n\t\t\t\t\tzIndex: 2500,\n\t\t\t\t\tentities: [{ id: 'user' }],\n\t\t\t\t\tpreselectedItems,\n\t\t\t\t\tundeselectedItems,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': this.onSelectUser,\n\t\t\t\t\t\t'Item:onDeselect': this.onDeselectUser,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.userSelectorDialog;\n\t\t},\n\t\tonSelectUser({ data: { item } }): void\n\t\t{\n\t\t\tthis.selectedUserIds.add(item.id);\n\t\t},\n\t\tonDeselectUser({ data: { item } }): void\n\t\t{\n\t\t\tthis.selectedUserIds.delete(item.id);\n\t\t},\n\t\tgetSelectedUserIds(): Number[]\n\t\t{\n\t\t\treturn this.selectedUserIds ?? [];\n\t\t},\n\t\tonResponsibleUserChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst { responsibleUserId } = event.getData();\n\n\t\t\tthis.ownerId = responsibleUserId;\n\t\t\tthis.selectedUserIds.add(responsibleUserId);\n\t\t},\n\t\tonDeadlineChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tif (data)\n\t\t\t{\n\t\t\t\tconst deadline = data.deadline.getTime();\n\t\t\t\tthis.from = deadline;\n\t\t\t\tthis.to = this.from + deadline;\n\t\t\t}\n\t\t},\n\t\thandlePlannerSelectorChanges({ data: { dateFrom, dateTo } }): void\n\t\t{\n\t\t\tthis.from = dateFrom.getTime();\n\t\t\tthis.duration = dateTo.getTime() - this.from;\n\n\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_CALENDAR_CHANGE, {\n\t\t\t\tfrom: this.from,\n\t\t\t\tto: this.from + this.duration,\n\t\t\t});\n\t\t},\n\t\t// @todo\n\t\t/* getAccessibilityForUsers(): Promise\n\t\t{\n\t\t\tconst offset = 12 * 24 * 3600; //12 days\n\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst config = {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tfrom: this.from - offset,\n\t\t\t\t\t\tto: this.from + offset,\n\t\t\t\t\t\t// @todo add currentEventId\n\t\t\t\t\t\t//currentEventId:\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tAjax.runAction('crm.activity.settings.calendar.getAccessibilityForUsers', config)\n\t\t\t\t\t.then((response) => resolve(response))\n\t\t\t\t\t.catch((errors) => {\n\t\t\t\t\t\tconsole.log(errors);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t}, */\n\t\tupdateSettings(data: Object | null): void\n\t\t{\n\t\t\tif (!data || !data.deadline)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.from = data.deadline.getTime();\n\t\t},\n\t\tonSelectLocation({ action, id }): void\n\t\t{\n\t\t\tthis.locationId = (action === 'select' ? id : null);\n\t\t},\n\t\tonCloseLocationBlock(): void\n\t\t{\n\t\t\tthis.locationId = null;\n\t\t\tthis.showLocation = false;\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\tconst { duration } = this;\n\n\t\t\treturn {\n\t\t\t\tfrom: this.from,\n\t\t\t\tto: this.from + duration,\n\t\t\t\tduration,\n\t\t\t\tselectedUserIds: [...this.getSelectedUserIds()],\n\t\t\t\tlocation: this.location,\n\t\t\t};\n\t\t},\n\t\tprepareDataOnBlockConstruct(data: BlockSettings, params: Object): Object\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tdata.settings.from = params.currentDeadline.getTime() / 1000;\n\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tdata.settings.ownerId = params.responsibleUserId;\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tusersList(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_USERS_LIST');\n\t\t},\n\t\tlocation(): string\n\t\t{\n\t\t\treturn this.locationId ? `calendar_${this.locationId}` : '';\n\t\t},\n\t\tselectedUsersIdsArray(): number[]\n\t\t{\n\t\t\treturn [...this.selectedUserIds];\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'ownerId',\n\t\t\t(newOwnerId: number, oldOwnerId: number) => {\n\t\t\t\tif (this.selectedUserIds.has(newOwnerId))\n\t\t\t\t{\n\t\t\t\t\tconst userIds = this.selectedUsersIdsArray;\n\t\t\t\t\tconst data = this.prepareUpdatePlannerData(userIds);\n\t\t\t\t\tthis.updatePlanner(userIds, data);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\n\t\tthis.$watch(\n\t\t\t'selectedUserIds',\n\t\t\t(newUserIds, oldUserIds) => {\n\t\t\t\tconst data = this.prepareUpdatePlannerData(newUserIds, oldUserIds);\n\t\t\t\tthis.updatePlanner(newUserIds, data);\n\t\t\t},\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\n\t\tthis.$watch(\n\t\t\t'settings',\n\t\t\t(newSettings, oldSettings) => {\n\t\t\t\tconst showLocation = Boolean(newSettings.showLocation ?? false);\n\t\t\t\tthis.showLocation = Type.isStringFilled(this.filledValues.location) || showLocation;\n\n\t\t\t\tif (oldSettings.showUserSelector !== newSettings.showUserSelector && newSettings.showUserSelector)\n\t\t\t\t{\n\t\t\t\t\tthis.showUserSelectorDialog();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\t},\n\n\twatch: {\n\t\tduration(): void\n\t\t{\n\t\t\tthis.onDataUpdate();\n\t\t},\n\t\tfrom(): void\n\t\t{\n\t\t\tthis.onDataUpdate();\n\t\t},\n\t\tto(): void\n\t\t{\n\t\t\tthis.onDataUpdate();\n\t\t},\n\t\tlocationId(newLocationId, oldLocationId): void\n\t\t{\n\t\t\tconst newUserIds = this.selectedUsersIdsArray;\n\n\t\t\tconst data = this.prepareUpdatePlannerData(newUserIds);\n\n\t\t\tthis.updatePlanner(newUserIds, data);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_block-header\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span \n\t\t\t\tref=\"userSelector\"\n\t\t\t\t@click=\"showUserSelectorDialog\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ usersList }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t\t<div class=\"crm-activity__todo-editor-v2_block-body\">\n\t\t\t<div class=\"crm-activity__settings_popup__calendar-container\">\n\t\t\t\t<div ref=\"plannerContainer\" class=\"crm-activity__settings_popup__calendar__planner-container\"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"showLocation\">\n\t\t\t<LocationSelector\n\t\t\t\t@change=\"onSelectLocation\"\n\t\t\t\t@close=\"onCloseLocationBlock\"\n\t\t\t\t:locationId=\"locationId\"\n\t\t\t\t:forceShowLocationSelectorDialog=\"isFocused && !this.settings.showUserSelector\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { ClientSelector } from 'crm.client-selector';\nimport { ajax as Ajax, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport { UI } from 'ui.notification';\n\nexport const TodoEditorBlocksClient = {\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst data = {\n\t\t\tselectedClients: new Set(),\n\t\t\tisFetchedConfig: false,\n\t\t\tclients: [],\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted()\n\t{\n\t\tthis.fetchConfig();\n\t\tthis.subscribeToReceiversChanges();\n\t},\n\n\tmethods: {\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'client';\n\t\t},\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tconst { filledValues } = this;\n\n\t\t\tif (Type.isObject(filledValues?.clients))\n\t\t\t{\n\t\t\t\tfilledValues.clients.forEach(({ entityId, entityTypeId, isAvailable }) => {\n\t\t\t\t\tdata.selectedClients.add({\n\t\t\t\t\t\tentityId: Number(entityId),\n\t\t\t\t\t\tentityTypeId: Number(entityTypeId),\n\t\t\t\t\t\tisAvailable,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (Type.isObject(filledValues?.selectedClients))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.selectedClients = filledValues.selectedClients;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tsubscribeToReceiversChanges(): void\n\t\t{\n\t\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', this.onReceiversChanged);\n\t\t},\n\t\tonReceiversChanged(event: BaseEvent): void\n\t\t{\n\t\t\tconst { item } = event.getData();\n\n\t\t\tif (this.entityTypeId !== item?.entityTypeId || this.entityId !== item?.entityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.fetchConfig(true);\n\t\t},\n\t\tonShowAddClientPhoneSelector(): void\n\t\t{\n\t\t\tif (Type.isArrayFilled(this.clients))\n\t\t\t{\n\t\t\t\tthis.onShowClientSelector();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst id = 'client-selector-dialog';\n\t\t\tconst context = `CRM_TIMELINE_TODO-${this.entityTypeId}`;\n\n\t\t\tif (!this.userSelectorDialog)\n\t\t\t{\n\t\t\t\tthis.userSelectorDialog = new Dialog({\n\t\t\t\t\tid,\n\t\t\t\t\tcontext,\n\t\t\t\t\ttargetNode: this.$refs.addClientsSelector,\n\t\t\t\t\tmultiple: false,\n\t\t\t\t\tdropdownMode: false,\n\t\t\t\t\tshowAvatars: true,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 450,\n\t\t\t\t\tzIndex: 2500,\n\t\t\t\t\tentities: this.getClientSelectorEntities(),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': this.onAddClient,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.userSelectorDialog.isOpen())\n\t\t\t{\n\t\t\t\tthis.userSelectorDialog.hide();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.userSelectorDialog.setTargetNode(this.$refs.addClientsSelector);\n\t\t\t\t\tthis.userSelectorDialog.show();\n\t\t\t\t}, 5);\n\t\t\t}\n\t\t},\n\t\tasync onAddClient(event: BaseEvent): void\n\t\t{\n\t\t\tif (this.isClientBindingInProgress)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isClientBindingInProgress = true;\n\n\t\t\tconst { item } = event.getData();\n\n\t\t\tconst entityId = item.id;\n\t\t\tconst entityTypeId = BX.CrmEntityType.resolveId(item.entityId);\n\n\t\t\tconst isBound = await this.bindClient(entityId, entityTypeId);\n\t\t\tif (isBound)\n\t\t\t{\n\t\t\t\tBX.Crm.EntityEditor?.getDefault()?.reload();\n\t\t\t}\n\t\t},\n\t\tasync bindClient(clientId: number, clientTypeId: number): Promise\n\t\t{\n\t\t\tconst ajaxParams = {\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tclientId,\n\t\t\t\tclientTypeId,\n\t\t\t};\n\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tAjax.runAction('crm.activity.todo.bindClient', { data: ajaxParams })\n\t\t\t\t\t.then(({ data }) => {\n\t\t\t\t\t\tthis.isClientBindingInProgress = false;\n\n\t\t\t\t\t\tif (!data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isArrayFilled(data.clients))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.clients = data.clients;\n\n\t\t\t\t\t\t\tthis.selectedClients.add({\n\t\t\t\t\t\t\t\tentityId: clientId,\n\t\t\t\t\t\t\t\tentityTypeId: clientTypeId,\n\t\t\t\t\t\t\t\tisAvailable: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((data) => {\n\t\t\t\t\t\tthis.isClientBindingInProgress = false;\n\n\t\t\t\t\t\tif (data.errors.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showNotify(data.errors[0].message);\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.showNotify(this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_BIND_CLIENT_ERROR'));\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t},\n\t\tshowNotify(content: string): void\n\t\t{\n\t\t\tUI.Notification.Center.notify({ content });\n\t\t},\n\t\tonShowClientSelector(): void\n\t\t{\n\t\t\tif (this.clientSelector && this.clientSelector.isOpen())\n\t\t\t{\n\t\t\t\tthis.clientSelector.hide();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst targetNode = this.$refs.clientsContainer;\n\n\t\t\t\tthis.clientSelector = ClientSelector.createFromItems({\n\t\t\t\t\ttargetNode,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\titems: this.clients,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSelect: this.onSelectClient,\n\t\t\t\t\t\tonDeselect: this.onDeselectClient,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.availableSelectedClients.forEach(({ entityId, entityTypeId }) => {\n\t\t\t\t\t\tthis.clientSelector.setSelectedItemByEntityData(entityId, entityTypeId);\n\t\t\t\t\t});\n\t\t\t\t\tthis.clientSelector.show();\n\t\t\t\t}, 5);\n\t\t\t}\n\t\t},\n\t\tgetClientSelectorEntities(): []\n\t\t{\n\t\t\tconst contact = {\n\t\t\t\tid: 'contact',\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t\toptions: {\n\t\t\t\t\tshowTab: true,\n\t\t\t\t\tshowPhones: true,\n\t\t\t\t\tshowMails: true,\n\t\t\t\t\thideReadMoreLink: true,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst company = {\n\t\t\t\tid: 'company',\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t\toptions: {\n\t\t\t\t\texcludeMyCompany: true,\n\t\t\t\t\tshowTab: true,\n\t\t\t\t\tshowPhones: true,\n\t\t\t\t\tshowMails: true,\n\t\t\t\t\thideReadMoreLink: true,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (this.entityTypeId === BX.CrmEntityType.enumeration.contact)\n\t\t\t{\n\t\t\t\treturn [company];\n\t\t\t}\n\n\t\t\tif (this.entityTypeId === BX.CrmEntityType.enumeration.company)\n\t\t\t{\n\t\t\t\treturn [contact];\n\t\t\t}\n\n\t\t\treturn [contact, company];\n\t\t},\n\t\tonSelectClient({ data: { item } }): void\n\t\t{\n\t\t\tthis.selectedClients.add({\n\t\t\t\tentityId: item.customData.get('entityId'),\n\t\t\t\tentityTypeId: item.customData.get('entityTypeId'),\n\t\t\t\tisAvailable: true,\n\t\t\t});\n\t\t},\n\t\tonDeselectClient({ data: { item } }): void\n\t\t{\n\t\t\tthis.selectedClients.forEach((client) => {\n\t\t\t\tif (\n\t\t\t\t\tclient.entityId === item.customData.get('entityId')\n\t\t\t\t\t&& client.entityTypeId === item.customData.get('entityTypeId')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.selectedClients.delete(client);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tfetchConfig(force: boolean = false): void\n\t\t{\n\t\t\tif (this.isFetchedConfig && !force)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isFetchedConfig = false;\n\n\t\t\tif (!this.entityTypeId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst ajaxParameters = {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tentityId: this.entityId,\n\t\t\t};\n\n\t\t\tAjax.runAction('crm.activity.todo.getClientConfig', { data: ajaxParameters })\n\t\t\t\t.then(({ data }) => {\n\t\t\t\t\tthis.isFetchedConfig = true;\n\n\t\t\t\t\tif (Type.isArrayFilled(data.clients))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.clients = data.clients;\n\n\t\t\t\t\t\tif (this.selectedClients.size === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst { entityId, entityTypeId } = data.clients[0].customData;\n\n\t\t\t\t\t\t\tthis.selectedClients.add({\n\t\t\t\t\t\t\t\tentityId,\n\t\t\t\t\t\t\t\tentityTypeId,\n\t\t\t\t\t\t\t\tisAvailable: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tBX.UI.Notification.Center.notify({ content: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ERROR') });\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tonShowClient({ entityId, entityTypeId }): void\n\t\t{\n\t\t\tlet path = '';\n\t\t\tif (entityTypeId === BX.CrmEntityType.enumeration.company)\n\t\t\t{\n\t\t\t\tpath = `/crm/company/details/${Number(entityId)}/`;\n\t\t\t}\n\n\t\t\tif (entityTypeId === BX.CrmEntityType.enumeration.contact)\n\t\t\t{\n\t\t\t\tpath = `/crm/contact/details/${Number(entityId)}/`;\n\t\t\t}\n\n\t\t\tif (!Type.isStringFilled(path))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (BX.SidePanel)\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.open(path);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.top.location.href = path;\n\t\t\t}\n\t\t},\n\t\tgetClientTitleFormatted(entityId: number, entityTypeId: number, showComma: boolean = false): string\n\t\t{\n\t\t\tconst clientInfo = this.getClientInfo(entityId, entityTypeId);\n\n\t\t\tif (!clientInfo)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst comma = showComma ? ', ' : '';\n\n\t\t\treturn `${clientInfo.title}${comma}`;\n\t\t},\n\t\tgetClientInfo(entityId: number, entityTypeId: number): Object | undefined\n\t\t{\n\t\t\treturn this.clients.find(\n\t\t\t\t({ customData }) => {\n\t\t\t\t\treturn customData.entityId === entityId && customData.entityTypeId === entityTypeId;\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tselectedClients: [...this.selectedClients],\n\t\t\t};\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { selectedClients } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\tselectedClients,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tchangeTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CLIENT_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\taddTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CLIENT_BLOCK_ADD_ACTION');\n\t\t},\n\t\thasClients(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.availableSelectedClients);\n\t\t},\n\t\tentityTypeId(): number\n\t\t{\n\t\t\treturn this.settings.entityTypeId;\n\t\t},\n\t\tentityId(): number\n\t\t{\n\t\t\treturn this.settings.entityId;\n\t\t},\n\t\tavailableSelectedClients(): []\n\t\t{\n\t\t\treturn [...this.selectedClients].filter((client) => client.isAvailable);\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'selectedClients',\n\t\t\tthis.emitUpdateFilledValues,\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"isFetchedConfig\" class=\"crm-activity__todo-editor-v2_block-header\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span \n\t\t\t\tv-if=\"hasClients\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-data\"\n\t\t\t>\n\t\t\t\t<span\n\t\t\t\t\tv-for=\"(client, index) in availableSelectedClients\"\n\t\t\t\t\t:key=\"client.entityTypeId + '-' + client.entityId\"\n\t\t\t\t\t@click=\"onShowClient(client)\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"Boolean(getClientInfo(client.entityId, client.entityTypeId))\">\n\t\t\t\t\t\t{{ getClientTitleFormatted(client.entityId, client.entityTypeId, index !== availableSelectedClients.length - 1) }}\n\t\t\t\t\t</template>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span ref=\"clientsContainer\">\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"hasClients\"\n\t\t\t\t\tref=\"clientsSelector\"\n\t\t\t\t\t@click=\"onShowClientSelector\"\n\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t\t>\n\t\t\t\t\t{{ changeTitle }}\n\t\t\t\t</span>\n\t\t\t\t<span\n\t\t\t\t\tv-else\n\t\t\t\t\tref=\"addClientsSelector\"\n\t\t\t\t\t@click=\"onShowAddClientPhoneSelector\"\n\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t\t>\n\t\t\t\t\t{{ addTitle }}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t\t<div v-else class=\"crm-activity__todo-editor-v2_block-header --skeleton\"></div>\n\t`,\n};\n","import { Text, Type } from 'main.core';\nimport { TileWidgetComponent } from 'ui.uploader.tile-widget';\n\nconst MAX_UPLOAD_FILE_SIZE = 1024 * 1024 * 50; // 50M;\n\nexport const TodoEditorBlocksFile = {\n\tcomponents: {\n\t\tTileWidgetComponent,\n\t},\n\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst data = {\n\t\t\tfileTokens: [],\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst needShowLoaderPopup = !(BX.localStorage && BX.localStorage.get('skip_autoshow_file_selector'));\n\t\tif (this.isFocused && needShowLoaderPopup)\n\t\t{\n\t\t\tvoid this.$nextTick(this.onShowUploaderPopup);\n\t\t}\n\n\t\tthis.deleteFilesFromServerWhenDestroy = false;\n\t},\n\n\tmethods: {\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'file';\n\t\t},\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tconst { filledValues } = this;\n\n\t\t\tif (Type.isArray(filledValues?.fileTokens))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.fileTokens = filledValues.fileTokens;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tfileTokens: this.getFileTokenList(),\n\t\t\t};\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { fileTokens } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\tfileTokens,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t\tonShowUploaderPopup(): void\n\t\t{\n\t\t\tthis.$refs.fileBody.querySelector('.ui-tile-uploader-drop-label').click();\n\t\t},\n\t\treset(): void\n\t\t{\n\t\t\tthis.deleteFilesFromServerWhenDestroy = true;\n\t\t},\n\t\tgetFileTokenList(): string[]\n\t\t{\n\t\t\tconst tokens = [];\n\n\t\t\tthis.$refs.uploader.uploader.getFiles().forEach((file) => {\n\t\t\t\tif (file.isComplete())\n\t\t\t\t{\n\t\t\t\t\ttokens.push(file.getServerFileId());\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn tokens;\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tactionTitle(): string\n\t\t{\n\t\t\treturn this.hasFileTokens ? this.changeTitle : this.addTitle;\n\t\t},\n\t\tchangeTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\taddTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_FILE_BLOCK_UPLOAD_ACTION');\n\t\t},\n\t\thasFileTokens(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.fileTokens);\n\t\t},\n\t\tuploaderOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tcontroller: 'crm.fileUploader.todoActivityUploaderController',\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\tentityId: this.settings.entityId,\n\t\t\t\t\tentityTypeId: this.settings.entityTypeId,\n\t\t\t\t\tactivityId: this.context.activityId,\n\t\t\t\t},\n\t\t\t\tfiles: this.fileTokens,\n\t\t\t\tevents: {\n\t\t\t\t\t/* 'File:onRemove': (event) => {\n\n\t\t\t\t\t},\n\t\t\t\t\tonUploadStart: (event) => {\n\n\t\t\t\t\t},\n\t\t\t\t\t'File:onComplete': (event) => {\n\n\t\t\t\t\t}, */\n\t\t\t\t\tonUploadComplete: () => {\n\t\t\t\t\t\tvoid this.$nextTick(() => {\n\t\t\t\t\t\t\tthis.fileTokens = this.getFileTokenList();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tautoUpload: true,\n\t\t\t\tmaxFileSize: MAX_UPLOAD_FILE_SIZE,\n\t\t\t};\n\t\t},\n\t\twidgetOptions(): Object\n\t\t{\n\t\t\treturn {};\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'fileTokens',\n\t\t\tthis.emitUpdateFilledValues,\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tthis.$refs.uploader.adapter.setRemoveFilesFromServerWhenDestroy(this.deleteFilesFromServerWhenDestroy);\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_block-header --file\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span\n\t\t\t\t@click=\"onShowUploaderPopup\"\n\t\t\t\tref=\"file\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ actionTitle }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t\t<div ref=\"fileBody\" class=\"crm-activity__todo-editor-v2_block-body --file\">\n\t\t\t<TileWidgetComponent \n\t\t\t\tref=\"uploader\"\n\t\t\t\t:uploaderOptions=\"uploaderOptions\"\n\t\t\t\t:widgetOptions=\"widgetOptions\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Tag, Text } from 'main.core';\nimport { Popup } from 'main.popup';\n\nexport class InputPopup\n{\n\t#popup: Popup = null;\n\t#bindElement: HTMLElement = null;\n\t#title: string = null;\n\t#placeholder: string = null;\n\t#buttonTitle: string = null;\n\t#input: HTMLInputElement = null;\n\t#onSubmit: Function = null;\n\n\tconstructor(params: Object)\n\t{\n\t\tthis.#bindElement = params.bindElement;\n\t\tthis.#title = params.title;\n\t\tthis.#placeholder = params.placeholder;\n\t\tthis.#buttonTitle = params.buttonTitle || 'OK';\n\t\tthis.#onSubmit = params.onSubmit;\n\n\t\tthis.onClickHandler = this.onClickHandler.bind(this);\n\t\tthis.onKeyUpHandler = this.onKeyUpHandler.bind(this);\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup().show();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#input.focus();\n\t\t});\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tthis.#popup.destroy();\n\t\t}\n\t}\n\n\tsetValue(value: string): InputPopup\n\t{\n\t\tif (this.#input)\n\t\t{\n\t\t\tthis.#input.value = value;\n\t\t}\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\tid: `crm-todo-link-input-popup-${Text.getRandom()}`,\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tdraggable: false,\n\t\t\t\twidth: 466,\n\t\t\t\tpadding: 0,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tthis.#input = Tag.render`\n\t\t\t<input \n\t\t\t\ttype=\"text\" \n\t\t\t\tplaceholder=\"${Text.encode(this.#placeholder)}\"\n\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\tonkeyup=\"${this.onKeyUpHandler}\"\n\t\t\t>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-wrapper --link\">\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-title\">\n\t\t\t\t\t${Text.encode(this.#title)}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-content\">\n\t\t\t\t\t${this.#input}\n\t\t\t\t\t<button \n\t\t\t\t\t\tonclick=\"${this.onClickHandler}\" \n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Text.encode(this.#buttonTitle)}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tonClickHandler(event): void\n\t{\n\t\tthis.#getPopup().close();\n\t\tthis.#onSubmit(this.#input.value);\n\t}\n\n\tonKeyUpHandler(event): void\n\t{\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tthis.onClickHandler();\n\t\t}\n\t}\n}\n","import { Dom, Text, Type } from 'main.core';\nimport { InputPopup } from './input-popup';\n\nexport const TodoEditorBlocksLink = {\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst data = {\n\t\t\tlink: null,\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted(): void\n\t{\n\t\tif (this.isFocused)\n\t\t{\n\t\t\tvoid this.$nextTick(this.onShowLinkPopup);\n\t\t}\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.inputPopup?.destroy();\n\t},\n\n\tmethods: {\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'link';\n\t\t},\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tconst { filledValues } = this;\n\n\t\t\tif (Type.isStringFilled(filledValues?.link))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.link = filledValues.link;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\tconst { link } = this;\n\n\t\t\treturn {\n\t\t\t\tlink,\n\t\t\t};\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { link } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\tlink,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t\tonLinkClick(): void\n\t\t{\n\t\t\tconst a = document.createElement('a');\n\t\t\ta.href = this.link;\n\t\t\ta.target = '_blank';\n\t\t\tDom.append(a, document.body);\n\t\t\ta.click();\n\t\t\tDom.remove(a);\n\t\t},\n\t\tonShowLinkPopup(): void\n\t\t{\n\t\t\tif (Type.isNil(this.inputPopup))\n\t\t\t{\n\t\t\t\tthis.inputPopup = new InputPopup({\n\t\t\t\t\tbindElement: this.$refs.link,\n\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_POPUP_TITLE'),\n\t\t\t\t\tplaceholder: 'https://',\n\t\t\t\t\tonSubmit: (value: string) => {\n\t\t\t\t\t\tthis.setLink(value);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.inputPopup.show();\n\t\t\tthis.inputPopup.setValue(this.link);\n\t\t},\n\t\tsetLink(value: string): void\n\t\t{\n\t\t\tthis.link = value;\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tactionTitle(): string\n\t\t{\n\t\t\treturn this.hasLink ? this.changeTitle : this.addTitle;\n\t\t},\n\t\tchangeTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\taddTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_ADD_ACTION');\n\t\t},\n\t\thasLink(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.link);\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'link',\n\t\t\tthis.emitUpdateFilledValues,\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_block-header --link\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span \n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-data\"\n\t\t\t\t@click=\"onLinkClick\"\n\t\t\t>\n\t\t\t\t{{ link }}\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\t@click=\"onShowLinkPopup\"\n\t\t\t\tref=\"link\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ actionTitle }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t`,\n};\n","import {\n\tTodoEditorBlocksAddress,\n\tTodoEditorBlocksCalendar,\n\tTodoEditorBlocksClient,\n\tTodoEditorBlocksFile,\n\tTodoEditorBlocksLink,\n} from './block/index';\n\nexport default class BlockFactory\n{\n\tstatic getInstance(id: string)\n\t{\n\t\tif (id === TodoEditorBlocksCalendar.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksCalendar;\n\t\t}\n\n\t\tif (id === TodoEditorBlocksClient.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksClient;\n\t\t}\n\n\t\tif (id === TodoEditorBlocksLink.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksLink;\n\t\t}\n\n\t\tif (id === TodoEditorBlocksFile.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksFile;\n\t\t}\n\n\t\tif (id === TodoEditorBlocksAddress.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksAddress;\n\t\t}\n\n\t\tthrow new Error(`Unknown block id: ${id}`);\n\t}\n}\n","import { ColorSelector, ColorSelectorEvents } from 'crm.field.color-selector';\nimport { EventEmitter } from 'main.core.events';\nimport { hint } from 'ui.vue3.directives.hint';\n\nconst DEFAULT_COLOR_ID = 'default';\n\nexport const TodoEditorColorSelector = {\n\tdirectives: { hint },\n\temits: ['onChange'],\n\tprops: {\n\t\tvaluesList: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tselectedValueId: {\n\t\t\ttype: String,\n\t\t\tdefault: DEFAULT_COLOR_ID,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentValueId: this.selectedValueId || DEFAULT_COLOR_ID,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tgetValue(): Array\n\t\t{\n\t\t\treturn this.currentValueId;\n\t\t},\n\t\tsetValue(value: ?string): void\n\t\t{\n\t\t\tif (value === null)\n\t\t\t{\n\t\t\t\tthis.resetToDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentValueId = value;\n\t\t\tthis.itemSelector?.setValue(value);\n\t\t},\n\t\tonColorSelectorValueChange({ data }): void\n\t\t{\n\t\t\tthis.currentValueId = data.value;\n\n\t\t\tthis.$emit('onChange');\n\t\t},\n\t\tresetToDefault(): void\n\t\t{\n\t\t\tthis.setValue(DEFAULT_COLOR_ID);\n\t\t\tthis.itemSelector?.setValue(DEFAULT_COLOR_ID);\n\t\t},\n\t},\n\n\tcomputed: {\n\t\thint(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_COLOR_SELECTOR_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: 30,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t\toffsetTop: 2,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tvoid this.$nextTick(() => {\n\t\t\tthis.itemSelector = new ColorSelector({\n\t\t\t\ttarget: this.$refs.itemSelectorRef,\n\t\t\t\tcolorList: this.valuesList,\n\t\t\t\tselectedColorId: this.currentValueId,\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.itemSelector,\n\t\t\t\tColorSelectorEvents.EVENT_COLORSELECTOR_VALUE_CHANGE,\n\t\t\t\tthis.onColorSelectorValueChange,\n\t\t\t);\n\t\t});\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_color-selector\">\n\t\t\t<div ref=\"itemSelectorRef\" v-hint=\"hint\"></div>\n\t\t</div>\n\t`,\n};\n","import { CompactIcons, PingSelector, PingSelectorEvents } from 'crm.field.ping-selector';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { hint } from 'ui.vue3.directives.hint';\nimport { Events } from './todo-editor';\n\nexport const TodoEditorPingSelector = {\n\tdirectives: { hint },\n\temits: ['onChange'],\n\tprops: {\n\t\tvaluesList: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: [],\n\t\t},\n\t\tselectedValues: {\n\t\t\ttype: Array,\n\t\t\tdefault: [],\n\t\t},\n\t\tdeadline: {\n\t\t\ttype: Date,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\thint(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_PING_SELECTOR_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: 34,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\n\tmethods: {\n\t\tonPingSelectorValueChange(): void\n\t\t{\n\t\t\tthis.$emit('onChange');\n\t\t},\n\n\t\tonDeadlineChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst { deadline } = event.getData();\n\t\t\tif (deadline)\n\t\t\t{\n\t\t\t\tthis.itemSelector?.setDeadline(deadline);\n\t\t\t}\n\t\t},\n\n\t\tgetValue(): Array\n\t\t{\n\t\t\tif (this.itemSelector)\n\t\t\t{\n\t\t\t\treturn this.itemSelector.getValue();\n\t\t\t}\n\n\t\t\treturn [];\n\t\t},\n\n\t\tsetValue(values: Array): void\n\t\t{\n\t\t\tthis.itemSelector?.setValue(values);\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.itemSelector = new PingSelector({\n\t\t\ttarget: this.$refs.container,\n\t\t\tvaluesList: this.valuesList,\n\t\t\tselectedValues: this.selectedValues,\n\t\t\ticon: CompactIcons.BELL,\n\t\t\tdeadline: this.deadline,\n\t\t});\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.itemSelector,\n\t\t\tPingSelectorEvents.EVENT_PINGSELECTOR_VALUE_CHANGE,\n\t\t\tthis.onPingSelectorValueChange,\n\t\t);\n\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_DEADLINE_CHANGE, this.onDeadlineChange);\n\t},\n\n\ttemplate: '<div style=\"width: 100%;\"><div ref=\"container\" v-hint=\"hint\"></div></div>',\n};\n","import { Text, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport { hint } from 'ui.vue3.directives.hint';\nimport { Events } from './todo-editor';\n\nexport const TodoEditorResponsibleUserSelector = {\n\tdirectives: { hint },\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t\tdefault: 0,\n\t\t},\n\t\tuserName: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t\timageUrl: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tuserAvatarUrl: this.imageUrl,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tuserIconClassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'ui-icon',\n\t\t\t\t'ui-icon-common-user',\n\t\t\t\t'crm-timeline__user-icon',\n\t\t\t];\n\t\t},\n\n\t\tuserIconStyles(): Object\n\t\t{\n\t\t\tif (!this.userAvatarUrl)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${encodeURI(Text.encode(this.userAvatarUrl))}')`,\n\t\t\t\tbackgroundSize: '21px',\n\t\t\t};\n\t\t},\n\n\t\thint(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CHANGE_RESPONSIBLE'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: 35,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\n\tmethods: {\n\t\tonSelectUser(event: BaseEvent): void\n\t\t{\n\t\t\tconst selectedItem = event.getData().item.getDialog().getSelectedItems()[0];\n\t\t\tif (selectedItem)\n\t\t\t{\n\t\t\t\tthis.userAvatarUrl = selectedItem.getAvatar();\n\t\t\t\tthis.$Bitrix.eventEmitter.emit(\n\t\t\t\t\tEvents.EVENT_RESPONSIBLE_USER_CHANGE,\n\t\t\t\t\t{\n\t\t\t\t\t\tresponsibleUserId: selectedItem.getId(),\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\tonDeselectUser(): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst selectedItems = this.userSelectorDialog.getSelectedItems();\n\t\t\t\tif (selectedItems.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.userAvatarUrl = this.imageUrl;\n\t\t\t\t\tthis.userSelectorDialog.hide();\n\t\t\t\t\tthis.$Bitrix.eventEmitter.emit(\n\t\t\t\t\t\tEvents.EVENT_RESPONSIBLE_USER_CHANGE,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresponsibleUserId: this.userId,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t},\n\n\t\tshowUserDialog(): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.getUserSelectorDialog().show();\n\t\t\t}, 5);\n\t\t},\n\n\t\tresetToDefault(): void\n\t\t{\n\t\t\tthis.userAvatarUrl = this.imageUrl;\n\t\t\tif (this.userSelectorDialog)\n\t\t\t{\n\t\t\t\tconst defaultUserItem = this.userSelectorDialog.getItem({\n\t\t\t\t\tid: this.userId,\n\t\t\t\t\tentityId: 'user',\n\t\t\t\t});\n\n\t\t\t\tif (defaultUserItem)\n\t\t\t\t{\n\t\t\t\t\tdefaultUserItem.select(true);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tgetUserSelectorDialog(): Dialog\n\t\t{\n\t\t\tif (Type.isNil(this.userSelectorDialog))\n\t\t\t{\n\t\t\t\tthis.userSelectorDialog = new Dialog({\n\t\t\t\t\tid: 'responsible-user-selector-dialog',\n\t\t\t\t\ttargetNode: this.$refs.userSelector,\n\t\t\t\t\tcontext: 'CRM_ACTIVITY_TODO_RESPONSIBLE_USER',\n\t\t\t\t\tmultiple: false,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: true,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 450,\n\t\t\t\t\tzIndex: 2500,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems: [\n\t\t\t\t\t\t['user', this.userId],\n\t\t\t\t\t],\n\t\t\t\t\tundeselectedItems: [\n\t\t\t\t\t\t['user', this.userId],\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': this.onSelectUser,\n\t\t\t\t\t\t'Item:onDeselect': this.onDeselectUser,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.userSelectorDialog;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"crm-activity__todo-editor-v2_responsible-user-selector\"\n\t\t\tref=\"userSelector\"\n\t\t\t@click=\"showUserDialog\"\n\t\t\tv-hint=\"hint\"\n\t\t>\n\t\t\t<span :class=\"userIconClassName\">\n\t\t\t\t<i :style=\"userIconStyles\"></i>\n\t\t\t</span>\n\t\t</div>\n\t`,\n};\n","import { CopilotTextarea, Events as CopilotTextareaEvents } from 'crm.ai.copilot-textarea';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { Browser, Dom, Runtime, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { ElementIds, EventIds } from '../analytics';\nimport type { BlockSettings } from '../todo-editor';\nimport BlockFactory from './block-factory';\nimport {\n\tTodoEditorBlocksAddress,\n\tTodoEditorBlocksCalendar,\n\tTodoEditorBlocksClient,\n\tTodoEditorBlocksFile,\n\tTodoEditorBlocksLink,\n} from './block/index';\nimport { TodoEditorColorSelector } from './color-selector/todo-editor-color-selector';\nimport { TodoEditorPingSelector } from './todo-editor-ping-selector';\nimport { TodoEditorResponsibleUserSelector } from './todo-editor-responsible-user-selector';\n\nconst TEXTAREA_MAX_HEIGHT = 126;\nconst ADD_MODE = 'add';\n\nexport const Events = {\n\tEVENT_RESPONSIBLE_USER_CHANGE: 'crm:timeline:todo:responsible-user-changed',\n\tEVENT_DEADLINE_CHANGE: 'crm:timeline:todo:deadline-changed',\n\tEVENT_CALENDAR_CHANGE: 'crm:timeline:todo:calendar-changed',\n\tEVENT_ACTIONS_POPUP_ITEM_CLICK: 'crm:timeline:todo:actions-popup-item-click',\n\tEVENT_UPDATE_CLICK: 'crm:timeline:todo:update',\n\tEVENT_REPEAT_CLICK: 'crm:timeline:todo:repeat',\n};\n\nconst CALENDAR_BLOCK_ID = TodoEditorBlocksCalendar.methods.getId();\n\nexport const TodoEditor = {\n\tcomponents: {\n\t\tTodoEditorResponsibleUserSelector,\n\t\tTodoEditorPingSelector,\n\t\tTodoEditorBlocksCalendar,\n\t\tTodoEditorBlocksClient,\n\t\tTodoEditorBlocksLink,\n\t\tTodoEditorBlocksFile,\n\t\tTodoEditorBlocksAddress,\n\t\tTodoEditorColorSelector,\n\t},\n\n\tprops: {\n\t\tonFocus: Function,\n\t\tonSaveHotkeyPressed: Function,\n\t\tdeadline: Date,\n\t\tdefaultTitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tdefaultDescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tpopupMode: Boolean,\n\t\tcurrentUser: Object,\n\t\tpingSettings: Object,\n\t\tcopilotSettings: Object,\n\t\tcolorSettings: Object,\n\t\tmode: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: ADD_MODE,\n\t\t},\n\t\tactionsPopup: Object,\n\t\tblocks: {\n\t\t\ttype: Array,\n\t\t\tdefault: [],\n\t\t},\n\t\tactivityId: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t\trequired: false,\n\t\t},\n\t\tanalytics: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t\trequired: false,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\tconst isCopilotEnabled = Type.isPlainObject(this.copilotSettings);\n\n\t\tconst currentDeadline = this.deadline ?? new Date();\n\t\tconst calendarDateTo = Runtime.clone(currentDeadline);\n\t\tcalendarDateTo.setHours(currentDeadline.getHours() + 1);\n\n\t\tconst blocksData = Runtime.clone(this.blocks);\n\n\t\tObject.keys(blocksData).forEach((blockId: string) => {\n\t\t\tthis.prepareBlockDataWithEditorParams(blocksData[blockId], { currentDeadline });\n\t\t});\n\n\t\treturn {\n\t\t\tcurrentActivityId: this.activityId,\n\t\t\ttitle: this.defaultTitle,\n\t\t\tdescription: this.defaultDescription,\n\t\t\tcurrentDeadline,\n\t\t\tcalendarDateTo,\n\t\t\tpingOffsets: this.pingSettings.selectedValues,\n\t\t\tcolorId: this.colorSettings.selectedValueId,\n\t\t\tresponsibleUserId: this.currentUser.userId,\n\t\t\tisTextareaToLong: false,\n\t\t\twasUsed: false,\n\t\t\tisCopilotEnabled,\n\t\t\tblocksData,\n\t\t\tmodeData: this.mode,\n\t\t\tcurrentUserData: this.currentUser,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tdeadlineFormatted(): string\n\t\t{\n\t\t\tlet converter = new DatetimeConverter(this.currentDeadline);\n\n\t\t\tlet deadlineFormatted = converter.toDatetimeString({\n\t\t\t\twithDayOfWeek: true,\n\t\t\t\tdelimiter: ', ',\n\t\t\t});\n\n\t\t\t// @todo use event here\n\t\t\tconst calendarBlock = this.getBlockDataById(CALENDAR_BLOCK_ID);\n\t\t\tif (calendarBlock?.active)\n\t\t\t{\n\t\t\t\tconverter = new DatetimeConverter(this.calendarDateTo);\n\t\t\t\tconst calendarDateTo = converter.toTimeString();\n\t\t\t\tdeadlineFormatted = `${deadlineFormatted}-${calendarDateTo}`;\n\t\t\t}\n\n\t\t\treturn deadlineFormatted;\n\t\t},\n\t\tcontext(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tuserId: this.responsibleUserId,\n\t\t\t\tactivityId: this.currentActivityId,\n\t\t\t};\n\t\t},\n\t\tplaceholderDescription(): string\n\t\t{\n\t\t\tlet code = '';\n\n\t\t\tif (this.wasUsed)\n\t\t\t{\n\t\t\t\tcode = (\n\t\t\t\t\tthis.isCopilotEnabled\n\t\t\t\t\t\t? 'CRM_ACTIVITY_TODO_ADD_PLACEHOLDER_WITH_COPILOT_MSGVER_1'\n\t\t\t\t\t\t: 'CRM_ACTIVITY_TODO_ADD_PLACEHOLDER_MSGVER_1'\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcode = 'CRM_ACTIVITY_TODO_ADD_PLACEHOLDER_ROLLED';\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage(code);\n\t\t},\n\t\tplaceholderTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADD_TITLE_PLACEHOLDER');\n\t\t},\n\t\tpopupMenuButtonTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_SHOW_ACTIONS_POPUP');\n\t\t},\n\t\torderedBlocksData(): BlockSettings[]\n\t\t{\n\t\t\treturn this.blocksData.sort((a, b) => b.sort - a.sort);\n\t\t},\n\t},\n\n\twatch: {\n\t\tdescription(): void\n\t\t{\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tconst currentTextareaHeight = this.$refs.textarea.scrollHeight;\n\t\t\t\tDom.style(this.$refs.textarea, 'height', `${currentTextareaHeight}px`);\n\t\t\t\tif (this.popupMode === true)\n\t\t\t\t{\n\t\t\t\t\tthis.isTextareaToLong = currentTextareaHeight > TEXTAREA_MAX_HEIGHT;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\n\tmethods: {\n\t\t/* @internal */\n\t\tprepareBlockDataWithEditorParams(blocksData: BlockSettings, { currentDeadline }): void\n\t\t{\n\t\t\tthis.prepareBlockData(blocksData, {\n\t\t\t\tcurrentDeadline,\n\t\t\t\tresponsibleUserId: this.responsibleUserId || this.currentUser.userId,\n\t\t\t});\n\t\t},\n\n\t\tprepareBlockData(blockData: BlockSettings, params: Object): void\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblockData.active = Type.isBoolean(blockData.active) ? blockData.active : false;\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblockData.sort = Type.isNil(blockData.sort) ? 0 : blockData.sort;\n\n\t\t\tconst blockInstance = BlockFactory.getInstance(blockData.id);\n\t\t\tif (Type.isFunction(blockInstance.methods.prepareDataOnBlockConstruct))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tblockData = {\n\t\t\t\t\t...blockData,\n\t\t\t\t\t...blockInstance.methods.prepareDataOnBlockConstruct(blockData, params),\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t\tsetData({ title, description, deadline, id, colorId, currentUser, pingOffsets }): void\n\t\t{\n\t\t\tthis.title = title;\n\t\t\tthis.description = description;\n\t\t\tthis.currentDeadline = new Date(deadline);\n\t\t\tthis.currentActivityId = id;\n\n\t\t\tthis.currentUserData = currentUser;\n\t\t\tthis.responsibleUserId = currentUser.userId;\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.$refs.userSelector?.resetToDefault();\n\t\t\t});\n\n\t\t\tthis.setPingOffsets(pingOffsets);\n\t\t\tthis.$refs.pingSelector?.setValue(pingOffsets);\n\n\t\t\tthis.$refs.colorSelector.setValue(colorId);\n\t\t},\n\n\t\tsetMode(mode: string): void\n\t\t{\n\t\t\tthis.modeData = mode;\n\t\t},\n\n\t\tresetCurrentActivityId(): void\n\t\t{\n\t\t\tthis.currentActivityId = null;\n\t\t},\n\n\t\tsetBlockFilledValues(id: string, filledValues: Object): void\n\t\t{\n\t\t\tconst blockData = this.getBlockDataById(id);\n\n\t\t\tif (blockData)\n\t\t\t{\n\t\t\t\tblockData.filledValues = filledValues;\n\t\t\t}\n\t\t},\n\n\t\tsetBlockActive(id: string, value: boolean = true): void\n\t\t{\n\t\t\tconst blockData = this.getBlockDataById(id);\n\n\t\t\tif (blockData)\n\t\t\t{\n\t\t\t\tblockData.active = value;\n\t\t\t}\n\t\t},\n\n\t\tresetTitleAndDescription(): void\n\t\t{\n\t\t\tthis.setTitle(this.defaultTitle);\n\t\t\tthis.setDescription(this.defaultDescription);\n\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t},\n\n\t\tsetTitle(title: string): void\n\t\t{\n\t\t\tthis.title = title;\n\t\t},\n\n\t\tsetDescription(description: string): void\n\t\t{\n\t\t\tthis.description = description;\n\t\t},\n\n\t\tonTextareaFocus(event: FocusEvent): void\n\t\t{\n\t\t\tthis.descriptionBeforeFocus = event.target.value;\n\n\t\t\tthis.setWasUsed(true);\n\t\t\tthis.onFocus();\n\t\t},\n\n\t\tonTextareaKeydown(event): void\n\t\t{\n\t\t\tif (event.keyCode !== 13)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst isMacCtrlKeydown = Browser.isMac() && (event.metaKey === true || event.altKey === true);\n\n\t\t\tif (event.ctrlKey === true || isMacCtrlKeydown)\n\t\t\t{\n\t\t\t\tthis.onSaveHotkeyPressed();\n\t\t\t}\n\t\t},\n\n\t\tsetTextareaFocused(): void\n\t\t{\n\t\t\tthis.setWasUsed(true);\n\t\t\tthis.$refs.textarea.focus();\n\t\t},\n\n\t\tsetWasUsed(value: boolean): void\n\t\t{\n\t\t\tthis.wasUsed = value;\n\t\t},\n\n\t\tonDeadlineClick(): void\n\t\t{\n\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\t\tBX.calendar({\n\t\t\t\tnode: this.$refs.deadline,\n\t\t\t\tbTime: true,\n\t\t\t\tbHideTime: false,\n\t\t\t\tbSetFocus: false,\n\t\t\t\tvalue: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), this.currentDeadline),\n\t\t\t\tcallback: this.onSetDeadlineByCalendar.bind(this),\n\t\t\t});\n\t\t},\n\n\t\tonSetDeadlineByCalendar(deadline: Date): void\n\t\t{\n\t\t\tthis.setDeadline(deadline);\n\n\t\t\tthis.sendAnalyticsDeadlineChange();\n\t\t},\n\n\t\tsetDeadline(deadline: Date): void\n\t\t{\n\t\t\tthis.currentDeadline = deadline;\n\n\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_DEADLINE_CHANGE, { deadline });\n\t\t},\n\n\t\tonResponsibleUserChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tif (data)\n\t\t\t{\n\t\t\t\tthis.setResponsibleUserId(data.responsibleUserId);\n\n\t\t\t\tif (!this.responsibleUserSelectorChangeSended)\n\t\t\t\t{\n\t\t\t\t\tthis.responsibleUserSelectorChangeSended = true;\n\t\t\t\t\tthis.sendAnalytics(EventIds.activityTouch, ElementIds.responsibleUserId);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tonCalendarChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tif (data)\n\t\t\t{\n\t\t\t\tthis.currentDeadline = new Date(data.from);\n\t\t\t\tthis.calendarDateTo = new Date(data.to);\n\n\t\t\t\tthis.sendAnalyticsDeadlineChange();\n\t\t\t}\n\t\t},\n\n\t\tsetPingOffsets(offsets: number[]): void\n\t\t{\n\t\t\tthis.pingOffsets = offsets;\n\t\t},\n\n\t\tsetResponsibleUserId(userId: number): void\n\t\t{\n\t\t\tthis.responsibleUserId = userId;\n\t\t},\n\n\t\tresetPingOffsetsToDefault(): void\n\t\t{\n\t\t\tthis.setPingOffsets(this.pingSettings.selectedValues);\n\t\t\tthis.$refs.pingSelector?.setValue(this.pingSettings.selectedValues);\n\t\t},\n\n\t\tresetResponsibleUserToDefault(): void\n\t\t{\n\t\t\tthis.setResponsibleUserId(this.currentUser.userId);\n\n\t\t\tconst userSelector = this.$refs.userSelector;\n\t\t\tif (userSelector)\n\t\t\t{\n\t\t\t\tuserSelector.resetToDefault();\n\t\t\t}\n\t\t},\n\n\t\tresetColorSelectorToDefault(): void\n\t\t{\n\t\t\tconst colorSelector = this.$refs.colorSelector;\n\t\t\tif (colorSelector)\n\t\t\t{\n\t\t\t\tcolorSelector.resetToDefault();\n\t\t\t}\n\t\t},\n\n\t\tgetData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttitle: (\n\t\t\t\t\t(Type.isString(this.title) && Type.isStringFilled(this.title.trim()))\n\t\t\t\t\t\t? this.title.trim()\n\t\t\t\t\t\t: null\n\t\t\t\t),\n\t\t\t\tdescription: this.description,\n\t\t\t\tdeadline: this.currentDeadline,\n\t\t\t\tresponsibleUserId: this.responsibleUserId,\n\t\t\t\tpingOffsets: this.$refs.pingSelector?.getValue(),\n\t\t\t\tcolorId: this.$refs.colorSelector?.getValue(),\n\t\t\t};\n\t\t},\n\n\t\tonColorSelectorValueChange(): void\n\t\t{\n\t\t\tif (!this.colorSelectorChangeSended)\n\t\t\t{\n\t\t\t\tthis.colorSelectorChangeSended = true;\n\t\t\t\tthis.sendAnalytics(EventIds.activityTouch, ElementIds.colorSettings);\n\t\t\t}\n\t\t},\n\n\t\tonPingSettingsSelectorValueChange(): void\n\t\t{\n\t\t\tif (!this.pingSettingsSelectorChangeSended)\n\t\t\t{\n\t\t\t\tthis.pingSettingsSelectorChangeSended = true;\n\t\t\t\tthis.sendAnalytics(EventIds.activityTouch, ElementIds.pingSettings);\n\t\t\t}\n\t\t},\n\n\t\tsendAnalyticsDeadlineChange(): void\n\t\t{\n\t\t\tif (!this.isDeadlineChanged)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics(EventIds.activityTouch, ElementIds.deadline);\n\t\t\t\tthis.isDeadlineChanged = true;\n\t\t\t}\n\t\t},\n\n\t\tsendAnalytics(event: string, element: string): void\n\t\t{\n\t\t\tif (this.analytics === null)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.analytics\n\t\t\t\t.setEvent(event)\n\t\t\t\t.setElement(element)\n\t\t\t\t.send()\n\t\t\t;\n\t\t},\n\n\t\tonTitleInput(event: InputEvent): void\n\t\t{\n\t\t\tconst { value } = event.target;\n\n\t\t\tthis.setTitle(value);\n\t\t},\n\n\t\tonTitleFocus(event: FocusEvent): void\n\t\t{\n\t\t\tthis.titleBeforeFocus = event.target.value;\n\t\t},\n\n\t\tonTitleBlur(event: FocusEvent): void\n\t\t{\n\t\t\tconst { value } = event.target;\n\n\t\t\tif (value !== this.defaultTitle && value !== this.titleBeforeFocus)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics(EventIds.activityTouch, ElementIds.title);\n\t\t\t}\n\t\t},\n\n\t\tonTextareaInput(event: InputEvent): void\n\t\t{\n\t\t\tconst { value } = event.target;\n\n\t\t\tthis.setDescription(value);\n\t\t},\n\n\t\tonTextareaBlur(event: FocusEvent): void\n\t\t{\n\t\t\tconst { value } = event.target;\n\n\t\t\tif (Type.isStringFilled(value) && value !== this.descriptionBeforeFocus)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics(EventIds.activityTouch, ElementIds.description);\n\t\t\t}\n\t\t},\n\n\t\tonActionsPopupItemClick({ data: { id, componentId, componentParams } }): void\n\t\t{\n\t\t\tconst actionId = Type.isNil(componentId) ? id : componentId;\n\n\t\t\tif (!Type.isStringFilled(actionId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.blocksData.forEach((block: BlockSettings) => {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tblock.focused = false;\n\t\t\t});\n\n\t\t\tconst block = this.getBlockDataById(actionId);\n\n\t\t\tif (Type.isPlainObject(componentParams))\n\t\t\t{\n\t\t\t\tblock.settings = {\n\t\t\t\t\t...componentParams,\n\t\t\t\t\t...this.getBlockDataFromPropsById(actionId).settings,\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tblock.settings = Runtime.clone(this.getBlockDataFromPropsById(actionId).settings);\n\t\t\t}\n\n\t\t\tthis.prepareBlockDataWithEditorParams(\n\t\t\t\tblock,\n\t\t\t\t{\n\t\t\t\t\tcurrentDeadline: this.currentDeadline,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tblock.active = true;\n\t\t\tblock.focused = true;\n\t\t\tblock.sort = this.getNextBlockSortValue();\n\n\t\t\tthis.setTextareaFocused();\n\n\t\t\tif (!this.addBlockSended)\n\t\t\t{\n\t\t\t\tthis.addBlockSended = true;\n\t\t\t\tthis.sendAnalytics(EventIds.activityTouch, ElementIds.addBlock);\n\t\t\t}\n\t\t},\n\n\t\tgetNextBlockSortValue(): number\n\t\t{\n\t\t\tlet maxSortValue = 0;\n\n\t\t\tthis.blocksData.forEach((data) => {\n\t\t\t\tif (maxSortValue < data.sort)\n\t\t\t\t{\n\t\t\t\t\tmaxSortValue = data.sort;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn ++maxSortValue;\n\t\t},\n\n\t\tonCopilotTextareaValueChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst copilotId = this.isCopilotEnabled ? this.copilotTextarea.getId() : '';\n\t\t\tconst id = event.getData().id;\n\n\t\t\tif (this.wasUsed && copilotId === id)\n\t\t\t{\n\t\t\t\tconst value = event.getData().value;\n\n\t\t\t\tthis.setDescription(value);\n\t\t\t}\n\t\t},\n\n\t\tshowActionsPopup(event: BaseEvent): void\n\t\t{\n\t\t\tthis.actionsPopup.bindElement(event.target).show();\n\t\t},\n\n\t\tonBlockCloseClick(id: string): void\n\t\t{\n\t\t\tconst block = this.getBlockDataById(id);\n\n\t\t\tthis.resetBlock(block);\n\t\t},\n\n\t\tcloseBlocks(): void\n\t\t{\n\t\t\tthis.blocksData.forEach((block: BlockSettings) => {\n\t\t\t\tthis.resetBlock(block);\n\t\t\t});\n\t\t},\n\n\t\tresetBlock(block: BlockSettings): void\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblock.active = false;\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblock.focused = false;\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblock.sort = 0;\n\n\t\t\tif (Type.isFunction(this.$refs[block.id]?.reset))\n\t\t\t{\n\t\t\t\tthis.$refs[block.id].reset();\n\t\t\t}\n\n\t\t\tconst blockData = this.getBlockDataById(block.id);\n\t\t\tif (Type.isObject(blockData))\n\t\t\t{\n\t\t\t\tdelete blockData.filledValues;\n\t\t\t}\n\t\t},\n\n\t\tgetExecutedBlocksData(): Object[]\n\t\t{\n\t\t\tconst data = [];\n\t\t\tthis.blocksData.filter((block) => block.active).forEach((block: BlockSettings) => {\n\t\t\t\tdata.push({\n\t\t\t\t\t...this.$refs[block.id][0].getExecutedData(),\n\t\t\t\t\tid: block.id,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\n\t\tgetBlockComponentName(blockId: string): string\n\t\t{\n\t\t\treturn `TodoEditorBlocks${blockId.charAt(0).toUpperCase()}${blockId.slice(1)}`;\n\t\t},\n\n\t\tgetBlockDataById(blockId: string): BlockSettings\n\t\t{\n\t\t\treturn this.blocksData.find((block) => block.id === blockId);\n\t\t},\n\n\t\tgetBlockDataFromPropsById(blockId: string): BlockSettings\n\t\t{\n\t\t\treturn this.blocks.find((block) => block.id === blockId);\n\t\t},\n\n\t\tupdateFilledValues(blockId: string, data: Object): void\n\t\t{\n\t\t\tconst blockData = this.getBlockDataById(blockId);\n\n\t\t\tif (blockData)\n\t\t\t{\n\t\t\t\tblockData.filledValues = { ...blockData.filledValues, ...data };\n\t\t\t}\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_CALENDAR_CHANGE, this.onCalendarChange);\n\n\t\tEventEmitter.subscribe(this.actionsPopup, Events.EVENT_ACTIONS_POPUP_ITEM_CLICK, this.onActionsPopupItemClick);\n\n\t\tif (this.isCopilotEnabled)\n\t\t{\n\t\t\tthis.copilotTextarea = new CopilotTextarea({\n\t\t\t\tid: Text.getRandom(),\n\t\t\t\ttarget: this.$refs.textarea,\n\t\t\t\tcopilotParams: this.copilotSettings,\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(CopilotTextareaEvents.EVENT_VALUE_CHANGE, this.onCopilotTextareaValueChange);\n\t\t}\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tthis.$Bitrix.eventEmitter.unsubscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t\tthis.$Bitrix.eventEmitter.unsubscribe(Events.EVENT_CALENDAR_CHANGE, this.onCalendarChange);\n\n\t\tEventEmitter.unsubscribe(this.actionsPopup, Events.EVENT_ACTIONS_POPUP_ITEM_CLICK, this.onActionsPopupItemClick);\n\n\t\tif (this.isCopilotEnabled)\n\t\t{\n\t\t\tEventEmitter.unsubscribe(CopilotTextareaEvents.EVENT_VALUE_CHANGE, this.onCopilotTextareaValueChange);\n\t\t}\n\t},\n\n\ttemplate: `\n\t\t<label>\n\t\t\t<div class=\"crm-activity__todo-editor-v2_container\">\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_header\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tv-if=\"wasUsed\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tref=\"title\"\n\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_input_control --title\"\n\t\t\t\t\t\t:value=\"title\"\n\t\t\t\t\t\t:placeholder=\"placeholderTitle\"\n\t\t\t\t\t\tmaxlength=\"40\"\n\t\t\t\t\t\t@input=\"onTitleInput\"\n\t\t\t\t\t\t@focus=\"onTitleFocus\"\n\t\t\t\t\t\t@blur=\"onTitleBlur\"\n\t\t\t\t\t>\n\t\t\t\t\t<TodoEditorColorSelector\n\t\t\t\t\t\tref=\"colorSelector\"\n\t\t\t\t\t\t:valuesList=\"colorSettings.valuesList\"\n\t\t\t\t\t\t:selectedValueId=\"colorSettings.selectedValueId\"\n\t\t\t\t\t\t@onChange=\"onColorSelectorValueChange\"\n\t\t\t\t\t/>\n\t\t\t\t\t<TodoEditorResponsibleUserSelector\n\t\t\t\t\t\t:userId=\"currentUserData.userId\"\n\t\t\t\t\t\t:userName=\"currentUserData.title\"\n\t\t\t\t\t\t:imageUrl=\"currentUserData.imageUrl\"\n\t\t\t\t\t\tref=\"userSelector\"\n\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_action-btn\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_body\">\n\t\t\t\t\t<textarea\n\t\t\t\t\t\trows=\"2\"\n\t\t\t\t\t\tref=\"textarea\"\n\t\t\t\t\t\t@keydown=\"onTextareaKeydown\"\n\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_input_control\"\n\t\t\t\t\t\t:placeholder=\"placeholderDescription\"\n\t\t\t\t\t\t@input=\"onTextareaInput\"\n\t\t\t\t\t\t@focus=\"onTextareaFocus\"\n\t\t\t\t\t\t@blur=\"onTextareaBlur\"\n\t\t\t\t\t\t:value=\"description\"\n\t\t\t\t\t\t:class=\"{ '--has-scroll': isTextareaToLong }\"\n\t\t\t\t\t></textarea>\n\t\t\t\t\t<button \n\t\t\t\t\t\tclass=\"crm-activity__todo-show-actions-popup-button ui-btn ui-btn-sm ui-btn-base-light\"\n\t\t\t\t\t\t@click=\"showActionsPopup\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ popupMenuButtonTitle }}\n\t\t\t\t\t\t<span class=\"crm-activity__todo-show-actions-popup-button-arrow\"></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<div class=\"crm-activity__todo-editor-v2_tools\" v-if=\"wasUsed\">\n\t\t\t\t\t\t<div class=\"crm-activity__todo-editor-v2_left_tools\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tref=\"deadline\"\n\t\t\t\t\t\t\t\t@click=\"onDeadlineClick\"\n\t\t\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_deadline\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"crm-activity__todo-editor-v2_deadline-pill\">\n\t\t\t\t\t\t\t\t\t<span class=\"crm-activity__todo-editor-v2_deadline-icon\"></span>\n\t\t\t\t\t\t\t\t\t<span class=\"crm-activity__todo-editor-v2_deadline-text\">{{ deadlineFormatted }}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<TodoEditorPingSelector\n\t\t\t\t\t\t\t\tref=\"pingSelector\"\n\t\t\t\t\t\t\t\t:valuesList=\"pingSettings.valuesList\"\n\t\t\t\t\t\t\t\t:selectedValues=\"pingOffsets\"\n\t\t\t\t\t\t\t\t:deadline=\"currentDeadline\"\n\t\t\t\t\t\t\t\t@onChange=\"onPingSettingsSelectorValueChange\"\n\t\t\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_ping_selector\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-wrapper\"\n\t\t\t\tv-for=\"block in orderedBlocksData\"\n\t\t\t\tkey=\"block.id\"\n\t\t\t\tv-show=\"block?.active\"\n\t\t\t>\n\t\t\t\t<component\n\t\t\t\t\tv-if=\"block?.active\"\n\t\t\t\t\tv-bind:is=\"getBlockComponentName(block.id)\"\n\t\t\t\t\t:ref=\"block.id\"\n\t\t\t\t\t@close=\"onBlockCloseClick\"\n\t\t\t\t\t:id=\"getBlockDataById(block.id).id\"\n\t\t\t\t\t:title=\"getBlockDataById(block.id).title\"\n\t\t\t\t\t:icon=\"getBlockDataById(block.id).icon\"\n\t\t\t\t\t:settings=\"getBlockDataById(block.id).settings ?? {}\"\n\t\t\t\t\t:filledValues=\"getBlockDataById(block.id).filledValues\"\n\t\t\t\t\t:isFocused=\"getBlockDataById(block.id).focused\"\n\t\t\t\t\t:context=\"context\"\n\t\t\t\t\t@updateFilledValues=\"updateFilledValues\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</label>\n\t`,\n};\n","import { Loc, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Menu, MenuManager } from 'main.popup';\nimport { FeaturePromotersRegistry } from 'ui.info-helper';\nimport { Events } from './components/todo-editor';\nimport type { ActionMenuItem } from './todo-editor';\n\nconst DELIMITER_TYPE = 'delimiter';\n\nexport default class ActionsPopup\n{\n\t#menu: Menu = null;\n\t#items: ActionMenuItem[] = [];\n\t#bindElement: HTMLElement = null;\n\n\tconstructor(items: Object[])\n\t{\n\t\tthis.#items = items;\n\t}\n\n\tbindElement(bindElement: HTMLElement): ActionsPopup\n\t{\n\t\tthis.#bindElement = bindElement;\n\n\t\treturn this;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getMenuPopup().show();\n\t}\n\n\t#getMenuPopup(): Menu\n\t{\n\t\tif (Type.isNil(this.#menu))\n\t\t{\n\t\t\tthis.#menu = MenuManager.create({\n\t\t\t\tid: `crm-activity__todo-editor-v2-actions-menu_${Text.getRandom()}`,\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 50,\n\t\t\t\tangle: true,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\titems: this.#getPreparedItems(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t#getPreparedItems(): Object[]\n\t{\n\t\tconst result = [];\n\n\t\tthis.#items.forEach((itemData) => {\n\t\t\tif (itemData.hidden)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresult.push(this.#getActionItem(itemData));\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#getActionItem(itemData: Object): Object\n\t{\n\t\tconst { svgData, messageCode, id, onClick, type, componentId, componentParams } = itemData;\n\n\t\tif (type === DELIMITER_TYPE)\n\t\t{\n\t\t\treturn {\n\t\t\t\tdelimiter: true,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\thtml: this.#getActionItemHtml(svgData, messageCode, componentParams?.isLocked),\n\t\t\tonclick: this.onItemClick.bind(this, { id, componentId, componentParams, onClick }),\n\t\t};\n\t}\n\n\tonItemClick({ id, componentId, componentParams, onClick }): void\n\t{\n\t\tif (componentParams?.isLocked)\n\t\t{\n\t\t\tFeaturePromotersRegistry.getPromoter({ featureId: 'calendar_location' }).show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isFunction(onClick))\n\t\t{\n\t\t\tonClick();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#onClickActionItem({\n\t\t\t\tid,\n\t\t\t\tcomponentId,\n\t\t\t\tcomponentParams,\n\t\t\t});\n\t\t}\n\n\t\tthis.#menu.close();\n\t}\n\n\t#getActionItemHtml(svgData: string, messageCode: string, isLocked: boolean = false): string\n\t{\n\t\treturn `\n\t\t\t<span class=\"crm-activity__todo-editor-v2-actions-menu-item ${isLocked ? '--locked' : ''}\">\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-activity__todo-editor-v2-actions-menu-item-icon\"\n\t\t\t\t\tstyle=\"background-image: url('data:image/svg+xml,${encodeURIComponent(svgData)}')\"\n\t\t\t\t></span>\n\t\t\t\t${Loc.getMessage(messageCode)}\n\t\t\t</span>\n\t\t`;\n\t}\n\n\t#onClickActionItem({ id, componentId, componentParams }): void\n\t{\n\t\tconst data = {\n\t\t\tid,\n\t\t\tcomponentId,\n\t\t\tcomponentParams,\n\t\t};\n\n\t\tEventEmitter.emit(this, Events.EVENT_ACTIONS_POPUP_ITEM_CLICK, data);\n\t}\n}\n","export class TodoEditorBorderColor {\n\tstatic DEFAULT = 'default';\n\tstatic PRIMARY = 'primary';\n}","import { DatetimeConverter } from 'crm.timeline.tools';\nimport { ajax as Ajax, Dom, Extension, Loc, Runtime, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { UI } from 'ui.notification';\nimport { BitrixVue } from 'ui.vue3';\nimport ActionsPopup from './actions-popup';\nimport type { ElementIdsType, SectionIdType, SubSectionIdType } from './analytics';\nimport { Analytics, ElementIds, EventIds, Section, SubSection } from './analytics';\nimport {\n\tTodoEditorBlocksAddress,\n\tTodoEditorBlocksCalendar,\n\tTodoEditorBlocksClient,\n\tTodoEditorBlocksFile,\n\tTodoEditorBlocksLink,\n} from './components/block/index';\nimport { Events, TodoEditor as TodoEditorComponent } from './components/todo-editor';\nimport { TodoEditorBorderColor } from './enums/border-color';\n\nimport './todo-editor.css';\n\ndeclare type TodoEditorParams = {\n\tcontainer: HTMLElement,\n\tdeadline?: Date,\n\tdefaultDescription?: string,\n\tevents?: { [event: string]: (event) => {} },\n\townerId: number,\n\tcurrentUser?: Object,\n\tpingSettings: Object,\n\tcopilotSettings?: Object,\n\tcolorSettings: ColorSettings,\n\tcalendarSettings?: Object,\n\tactionMenuSettings?: ActionMenuSettings,\n\townerTypeId: number,\n\tborderColor: string,\n\tpopupMode: boolean,\n\tanalytics?: AnalyticsSettings,\n};\n\nexport type ColorSettings = {\n\tvaluesList: ColorItem[],\n\tcurrentValueId: ?string,\n}\n\ntype ColorItem = {\n\tid: string,\n\ttitle: string,\n\tcolor: string,\n\ticonBackground: string,\n\titemBackground: string,\n\tlogoBackground: string,\n}\n\ntype ActionMenuSettings = {\n\thiddenActionItems: string[],\n}\n\ntype CancelParams = {\n\tsendAnalytics: boolean,\n\tanalytics?: AnalyticsSettings;\n}\n\ntype AnalyticsSettings = {\n\tsection: SectionIdType;\n\tsubSection: SubSectionIdType;\n\telement?: ElementIdsType;\n\tnotificationSkipPeriod?: string;\n}\n\nexport type BlockSettings = {\n\tid: string,\n\ttitle: string,\n\ticon: string,\n\tsort: number,\n\tsettings?: Object,\n\tactive?: boolean,\n\tfocused?: boolean,\n\tfilledValues?: Object,\n}\n\nexport const TodoEditorMode = {\n\tADD: 'add',\n\tUPDATE: 'update',\n\tCOPY: 'copy',\n};\n\nexport type ActionMenuItem = {\n\tid?: string,\n\thidden?: boolean,\n\tmessageCode?: string,\n\tsvgData?: string,\n\tcomponentId?: string,\n\tcomponentParams?: Object,\n\ttype?: string,\n\tonClick?: Function,\n}\n\n/**\n * @memberOf BX.Crm.Activity\n */\nexport class TodoEditorV2\n{\n/**\n * @event onFocus\n * @event onSaveHotkeyPressed\n */\n\tstatic BorderColor = TodoEditorBorderColor;\n\tstatic AnalyticsSection = Section;\n\tstatic AnalyticsSubSection = SubSection;\n\tstatic AnalyticsElement = ElementIds;\n\tstatic AnalyticsEvent = EventIds;\n\n\t#container: HTMLElement = null;\n\t#layoutApp = null;\n\t#layoutComponent = null;\n\t#loadingPromise: ?Promise = null;\n\n\t#mode: String = TodoEditorMode.ADD;\n\t#ownerTypeId: Number = null;\n\t#ownerId: Number = null;\n\t#currentUser: Object = null;\n\t#pingSettings: Object = null;\n\t#copilotSettings: ?Object = null;\n\t#colorSettings: ?ColorSettings = null;\n\t#calendarSettings: ?Object = null;\n\t#defaultTitle: String = null;\n\t#defaultDescription: String = null;\n\t#deadline: Date = null;\n\t#parentActivityId: Number = null;\n\t#borderColor = '';\n\t#activityId: Number = null;\n\t#eventEmitter: EventEmitter = null;\n\t#popupMode: boolean = false;\n\t#hiddenActionItems: string[] = [];\n\t#actionsPopup: ?ActionsPopup = null;\n\t#analytics: ?Analytics = null;\n\n\tconstructor(params: TodoEditorParams)\n\t{\n\t\tthis.#checkParams(params);\n\t\tthis.#initParams(params);\n\t\tthis.#prepareContainer();\n\n\t\tthis.onUpdateHandler = this.onUpdateHandler.bind(this);\n\t\tthis.onRepeatHandler = this.onRepeatHandler.bind(this);\n\n\t\tthis.#bindEvents(params);\n\t}\n\n\t#checkParams(params: TodoEditorParams): void\n\t{\n\t\tif (!Type.isDomNode(params.container))\n\t\t{\n\t\t\tthrow new Error('TodoEditor container must be a DOM Node');\n\t\t}\n\n\t\tif (!Type.isNumber(params.ownerTypeId))\n\t\t{\n\t\t\tthrow new TypeError('OwnerTypeId must be set');\n\t\t}\n\n\t\tif (!Type.isNumber(params.ownerId))\n\t\t{\n\t\t\tthrow new TypeError('OwnerId must be set');\n\t\t}\n\n\t\tif (!Type.isObjectLike(params.currentUser))\n\t\t{\n\t\t\tthrow new TypeError('Current user must be set');\n\t\t}\n\n\t\tif (!Type.isObjectLike(params.pingSettings) || Object.keys(params.pingSettings).length === 0)\n\t\t{\n\t\t\tthrow new TypeError('Ping settings must be set');\n\t\t}\n\n\t\tif (!Type.isObjectLike(params.calendarSettings) || Object.keys(params.calendarSettings).length === 0)\n\t\t{\n\t\t\tthrow new TypeError('Calendar settings must be set');\n\t\t}\n\n\t\tif (!Type.isObjectLike(params.colorSettings) || Object.keys(params.colorSettings).length === 0)\n\t\t{\n\t\t\tthrow new TypeError('Color settings must be set');\n\t\t}\n\t}\n\n\t#initParams(params: TodoEditorParams): void\n\t{\n\t\tthis.#container = params.container;\n\t\tthis.#borderColor = this.#isValidBorderColor(params.borderColor)\n\t\t\t? params.borderColor\n\t\t\t: TodoEditorV2.BorderColor.DEFAULT\n\t\t;\n\n\t\tthis.#ownerTypeId = params.ownerTypeId;\n\t\tthis.#ownerId = params.ownerId;\n\t\tthis.#currentUser = params.currentUser;\n\t\tthis.#pingSettings = params.pingSettings || {};\n\t\tthis.#copilotSettings = params.copilotSettings || null;\n\t\tthis.#colorSettings = params.colorSettings;\n\t\tthis.#calendarSettings = params.calendarSettings || {};\n\t\tthis.#defaultTitle = this.#getDefaultTitle();\n\t\tthis.#defaultDescription = Type.isString(params.defaultDescription)\n\t\t\t? params.defaultDescription\n\t\t\t: this.#getDefaultDescription()\n\t\t;\n\t\tthis.#deadline = Type.isDate(params.deadline) ? params.deadline : null;\n\t\tif (!this.#deadline)\n\t\t{\n\t\t\tthis.setDefaultDeadLine(false);\n\t\t}\n\n\t\tif (Type.isArrayFilled(params.actionMenuSettings?.hiddenActionItems))\n\t\t{\n\t\t\tthis.#hiddenActionItems = params.actionMenuSettings.hiddenActionItems;\n\t\t}\n\n\t\tthis.#popupMode = Type.isBoolean(params.popupMode) ? params.popupMode : false;\n\n\t\tif (Type.isPlainObject(params.analytics))\n\t\t{\n\t\t\tthis.#analytics = Analytics.createFromToDoEditorData({\n\t\t\t\tanalyticSection: params.analytics.section,\n\t\t\t\tanalyticSubSection: params.analytics.subSection,\n\t\t\t});\n\t\t}\n\t}\n\n\t#prepareContainer(): void\n\t{\n\t\tDom.addClass(this.#container, this.#getClassname());\n\t}\n\n\tsetMode(mode: String): TodoEditorV2\n\t{\n\t\tif (!Object.values(TodoEditorMode).includes(mode))\n\t\t{\n\t\t\tthrow new Error(`Unknown TodoEditor mode ${mode}`);\n\t\t}\n\n\t\tthis.#mode = mode;\n\n\t\tif (this.#layoutComponent)\n\t\t{\n\t\t\tthis.#layoutComponent.setMode(mode);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#layoutApp = BitrixVue.createApp(TodoEditorComponent, {\n\t\t\tdeadline: this.#deadline,\n\t\t\tdefaultTitle: this.#defaultTitle,\n\t\t\tdefaultDescription: this.#defaultDescription,\n\t\t\tonFocus: this.#onInputFocus.bind(this),\n\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t\tpopupMode: this.#popupMode,\n\t\t\tcurrentUser: this.#currentUser,\n\t\t\tpingSettings: this.#pingSettings,\n\t\t\tcopilotSettings: this.#copilotSettings,\n\t\t\tcolorSettings: this.#colorSettings,\n\t\t\tactionsPopup: this.#getActionsPopup(),\n\t\t\tblocks: this.#getBlocks(),\n\t\t\tmode: this.#mode,\n\t\t\tanalytics: this.#getAnalyticsInstance(),\n\t\t});\n\n\t\tthis.#layoutComponent = this.#layoutApp.mount(this.#container);\n\t}\n\n\t#getActionsPopup(): ActionsPopup\n\t{\n\t\tif (this.#actionsPopup === null)\n\t\t{\n\t\t\tconst items: ActionMenuItem[] = [\n\t\t\t\t{\n\t\t\t\t\tid: 'calendar',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_CALENDAR',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M11.9907 10.3123H13.1133C13.3394 10.3123 13.5227 10.4944 13.5227 10.7191V11.8343C13.5227 12.0589 13.3394 12.241 13.1133 12.241H11.9907C11.7646 12.241 11.5813 12.0589 11.5813 11.8343V10.7191C11.5813 10.4944 11.7646 10.3123 11.9907 10.3123Z\" fill=\"#A8ADB4\"/><path d=\"M10.2021 10.3126H9.07947C8.85336 10.3126 8.67007 10.4947 8.67007 10.7193V11.8345C8.67007 12.0591 8.85336 12.2412 9.07947 12.2412H10.2021C10.4282 12.2412 10.6115 12.0591 10.6115 11.8345V10.7193C10.6115 10.4947 10.4282 10.3126 10.2021 10.3126Z\" fill=\"#A8ADB4\"/><path d=\"M10.2011 13.2054H9.07852C8.85242 13.2054 8.66912 13.3874 8.66912 13.6121V14.7273C8.66912 14.9519 8.85242 15.134 9.07852 15.134H10.2011C10.4272 15.134 10.6105 14.9519 10.6105 14.7273V13.6121C10.6105 13.3874 10.4272 13.2054 10.2011 13.2054Z\" fill=\"#A8ADB4\"/><path d=\"M13.1133 13.2054H11.9907C11.7646 13.2054 11.5813 13.3874 11.5813 13.6121V14.7273C11.5813 14.9519 11.7646 15.134 11.9907 15.134H13.1133C13.3394 15.134 13.5227 14.9519 13.5227 14.7273V13.6121C13.5227 13.3874 13.3394 13.2054 13.1133 13.2054Z\" fill=\"#A8ADB4\"/><path d=\"M14.9029 10.3123H16.0255C16.2516 10.3123 16.4349 10.4944 16.4349 10.7191V11.8343C16.4349 12.0589 16.2516 12.241 16.0255 12.241H14.9029C14.6768 12.241 14.4935 12.0589 14.4935 11.8343V10.7191C14.4935 10.4944 14.6768 10.3123 14.9029 10.3123Z\" fill=\"#A8ADB4\"/><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M17.1486 5.691V5.15946H18.3308C19.4103 5.2275 20.2467 6.16407 20.2272 7.28562V17.9164C20.2272 18.5032 19.7685 18.9795 19.201 18.9795H5.80482C5.23836 18.9795 4.77862 18.5032 4.77862 17.9164V7.28562C4.77451 7.23034 4.77246 7.17612 4.77246 7.12191C4.77451 6.03544 5.62627 5.15734 6.67505 5.15946H7.85724V5.691C7.85724 6.57123 8.54582 7.28562 9.39654 7.28562C10.2473 7.28562 10.9359 6.57123 10.9359 5.691V5.15946H14.07V5.691C14.07 6.57123 14.7596 7.28562 15.6093 7.28562C16.459 7.28562 17.1486 6.57123 17.1486 5.691ZM18.1748 16.8533H6.83106V8.40898H18.1748V16.8533Z\" fill=\"#A8ADB4\"/><path d=\"M10.1507 4.31111V5.4805C10.1507 5.91211 9.81308 6.26186 9.39644 6.26186C8.9798 6.26186 8.64218 5.91211 8.64218 5.4805V4.31111L8.64771 4.20959C8.69329 3.82206 9.01469 3.52246 9.40157 3.52442C9.81821 3.52762 10.1528 3.8795 10.1507 4.31111Z\" fill=\"#A8ADB4\"/><path d=\"M16.3215 4.33979V5.44858C16.3215 5.85574 16.0024 6.18636 15.6083 6.18636C15.2142 6.1853 14.8971 5.85468 14.8971 5.44752V4.33979C14.8971 3.93157 15.2163 3.60201 15.6093 3.60201C16.0024 3.60201 16.3215 3.93157 16.3215 4.33979Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t},\n\t\t\t\t// temporary commented\n\t\t\t\t// {\n\t\t\t\t// \tid: 'slot',\n\t\t\t\t// \tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_SLOT',\n\t\t\t\t// \tsvgData: '<svg width=\"25\" height=\"25\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M6.48621 17.5597H9.71158L8.73957 19.6426H5.48731C4.93592 19.6426 4.48842 19.1759 4.48842 18.601V8.18467C4.48442 8.13051 4.48242 8.07738 4.48242 8.02426C4.48442 6.95972 5.3135 6.09933 6.33437 6.10142H7.4851V6.62223C7.4851 7.4847 8.15536 8.18467 8.98344 8.18467C9.81152 8.18467 10.4818 7.4847 10.4818 6.62223V6.10142H13.5351V6.62223C13.5351 7.4847 14.2064 8.18467 15.0334 8.18467C15.8605 8.18467 16.5318 7.4847 16.5318 6.62223V6.10142H17.7853C18.8361 6.16808 19.6502 7.08575 19.6313 8.18467V11.9389L17.6335 10.274V9.28577H6.48621V17.5597ZM9.71763 6.41636V5.27057C9.71963 4.84767 9.39399 4.50289 8.98844 4.49977C8.58288 4.49768 8.25125 4.83829 8.24925 5.26015V5.27057V6.41636C8.24925 6.83926 8.57789 7.18196 8.98344 7.18196C9.38899 7.18196 9.71763 6.83926 9.71763 6.41636ZM15.7266 6.38426V5.29784C15.7266 4.89786 15.4159 4.57495 15.0333 4.57495C14.6507 4.57495 14.3401 4.89786 14.3401 5.29784V6.38322C14.3401 6.78216 14.6487 7.10611 15.0323 7.10715C15.4159 7.10715 15.7266 6.7832 15.7266 6.38426ZM8.77829 11.1139C8.50215 11.1139 8.27829 11.3377 8.27829 11.6139V12.5036C8.27829 12.7797 8.50215 13.0036 8.77829 13.0036H9.66803C9.94418 13.0036 10.168 12.7797 10.168 12.5036V11.6139C10.168 11.3377 9.94418 11.1139 9.66803 11.1139H8.77829ZM11.1129 11.6511C11.1129 11.375 11.3368 11.1511 11.6129 11.1511H12.5027C12.7788 11.1511 13.0027 11.375 13.0027 11.6511V12.5409C13.0027 12.817 12.7788 13.0409 12.5027 13.0409H11.6129C11.3368 13.0409 11.1129 12.817 11.1129 12.5409V11.6511ZM16.9787 12.1586C16.9787 11.9791 17.2088 11.8845 17.3531 12.0046L22.4009 16.205C22.5328 16.3148 22.5328 16.506 22.4009 16.6158L17.3531 20.8162C17.2088 20.9363 16.9787 20.8417 16.9787 20.6622V17.9552C16.9513 17.9654 16.9214 17.971 16.8903 17.971C13.9663 17.9713 11.4309 19.8957 10.3896 20.8119C10.23 20.9523 9.96759 20.8299 10.0157 20.6312C10.4226 18.9502 11.9512 14.6044 16.8959 14.4746C16.9249 14.4738 16.9529 14.4784 16.9787 14.4873V12.1586Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t// },\n\t\t\t\t{\n\t\t\t\t\ttype: 'delimiter',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'client',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_CLIENT',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M19.1102 18.7826C19.5562 18.6205 19.8037 18.1517 19.7122 17.686L19.3963 16.0768C19.3963 15.4053 18.5019 14.6382 16.7409 14.1912C16.1442 14.0278 15.577 13.7745 15.0596 13.4403C14.9464 13.3768 14.9636 12.7904 14.9636 12.7904L14.3964 12.7056C14.3964 12.658 14.3479 11.9547 14.3479 11.9547C15.0265 11.7309 14.9567 10.4105 14.9567 10.4105C15.3877 10.6451 15.6684 9.60016 15.6684 9.60016C16.1781 8.14839 15.4145 8.23617 15.4145 8.23617C15.5481 7.34989 15.5481 6.44915 15.4145 5.56287C15.075 2.62285 9.96373 3.42099 10.5698 4.38119C9.07596 4.11109 9.41682 7.44748 9.41682 7.44748L9.74084 8.31146C9.29173 8.5974 9.37993 8.92555 9.47844 9.29212C9.51952 9.44494 9.56238 9.60443 9.56886 9.77033C9.60016 10.6029 10.1192 10.4304 10.1192 10.4304C10.1512 11.8045 10.8415 11.9834 10.8415 11.9834C10.9712 12.8464 10.8904 12.6995 10.8904 12.6995L10.276 12.7725C10.2844 12.9687 10.2681 13.1652 10.2275 13.3576C9.87062 13.5137 9.6521 13.638 9.43575 13.761C9.21426 13.8869 8.99503 14.0116 8.6319 14.1679C7.24504 14.7644 5.73779 15.5403 5.46984 16.5849C5.3915 16.8903 5.31478 17.3009 5.24543 17.729C5.17275 18.1776 5.42217 18.6168 5.84907 18.7728C7.71183 19.4533 9.81409 19.8566 12.0441 19.9044H12.942C15.1614 19.8568 17.2541 19.4572 19.1102 18.7826Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'colleague',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_COLLEAGUE',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M15.3717 14.7295C15.3717 14.7295 15.8697 16.6051 16.1536 17.9919C16.2039 18.2372 16.0599 18.4795 15.8198 18.5503C14.2716 19.0067 12.5157 19.2655 10.6546 19.268H10.5989C8.33167 19.2649 6.22074 18.8816 4.45101 18.2238C4.09757 18.0925 3.90181 17.7203 3.97453 17.3503C4.14815 16.467 4.33844 15.5288 4.43784 15.1361C4.64903 14.3016 5.83236 13.6816 6.92075 13.205C7.20527 13.0805 7.37691 12.9811 7.55037 12.8806C7.72026 12.7822 7.89189 12.6828 8.17301 12.5578C8.20474 12.4044 8.21749 12.2477 8.21099 12.0911L8.69326 12.0328C8.69326 12.0328 8.75664 12.1501 8.6547 11.4606C8.6547 11.4606 8.11342 11.3162 8.0883 10.2184C8.0883 10.2184 7.68169 10.3563 7.65715 9.69107C7.65216 9.55801 7.61854 9.43016 7.58634 9.30774C7.50923 9.0145 7.4403 8.75241 7.79269 8.52443L7.53826 7.83494C7.53826 7.83494 7.27128 5.168 8.4438 5.38499C7.96824 4.6188 11.98 3.98123 12.2465 6.33026C12.3513 7.03836 12.3513 7.758 12.2465 8.46609C12.2465 8.46609 12.8459 8.39609 12.4457 9.55574C12.4457 9.55574 12.2254 10.3893 11.8872 10.2012C11.8872 10.2012 11.9421 11.2561 11.4093 11.4349C11.4093 11.4349 11.4472 11.9966 11.4472 12.0349L11.8927 12.104C11.8927 12.104 11.8804 12.5724 11.9681 12.6231C12.3741 12.8901 12.8192 13.0925 13.2875 13.2231C14.6706 13.5801 15.3717 14.1928 15.3717 14.7295Z\" fill=\"#A8ADB4\"/><path d=\"M21.5203 15.2542C21.5307 15.4621 21.5426 15.6981 21.5546 15.9373C21.5725 16.2952 21.3506 16.6229 21.0072 16.7257C19.8897 17.0604 18.6226 17.3309 17.2483 17.5217H16.816C16.7901 17.1556 16.4584 15.8876 16.266 15.1519C16.1897 14.8602 16.1352 14.6521 16.1304 14.6171C16.1056 13.9241 15.496 13.3052 14.4537 12.8823C14.5326 12.7757 14.6001 12.6612 14.6553 12.5407C14.8014 12.3594 14.992 12.2187 15.2085 12.1324L15.2252 11.5899L14.081 11.2324C14.081 11.2324 13.7869 11.095 13.7576 11.095C13.7915 11.0115 13.8339 10.9318 13.8841 10.857C13.906 10.7987 14.0445 10.3635 14.0445 10.3635C13.8779 10.5775 13.6825 10.7675 13.4638 10.9282C13.6639 10.5746 13.8337 10.2047 13.9712 9.82247C14.0619 9.45455 14.1226 9.07991 14.1529 8.7022C14.2312 8.01581 14.3536 7.33514 14.5192 6.66437C14.638 6.32965 14.8474 6.03436 15.1241 5.81126C15.533 5.5276 16.0102 5.35795 16.5067 5.31982H16.5651C17.0624 5.35763 17.5406 5.52729 17.9503 5.81126C18.2273 6.03393 18.4368 6.32909 18.5555 6.66379C18.7209 7.33461 18.8433 8.01526 18.9221 8.70162C18.9574 9.07094 19.0211 9.437 19.1128 9.79651C19.2503 10.1855 19.4171 10.5635 19.6118 10.9273C19.3927 10.7671 19.1969 10.5773 19.0299 10.3635C19.0299 10.3635 19.1377 10.7584 19.1593 10.8167C19.2185 10.9049 19.2712 10.9972 19.317 11.0929C19.2887 11.0929 18.9937 11.2303 18.9937 11.2303L17.8495 11.5879L17.8658 12.1307C18.0825 12.2167 18.2731 12.3574 18.4191 12.539C18.4883 12.7133 18.5979 12.8687 18.7389 12.9925C19.015 13.0885 19.2812 13.2108 19.5338 13.3577C19.9163 13.5702 20.149 13.6309 20.5105 13.8534C21.1937 14.2737 21.4835 14.5246 21.5201 15.2515L21.5203 15.2542Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t\tcomponentId: 'calendar',\n\t\t\t\t\tcomponentParams: {\n\t\t\t\t\t\tshowUserSelector: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'delimiter',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'address',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_ADDRESS',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12.5059 3.50928C9.12771 3.50928 6.41309 6.22284 6.41309 9.6021C6.41309 13.2243 10.1465 18.3027 11.7684 20.338C12.1493 20.816 12.8582 20.8132 13.2357 20.3325C14.8534 18.2721 18.5987 13.1219 18.5987 9.6021C18.5987 6.22284 15.8841 3.50928 12.5059 3.50928ZM12.506 12.3707C10.9556 12.3707 9.73636 11.1526 9.73636 9.60108C9.73636 8.05063 10.9545 6.83142 12.506 6.83142C14.0565 6.83142 15.2757 8.04956 15.2757 9.60108C15.2757 11.1526 14.0565 12.3707 12.506 12.3707Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t\thidden: !this.#canUseAddressBlock(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'room',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_ROOM',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"25\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5.23231 5.98876C6.98167 4.03949 18.4413 4.15905 20.0081 5.98876C21.5749 7.81847 21.8554 15.3273 20.0081 17.0395C19.6571 17.3648 18.9666 17.6131 18.0668 17.793C18.0471 18.8982 17.9669 21.1391 17.6418 21.1391C17.3455 21.1391 15.2474 19.3102 13.962 18.1643C10.2879 18.232 6.19211 17.778 5.23231 17.0395C3.55525 15.7491 3.48296 7.93803 5.23231 5.98876ZM6.27368 14.5419C6.87367 14.6452 7.7036 14.7319 8.66214 14.7982C8.72234 14.54 8.79838 14.2423 8.8529 14.029C8.89254 13.8739 8.9208 13.7633 8.92333 13.7447C8.93599 13.3759 9.43469 13.0463 9.97766 12.8211C9.93653 12.7643 9.90135 12.7034 9.87269 12.6394C9.79701 12.5432 9.69766 12.4684 9.58444 12.4221L9.57579 12.1334L10.172 11.9424C10.172 11.9424 10.3259 11.8694 10.3407 11.8694C10.3231 11.825 10.301 11.7825 10.2747 11.7426C10.2656 11.718 10.218 11.5663 10.1989 11.5056L10.191 11.4805C10.2773 11.5942 10.3789 11.6955 10.4928 11.7814C10.3883 11.593 10.2999 11.3962 10.2283 11.1929C10.181 10.997 10.1494 10.7976 10.1336 10.5966C10.0927 10.2313 10.029 9.86897 9.94254 9.51169C9.88118 9.33425 9.77217 9.17712 9.62748 9.05751C9.41503 8.90666 9.16566 8.81625 8.90592 8.7959H8.87605C8.61632 8.81632 8.36698 8.90673 8.15451 9.05751C8.0096 9.17698 7.9005 9.33415 7.83924 9.51169C7.75307 9.86902 7.68931 10.2313 7.64834 10.5966C7.62998 10.7932 7.59675 10.988 7.54893 11.1796C7.47744 11.3864 7.39056 11.5877 7.28902 11.7816C7.40367 11.6961 7.50591 11.5951 7.59282 11.4815C7.59282 11.4815 7.53662 11.6922 7.52531 11.7229C7.49449 11.7699 7.46708 11.819 7.44328 11.8699C7.4583 11.8699 7.61206 11.9429 7.61206 11.9429L8.20819 12.1334L8.19958 12.4221C8.08625 12.4682 7.98689 12.543 7.9113 12.6392C7.87548 12.7316 7.81841 12.8143 7.74472 12.8805C7.60094 12.9315 7.46246 12.9964 7.33121 13.0741C7.13253 13.187 6.91378 13.2603 6.68715 13.2896C6.45896 13.328 6.31499 13.7045 6.31499 13.7045C6.31464 13.7106 6.29359 14.1341 6.27368 14.5419ZM9.28982 14.8373C11.3578 14.9552 13.8758 14.9842 15.9706 14.8924C15.848 14.3765 15.7382 13.954 15.7382 13.954C15.7382 13.954 15.3331 13.2757 14.5348 13.0651C14.2636 12.9878 14.0063 12.8682 13.7724 12.7109C13.7348 12.6134 13.72 12.5086 13.729 12.4045L13.4731 12.3645C13.4731 12.342 13.4512 12.0104 13.4512 12.0104C13.7587 11.9049 13.7271 11.2824 13.7271 11.2824C13.9224 11.3929 14.0496 10.901 14.0496 10.901C14.2806 10.217 13.9345 10.2581 13.9345 10.2581C13.9951 9.84024 13.9951 9.41586 13.9345 8.99799C13.7808 7.61217 11.4644 7.98794 11.7391 8.44097C11.0622 8.31303 11.2167 9.88648 11.2167 9.88648L11.3636 10.2933C11.1602 10.4278 11.2001 10.5825 11.2446 10.7553C11.2632 10.8274 11.2825 10.9027 11.2854 10.9811C11.2996 11.3739 11.5343 11.2923 11.5343 11.2923C11.5489 11.9401 11.8615 12.0252 11.8615 12.0252C11.9202 12.432 11.8838 12.3618 11.8838 12.3618L11.6054 12.3963C11.6092 12.4887 11.6019 12.5813 11.5835 12.672C11.4219 12.7457 11.3229 12.8042 11.2252 12.8619C11.1246 12.9214 11.0254 12.98 10.8604 13.0537C10.232 13.3343 9.54886 13.7007 9.42766 14.193C9.39512 14.3251 9.34534 14.5617 9.28982 14.8373ZM16.6009 14.86C17.5258 14.806 18.3408 14.7254 18.9595 14.6151C18.9386 14.1847 18.9145 13.6995 18.914 13.693C18.914 13.693 18.7709 13.3189 18.5442 13.2808C18.3191 13.2516 18.1018 13.1789 17.9044 13.0667C17.774 12.9895 17.6364 12.925 17.4936 12.8744C17.4204 12.8085 17.3637 12.7264 17.328 12.6346C17.253 12.5391 17.1543 12.4647 17.0416 12.419L17.0333 12.1321L17.6255 11.9429C17.6255 11.9429 17.7783 11.8703 17.7932 11.8703C17.7695 11.8198 17.7422 11.7709 17.7115 11.7242C17.7003 11.6937 17.6445 11.4845 17.6445 11.4845C17.7308 11.5974 17.8324 11.6977 17.9463 11.7826C17.8454 11.59 17.7591 11.39 17.6881 11.1845C17.6406 10.9942 17.6075 10.8007 17.5893 10.6053C17.5486 10.2425 17.4853 9.88251 17.3997 9.52753C17.3388 9.35114 17.2304 9.195 17.0864 9.07631C16.8754 8.92651 16.6276 8.8367 16.3696 8.81641H16.3399C16.0819 8.83662 15.8342 8.92644 15.6231 9.07631C15.4793 9.19514 15.371 9.35125 15.31 9.52753C15.2242 9.88246 15.1609 10.2425 15.1202 10.6053C15.1046 10.805 15.0731 11.0031 15.0262 11.1978C14.9551 11.3996 14.8672 11.5952 14.7634 11.7825C14.8767 11.6971 15.0035 11.4835 15.0035 11.4835C15.0035 11.4835 14.9918 11.7131 14.9804 11.7437C14.9543 11.7834 14.9323 11.8256 14.9149 11.8697C14.9296 11.8697 15.0825 11.9423 15.0825 11.9423L15.6746 12.1321L15.6661 12.419C15.5535 12.4649 15.3162 12.6391 15.2754 12.6955C15.8148 12.9192 16.3102 13.3665 16.323 13.7329C16.3255 13.7515 16.3539 13.8629 16.3938 14.0188C16.4536 14.2532 16.5393 14.5883 16.6009 14.86Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t\tcomponentId: 'calendar',\n\t\t\t\t\tcomponentParams: {\n\t\t\t\t\t\tshowLocation: true,\n\t\t\t\t\t\tisLocked: !this.#isLocationFeatureEnabled(),\n\t\t\t\t\t},\n\t\t\t\t\thidden: !this.#canUseAddressBlock(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'delimiter',\n\t\t\t\t\thidden: !this.#canUseAddressBlock(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'link',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_LINK',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"25\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M16.4859 14.0353L17.7859 15.3353C18.5909 16.1402 18.5914 17.4575 17.7865 18.2624C16.9815 19.0674 15.6637 19.0674 14.8588 18.2624L13.5588 16.9624C12.9846 16.3883 12.8287 15.5561 13.0731 14.8323L13.474 15.2332C13.8267 15.586 14.4045 15.587 14.7578 15.2338C15.111 14.8805 15.1105 14.3022 14.7578 13.9494L14.3569 13.5485C15.0802 13.3046 15.9118 13.4611 16.4859 14.0353ZM7.27004 10.6737L5.97001 9.37368C5.16509 8.56875 5.16561 7.25145 5.97054 6.44652C6.77547 5.64159 8.09224 5.64159 8.89717 6.44652L10.1972 7.74655C10.7713 8.32068 10.9283 9.15282 10.6839 9.87558L10.047 9.23865C9.69373 8.88538 9.11594 8.88538 8.76267 9.23865C8.4094 9.59192 8.40992 10.1692 8.76319 10.5225L9.40012 11.1594C8.67684 11.4043 7.84417 11.2478 7.27004 10.6737ZM11.4334 6.67575L9.96797 5.21034C8.52873 3.7711 6.1736 3.7711 4.73436 5.21034C3.29512 6.64959 3.29512 9.00471 4.73436 10.444L6.19977 11.9094C7.41658 13.1262 9.28184 13.302 10.7022 12.4615L11.7715 13.5307C10.9304 14.9506 11.1068 16.8164 12.3231 18.0327L13.789 19.4986C15.2283 20.9379 17.5834 20.9379 19.0226 19.4986C20.4619 18.0594 20.4619 15.7043 19.0226 14.265L17.5567 12.7991C16.3404 11.5828 14.4746 11.4064 13.0553 12.2469L11.9861 11.1777C12.826 9.75783 12.6502 7.89257 11.4334 6.67575Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'file',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_FILE',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M18.6123 10.7026C18.7309 10.8212 18.7309 11.0135 18.6123 11.1321L17.8165 11.9279C17.6979 12.0465 17.5056 12.0465 17.387 11.9279L12.7007 7.24153C11.3529 5.89374 9.14743 5.89374 7.79963 7.24153C6.45184 8.58932 6.45184 10.7948 7.79963 12.1426L13.5486 17.8916C14.3938 18.7368 15.7665 18.7368 16.6118 17.8916C17.457 17.0463 17.457 15.6736 16.6118 14.8284L11.4754 9.69206C11.1323 9.34889 10.5933 9.34889 10.2502 9.69206C9.90699 10.0352 9.90699 10.5742 10.2502 10.9173L14.3239 14.991C14.4425 15.1096 14.4425 15.3019 14.3239 15.4205L13.5281 16.2163C13.4095 16.3349 13.2172 16.3349 13.0986 16.2163L9.0249 12.1426C8.00783 11.1255 8.00783 9.48386 9.0249 8.46679C10.042 7.44973 11.6836 7.44973 12.7007 8.46679L17.837 13.6031C19.3561 15.1222 19.3561 17.5977 17.837 19.1168C16.3179 20.6359 13.8424 20.6359 12.3233 19.1168L6.57437 13.3679C4.55268 11.3462 4.55268 8.03795 6.57437 6.01626C8.59606 3.99458 11.9043 3.99458 13.926 6.01626L18.6123 10.7026Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tthis.#prepareActionItems(items);\n\n\t\t\tthis.#actionsPopup = new ActionsPopup(items);\n\t\t}\n\n\t\treturn this.#actionsPopup;\n\t}\n\n\t#prepareActionItems(items: ActionMenuItem[]): void\n\t{\n\t\titems.forEach((item) => {\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\titem.hidden = (item.id && this.#hiddenActionItems.includes(item.id)) || item.hidden;\n\t\t});\n\t}\n\n\t#bindEvents(params: TodoEditorParams): void\n\t{\n\t\tthis.#eventEmitter = new EventEmitter();\n\t\tthis.#eventEmitter.setEventNamespace('Crm.Activity.TodoEditor');\n\n\t\tif (Type.isObject(params.events))\n\t\t{\n\t\t\tObject.keys(params.events).forEach((eventName) => {\n\t\t\t\tif (Type.isFunction(params.events[eventName]))\n\t\t\t\t{\n\t\t\t\t\tthis.#eventEmitter.subscribe(eventName, params.events[eventName]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tEventEmitter.subscribe(Events.EVENT_UPDATE_CLICK, this.onUpdateHandler);\n\t\tEventEmitter.subscribe(Events.EVENT_REPEAT_CLICK, this.onRepeatHandler);\n\t}\n\n\tasync onUpdateHandler(event: BaseEvent): void\n\t{\n\t\tconst canShowPrefilledComponent = await this.#canShowPrefilledComponent();\n\t\tif (!canShowPrefilledComponent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuBar = BX.Crm?.Timeline?.MenuBar?.getDefault();\n\t\tif (!menuBar)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tmenuBar.setActiveItemById('todo');\n\n\t\tconst { entityData, blocksData } = await this.#getUpdateOrRepeatActionData(event.getData());\n\n\t\tthis\n\t\t\t.setActivityId(entityData.id)\n\t\t\t.setCurrentUser(entityData.currentUser)\n\t\t;\n\n\t\tawait this.#showPrefilledComponent(entityData, blocksData, TodoEditorMode.UPDATE);\n\t}\n\n\tasync #canShowPrefilledComponent(): Promise\n\t{\n\t\tif (Dom.hasClass(this.#container, '--is-edit'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tUI.Dialogs.MessageBox.show({\n\t\t\t\t\tmodal: true,\n\t\t\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_CONFIRM_DIALOG_TITLE'),\n\t\t\t\t\tmessage: Loc.getMessage('CRM_ACTIVITY_TODO_CONFIRM_DIALOG_MESSAGE'),\n\t\t\t\t\tbuttons: BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tokCaption: Loc.getMessage('CRM_ACTIVITY_TODO_CONFIRM_DIALOG_OK_BUTTON'),\n\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: (messageBox) => {\n\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve(true);\n\t}\n\n\tasync onRepeatHandler(event: BaseEvent): void\n\t{\n\t\tconst canShowPrefilledComponent = await this.#canShowPrefilledComponent();\n\t\tif (!canShowPrefilledComponent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { entityData, blocksData } = await this.#getUpdateOrRepeatActionData(event.getData());\n\n\t\tthis.#setActiveMenuBarItem();\n\t\tthis\n\t\t\t.setActivityId(null)\n\t\t\t.setCurrentUser(entityData.currentUser)\n\t\t\t.setDefaultDeadLine()\n\t\t;\n\n\t\tentityData.deadline = this.#deadline;\n\t\tconst calendar = blocksData?.find((blockData) => blockData.id === 'calendar');\n\t\tif (Type.isObject(calendar))\n\t\t{\n\t\t\tcalendar.data.from = this.#deadline.getTime();\n\t\t}\n\n\t\tawait this.#showPrefilledComponent(entityData, blocksData, TodoEditorMode.COPY);\n\t}\n\n\t#setActiveMenuBarItem(): void\n\t{\n\t\tconst menuBar = BX.Crm?.Timeline?.MenuBar?.getDefault();\n\t\tif (menuBar)\n\t\t{\n\t\t\tmenuBar.setActiveItemById('todo');\n\t\t}\n\t}\n\n\tasync #getUpdateOrRepeatActionData(data: Object): Promise\n\t{\n\t\tconst { activityId, ownerTypeId, ownerId } = data;\n\t\tconst { data: { entityData, blocksData } } = await this.#fetchSettings({\n\t\t\tid: activityId,\n\t\t\townerTypeId,\n\t\t\townerId,\n\t\t});\n\n\t\treturn {\n\t\t\tentityData,\n\t\t\tblocksData,\n\t\t};\n\t}\n\n\tasync #showPrefilledComponent(entityData: Object, blocksData: Object, mode: string = TodoEditorMode.ADD): void\n\t{\n\t\tawait this.#initLayoutComponentForEdit(entityData, blocksData);\n\t\tthis.#scrollToTop();\n\n\t\tthis.setMode(mode);\n\t\tthis.setFocused();\n\t}\n\n\tasync #initLayoutComponentForEdit(entityData: Object, blocksData: Object[]): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tvoid this.#clearValue().then(() => {\n\t\t\t\tthis.#layoutComponent.setData(entityData);\n\n\t\t\t\tblocksData.forEach(({ id, data }) => {\n\t\t\t\t\tif (Type.isBoolean(data.active) && data.active === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#layoutComponent.setBlockFilledValues(id, data);\n\t\t\t\t\tthis.#layoutComponent.setBlockActive(id);\n\t\t\t\t});\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\t#scrollToTop(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: 0,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\tasync #fetchSettings({ id, ownerId, ownerTypeId }): Promise\n\t{\n\t\tconst data = {\n\t\t\tid,\n\t\t\townerId,\n\t\t\townerTypeId,\n\t\t};\n\n\t\treturn new Promise((resolve) => {\n\t\t\tAjax\n\t\t\t\t.runAction(this.#getConfigActionPath(), { data })\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch((errors) => {\n\t\t\t\t\tconsole.error(errors);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\t#getConfigActionPath(): String\n\t{\n\t\treturn 'crm.activity.todo.fetchSettings';\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (this.#loadingPromise)\n\t\t{\n\t\t\treturn this.#loadingPromise;\n\t\t}\n\n\t\t// wrap BX.Promise in native js promise\n\t\tthis.#loadingPromise = new Promise((resolve, reject) => {\n\t\t\tthis.#getSaveActionData().then((data) => {\n\t\t\t\tconst analytics = this.#getAnalyticsLabel(data);\n\n\t\t\t\tAjax\n\t\t\t\t\t.runAction(this.#getSaveActionPath(), {\n\t\t\t\t\t\tdata,\n\t\t\t\t\t\tanalytics,\n\t\t\t\t\t})\n\t\t\t\t\t.then(resolve)\n\t\t\t\t\t.catch(reject)\n\t\t\t\t;\n\t\t\t}).catch(reject);\n\t\t}).catch((response) => {\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\tautoHideDelay: 5000,\n\t\t\t});\n\n\t\t\t// so that on error returned promise is marked as rejected\n\t\t\tthrow response;\n\t\t}).finally(() => {\n\t\t\tthis.#loadingPromise = null;\n\t\t});\n\n\t\treturn this.#loadingPromise;\n\t}\n\n\t#getSaveActionData(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tvoid this.#getSaveActionDataSettings().then((settings) => {\n\t\t\t\tconst userData = this.#layoutComponent.getData();\n\t\t\t\tconst data = {\n\t\t\t\t\townerTypeId: this.#ownerTypeId,\n\t\t\t\t\townerId: this.#ownerId,\n\t\t\t\t\ttitle: userData.title,\n\t\t\t\t\tdescription: userData.description,\n\t\t\t\t\tresponsibleId: userData.responsibleUserId,\n\t\t\t\t\tdeadline: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), userData.deadline),\n\t\t\t\t\tparentActivityId: this.#parentActivityId,\n\t\t\t\t\tsettings,\n\t\t\t\t\tpingOffsets: userData.pingOffsets,\n\t\t\t\t\tcolorId: userData.colorId,\n\t\t\t\t};\n\n\t\t\t\tif (this.#mode === TodoEditorMode.UPDATE)\n\t\t\t\t{\n\t\t\t\t\tdata.id = this.#activityId;\n\t\t\t\t}\n\t\t\t\telse if (this.#mode === TodoEditorMode.COPY)\n\t\t\t\t{\n\t\t\t\t\tdata.isCopy = true;\n\t\t\t\t}\n\n\t\t\t\tresolve(data);\n\t\t\t});\n\t\t});\n\t}\n\n\t#getSaveActionPath(): String\n\t{\n\t\treturn (this.#mode === TodoEditorMode.UPDATE ? 'crm.activity.todo.update' : 'crm.activity.todo.add');\n\t}\n\n\t#getSaveActionDataSettings(): Promise\n\t{\n\t\tconst result = this.#layoutComponent.getExecutedBlocksData();\n\n\t\treturn Promise.resolve(result);\n\t}\n\n\t#getAnalyticsLabel(data: Object): Object\n\t{\n\t\tconst analyticsLabel = this.#getAnalyticsInstance();\n\t\tif (analyticsLabel === null)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\tanalyticsLabel\n\t\t\t.setEvent(EventIds.activityAdd)\n\t\t\t.setElement(ElementIds.createButton)\n\t\t;\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdata = Runtime.clone(data);\n\n\t\tconst pingOffsets = data.pingOffsets.map((value) => Number(value));\n\t\tconst defaultOffsets = this.#pingSettings.selectedValues;\n\t\tif (JSON.stringify(pingOffsets) !== JSON.stringify(defaultOffsets))\n\t\t{\n\t\t\tanalyticsLabel.setPingSettings(data.pingOffsets.join(','));\n\t\t}\n\n\t\tconst defaultColorId = 'default';\n\t\tif (data.colorId !== defaultColorId)\n\t\t{\n\t\t\tanalyticsLabel.setColorId(data.colorId);\n\t\t}\n\n\t\tconst blockTypes = [];\n\t\tdata.settings.forEach((block) => {\n\t\t\tblockTypes.push(block.id);\n\t\t});\n\t\tif (Type.isArrayFilled(blockTypes))\n\t\t{\n\t\t\tanalyticsLabel.setBlockTypes(blockTypes);\n\t\t}\n\n\t\treturn analyticsLabel.getData();\n\t}\n\n\t#getBlocks(): BlockSettings[]\n\t{\n\t\tconst blocks = [\n\t\t\tthis.#getCalendarBlockSettings(),\n\t\t\tthis.#getClientBlockSettings(),\n\t\t\tthis.#getLinkBlockSettings(),\n\t\t\tthis.#getFileBlockSettings(),\n\t\t];\n\n\t\tif (this.#canUseAddressBlock())\n\t\t{\n\t\t\tblocks.push(this.#getAddressBlockSettings());\n\t\t}\n\n\t\treturn blocks;\n\t}\n\n\t#getCalendarBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksCalendar.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_calendar-icon.svg',\n\t\t\tsettings: this.#calendarSettings,\n\t\t};\n\t}\n\n\t#getClientBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksClient.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_CLIENT_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_client-icon.svg',\n\t\t\tsettings: {\n\t\t\t\tentityTypeId: this.#ownerTypeId,\n\t\t\t\tentityId: this.#ownerId,\n\t\t\t},\n\t\t};\n\t}\n\n\t#getLinkBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksLink.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_link-icon.svg',\n\t\t};\n\t}\n\n\t#getFileBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksFile.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_FILE_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_file-icon.svg',\n\t\t\tsettings: {\n\t\t\t\tentityTypeId: this.#ownerTypeId,\n\t\t\t\tentityId: this.#ownerId,\n\t\t\t},\n\t\t};\n\t}\n\n\t#getAddressBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksAddress.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_address-icon.svg',\n\t\t\tsettings: {\n\t\t\t\tentityTypeId: this.#ownerTypeId,\n\t\t\t\tentityId: this.#ownerId,\n\t\t\t},\n\t\t};\n\t}\n\n\t#canUseAddressBlock(): boolean\n\t{\n\t\tconst settings = Extension.getSettings('crm.activity.todo-editor-v2');\n\n\t\treturn settings?.canUseAddressBlock === true;\n\t}\n\n\tgetDeadline(): ?Date\n\t{\n\t\treturn this.#layoutComponent?.getData().deadline ?? null;\n\t}\n\n\tgetDescription(): String\n\t{\n\t\treturn this.#layoutComponent?.getData().description ?? '';\n\t}\n\n\tsetParentActivityId(activityId: Number): TodoEditorV2\n\t{\n\t\tthis.#parentActivityId = activityId;\n\n\t\treturn this;\n\t}\n\n\tsetActivityId(activityId: ?Number): TodoEditorV2\n\t{\n\t\tthis.#activityId = activityId;\n\n\t\treturn this;\n\t}\n\n\tsetCurrentUser(currentUser: Object): TodoEditorV2\n\t{\n\t\tthis.#currentUser = currentUser;\n\n\t\treturn this;\n\t}\n\n\tsetDeadline(deadLine: String): TodoEditorV2\n\t{\n\t\tconst value = DateTimeFormat.parse(deadLine);\n\t\tif (Type.isDate(value))\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadline(value);\n\t\t\tthis.#deadline = value;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetDefaultDeadLine(isNeedUpdateLayout: Boolean = true): TodoEditorV2\n\t{\n\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\tconst defaultDate = BX.parseDate(Loc.getMessage('CRM_TIMELINE_TODO_EDITOR_DEFAULT_DATETIME'));\n\t\tif (Type.isDate(defaultDate))\n\t\t{\n\t\t\tthis.#deadline = defaultDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#deadline = new Date();\n\t\t\tthis.#deadline.setMinutes(0);\n\t\t\tthis.#deadline.setTime(this.#deadline.getTime() + 60 * 60 * 1000); // next hour\n\t\t}\n\n\t\tif (isNeedUpdateLayout)\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadline(this.#deadline);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetFocused(): void\n\t{\n\t\tthis.#layoutComponent.setTextareaFocused();\n\t}\n\n\tsetDescription(description: String): TodoEditorV2\n\t{\n\t\tthis.#layoutComponent.setDescription(description);\n\n\t\treturn this;\n\t}\n\n\tcancel(params: CancelParams = {}): Promise\n\t{\n\t\tif (params?.sendAnalytics === false)\n\t\t{\n\t\t\treturn this.#clearValue();\n\t\t}\n\n\t\tconst analytics = this.#getAnalyticsInstance();\n\t\tif (analytics === null)\n\t\t{\n\t\t\treturn this.#clearValue();\n\t\t}\n\n\t\tanalytics\n\t\t\t.setEvent(EventIds.activityAdd)\n\t\t\t.setElement(ElementIds.cancelButton)\n\t\t;\n\n\t\tconst subSection = params?.analytics?.subSection;\n\t\tif (Type.isStringFilled(subSection))\n\t\t{\n\t\t\tanalytics.setSubSection(subSection);\n\t\t}\n\n\t\tconst element = params?.analytics?.element;\n\t\tif (Type.isStringFilled(element))\n\t\t{\n\t\t\tanalytics.setElement(element);\n\t\t}\n\n\t\tconst notificationSkipPeriod = params?.analytics?.notificationSkipPeriod;\n\t\tif (Type.isStringFilled(notificationSkipPeriod))\n\t\t{\n\t\t\tanalytics.setNotificationSkipPeriod(notificationSkipPeriod);\n\t\t}\n\n\t\tanalytics.send();\n\n\t\treturn this.#clearValue();\n\t}\n\n\t#getAnalyticsInstance(): ?Analytics\n\t{\n\t\tconst data = this.#analytics?.getData();\n\n\t\tif (!data)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new Analytics(data.c_section, data.c_sub_section);\n\t}\n\n\t#clearValue(): Promise\n\t{\n\t\tthis.#parentActivityId = null;\n\n\t\treturn this.#clearData();\n\t}\n\n\tresetToDefaults(): Promise\n\t{\n\t\tthis.#layoutComponent.setDescription(this.#getDefaultDescription());\n\n\t\treturn this.#clearData();\n\t}\n\n\t#clearData(): Promise\n\t{\n\t\tthis.setDefaultDeadLine();\n\t\tthis.setMode(TodoEditorMode.ADD);\n\n\t\tthis.#layoutComponent.setWasUsed(false);\n\t\tthis.#layoutComponent.resetTitleAndDescription();\n\t\tthis.#layoutComponent.resetPingOffsetsToDefault();\n\t\tthis.#layoutComponent.resetResponsibleUserToDefault();\n\t\tthis.#layoutComponent.resetColorSelectorToDefault();\n\t\tthis.#layoutComponent.resetCurrentActivityId();\n\n\t\tDom.removeClass(this.#container, '--is-edit');\n\n\t\tthis.#layoutComponent.closeBlocks();\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, 10);\n\t\t});\n\t}\n\n\t#getDefaultTitle(): String\n\t{\n\t\treturn Loc.getMessage('CRM_ACTIVITY_TODO_ADD_TITLE_DEFAULT');\n\t}\n\n\t#getDefaultDescription(): String\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT';\n\t\tswitch (this.#ownerTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT_DEAL';\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#onInputFocus(): void\n\t{\n\t\tDom.addClass(this.#container, '--is-edit');\n\t\tthis.#eventEmitter.emit('onFocus');\n\t}\n\n\t#onSaveHotkeyPressed(): void\n\t{\n\t\tthis.#eventEmitter.emit('onSaveHotkeyPressed');\n\t}\n\n\t#isValidBorderColor(borderColor: string): boolean\n\t{\n\t\treturn Type.isString(borderColor) && TodoEditorV2.BorderColor[borderColor.toUpperCase()];\n\t}\n\n\t#getClassname(): string\n\t{\n\t\treturn `crm-activity__todo-editor-v2 --border-${this.#borderColor}`;\n\t}\n\n\t#isLocationFeatureEnabled(): boolean\n\t{\n\t\treturn Extension.getSettings('crm.activity.todo-editor-v2').get('locationFeatureEnabled');\n\t}\n}\n"],"names":["EventIds","Object","freeze","activityTouch","activityAdd","activityComplete","Section","lead","deal","quote","contact","company","dynamic","smartInvoice","custom","myCompany","smartDocument","catalogContact","catalogCompany","SubSection","list","kanban","activities","deadlines","details","notificationPopup","kanbanDropzone","CrmMode","simple","classic","ElementIds","colorSettings","description","title","responsibleUserId","deadline","pingSettings","addBlock","createButton","cancelButton","skipPeriodButton","autoFromActivityViewMode","complexButton","checkbox","Analytics","data","analyticSection","section","analyticSubSection","subSection","Extension","getSettings","event","colorId","blockTypes","notificationSkipPeriod","element","getData","sendAnalyticsData","tool","category","type","c_section","c_sub_section","c_element","p1","Type","isStringFilled","p2","p3","isArrayFilled","p4","p5","get","toLowerCase","isValid","keys","forEach","key","isNil","InputPopup","params","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","bindElement","buttonTitle","addressJson","Address","JSON","parse","addressFormatted","onSubmit","onClickHandler","bind","onKeyUpHandler","_classPrivateMethodGet","show","setTimeout","focus","destroy","widgetFactory","Factory","createAddressWidget","address","mode","ControlMode","edit","subscribeOnAddressChangedEvent","isObject","addressWidgetParams","inputNode","mapBindElement","fieldsContainer","controlWrapper","render","close","keyCode","Popup","id","Text","getRandom","content","closeByEsc","closeIcon","draggable","width","padding","events","onFirstShow","initAddress","Tag","encode","TodoEditorBlocksAddress","props","String","required","icon","settings","filledValues","context","isFocused","Boolean","emits","getPreparedData","mounted","$nextTick","onShowAddressPopup","beforeUnmount","inputPopup","methods","getId","format","Format","Loc","getMessage","addressInstance","languageId","setFieldValue","fieldForUnRecognized","toString","replaceAll","toJson","getExecutedData","emitUpdateFilledValues","newFilledValues","$emit","$refs","$Bitrix","value","setAddress","computed","encodedTitle","iconStyles","path","background","encodeURI","actionTitle","hasAddress","changeTitle","addTitle","preparedAddress","created","$watch","deep","template","DEFAULT_TAB_ID","LocationSelector","locationId","Number","forceShowLocationSelectorDialog","locations","fetchRoomsManagerData","showLocationSelectorDialog","isLocationFeatureEnabled","FeaturePromotersRegistry","getPromoter","featureId","getLocationSelectorDialog","locationSelectorDialog","tabs","items","rooms","room","push","ID","NAME","subtitle","getCapacityTitle","CAPACITY","entityId","avatarOptions","bgColor","COLOR","bgSize","bgImage","customData","LOCATION_ID","Dialog","targetNode","locationSelector","multiple","dropdownMode","showAvatars","enableSearch","height","zIndex","onSelectLocation","onDeselectLocation","Promise","resolve","Ajax","runAction","then","response","catch","errors","console","log","emitChangeEvent","item","action","getLocationById","find","location","blockTitle","locationsListTitle","selectedLocationTitle","hasSelectedLocation","isNumber","TodoEditorBlocksCalendar","components","ownerId","selectedUserIds","Set","add","timestamp","from","Timezone","UserTime","getTimestamp","millisecondsInFiveMinutes","Math","ceil","duration","to","plannerInstance","showLocation","timezoneName","eventEmitter","subscribe","Events","EVENT_RESPONSIBLE_USER_CHANGE","onResponsibleUserChange","EVENT_DEADLINE_CHANGE","onDeadlineChange","showPlanner","getPlanner","selector","handlePlannerSelectorChanges","userIds","selectedUsersIdsArray","prepareUpdatePlannerData","updatePlanner","showUserSelector","showUserSelectorDialog","unsubscribe","attendeesEntityList","values","filter","split","timezoneFrom","Planner","wrap","plannerContainer","compactMode","showEntryName","minWidth","minHeight","entryTimezone","newUserIds","oldUserIds","entityList","dateFrom","getFormattedDate","dateTo","timezone","entries","prevUserList","skipFeatureCheck","userId","entityType","showLoader","accessibility","roomId","hideLoader","update","onDataUpdate","error","updatePlannerSelector","emit","EVENT_CALENDAR_CHANGE","createDateInstance","updateSelector","startOfDay","Date","now","date","setHours","getFormattedValue","DateTimeFormat","getFormat","getUserSelectorDialog","userSelectorDialog","preselectedItems","undeselectedItems","userSelector","entities","onSelectUser","onDeselectUser","delete","getSelectedUserIds","getTime","updateSettings","onCloseLocationBlock","prepareDataOnBlockConstruct","currentDeadline","usersList","newOwnerId","oldOwnerId","has","newSettings","oldSettings","watch","newLocationId","oldLocationId","TodoEditorBlocksClient","selectedClients","isFetchedConfig","clients","fetchConfig","subscribeToReceiversChanges","entityTypeId","isAvailable","EventEmitter","onReceiversChanged","onShowAddClientPhoneSelector","onShowClientSelector","addClientsSelector","getClientSelectorEntities","onAddClient","isOpen","hide","setTargetNode","isClientBindingInProgress","preventDefault","BX","CrmEntityType","resolveId","isBound","bindClient","Crm","EntityEditor","getDefault","reload","clientId","clientTypeId","ajaxParams","length","showNotify","message","UI","Notification","Center","notify","clientSelector","clientsContainer","ClientSelector","createFromItems","onSelect","onSelectClient","onDeselect","onDeselectClient","availableSelectedClients","setSelectedItemByEntityData","dynamicLoad","dynamicSearch","options","showTab","showPhones","showMails","hideReadMoreLink","excludeMyCompany","enumeration","client","force","ajaxParameters","size","onShowClient","SidePanel","Instance","open","window","top","href","getClientTitleFormatted","showComma","clientInfo","getClientInfo","comma","hasClients","MAX_UPLOAD_FILE_SIZE","TodoEditorBlocksFile","TileWidgetComponent","fileTokens","needShowLoaderPopup","localStorage","onShowUploaderPopup","deleteFilesFromServerWhenDestroy","isArray","getFileTokenList","fileBody","querySelector","click","reset","tokens","uploader","getFiles","file","isComplete","getServerFileId","hasFileTokens","uploaderOptions","controller","controllerOptions","activityId","files","onUploadComplete","autoUpload","maxFileSize","widgetOptions","adapter","setRemoveFilesFromServerWhenDestroy","placeholder","TodoEditorBlocksLink","link","onShowLinkPopup","onLinkClick","a","document","createElement","target","Dom","append","body","remove","setLink","setValue","hasLink","BlockFactory","Error","DEFAULT_COLOR_ID","TodoEditorColorSelector","directives","hint","valuesList","selectedValueId","default","currentValueId","getValue","resetToDefault","itemSelector","onColorSelectorValueChange","text","popupOptions","angle","offset","position","offsetTop","ColorSelector","itemSelectorRef","colorList","selectedColorId","ColorSelectorEvents","EVENT_COLORSELECTOR_VALUE_CHANGE","TodoEditorPingSelector","Array","selectedValues","onPingSelectorValueChange","setDeadline","PingSelector","container","CompactIcons","BELL","PingSelectorEvents","EVENT_PINGSELECTOR_VALUE_CHANGE","TodoEditorResponsibleUserSelector","userName","imageUrl","userAvatarUrl","userIconClassName","userIconStyles","backgroundImage","backgroundSize","selectedItem","getDialog","getSelectedItems","getAvatar","selectedItems","showUserDialog","defaultUserItem","getItem","select","TEXTAREA_MAX_HEIGHT","ADD_MODE","EVENT_ACTIONS_POPUP_ITEM_CLICK","EVENT_UPDATE_CLICK","EVENT_REPEAT_CLICK","CALENDAR_BLOCK_ID","TodoEditor","onFocus","Function","onSaveHotkeyPressed","defaultTitle","defaultDescription","popupMode","currentUser","copilotSettings","actionsPopup","blocks","analytics","isCopilotEnabled","isPlainObject","calendarDateTo","Runtime","clone","getHours","blocksData","blockId","prepareBlockDataWithEditorParams","currentActivityId","pingOffsets","isTextareaToLong","wasUsed","modeData","currentUserData","deadlineFormatted","converter","DatetimeConverter","toDatetimeString","withDayOfWeek","delimiter","calendarBlock","getBlockDataById","active","toTimeString","placeholderDescription","code","placeholderTitle","popupMenuButtonTitle","orderedBlocksData","sort","b","style","textarea","currentTextareaHeight","scrollHeight","prepareBlockData","blockData","isBoolean","blockInstance","getInstance","isFunction","setData","setPingOffsets","pingSelector","colorSelector","setMode","resetCurrentActivityId","setBlockFilledValues","setBlockActive","resetTitleAndDescription","setTitle","setDescription","onTextareaFocus","descriptionBeforeFocus","setWasUsed","onTextareaKeydown","isMacCtrlKeydown","Browser","isMac","metaKey","altKey","ctrlKey","setTextareaFocused","onDeadlineClick","calendar","node","bTime","bHideTime","bSetFocus","getSiteDateTimeFormat","callback","onSetDeadlineByCalendar","sendAnalyticsDeadlineChange","setResponsibleUserId","responsibleUserSelectorChangeSended","sendAnalytics","onCalendarChange","offsets","resetPingOffsetsToDefault","resetResponsibleUserToDefault","resetColorSelectorToDefault","isString","trim","colorSelectorChangeSended","onPingSettingsSelectorValueChange","pingSettingsSelectorChangeSended","isDeadlineChanged","setEvent","setElement","send","onTitleInput","onTitleFocus","titleBeforeFocus","onTitleBlur","onTextareaInput","onTextareaBlur","onActionsPopupItemClick","componentId","componentParams","actionId","block","focused","getBlockDataFromPropsById","getNextBlockSortValue","addBlockSended","maxSortValue","onCopilotTextareaValueChange","copilotId","copilotTextarea","showActionsPopup","onBlockCloseClick","resetBlock","closeBlocks","getExecutedBlocksData","getBlockComponentName","charAt","toUpperCase","slice","updateFilledValues","CopilotTextarea","copilotParams","CopilotTextareaEvents","EVENT_VALUE_CHANGE","DELIMITER_TYPE","ActionsPopup","onClick","isLocked","MenuManager","create","autoHide","offsetLeft","result","itemData","hidden","svgData","messageCode","html","onclick","onItemClick","encodeURIComponent","TodoEditorBorderColor","TodoEditorMode","ADD","UPDATE","COPY","TodoEditorV2","onUpdateHandler","onRepeatHandler","includes","BitrixVue","createApp","TodoEditorComponent","mount","canShowPrefilledComponent","menuBar","Timeline","MenuBar","setActiveItemById","entityData","setActivityId","setCurrentUser","setDefaultDeadLine","reject","autoHideDelay","finally","deadLine","isDate","isNeedUpdateLayout","defaultDate","parseDate","setMinutes","setTime","setSubSection","setNotificationSkipPeriod","isDomNode","ownerTypeId","TypeError","isObjectLike","calendarSettings","borderColor","BorderColor","DEFAULT","actionMenuSettings","hiddenActionItems","createFromToDoEditorData","addClass","setEventNamespace","eventName","hasClass","Dialogs","MessageBox","modal","buttons","MessageBoxButtons","OK_CANCEL","okCaption","onOk","messageBox","onCancel","setFocused","scrollTo","behavior","userData","responsibleId","parentActivityId","isCopy","analyticsLabel","map","defaultOffsets","stringify","setPingSettings","join","defaultColorId","setColorId","setBlockTypes","canUseAddressBlock","removeClass","messagePhrase"],"mappings":"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"}