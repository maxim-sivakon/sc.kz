this.BX=this.BX||{};this.BX.SocialNetwork=this.BX.SocialNetwork||{};(function(e,t,a,r){"use strict";var n,i,l,o,s,c,u,g;var d=function(e){babelHelpers.inherits(a,e);function a(e,t){var r;babelHelpers.classCallCheck(this,a);r=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).call(this,e,t));r.handleDialogDestroy=r.handleDialogDestroy.bind(babelHelpers.assertThisInitialized(r));r.handleSliderMessage=r.handleSliderMessage.bind(babelHelpers.assertThisInitialized(r));r.bindEvents();return r}babelHelpers.createClass(a,[{key:"getContent",value:function e(){var t=this;return this.cache.remember("content",(function(){if(t.getOption("tagCreationLabel",false)){return t.createTagCreationLabel()}var e=t.getOption("inviteEmployeeLink");var a=t.getOption("inviteGuestLink");var l=t.getOption("lockGuestLink",false);var o=t.getOption("lockGuestLinkFeatureId","");var s=t.getOption("inviteEmployeeScope");var c=t.getOption("createProjectLink");var u=t.getOption("lockProjectLink",false);var g=t.getOption("lockProjectLinkFeatureId","");var d={111:"SOCNET_ENTITY_SELECTOR_EMPLOYEE_OR_PROJECT_OR_GUEST",110:"SOCNET_ENTITY_SELECTOR_INVITE_EMPLOYEE_OR_GUEST",101:"SOCNET_ENTITY_SELECTOR_EMPLOYEE_OR_PROJECT","011":"SOCNET_ENTITY_SELECTOR_PROJECT_OR_GUEST"};var E=Number(Boolean(e)).toString()+Number(Boolean(a)).toString()+Number(Boolean(c)).toString();var T=d[E]?d[E]:null;if(T){var v=r.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),r.Loc.getMessage(T));var f=v.querySelector("employee");var h=v.querySelector("guest");var p=v.querySelector("project");var k=Array.from(v.querySelectorAll("span"));var b=Array.from(v.children).find((function(e){return[f,h,p].includes(e)}));var L=f&&h&&p;if(f){var I=!L&&b===f;v.replaceChild(t.createInviteEmployeeLink(f.innerHTML,I),f)}if(h){var S=!L&&b===h;var O;if(l){O=t.createLockedGuestLink(h.innerHTML,S,o);t.createLock(O,o)}else{O=t.createInviteGuestLink(h.innerHTML,S);t.createHint(O)}v.replaceChild(O,h)}if(p){var C=!L&&b===p;v.replaceChild(t.createProjectLink(p.innerHTML,C),p)}k.forEach((function(e){v.replaceChild(r.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<span class="ui-selector-footer-conjunction">',"</span>"])),e.innerHTML),e)}));var y=document.createDocumentFragment();Array.from(v.childNodes).forEach((function(e){y.appendChild(e)}));return y}else if(e){var _="";switch(s){case"I":_=r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_INVITE_EMPLOYEE");break;case"E":_=r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_INVITE_EXTRANET");break;case"IE":_=r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_INVITE_EMPLOYEE_OR_EXTRANET");break;default:}return t.createInviteEmployeeLink(_,true)}else if(a){var m;if(l){m=t.createLockedGuestLink(r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_INVITE_GUEST"),true,o);t.createLock(m,o)}else{m=t.createInviteGuestLink(r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_INVITE_GUEST"),true);t.createHint(m)}return m}else if(c){if(u){var N=t.createLockedProjectLink(r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_CREATE_PROJECT"),true,g);t.createLock(N,g);return N}return t.createProjectLink(r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_CREATE_PROJECT"),true)}return null}))}},{key:"createTagCreationLabel",value:function e(){return r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_TAG_FOOTER_LABEL")}},{key:"createInviteEmployeeLink",value:function e(t,a){var n="ui-selector-footer-link".concat(a?" ui-selector-footer-link-add":"");return r.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="','" onclick="','">',"</span>\n\t\t"])),n,this.handleInviteEmployeeClick.bind(this),t)}},{key:"createInviteGuestLink",value:function e(t,a){var n="ui-selector-footer-link".concat(a?" ui-selector-footer-link-add":"");return r.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="','" onclick="','">',"</span>\n\t\t"])),n,this.handleInviteGuestClick.bind(this),t)}},{key:"createLockedGuestLink",value:function e(t,a,n){var i=this;var l="ui-selector-footer-link".concat(a?" ui-selector-footer-link-add":"");return r.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span\n\t\t\t\tclass="','"\n\t\t\t\tonclick="','"\n\t\t\t>',"</span>\n\t\t"])),l,(function(e){return i.handleLockedClick(e,n)}),t)}},{key:"createProjectLink",value:function e(t,a){var n="ui-selector-footer-link".concat(a?" ui-selector-footer-link-add":"");return r.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="','" onclick="','">',"</span>\n\t\t"])),n,this.handleCreateProjectClick.bind(this),t)}},{key:"createLockedProjectLink",value:function e(t,a,n){var i=this;var l="ui-selector-footer-link".concat(a?" ui-selector-footer-link-add":"");return r.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span\n\t\t\t\tclass="','"\n\t\t\t\tonclick="','"\n\t\t\t>',"</span>\n\t\t"])),l,(function(e){return i.handleLockedClick(e,n)}),t)}},{key:"createHint",value:function e(t){r.Runtime.loadExtension("ui.hint").then((function(){var e=BX.UI.Hint.createInstance();var a=e.createNode(r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_INVITED_GUEST_HINT"));r.Dom.insertAfter(a,t)}))}},{key:"createLock",value:function e(t,a){var n=this;r.Runtime.loadExtension("ui.info-helper").then((function(){var e=r.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span\n\t\t\t\t\tclass="ui-selector-footer-lock tariff-lock"\n\t\t\t\t\tonclick="','"\n\t\t\t\t></span>\n\t\t\t'])),(function(e){return n.handleLockedClick(e,a)}));r.Dom.insertAfter(e,t)}))}},{key:"handleInviteEmployeeClick",value:function e(){var t=this.getOption("inviteEmployeeLink");if(r.Type.isStringFilled(t)){var a=this.getDialog().getEntity("user");var n=a.getOptions()||{};BX.SidePanel.Instance.open(t,{allowChangeHistory:false,cacheable:false,requestMethod:"post",requestParams:{componentParams:JSON.stringify({USER_OPTIONS:n})},data:{entitySelectorId:this.getDialog().getId()}})}}},{key:"handleInviteGuestClick",value:function e(){var t=this.getOption("inviteGuestLink");if(r.Type.isStringFilled(t)){var a=this.getDialog().getEntity("user");var n=a.getOptions()||{};var i=[];var l=this.getDialog().getTagSelectorQuery();if(r.Validation.isEmail(l)){i.push({email:l})}BX.SidePanel.Instance.open(t,{width:1200,allowChangeHistory:false,cacheable:false,requestMethod:"post",requestParams:{componentParams:JSON.stringify({USER_OPTIONS:n,ROWS:i})},data:{entitySelectorId:this.getDialog().getId()}})}}},{key:"handleLockedClick",value:function e(t,a){r.Runtime.loadExtension("ui.info-helper").then((function(e){var t=e.FeaturePromotersRegistry;if(t){t.getPromoter({featureId:a}).show()}else{BX.UI.InfoHelper.show("limit_".concat(a),{isLimit:true})}}))["catch"]((function(e){}))}},{key:"handleCreateProjectClick",value:function e(){var t=this.getOption("createProjectLink");if(r.Type.isStringFilled(t)){var a=this.getDialog().getEntity("project");var n=a.getOptions()||{};BX.SidePanel.Instance.open(t,{allowChangeHistory:false,cacheable:false,requestMethod:"post",requestParams:{PROJECT_OPTIONS:n,refresh:"N"},data:{entitySelectorId:this.getDialog().getId()}})}}},{key:"bindEvents",value:function e(){this.getDialog().subscribe("onDestroy",this.handleDialogDestroy);t.EventEmitter.subscribe("SidePanel.Slider:onMessage",this.handleSliderMessage)}},{key:"unbindEvents",value:function e(){this.getDialog().unsubscribe("onDestroy",this.handleDialogDestroy);t.EventEmitter.unsubscribe("SidePanel.Slider:onMessage",this.handleSliderMessage)}},{key:"handleDialogDestroy",value:function e(){this.unbindEvents()}},{key:"handleSliderMessage",value:function e(t){var a=t.getData(),r=babelHelpers.slicedToArray(a,1),n=r[0];var i=n.getSender();if(i.getData().get("entitySelectorId")!==this.getDialog().getId()){return}if(n.getEventId()==="BX.Intranet.Invitation:onAdd"||n.getEventId()==="BX.Intranet.Invitation.Guest:onAdd"){var l=n.getData(),o=l.users;this.addUsers(o)}if(n.getEventId()==="BX.Socialnetwork.Workgroup:onAdd"){var s=n.getData(),c=s.projects;this.addProjects(c)}}},{key:"addUsers",value:function e(t){var a=this;if(!r.Type.isArrayFilled(t)){return}var n=this.getDialog().getRecentTab()||this.getDialog().getTab("invited-users");if(!n){n=this.getDialog().addTab(this.createInvitedUsersTab())}t.forEach((function(e){if(!r.Type.isPlainObject(e)){return}var t=a.getDialog().addItem(Object.assign({},e,{tabs:n.getId(),sort:2}));if(t){t.select()}}));this.getDialog().selectTab(n.getId())}},{key:"addProjects",value:function e(t){var a=this;if(!r.Type.isArrayFilled(t)){return}var n=this.getDialog().getRecentTab()||this.getDialog().getTab("projects");var i=n?n.getId():null;t.forEach((function(e){if(!r.Type.isPlainObject(e)){return}var t=a.getDialog().addItem(Object.assign({},e,{tabs:i,sort:2}));if(t){t.select()}}));this.getDialog().selectTab(i)}},{key:"createInvitedUsersTab",value:function e(){var t="data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2223%22%20height%3D%2223%22%20"+"fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20fill-rule%3D%22evenodd"+"%22%20clip-rule%3D%22evenodd%22%20d%3D%22M11.447%202.984a8.447%208.447%200%20100%2016.893%208.447%2"+"08.447%200%20000-16.893zM5.785%2016.273c-.02.018-.116.09-.234.177a7.706%207.706%200%2001-1.846-5.02"+"c0-.36.025-.717.073-1.069.442.573.927%201.347%201.094%201.579.272.379.575.75.84%201.136.444.648.91%"+"201.534.673%202.34-.102.346-.328.627-.6.857zm8.92-6.27s.402%201.575%202.122%201.444c.544-.04.509%20"+"1.414.162%202.015-.43.743-.318%201.627-.725%202.37-.256.467-.69.814-1.035%201.213-.43.501-.913.984-"+"1.631.922-.474-.04-.67-.565-.763-.939-.23-.928-.39-2.828-.39-2.828s-.668-1.443-2.177-1.003c-1.509."+"44-1.816-.728-1.859-1.84-.102-2.742%202.204-3.032%202.472-2.984.383.069%201.507.262%201.79.418.956"+".528%201.935-.2%201.858-.585-.077-.385-2.453-.939-3.296-.999-.843-.06-.92.24-1.151-.014-.187-.205-"+".015-.53.116-.703.93-1.225%202.48-1.522%203.791-2.16.02-.01.051-.08.087-.184a7.72%207.72%200%20012."+"846%201.81%207.719%207.719%200%20011.894%203.091c-.28.165.277-.057-1.185.283-1.462.34-2.926.673-2.9"+"26.673z%22%20fill%3D%22%23ABB1B8%22/%3E%3C/svg%3E";return{id:"invited-users",title:r.Loc.getMessage("SOCNET_ENTITY_SELECTOR_INVITED_USERS_TAB_TITLE"),bgColor:{selected:"#f7a700",selectedHovered:"#faac09"},icon:{default:t,selected:t.replace(/ABB1B8/g,"fff")}}}}]);return a}(a.DefaultFooter);var E;var T=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"render",value:function e(){return r.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-selector-footer-default ui-selector-footer-long-text">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),this.getContent()?this.getContent():"")}}]);return t}(a.DefaultFooter);e.Dialog=a.Dialog;e.Footer=d;e.TextFooter=T})(this.BX.SocialNetwork.EntitySelector=this.BX.SocialNetwork.EntitySelector||{},BX.Event,BX.UI.EntitySelector,BX);
//# sourceMappingURL=sonet-entity-selector.bundle.map.js