{"version":3,"file":"html-formatter.bundle.js","sources":["../src/helpers/create-empty-paragraphs.js","../src/helpers/should-wrap-in-paragraph.js","../src/helpers/wrap-text-nodes.js","../src/helpers/normalize-text-nodes.js","../src/node-formatters/root/root-formatter.js","../src/helpers/find-parent.js","../src/node-formatters/text/text-formatter.js","../src/node-formatters/text/tab-formatter.js","../src/node-formatters/text/linebreak-formatter.js","../src/helpers/trim-line-breaks.js","../src/helpers/normalize-line-breaks.js","../src/node-formatters/paragraph/paragraph-formatter.js","../src/node-formatters/format/bold-formatter.js","../src/node-formatters/format/underline-formatter.js","../src/node-formatters/format/italic-formatter.js","../src/node-formatters/format/strikethrough-formatter.js","../src/node-formatters/span/span-formatter.js","../src/node-formatters/table/table-formatter.js","../src/node-formatters/table/table-head-cell-formatter.js","../src/node-formatters/table/table-data-cell-formatter.js","../src/node-formatters/table/table-row-formatter.js","../src/node-formatters/list/list-formatter.js","../src/node-formatters/list/list-item-formatter.js","../src/node-formatters/quote/quote-formatter.js","../src/node-formatters/code/code-formatter.js","../src/node-formatters/link/link-formatter.js","../src/node-formatters/spoiler/spoiler-formatter.js","../src/node-formatters/mention/user-formatter.js","../src/node-formatters/mention/department-formatter.js","../src/node-formatters/mention/project-formatter.js","../src/helpers/create-image-node.js","../src/helpers/validate-image-url.js","../src/node-formatters/image/image-formatter.js","../src/helpers/create-video-node.js","../src/helpers/sanitize-url.js","../src/helpers/validate-video-url.js","../src/node-formatters/video/video-formatter.js","../src/node-formatters/file/file-formatter.js","../src/html-formatter.js"],"sourcesContent":["import { BBCodeElementNode, BBCodeScheme } from 'ui.bbcode.model';\n\nexport function createEmptyParagraphs(scheme: BBCodeScheme, count: number = 1): Array<BBCodeElementNode>\n{\n\tconst result = [];\n\tfor (let i = 0; i < count; i++)\n\t{\n\t\tresult.push(scheme.createElement({ name: 'p' }));\n\t}\n\n\treturn result;\n}\n","import { type BBCodeElementNode, BBCodeNode } from 'ui.bbcode.model';\n\nexport function shouldWrapInParagraph(node: BBCodeNode | BBCodeElementNode): boolean\n{\n\treturn node.getType() !== BBCodeNode.ELEMENT_NODE || node.hasGroup('#inline') || node.hasGroup('#inlineBlock');\n}\n","import { BBCodeElementNode, BBCodeNode, BBCodeScheme } from 'ui.bbcode.model';\nimport { createEmptyParagraphs } from './create-empty-paragraphs';\nimport { shouldWrapInParagraph } from './should-wrap-in-paragraph';\n\nexport function wrapTextNodes(nodes: Array<BBCodeNode>, scheme: BBCodeScheme): Array<BBCodeElementNode>\n{\n\tconst result = [];\n\tlet currentParagraph = null;\n\tlet lineBreaks = 0;\n\n\tfor (const node of nodes)\n\t{\n\t\tif (scheme.isNewLine(node))\n\t\t{\n\t\t\tlineBreaks++;\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (shouldWrapInParagraph(node))\n\t\t{\n\t\t\tif (currentParagraph === null || lineBreaks >= 2)\n\t\t\t{\n\t\t\t\tresult.push(...createEmptyParagraphs(scheme, lineBreaks - 2));\n\t\t\t\tcurrentParagraph = scheme.createElement({ name: 'p' });\n\t\t\t\tresult.push(currentParagraph);\n\t\t\t}\n\t\t\telse if (lineBreaks === 1)\n\t\t\t{\n\t\t\t\tcurrentParagraph.appendChild(scheme.createNewLine());\n\t\t\t}\n\n\t\t\tcurrentParagraph.appendChild(node);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (lineBreaks > 2)\n\t\t\t{\n\t\t\t\tresult.push(...createEmptyParagraphs(scheme, lineBreaks - 2));\n\t\t\t}\n\n\t\t\tresult.push(node);\n\t\t\tcurrentParagraph = null;\n\t\t}\n\n\t\tlineBreaks = 0;\n\t}\n\n\t// to avoid a height collapsing for empty elements\n\tif (result.length === 0)\n\t{\n\t\treturn [scheme.createElement({ name: 'p' })];\n\t}\n\n\treturn result;\n}\n","import { BBCodeElementNode, BBCodeScheme } from 'ui.bbcode.model';\nimport { wrapTextNodes } from './wrap-text-nodes';\n\nexport function normalizeTextNodes(node: BBCodeElementNode): BBCodeElementNode\n{\n\tconst scheme: BBCodeScheme = node.getScheme();\n\tconst children: Array<BBCodeElementNode> = wrapTextNodes(node.getChildren(), scheme);\n\tnode.setChildren(children);\n\n\treturn node;\n}\n","import { NodeFormatter, type NodeFormatterOptions, type BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { type BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\n\nexport class RootNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: '#root',\n\t\t\tconvert(): DocumentFragment {\n\t\t\t\treturn document.createDocumentFragment();\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { BBCodeNode } from 'ui.bbcode.model';\n\nexport function findParent(startingNode: BBCodeNode, findFn: (node: BBCodeNode) => boolean): BBCodeNode | null\n{\n\tlet curr: BBCodeNode | null = startingNode;\n\twhile (curr !== null && curr.getType() !== BBCodeNode.ROOT_NODE)\n\t{\n\t\tif (findFn(curr))\n\t\t{\n\t\t\treturn curr;\n\t\t}\n\n\t\tcurr = curr.getParent();\n\t}\n\n\treturn null;\n}\n","import { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { type BBCodeNode } from 'ui.bbcode.model';\nimport { type Smiley, SmileyManager, SmileyParser } from 'ui.smiley';\nimport { findParent } from '../../helpers/find-parent';\n\nexport class TextNodeFormatter extends NodeFormatter\n{\n\t#smileyParser: SmileyParser = null;\n\n\tconstructor(options: NodeFormatterOptions = {}) {\n\t\tsuper({\n\t\t\tname: '#text',\n\t\t\tconvert({ node }: ConvertCallbackOptions): Text {\n\t\t\t\tconst text = node.toString();\n\t\t\t\tif (findParent(node, (parent: BBCodeNode) => parent.getName() === 'code'))\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(text);\n\t\t\t\t}\n\n\t\t\t\tconst splits: Array<{ start: number, end: number }> = this.#smileyParser.parse(text);\n\t\t\t\tif (splits.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(text);\n\t\t\t\t}\n\n\t\t\t\t// console.log('splits', splits);\n\n\t\t\t\tconst fragment = document.createDocumentFragment();\n\t\t\t\tlet currentIndex = 0;\n\t\t\t\tfor (const split of splits)\n\t\t\t\t{\n\t\t\t\t\tif (currentIndex < split.start)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst chunk = document.createTextNode(text.slice(currentIndex, split.start));\n\t\t\t\t\t\tfragment.appendChild(chunk);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst typing = text.slice(split.start, split.end);\n\t\t\t\t\tconst smiley = SmileyManager.get(typing);\n\t\t\t\t\tif (smiley === null)\n\t\t\t\t\t{\n\t\t\t\t\t\tfragment.appendChild(document.createTextNode(typing));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfragment.appendChild(this.createImg(smiley));\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrentIndex = split.end;\n\t\t\t\t}\n\n\t\t\t\tif (currentIndex < text.length)\n\t\t\t\t{\n\t\t\t\t\tconst tail = document.createTextNode(text.slice(currentIndex));\n\t\t\t\t\tfragment.appendChild(tail);\n\t\t\t\t}\n\n\t\t\t\treturn fragment;\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\n\t\tthis.#smileyParser = new SmileyParser(SmileyManager.getAll());\n\t}\n\n\tcreateImg(smiley: Smiley): HTMLImageElement\n\t{\n\t\tconst img: HTMLImageElement = document.createElement('img');\n\t\timg.src = encodeURI(smiley.getImage());\n\t\timg.className = 'ui-typography-smiley';\n\t\timg.alt = smiley.getTyping();\n\t\tif (smiley.getWidth() > 0 && smiley.getHeight() > 0)\n\t\t{\n\t\t\timg.width = smiley.getWidth();\n\t\t\timg.height = smiley.getHeight();\n\t\t}\n\n\t\treturn img;\n\t}\n}\n","import { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class TabNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {}) {\n\t\tsuper({\n\t\t\tname: '#tab',\n\t\t\tconvert({ node }: ConvertCallbackOptions): Text {\n\t\t\t\tif (node.getParent().getName() === 'code')\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t\t}\n\n\t\t\t\treturn document.createTextNode(' ');\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class LinebreakNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {}) {\n\t\tsuper({\n\t\t\tname: '#linebreak',\n\t\t\tconvert({ node }: ConvertCallbackOptions): Text | HTMLBRElement {\n\t\t\t\treturn document.createElement('br');\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { type BBCodeNode } from 'ui.bbcode.model';\n\nexport function trimLineBreaks(nodes: Array<BBCodeNode>): Array<BBCodeNode>\n{\n\tconst trimmedNodes = [...nodes];\n\tconst firstNode: BBCodeNode = trimmedNodes[0];\n\tconst lastNode: BBCodeNode = trimmedNodes[trimmedNodes.length - 1];\n\tif (isLineBreakNode(firstNode) || (isParagraphNode(firstNode) && firstNode.isEmpty()))\n\t{\n\t\ttrimmedNodes.splice(0, 1);\n\t}\n\n\tif (isLineBreakNode(lastNode) || (isParagraphNode(lastNode) && lastNode.isEmpty()))\n\t{\n\t\ttrimmedNodes.splice(-1, 1);\n\t}\n\n\treturn trimmedNodes;\n}\n\nfunction isLineBreakNode(node: BBCodeNode): boolean\n{\n\treturn node && node.getScheme().isNewLine(node);\n}\n\nfunction isParagraphNode(node: BBCodeNode): boolean\n{\n\treturn node && node.getName() === 'p';\n}\n","import { type BBCodeElementNode, type BBCodeScheme } from 'ui.bbcode.model';\nimport { trimLineBreaks } from './trim-line-breaks';\n\nexport function normalizeLineBreaks(node: BBCodeElementNode): BBCodeElementNode\n{\n\tconst scheme: BBCodeScheme = node.getScheme();\n\tconst children: Array<BBCodeElementNode> = trimLineBreaks(node.getChildren(), scheme);\n\n\tnode.setChildren(children);\n\n\t// to avoid a height collapsing for empty elements\n\tif (children.length === 0 || (!scheme.isNewLine(children.at(-1)) && /^\\s*$/.test(node.getTextContent())))\n\t{\n\t\tnode.appendChild(scheme.createNewLine());\n\t}\n\n\treturn node;\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeLineBreaks } from '../../helpers/normalize-line-breaks';\n\nexport class ParagraphNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'p',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLParagraphElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: node.getName(),\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-paragraph',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeLineBreaks(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class BoldNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'b',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'b',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-bold',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class UnderlineNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'u',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'u',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-underline',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class ItalicNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'i',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'i',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-italic',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class StrikethroughNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 's',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 's',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-strikethrough',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class SpanNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'span',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: node.getAttributes(),\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\n\nexport class TableNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'table',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'table',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\n\nexport class TableHeadCellNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'th',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'th',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table-cell ui-typography-table-cell-header',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\n\nexport class TableDataCellNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'td',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'td',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table-cell',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\n\nexport class TableRowNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'tr',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'tr',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table-row',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class ListNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions)\n\t{\n\t\tsuper({\n\t\t\tname: 'list',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLUListElement | HTMLOListElement {\n\t\t\t\tconst tagName = node.getValue() === '1' ? 'ol' : 'ul';\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: tagName,\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: `ui-typography-${tagName}`,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class ListItemNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions)\n\t{\n\t\tsuper({\n\t\t\tname: '*',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLLIElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'li',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-li',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeLineBreaks } from '../../helpers/normalize-line-breaks';\n\nexport class QuoteNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'quote',\n\t\t\tconvert(): HTMLQuoteElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'blockquote',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-quote',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeLineBreaks(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype NodeFormatterOptions,\n\ttype BeforeConvertCallbackOptions,\n\ttype ConvertCallbackOptions,\n} from 'ui.bbcode.formatter';\n\nimport { type BBCodeNode } from 'ui.bbcode.model';\nimport { CodeParser, type CodeToken } from 'ui.code-parser';\nimport { normalizeLineBreaks } from '../../helpers/normalize-line-breaks';\n\nexport class CodeNodeFormatter extends NodeFormatter\n{\n\t#codeParser: CodeParser = new CodeParser();\n\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'code',\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeLineBreaks(node);\n\t\t\t},\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\tconst content = node.getTextContent();\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'code',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-code',\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tdecorator: true,\n\t\t\t\t\t},\n\t\t\t\t\tchildren: getCodeTokenNodes(this.#codeParser.parse(content)),\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n\nfunction getCodeTokenNodes(tokens: Array<CodeToken>): Array<Text | HTMLElement>\n{\n\tconst nodes: Array<Text | HTMLElement>[] = [];\n\ttokens.forEach((token: CodeToken): void => {\n\t\tconst partials: string[] = token.content.split(/([\\t\\n])/);\n\t\tconst partialsLength: number = partials.length;\n\t\tfor (let i = 0; i < partialsLength; i++)\n\t\t{\n\t\t\tconst part: string = partials[i];\n\t\t\tif (part === '\\n' || part === '\\r\\n')\n\t\t\t{\n\t\t\t\tnodes.push(document.createElement('br'));\n\t\t\t}\n\t\t\telse if (part === '\\t')\n\t\t\t{\n\t\t\t\tnodes.push(document.createTextNode('\\t'));\n\t\t\t}\n\t\t\telse if (part.length > 0)\n\t\t\t{\n\t\t\t\tconst span = document.createElement('span');\n\t\t\t\tspan.className = `ui-typography-token-${token.type}`;\n\t\t\t\tspan.textContent = part;\n\t\t\t\tnodes.push(span);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn nodes;\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype NodeFormatterOptions,\n\ttype AfterCallbackOptions,\n\ttype ConvertCallbackOptions,\n\ttype ValidateCallbackOptions,\n} from 'ui.bbcode.formatter';\nimport type { BBCodeContentNode } from 'ui.bbcode.model';\nimport {\n\tBBCodeElementNode,\n\tBBCodeRootNode,\n\tBBCodeScheme,\n} from 'ui.bbcode.model';\n\nexport class LinkNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'url',\n\t\t\tvalidate({ node }: ValidateCallbackOptions): boolean {\n\t\t\t\tconst nodeValue: string = LinkNodeFormatter.fetchNodeValue(node);\n\n\t\t\t\treturn !LinkNodeFormatter.startsWithJavascriptScheme(nodeValue);\n\t\t\t},\n\t\t\tbefore({ node, formatter }: AfterCallbackOptions): BBCodeElementNode {\n\t\t\t\tif (formatter.isShortLinkEnabled())\n\t\t\t\t{\n\t\t\t\t\tconst isIncludeImg: boolean = node.getChildren().some((node: BBCodeContentNode) => {\n\t\t\t\t\t\treturn node.getName() === 'img';\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!isIncludeImg)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst scheme: BBCodeScheme = node.getScheme();\n\t\t\t\t\t\tconst nodeContentLength: number = node.getPlainTextLength();\n\t\t\t\t\t\tconst { shortLink } = formatter.getLinkSettings();\n\t\t\t\t\t\tif (nodeContentLength > shortLink.maxLength)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst sourceHref: string = LinkNodeFormatter.fetchNodeValue(node);\n\n\t\t\t\t\t\t\tconst nodeRoot: BBCodeRootNode = scheme.createRoot({\n\t\t\t\t\t\t\t\tchildren: node.getChildren(),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconst [left, right] = nodeRoot.split({\n\t\t\t\t\t\t\t\toffset: shortLink.maxLength - shortLink.lastFragmentLength,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconst sourceRightFragmentLength: number = right.getPlainTextLength();\n\t\t\t\t\t\t\tconst newLink: BBCodeElementNode = node.clone();\n\t\t\t\t\t\t\tnewLink.setValue(sourceHref);\n\n\t\t\t\t\t\t\tif (sourceRightFragmentLength > shortLink.lastFragmentLength)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnewLink.appendChild(\n\t\t\t\t\t\t\t\t\t...left.getChildren(),\n\t\t\t\t\t\t\t\t\tscheme.createText('...'),\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tconst [, lastFragment] = right.split({\n\t\t\t\t\t\t\t\t\toffset: sourceRightFragmentLength - shortLink.lastFragmentLength,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tnewLink.appendChild(...lastFragment.getChildren());\n\n\t\t\t\t\t\t\t\treturn newLink;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnewLink.setChildren([\n\t\t\t\t\t\t\t\t...left.getChildren(),\n\t\t\t\t\t\t\t\tscheme.createText('...'),\n\t\t\t\t\t\t\t\t...right.getChildren(),\n\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\t\treturn newLink;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLLinkElement | HTMLUnknownElement {\n\t\t\t\tconst sourceHref: string = (() => {\n\t\t\t\t\tconst value: ?string = node.getValue();\n\t\t\t\t\tif (Type.isStringFilled(value))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node.getContent();\n\t\t\t\t})();\n\t\t\t\tconst nodeAttributes: {[key: string]: string} = node.getAttributes();\n\t\t\t\tconst { defaultTarget = '_blank', attributes } = formatter.getLinkSettings();\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'a',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...nodeAttributes,\n\t\t\t\t\t\t...attributes,\n\t\t\t\t\t\thref: sourceHref,\n\t\t\t\t\t\ttarget: defaultTarget,\n\t\t\t\t\t\tclassName: 'ui-typography-link',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n\n\tstatic fetchNodeValue(node: BBCodeElementNode): string\n\t{\n\t\tconst value: ?string = node.getValue();\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\treturn value;\n\t\t}\n\n\t\treturn node.toPlainText();\n\t}\n\n\tstatic startsWithJavascriptScheme(sourceHref: string): boolean\n\t{\n\t\tif (Type.isStringFilled(sourceHref))\n\t\t{\n\t\t\t// eslint-disable-next-line no-control-regex\n\t\t\tconst regexp = /^[\\u0000-\\u001F ]*j[\\t\\n\\r]*a[\\t\\n\\r]*v[\\t\\n\\r]*a[\\t\\n\\r]*s[\\t\\n\\r]*c[\\t\\n\\r]*r[\\t\\n\\r]*i[\\t\\n\\r]*p[\\t\\n\\r]*t[\\t\\n\\r]*:/i;\n\n\t\t\treturn regexp.test(sourceHref);\n\t\t}\n\n\t\treturn false;\n\t}\n}\n","import { Dom, Type, Loc } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype AfterCallbackOptions,\n\ttype NodeFormatterOptions,\n\ttype ConvertCallbackOptions,\n\ttype BeforeConvertCallbackOptions,\n} from 'ui.bbcode.formatter';\n\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\nimport type { BBCodeNode } from 'ui.bbcode.model';\n\nexport class SpoilerNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'spoiler',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLDetailsElement {\n\t\t\t\tconst value = node.getValue().trim();\n\t\t\t\tconst title = Type.isStringFilled(value) ? value : Loc.getMessage('HTML_FORMATTER_SPOILER_TITLE');\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'details',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-spoiler ui-icon-set__scope',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create({\n\t\t\t\t\t\t\ttag: 'summary',\n\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\tclassName: 'ui-typography-spoiler-title',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: title,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\tafter({ element }: AfterCallbackOptions): HTMLElement {\n\t\t\t\tconst [summary, ...content] = element.children;\n\n\t\t\t\telement.appendChild(summary);\n\t\t\t\telement.appendChild(\n\t\t\t\t\tDom.create({\n\t\t\t\t\t\ttag: 'div',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tclassName: 'ui-typography-spoiler-content',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t...content,\n\t\t\t\t\t\t],\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\treturn element;\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatterOptions } from '../../html-formatter';\n\nexport class UserNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions)\n\t{\n\t\tsuper({\n\t\t\tname: 'user',\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLAnchorElement {\n\t\t\t\tconst mentionSettings: HtmlFormatterOptions['mention'] = formatter.getMentionSettings();\n\t\t\t\tif (Type.isStringFilled(mentionSettings?.urlTemplate?.user))\n\t\t\t\t{\n\t\t\t\t\tconst urlTemplate: string = mentionSettings.urlTemplate.user;\n\t\t\t\t\tconst userUrl: string = urlTemplate.replaceAll('#ID#', node.getValue());\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\thref: userUrl,\n\t\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatterOptions } from '../../html-formatter';\n\nexport class DepartmentNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'department',\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLAnchorElement | HTMLSpanElement {\n\t\t\t\tconst mentionSettings: HtmlFormatterOptions['mention'] = formatter.getMentionSettings();\n\t\t\t\tif (Type.isStringFilled(mentionSettings?.urlTemplate?.department))\n\t\t\t\t{\n\t\t\t\t\tconst urlTemplate: string = mentionSettings.urlTemplate.department;\n\t\t\t\t\tconst departmentUrl: string = urlTemplate.replaceAll('#ID#', node.getValue());\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\thref: departmentUrl,\n\t\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatterOptions } from '../../html-formatter';\n\nexport class ProjectNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'project',\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLAnchorElement | HTMLSpanElement {\n\t\t\t\tconst mentionSettings: HtmlFormatterOptions['mention'] = formatter.getMentionSettings();\n\t\t\t\tif (Type.isStringFilled(mentionSettings?.urlTemplate?.project))\n\t\t\t\t{\n\t\t\t\t\tconst urlTemplate: string = mentionSettings.urlTemplate.project;\n\t\t\t\t\tconst projectUrl: string = urlTemplate.replaceAll('#group_id#', node.getValue());\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\thref: projectUrl,\n\t\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\n\nexport function createImageNode({ src, width, height }): HTMLSpanElement\n{\n\treturn Dom.create({\n\t\ttag: 'span',\n\t\tattrs: {\n\t\t\tclassName: 'ui-typography-image-container',\n\t\t},\n\t\tdataset: {\n\t\t\tdecorator: true,\n\t\t},\n\t\tchildren: [\n\t\t\tDom.create({\n\t\t\t\ttag: 'img',\n\t\t\t\tattrs: {\n\t\t\t\t\tsrc,\n\t\t\t\t\tclassName: 'ui-typography-image',\n\t\t\t\t\twidth,\n\t\t\t\t\tloading: 'lazy',\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\taspectRatio: width > 0 && height > 0 ? `${width} / ${height}` : 'auto',\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\terror: (event) => {\n\t\t\t\t\t\tconst img: HTMLImageElement = event.target;\n\t\t\t\t\t\timg.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\t\t\t\t\t\timg.style.cssText = 'border: 1px dashed red';\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t],\n\t});\n}\n","export function validateImageUrl(url: string): boolean\n{\n\treturn /^(http:|https:|ftp:|\\/)/i.test(url);\n}\n","import { Type } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { createImageNode } from '../../helpers/create-image-node';\nimport { validateImageUrl } from '../../helpers/validate-image-url';\n\nexport class ImageNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'img',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLSpanElement {\n\t\t\t\t// [img]{url}[/img]\n\t\t\t\t// [img width={width} height={height}]{url}[/img]\n\t\t\t\tconst src = node.getContent().trim();\n\t\t\t\tlet width = Number(node.getAttribute('width'));\n\t\t\t\tlet height = Number(node.getAttribute('height'));\n\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : null;\n\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : null;\n\n\t\t\t\tif (validateImageUrl(src))\n\t\t\t\t{\n\t\t\t\t\treturn createImageNode({ src, width, height });\n\t\t\t\t}\n\n\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\n\nexport function createVideoNode({ url, width, height, type }): HTMLSpanElement\n{\n\tconst video: HTMLVideoElement = Dom.create({\n\t\ttag: 'video',\n\t\tattrs: {\n\t\t\tcontrols: true,\n\t\t\tclassName: 'ui-typography-video-object',\n\t\t\tpreload: 'metadata',\n\t\t\tplaysinline: true,\n\t\t\tsrc: url,\n\t\t\twidth,\n\t\t},\n\t\tdataset: {\n\t\t\tdecorator: true,\n\t\t},\n\t\tstyle: {\n\t\t\taspectRatio: width > 0 && height > 0 ? `${width} / ${height}` : 'auto',\n\t\t},\n\t\t/* children: [\n\t\t\tDom.create({\n\t\t\t\ttag: 'source',\n\t\t\t\tattrs: {\n\t\t\t\t\ttype,\n\t\t\t\t\tsrc: url,\n\t\t\t\t},\n\t\t\t}),\n\t\t], */\n\t});\n\n\treturn Dom.create({\n\t\ttag: 'span',\n\t\tattrs: {\n\t\t\tclassName: 'ui-typography-video-container',\n\t\t},\n\t\tdataset: {\n\t\t\tdecorator: true,\n\t\t},\n\t\tchildren: [video],\n\t});\n}\n","import { Type } from 'main.core';\n\n// eslint-disable-next-line no-control-regex\nconst ATTRIBUTE_WHITESPACES = /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g;\nconst SAFE_URL = /^(?:(?:https?|ftps?|mailto):|[^a-z]|[+.a-z-]+(?:[^+.:a-z-]|$))/i;\n\nexport function sanitizeUrl(url: string): string\n{\n\tif (!Type.isStringFilled(url))\n\t{\n\t\treturn '';\n\t}\n\n\tconst normalizedUrl = url.replaceAll(ATTRIBUTE_WHITESPACES, '');\n\n\treturn SAFE_URL.test(normalizedUrl) ? normalizedUrl : '';\n}\n","export function validateVideoUrl(url: string): boolean\n{\n\treturn /^(http:|https:|\\/)/i.test(url);\n}\n","import { Dom, Type, Uri } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { VideoService } from 'ui.video-service';\nimport { createVideoNode } from '../../helpers/create-video-node';\nimport { sanitizeUrl } from '../../helpers/sanitize-url';\nimport { validateVideoUrl } from '../../helpers/validate-video-url';\n\nexport class VideoNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'video',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLSpanElement {\n\t\t\t\t// [video type={type} width={width} height={height}]{url}[/video]\n\t\t\t\tconst src = sanitizeUrl(node.getContent().trim());\n\t\t\t\tif (!validateVideoUrl(src))\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t\t}\n\n\t\t\t\tlet width = Number(node.getAttribute('width'));\n\t\t\t\tlet height = Number(node.getAttribute('height'));\n\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : 560;\n\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : 315;\n\n\t\t\t\tconst url = /^https?:/.test(src) ? src : `https://${src.replace(/^\\/\\//, '')}`;\n\t\t\t\tconst uri = new Uri(url);\n\t\t\t\tconst trusted = VideoService.createByHost(uri.getHost()) !== null;\n\t\t\t\tif (trusted)\n\t\t\t\t{\n\t\t\t\t\tconst video: HTMLIFrameElement = Dom.create({\n\t\t\t\t\t\ttag: 'iframe',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tsrc,\n\t\t\t\t\t\t\tclassName: 'ui-typography-video-object',\n\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\theight: 'auto',\n\t\t\t\t\t\t\tframeborder: 0,\n\t\t\t\t\t\t\tallowfullscreen: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\taspectRatio: `${width} / ${height}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'span',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tclassName: 'ui-typography-video-container',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tdecorator: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [video],\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// const path = uri.getPath();\n\t\t\t\t// const position: number = path.lastIndexOf('.');\n\t\t\t\t// const extension = position >= 0 ? path.slice(Math.max(0, position + 1)).toLowerCase() : '';\n\t\t\t\t// const type = ['mp4', 'webm', 'mov'].includes(extension) ? `video/${extension}` : null;\n\n\t\t\t\treturn createVideoNode({ url, width, height });\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type, Text } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatter } from 'ui.bbcode.formatter.html-formatter';\nimport type { UploaderFileInfo } from 'ui.uploader.core';\nimport { createImageNode } from '../../helpers/create-image-node';\nimport { createVideoNode } from '../../helpers/create-video-node';\n\nexport class FileNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tconst formatter: HtmlFormatter = options.formatter;\n\t\tconst fileMode = formatter.getFileMode();\n\n\t\tsuper({\n\t\t\tname: fileMode || '__unknown__',\n\t\t\tconvert({ node, data }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\tif (fileMode === null)\n\t\t\t\t{\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t\t// [DISK FILE ID=n14194]\n\t\t\t\t// [DISK FILE ID=14194]\n\n\t\t\t\t// [FILE ID=5b87ba3b-edb1-49df-a840-50d17b6c3e8c.fbbdd477d5ff19d61...a875e731fa89cfd1e1]\n\t\t\t\t// [FILE ID=14194]\n\t\t\t\tconst serverFileId = node.getAttribute('id');\n\t\t\t\tconst createTextNode = () => {\n\t\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t\t};\n\n\t\t\t\tif (\n\t\t\t\t\t!Type.isStringFilled(serverFileId)\n\t\t\t\t\t|| (fileMode === 'disk' && !/^n?\\d+$/i.test(serverFileId))\n\t\t\t\t\t|| (fileMode === 'file' && !/^(\\d+|[\\da-f-]{36}\\.[\\da-f]{32,})$/i.test(serverFileId))\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn createTextNode();\n\t\t\t\t}\n\n\t\t\t\tconst info: UploaderFileInfo = data.files.find((file: UploaderFileInfo): boolean => {\n\t\t\t\t\treturn file.serverFileId.toString() === serverFileId.toString();\n\t\t\t\t});\n\n\t\t\t\tif (!info)\n\t\t\t\t{\n\t\t\t\t\treturn createTextNode();\n\t\t\t\t}\n\n\t\t\t\tif (info.isImage)\n\t\t\t\t{\n\t\t\t\t\tlet width = Text.toInteger(node.getAttribute('width'));\n\t\t\t\t\tlet height = Text.toInteger(node.getAttribute('height'));\n\n\t\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : info.serverPreviewWidth;\n\t\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : info.serverPreviewHeight;\n\n\t\t\t\t\treturn createImageNode({\n\t\t\t\t\t\twidth,\n\t\t\t\t\t\theight,\n\t\t\t\t\t\tsrc: info.serverPreviewUrl,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (info.isVideo)\n\t\t\t\t{\n\t\t\t\t\tlet width = Number(node.getAttribute('width'));\n\t\t\t\t\tlet height = Number(node.getAttribute('height'));\n\t\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : 600;\n\t\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : null;\n\n\t\t\t\t\treturn createVideoNode({ url: info.downloadUrl, width, height });\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'a',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\thref: info.downloadUrl,\n\t\t\t\t\t\tclassName: 'ui-typography-link',\n\t\t\t\t\t},\n\t\t\t\t\ttext: info.name || 'unknown',\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tfileId: info.serverFileId,\n\t\t\t\t\t\tfileInfo: JSON.stringify(info),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Type, Extension } from 'main.core';\nimport {\n\tFormatter,\n\tNodeFormatter,\n\ttype FormatterOptions,\n\ttype UnknownNodeCallbackOptions,\n\ttype BeforeConvertCallbackOptions,\n} from 'ui.bbcode.formatter';\nimport { BBCodeScheme, BBCodeFragmentNode } from 'ui.bbcode.model';\nimport * as NodeFormatters from './node-formatters';\n\nimport 'ui.typography';\n\nexport type HtmlFormatterOptions = FormatterOptions & {\n\tlinkSettings?: {\n\t\tallowedSchemes?: string,\n\t\tdefaultScheme?: 'http',\n\t\tdefaultTarget?: '_self' | '_blank' | '_parent' | '_top',\n\t\tshortLink: {\n\t\t\tenabled?: boolean,\n\t\t\tmaxLength?: number,\n\t\t\tlastFragmentLength?: number,\n\t\t},\n\t\tattributes?: {\n\t\t\t[key: string]: string,\n\t\t},\n\t},\n\tmention: {\n\t\turlTemplate: {\n\t\t\tuser: string,\n\t\t\tproject: string,\n\t\t\tdepartment: string,\n\t\t},\n\t},\n\tfileMode: 'disk' | 'file',\n};\n\nconst globalSettings = Extension.getSettings('ui.bbcode.formatter.html-formatter');\n\n/**\n * @memberOf BX.UI.BBCode.Formatter\n */\nexport class HtmlFormatter extends Formatter\n{\n\t#linkSettings: HtmlFormatterOptions['linkSettings'];\n\t#mentionSettings: HtmlFormatterOptions['mention'];\n\t#fileMode: HtmlFormatterOptions['fileMode'];\n\n\tconstructor(options: HtmlFormatterOptions = {})\n\t{\n\t\tsuper();\n\n\t\tthis.setLinkSettings({\n\t\t\t...globalSettings.linkSettings,\n\t\t\t...options.linkSettings,\n\t\t});\n\n\t\tthis.setMentionSettings({\n\t\t\t...globalSettings.mention,\n\t\t\t...options.mention,\n\t\t});\n\n\t\tthis.#fileMode = ['file', 'disk'].includes(options.fileMode) ? options.fileMode : null;\n\n\t\tconst defaultFormatters = Object.values(NodeFormatters).map((FormatterClass: NodeFormatter) => {\n\t\t\treturn new FormatterClass({ formatter: this });\n\t\t});\n\n\t\tthis.setNodeFormatters(defaultFormatters);\n\t\tthis.setNodeFormatters(options.formatters);\n\t}\n\n\tisShortLinkEnabled(): boolean\n\t{\n\t\tconst { shortLink } = this.getLinkSettings();\n\n\t\treturn (\n\t\t\tType.isPlainObject(shortLink)\n\t\t\t&& shortLink.enabled === true\n\t\t\t&& Type.isInteger(shortLink.maxLength)\n\t\t);\n\t}\n\n\tsetLinkSettings(settings: HtmlFormatterOptions['linkSettings'])\n\t{\n\t\tthis.#linkSettings = { ...settings };\n\t}\n\n\tgetLinkSettings(): HtmlFormatterOptions['linkSettings']\n\t{\n\t\treturn this.#linkSettings;\n\t}\n\n\tgetFileMode(): HtmlFormatterOptions['fileMode'] | null\n\t{\n\t\treturn this.#fileMode;\n\t}\n\n\tsetMentionSettings(settings: HtmlFormatterOptions['mention'])\n\t{\n\t\tthis.#mentionSettings = { ...settings };\n\t}\n\n\tgetMentionSettings(): HtmlFormatterOptions['mention']\n\t{\n\t\treturn this.#mentionSettings;\n\t}\n\n\tisElement(source): boolean\n\t{\n\t\tif (source.nodeType === Node.DOCUMENT_FRAGMENT_NODE)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (source.nodeType !== Node.ELEMENT_NODE || this.#isVoidElement(source))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Type.isUndefined(source.dataset.decorator);\n\t}\n\n\t#isVoidElement(source): boolean\n\t{\n\t\treturn ['img', 'br', 'hr', 'input'].includes(source.tagName.toLowerCase());\n\t}\n\n\tgetDefaultUnknownNodeCallback(options): (UnknownNodeCallbackOptions) => NodeFormatter | null\n\t{\n\t\treturn () => {\n\t\t\treturn new NodeFormatter({\n\t\t\t\tname: 'unknown',\n\t\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeFragmentNode {\n\t\t\t\t\tconst scheme: BBCodeScheme = node.getScheme();\n\n\t\t\t\t\tif (node.isVoid())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn scheme.createFragment({\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tscheme.createText(node.getOpeningTag()),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn scheme.createFragment({\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tscheme.createText(node.getOpeningTag()),\n\t\t\t\t\t\t\t...node.getChildren(),\n\t\t\t\t\t\t\tscheme.createText(node.getClosingTag()),\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tconvert(): DocumentFragment {\n\t\t\t\t\treturn document.createDocumentFragment();\n\t\t\t\t},\n\t\t\t});\n\t\t};\n\t}\n}\n"],"names":["createEmptyParagraphs","scheme","count","result","i","push","createElement","name","shouldWrapInParagraph","node","getType","BBCodeNode","ELEMENT_NODE","hasGroup","wrapTextNodes","nodes","currentParagraph","lineBreaks","isNewLine","appendChild","createNewLine","length","normalizeTextNodes","getScheme","children","getChildren","setChildren","RootNodeFormatter","NodeFormatter","constructor","options","convert","document","createDocumentFragment","before","findParent","startingNode","findFn","curr","ROOT_NODE","getParent","TextNodeFormatter","text","toString","parent","getName","createTextNode","splits","parse","fragment","currentIndex","split","start","chunk","slice","typing","end","smiley","SmileyManager","get","createImg","tail","SmileyParser","getAll","img","src","encodeURI","getImage","className","alt","getTyping","getWidth","getHeight","width","height","TabNodeFormatter","LinebreakNodeFormatter","trimLineBreaks","trimmedNodes","firstNode","lastNode","isLineBreakNode","isParagraphNode","isEmpty","splice","normalizeLineBreaks","at","test","getTextContent","ParagraphNodeFormatter","Dom","create","tag","attrs","BoldNodeFormatter","getAttributes","UnderlineNodeFormatter","ItalicNodeFormatter","StrikethroughNodeFormatter","SpanNodeFormatter","TableNodeFormatter","classname","TableHeadCellNodeFormatter","TableDataCellNodeFormatter","TableRowNodeFormatter","ListNodeFormatter","tagName","getValue","ListItemNodeFormatter","QuoteNodeFormatter","CodeNodeFormatter","content","dataset","decorator","getCodeTokenNodes","CodeParser","tokens","forEach","token","partials","partialsLength","part","span","type","textContent","LinkNodeFormatter","validate","nodeValue","fetchNodeValue","startsWithJavascriptScheme","formatter","isShortLinkEnabled","isIncludeImg","some","nodeContentLength","getPlainTextLength","shortLink","getLinkSettings","maxLength","sourceHref","nodeRoot","createRoot","left","right","offset","lastFragmentLength","sourceRightFragmentLength","newLink","clone","setValue","createText","lastFragment","value","Type","isStringFilled","getContent","nodeAttributes","defaultTarget","attributes","href","target","toPlainText","regexp","SpoilerNodeFormatter","trim","title","Loc","getMessage","after","element","summary","UserNodeFormatter","mentionSettings","getMentionSettings","urlTemplate","user","userUrl","replaceAll","DepartmentNodeFormatter","department","departmentUrl","ProjectNodeFormatter","project","projectUrl","createImageNode","loading","style","aspectRatio","events","error","event","cssText","validateImageUrl","url","ImageNodeFormatter","Number","getAttribute","isNumber","Math","round","createVideoNode","video","controls","preload","playsinline","ATTRIBUTE_WHITESPACES","SAFE_URL","sanitizeUrl","normalizedUrl","validateVideoUrl","VideoNodeFormatter","replace","uri","Uri","trusted","VideoService","createByHost","getHost","frameborder","allowfullscreen","FileNodeFormatter","fileMode","getFileMode","data","serverFileId","info","files","find","file","isImage","Text","toInteger","serverPreviewWidth","serverPreviewHeight","serverPreviewUrl","isVideo","downloadUrl","fileId","fileInfo","JSON","stringify","globalSettings","Extension","getSettings","HtmlFormatter","Formatter","setLinkSettings","linkSettings","setMentionSettings","mention","includes","defaultFormatters","Object","values","NodeFormatters","map","FormatterClass","setNodeFormatters","formatters","isPlainObject","enabled","isInteger","settings","isElement","source","nodeType","Node","DOCUMENT_FRAGMENT_NODE","isUndefined","getDefaultUnknownNodeCallback","isVoid","createFragment","getOpeningTag","getClosingTag","toLowerCase"],"mappings":"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"}