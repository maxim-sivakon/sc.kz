this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,a,o,i,n,r,l,c){"use strict";const d=new Set([i.ChatType.comment]);const b=new Set([i.Layout.channel.name,i.Layout.market.name]);var u=babelHelpers.classPrivateFieldLooseKey("instance");var v=babelHelpers.classPrivateFieldLooseKey("lastOpenedElement");var y=babelHelpers.classPrivateFieldLooseKey("onGoToMessageContext");var g=babelHelpers.classPrivateFieldLooseKey("onDesktopReload");var p=babelHelpers.classPrivateFieldLooseKey("sendAnalytics");var L=babelHelpers.classPrivateFieldLooseKey("isSameChat");var h=babelHelpers.classPrivateFieldLooseKey("onSameChatReopen");var m=babelHelpers.classPrivateFieldLooseKey("handleContextAccess");var f=babelHelpers.classPrivateFieldLooseKey("getChat");class P{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,u)[u]){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=new this}return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}static init(){P.getInstance()}constructor(){Object.defineProperty(this,f,{value:E});Object.defineProperty(this,m,{value:H});Object.defineProperty(this,h,{value:F});Object.defineProperty(this,L,{value:M});Object.defineProperty(this,p,{value:I});Object.defineProperty(this,g,{value:C});Object.defineProperty(this,y,{value:B});Object.defineProperty(this,v,{writable:true,value:{}});t.EventEmitter.subscribe(i.EventType.dialog.goToMessageContext,babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this));t.EventEmitter.subscribe(i.EventType.desktop.onReload,babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this))}async setLayout(e){if(e.contextId){const t=await babelHelpers.classPrivateFieldLooseBase(this,m)[m](e);if(!t){return Promise.resolve()}}if(e.entityId){this.setLastOpenedElement(e.name,e.entityId)}if(babelHelpers.classPrivateFieldLooseBase(this,L)[L](e)){babelHelpers.classPrivateFieldLooseBase(this,h)[h](e)}babelHelpers.classPrivateFieldLooseBase(this,p)[p](e);return s.Core.getStore().dispatch("application/setLayout",e)}getLayout(){return s.Core.getStore().getters["application/getLayout"]}saveCurrentLayout(){const e=this.getLayout();o.LocalStorageManager.getInstance().set(i.LocalStorageKey.layoutConfig,{name:e.name,entityId:e.entityId})}restoreLastLayout(){const e=o.LocalStorageManager.getInstance().get(i.LocalStorageKey.layoutConfig);if(!e){return Promise.resolve()}n.Logger.warn("LayoutManager: last layout was restored",e);o.LocalStorageManager.getInstance().remove(i.LocalStorageKey.layoutConfig);return this.setLayout(e)}getLastOpenedElement(e){var t;return(t=babelHelpers.classPrivateFieldLooseBase(this,v)[v][e])!=null?t:null}setLastOpenedElement(e,t){if(b.has(e)){return}babelHelpers.classPrivateFieldLooseBase(this,v)[v][e]=t}isChatContextAvailable(e){if(!this.getLayout().contextId){return false}const{type:t}=babelHelpers.classPrivateFieldLooseBase(this,f)[f](e);return!d.has(t)}destroy(){t.EventEmitter.unsubscribe(i.EventType.dialog.goToMessageContext,babelHelpers.classPrivateFieldLooseBase(this,y)[y]);t.EventEmitter.unsubscribe(i.EventType.desktop.onReload,babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this))}}async function B(e){const{dialogId:t,messageId:s}=e.getData();if(this.getLayout().entityId===t){return}const{type:a}=babelHelpers.classPrivateFieldLooseBase(this,f)[f](t);if(d.has(a)){return}const o=a===i.ChatType.copilot;void this.setLayout({name:o?i.Layout.copilot.name:i.Layout.chat.name,entityId:t,contextId:s})}function C(){this.saveCurrentLayout()}function I(e){const t=this.getLayout();if(t.name===e.name){return}if(e.name===i.Layout.copilot.name){a.Analytics.getInstance().onOpenCopilotTab()}a.Analytics.getInstance().onOpenTab(e.name)}function M(e){const{name:t,entityId:s}=this.getLayout();const a=t===e.name;const o=s&&s===e.entityId;return a&&o}function F(e){const{entityId:s,contextId:a}=e;const o=r.ChannelManager.isChannel(s);if(o){t.EventEmitter.emit(i.EventType.dialog.closeComments)}if(a){t.EventEmitter.emit(i.EventType.dialog.goToMessageContext,{messageId:a,dialogId:s})}}async function H(e){const{contextId:t,entityId:s}=e;if(!t){return Promise.resolve(true)}const{hasAccess:o,errorCode:i}=await l.AccessManager.checkMessageAccess(t);if(!o&&i===l.AccessErrorCode.messageAccessDeniedByTariff){a.Analytics.getInstance().onGoToContextHistoryLimitClick({dialogId:s});c.FeatureManager.chatHistory.openFeatureSlider();return Promise.resolve(false)}return Promise.resolve(true)}function E(e){return s.Core.getStore().getters["chats/get"](e,true)}Object.defineProperty(P,u,{writable:true,value:void 0});e.LayoutManager=P})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=layout.bundle.map.js