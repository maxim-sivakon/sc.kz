this.BX=this.BX||{};(function(e,t,n,r,s){"use strict";var a,i,o;function l(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var r=0;var s=function e(){};return{s:s,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,i=false,o;return{s:function t(){n=n.call(e)},n:function e(){var t=n.next();a=t.done;return t},e:function e(t){i=true;o=t},f:function e(){try{if(!a&&n["return"]!=null)n["return"]()}finally{if(i)throw o}}}}function u(e,t){if(!e)return;if(typeof e==="string")return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}function c(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"accounts",[]);babelHelpers.defineProperty(this,"currentUser",null);babelHelpers.defineProperty(this,"contextPopup",[]);babelHelpers.defineProperty(this,"popup",null);babelHelpers.defineProperty(this,"allCounters",{});babelHelpers.defineProperty(this,"wrapper",null);this.wrapper=document.getElementById("history-items");this.checkCounters(t);this.reload();this.viewDesktopUser();this.initPopup()}babelHelpers.createClass(e,[{key:"checkCounters",value:function e(t){for(var n=0,r=Object.keys(t);n<r.length;n++){var s=r[n];var a=s;if(s==="**"){a="live-feed"}this.allCounters[a]=t[s]}}},{key:"getSumCounters",value:function e(){var t=0;for(var n=0,r=Object.keys(this.allCounters);n<r.length;n++){var s=r[n];if(s==="tasks_effective"||s==="invited_users"){continue}var a=this.allCounters[s]?parseInt(this.allCounters[s]):0;t+=a}return t}},{key:"reload",value:function e(){var t=s.Loc.getMessage("USER_ID");this.accounts="undefined"!==typeof BXDesktopSystem?r.DesktopApi.getAccountList():[];this.currentUser=this.accounts.find((function(e){return e.id===t}));this.viewPopupAccounts()}},{key:"initPopup",value:function e(){var n=this;var r=document.querySelector(".intranet__desktop-menu_user-block");this.popup=new t.Popup({content:document.querySelector(".intranet__desktop-menu_popup"),bindElement:r,width:320,background:"#282e39",closeIcon:true,closeByEsc:true});s.Event.bind(r,"click",(function(){if(n.popup.isShown()){n.popup.close()}else{n.popup.show();n.reload()}}))}},{key:"setCounters",value:function e(t){var n=t;if(t["data"]){n=t.data;if(n[0]&&babelHelpers["typeof"](n[0])==="object"){n=n[0]}}for(var r=0,a=Object.keys(n);r<a.length;r++){var i=a[r];var o=i;if(i==="**"){o="live-feed"}this.allCounters[o]=n[i]}var l=this.getSumCounters();var u=document.getElementsByClassName("intranet__desktop-menu_user-block")[0];var c=u.querySelector('[data-role="counter"]');if(l>0){c.innerHTML=l>99?"99+":l;if(!s.Dom.hasClass(u,"intranet__desktop-menu_item_counters")){s.Dom.addClass(u,"intranet__desktop-menu_item_counters")}}else{c.innerHTML="";s.Dom.addClass(u,"intranet__desktop-menu_item_counters")}}},{key:"removeElements",value:function e(t){var n=document.getElementsByClassName(t);babelHelpers.toConsumableArray(n).forEach((function(e){e.remove()}))}},{key:"viewDesktopUser",value:function t(){var n=document.getElementsByClassName("intranet__desktop-menu_user")[0];var r=this.getSumCounters();this.removeElements("intranet__desktop-menu_user-block");var i=s.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="intranet__desktop-menu_user-block ','">\n\t\t\t\t<span class="intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-desktop">\n\t\t\t\t\t<i></i>\n\t\t\t\t\t<div class="intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger">\n\t\t\t\t\t\t<div class="ui-counter-inner" data-role="counter">','</div>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t\t<span class="intranet__desktop-menu_user-inner">\n\t\t\t\t\t<span class="intranet__desktop-menu_user-name">','</span>\n\t\t\t\t\t<span class="intranet__desktop-menu_user-post">',"</span>\n\t\t\t\t</span>\n\t\t\t</div>"])),r>0?"intranet__desktop-menu_item_counters":"",r,this.currentUser.portal,this.currentUser.work_position);s.Dom.append(i,n);var o=document.getElementsByClassName("ui-icon-common-user-desktop")[0];var l="url('".concat(s.Text.encode(this.currentUser.avatar===e.defaultAvatar?e.defaultAvatarDesctop:this.currentUser.protocol+"://"+this.currentUser.portal+this.currentUser.avatar),"')");s.Dom.style(o,"--ui-icon-service-bg-image",l)}},{key:"viewPopupAccounts",value:function t(){var n=document.getElementsByClassName("intranet__desktop-menu_popup")[0];var r="";if(this.currentUser.work_position!==""){r='<span class="intranet__desktop-menu_popup-post">'.concat(this.currentUser.work_position,"</span>")}this.removeElements("intranet__desktop-menu_popup-header");var a=s.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<div class="intranet__desktop-menu_popup-header">\n\t\t\t<span class="intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-popup">\n\t\t\t\t<i></i>\n\t\t\t</span>\n\t\t\t<span class="intranet__desktop-menu_popup-label">','</span>\n\t\t\t<div class="intranet__desktop-menu_popup-header-user">\n\t\t\t\t<span class="intranet__desktop-menu_popup-name">',"</span>\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"])),this.currentUser.portal,this.currentUser.first_name+" "+this.currentUser.last_name,r);s.Dom.insertBefore(a,n.firstElementChild);var u=document.getElementsByClassName("ui-icon-common-user-popup")[0];var c="url('".concat(s.Text.encode(this.currentUser.avatar===e.defaultAvatar?e.defaultAvatarDesctop:this.currentUser.protocol+"://"+this.currentUser.portal+this.currentUser.avatar),"')");s.Dom.style(u,"--ui-icon-service-bg-image",c);var p=document.getElementsByClassName("intranet__desktop-menu_popup-list")[0];this.removeElements("intranet__desktop-menu_popup-item-account");var d=0;var f=l(this.accounts),m;try{for(f.s();!(m=f.n()).done;){var v=m.value;var h="";var b=0;if(v.id===this.currentUser.id&&v.portal===this.currentUser.portal){b=this.getSumCounters();h="--selected"}var _=s.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<li class="intranet__desktop-menu_popup-item intranet__desktop-menu_popup-item-account '," ",'">\n\t\t\t\t\t<span class="intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-','">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t<div class="intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger">\n\t\t\t\t\t\t\t<div class="ui-counter-inner">','</div>\n\t\t\t\t\t\t</div>\t\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="intranet__desktop-menu_popup-user">\n\t\t\t\t\t\t<span class="intranet__desktop-menu_popup-name">','</span>\n\t\t\t\t\t\t<span class="intranet__desktop-menu_popup-post">','</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="intranet__desktop-menu_popup-btn ui-icon-set --more" id="ui-icon-set-','"></span>\n\t\t\t\t</li>'])),b>0?"intranet__desktop-menu_item_counters":"",h,d,b,v.portal,v.work_position,d);s.Dom.insertBefore(_,p.children[d]);this.addContextMenu(v,d);var g=document.getElementsByClassName("ui-icon-common-user-"+d)[0];var y="url('".concat(s.Text.encode(v.avatar===e.defaultAvatar?e.defaultAvatarDesctop:v.protocol+"://"+v.portal+v.avatar),"')");s.Dom.style(g,"--ui-icon-service-bg-image",y);d++}}catch(e){f.e(e)}finally{f.f()}}},{key:"addContextMenu",value:function e(n,r){var a=this;var i=document.getElementById("ui-icon-set-"+r);if(this.contextPopup[r]){this.contextPopup[r].destroy()}this.contextPopup[r]=new t.Menu({bindElement:i,className:"intranet__desktop-menu_context",items:[n.id===this.currentUser.id&&n.portal===this.currentUser.portal?{text:s.Loc.getMessage("MENU_ACCOUNT_POPUP_DISCONNECT"),onclick:function e(t,s){var a;var i=n.host;(a=BXDesktopSystem)===null||a===void 0?void 0:a.AccountDisconnect(i);this.contextPopup[r].close();this.popup.close();window.location.reload()}}:{text:s.Loc.getMessage("MENU_ACCOUNT_POPUP_CONNECT"),onclick:function e(t,s){var a;var i=n.host,o=n.login,l=n.protocol;var u=navigator.language;(a=BXDesktopSystem)===null||a===void 0?void 0:a.AccountConnect(i,o,l,u);this.contextPopup[r].close();this.popup.close()}},{text:s.Loc.getMessage("MENU_ACCOUNT_POPUP_REMOVE"),onclick:function e(t,s){var a;var i=n.host,o=n.login;(a=BXDesktopSystem)===null||a===void 0?void 0:a.AccountDelete(i,o);this.contextPopup[r].close();this.popup.close();window.location.reload()}}]});s.Event.bind(i,"click",(function(e){var t=parseInt(e.target.id.replace("ui-icon-set-",""));a.contextPopup[t].show()}))}},{key:"openLoginTab",value:function e(){r.DesktopApi.openAddAccountTab()}}]);return e}();babelHelpers.defineProperty(p,"defaultAvatar","/bitrix/js/im/images/blank.gif");babelHelpers.defineProperty(p,"defaultAvatarDesctop","/bitrix/js/ui/icons/b24/images/ui-user.svg?v2");function d(e,t){f(e,t);t.add(e)}function f(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function m(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var v=new WeakSet;var h=new WeakSet;var b=function(){function e(){babelHelpers.classCallCheck(this,e);d(this,h);d(this,v);babelHelpers.defineProperty(this,"bacgroundNode",null)}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;if(!this.bacgroundNode){var r;var s=(r=m(this,v,_).call(this))===null||r===void 0?void 0:r.getAppliedTheme();this.bacgroundNode=document.getElementsByTagName("body")[0];if(s){m(this,h,g).call(this,this.bacgroundNode,s)}n.EventEmitter.subscribe("BX.Intranet.Bitrix24:ThemePicker:onThemeApply",(function(e){m(t,h,g).call(t,t.bacgroundNode,e.data.theme)}))}}}]);return e}();function _(){var e,t,n,r,s;return(e=(t=BX.Intranet)===null||t===void 0?void 0:(n=t.Bitrix24)===null||n===void 0?void 0:n.ThemePicker.Singleton)!==null&&e!==void 0?e:(r=top.BX.Intranet)===null||r===void 0?void 0:(s=r.Bitrix24)===null||s===void 0?void 0:s.ThemePicker.Singleton}function g(e,t){var n="url('".concat(s.Text.encode(t.previewImage),"')");s.Dom.style(e,"backgroundImage",n);s.Dom.removeClass(e,"bitrix24-theme-default bitrix24-theme-dark bitrix24-theme-light");var r="bitrix24-theme-default";if(t.id!=="default"){r=String(t.id).indexOf("dark:")===0?"bitrix24-theme-dark":"bitrix24-theme-light"}s.Dom.addClass(e,r)}var y=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;BX.addCustomEvent("onPullEvent-main",(function(e,n){var r="SITE_ID";var s=BX.message(r);if(e==="user_counter"&&n[s]){var a=BX.clone(n[s]);t.updateCounters(a,false)}}));BX.addCustomEvent("onPullEvent-tasks",(function(e,n){if(e==="user_counter"&&Number(n.userId)===Number(BX.Loc.getMessage("USER_ID"))){var r={};if(!BX.Type.isUndefined(n.projects_major)){r.projects_major=n.projects_major}if(!BX.Type.isUndefined(n.scrum_total_comments)){r.scrum_total_comments=n.scrum_total_comments}t.updateCounters(r,false)}}));BX.addCustomEvent(window,"onImUpdateCounter",(function(e){if(!e)return;t.updateCounters(BX.clone(e),false)}));BX.addCustomEvent("onImUpdateCounterMessage",(function(e){t.updateCounters({"im-message":e},false)}));if(BX.browser.SupportLocalStorage()){BX.addCustomEvent(window,"onLocalStorageSet",(function(e){if(e.key.substring(0,4)==="lmc-"){var n={};n[e.key.substring(4)]=e.value;t.updateCounters(n,false)}}))}BX.addCustomEvent("onCounterDecrement",(function(e){t.decrementCounter(BX("menu-counter-live-feed"),e)}))}},{key:"updateCounters",value:function e(t,n){BX.ready((function(){if(BX.getClass("BX.Intranet.DescktopLeftMenu")){BX.Intranet.DescktopLeftMenu.updateCounters(t,n)}}))}},{key:"decrementCounter",value:function e(t,n){BX.ready((function(){if(BX.getClass("BX.Intranet.DescktopLeftMenu")){BX.Intranet.DescktopLeftMenu.decrementCounter(t,n)}}))}}]);return e}();var C=function(){function e(t,n){babelHelpers.classCallCheck(this,e);this.parentContainer=t;this.container=n;this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){this.makeTextIcons()}},{key:"getId",value:function e(){return this.container.dataset.id}},{key:"getCode",value:function e(){return this.constructor.code}},{key:"getName",value:function e(){return this.container.querySelector("[data-role='item-text']").textContent}},{key:"makeTextIcons",value:function e(){if(!this.container.classList.contains("menu-item-no-icon-state")){return}var t=this.container.querySelector(".menu-item-icon");var n=this.container.querySelector(".menu-item-link-text");if(t&&n){t.textContent=this.getShortName(n.textContent)}}},{key:"getCounterValue",value:function e(){var t=this.container.querySelector('[data-role="counter"]');if(!t){return null}return parseInt(t.dataset.counterValue)}},{key:"updateCounter",value:function e(t){var n=this.container.querySelector('[data-role="counter"]');if(!n){return}var r=parseInt(n.dataset.counterValue)||0;n.dataset.counterValue=t;if(t>0){n.innerHTML=t>99?"99+":t;this.container.classList.add("intranet__desktop-menu_item_counters")}else{n.innerHTML="";this.container.classList.remove("menu-item-with-index")}return{oldValue:r,newValue:t}}},{key:"getShortName",value:function e(t){if(!s.Type.isStringFilled(t)){return"..."}t=t.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(t.length<=0){return"..."}var n;var r=t.split(/[\s,]+/);if(r.length<=1){n=t.substring(0,1)}else if(r.length===2){n=r[0].substring(0,1)+r[1].substring(0,1)}else{var a=r[0];var i=r[1];for(var o=1;o<r.length;o++){if(r[o].length>3){i=r[o];break}}n=a.substring(0,1)+i.substring(0,1)}return n.toUpperCase()}}],[{key:"detect",value:function e(t){return t.getAttribute("data-role")!=="group"&&t.getAttribute("data-type")===this.code}}]);return e}();var k=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(C);babelHelpers.defineProperty(k,"code","admin");var H=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(C);babelHelpers.defineProperty(H,"code","custom");var E=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(C);babelHelpers.defineProperty(E,"code","standard");var T=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(C);babelHelpers.defineProperty(T,"code","self");var w=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(C);babelHelpers.defineProperty(w,"code","default");var S=[C,k,E,H,T,w];function P(e){var t=C;S.forEach((function(n){if(n.detect(e)){t=n}}));return t}function B(e,t){A(e,t);t.add(e)}function M(e,t,n){A(e,t);t.set(e,n)}function A(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function O(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var I=new WeakMap;var U=new WeakSet;var N=function(){function e(t){babelHelpers.classCallCheck(this,e);B(this,U);babelHelpers.defineProperty(this,"items",new Map);M(this,I,{writable:true,value:null});this.parentContainer=t;this.container=t.querySelector(".menu-items");t.querySelectorAll("li.menu-item-block").forEach(this.registerItem.bind(this))}babelHelpers.createClass(e,[{key:"registerItem",value:function e(t){var n=P(t);var r=new n(this.container,t);this.items.set(r.getId(),r);return r}},{key:"updateCounters",value:function e(t,n){var s=this;var a=null;n=n!==false;babelHelpers.toConsumableArray(Object.entries(t)).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],o=t[1];babelHelpers.toConsumableArray(O(s,U,x).call(s,i)).forEach((function(e){var t=e.updateCounter(o),n=t.oldValue,r=t.newValue;if((i.indexOf("crm_")<0||i.indexOf("crm_all")>=0)&&(i.indexOf("tasks_")<0||i.indexOf("tasks_total")>=0)){a=a||0;a+=r-n}}));if(n){BX.localStorage.set("lmc-"+i,o,5)}if(typeof BXIM!=="undefined"){if(babelHelpers.classPrivateFieldGet(s,I)===null){babelHelpers.classPrivateFieldSet(s,I,0);babelHelpers.toConsumableArray(s.items.entries()).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],r=t[1];var a=r.getCounterValue();if(a>0){var i="doesNotMatter";if(n.indexOf("menu_crm")>=0||n.indexOf("menu_tasks")>=0){var o=r.container.querySelector('[data-role="counter"]');if(o){i=o.id}}if(i==="doesNotMatter"||i.indexOf("crm_all")>=0||i.indexOf("tasks_total")>=0){babelHelpers.classPrivateFieldSet(s,I,babelHelpers.classPrivateFieldGet(s,I)+a)}}}))}else{babelHelpers.classPrivateFieldSet(s,I,babelHelpers.classPrivateFieldGet(s,I)+(a!==null?a:0))}var l=babelHelpers.classPrivateFieldGet(s,I)>99?"99+":babelHelpers.classPrivateFieldGet(s,I)<0?"0":babelHelpers.classPrivateFieldGet(s,I);if(r.DesktopApi.isDesktop()){r.DesktopApi.setBrowserIconBadge(l)}}}))}},{key:"decrementCounter",value:function e(t){var n=this;babelHelpers.toConsumableArray(Object.entries(t)).forEach((function(e){var r=babelHelpers.slicedToArray(e,2),s=r[0],a=r[1];var i=O(n,U,x).call(n,s).shift();if(i){var o=i.getCounterValue();t[s]=o>a?o-a:0}else{delete t[s]}}));this.updateCounters(t,false)}}]);return e}();function x(e){var t=[];babelHelpers.toConsumableArray(this.items.values()).forEach((function(n){var r=n.container.querySelector('[data-role="counter"]');if(r&&r.id.indexOf(e)>=0){t.push(n)}}));return t}var D;var X=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"items",[]);this.wrapper=document.getElementById("history-items")}babelHelpers.createClass(e,[{key:"init",value:function e(){var t;if("object"!=(typeof BXDesktopSystem==="undefined"?"undefined":babelHelpers["typeof"](BXDesktopSystem))){console.log("BXDesktopSystem is empty");return}this.items=(t=BXDesktopSystem)===null||t===void 0?void 0:t.BrowserHistory();this.showHistory()}},{key:"showHistory",value:function e(){var t=this;var n=0;this.items.forEach((function(e){var r="";var a="";if(s.Type.isStringFilled(e.title)){r=t.getShortName(e.title);a=e.title}else{if(e.url.includes("/desktop_app/")){r=Loc.getMessage("MENU_HISTORY_ITEM_ICON");a=Loc.getMessage("MENU_HISTORY_ITEM_NAME")}else{return}}if(e.url.includes("/desktop/menu")){return}var i=e.url;if(e.url.includes("/online/")){i="bx://v2/"+location.hostname+"/chat/"}var o=s.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<li class="intranet__desktop-menu_item">\n\t\t\t\t\t<a class="intranet__desktop-menu_item-link" href="','">\n\t\t\t\t\t\t<span class="intranet__desktop-menu_item-icon --custom">','</span>\n\t\t\t\t\t\t<span class="intranet__desktop-menu_item-title">',"</span>\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t"])),i,r,a);t.wrapper.appendChild(o);n++;if(n>11){return true}}))}},{key:"getShortName",value:function e(t){if(!s.Type.isStringFilled(t)){return"..."}t=t.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(t.length<=0){return"..."}var n;var r=t.split(/[\s,]+/);if(r.length<=1){n=t.substring(0,1)}else if(r.length===2){n=r[0].substring(0,1)+r[1].substring(0,1)}else{var a=r[0];var i=r[1];for(var o=1;o<r.length;o++){if(r[o].length>3){i=r[o];break}}n=a.substring(0,1)+i.substring(0,1)}return n.toUpperCase()}}]);return e}();function L(e,t,n){R(e,t);t.set(e,n)}function R(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var j=new WeakMap;var F=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"cache",new s.Cache.MemoryCache);babelHelpers.defineProperty(this,"browserHistory",null);babelHelpers.defineProperty(this,"account",null);babelHelpers.defineProperty(this,"theme",null);L(this,j,{writable:true,value:0});this.menuContainer=document.getElementById("menu-items-block");if(!this.menuContainer){return false}this.initTheme();this.getItemsController();this.getHistoryItems();this.showAccount(t);this.runAPICounters()}babelHelpers.createClass(e,[{key:"initTheme",value:function e(){this.theme=new b;this.theme.init()}},{key:"getItemsController",value:function e(){var t=this;return this.cache.remember("itemsMenuController",(function(){return new N(t.menuContainer)}))}},{key:"getHistoryItems",value:function e(){this.browserHistory=new X;this.browserHistory.init()}},{key:"showAccount",value:function e(t){this.account=new p(t);BX.Intranet.Account=this.account}},{key:"runAPICounters",value:function e(){BX.Intranet.Counters=new y;BX.Intranet.Counters.init()}},{key:"decrementCounter",value:function e(t,n){if(!t||t.id!=="menu-counter-live-feed"){return}babelHelpers.classPrivateFieldSet(this,j,babelHelpers.classPrivateFieldGet(this,j)+parseInt(n));this.getItemsController().decrementCounter({"live-feed":parseInt(n)})}},{key:"updateCounters",value:function e(t,n){if(!t){return}if(t["**"]!==undefined){t["live-feed"]=t["**"];delete t["**"]}var r=false;if(!s.Type.isUndefined(t["**SG0"])){this.workgroupsCounterData["livefeed"]=t["**SG0"];delete t["**SG0"];r=true}if(!s.Type.isUndefined(t[s.Loc.getMessage("COUNTER_PROJECTS_MAJOR")])){this.workgroupsCounterData[s.Loc.getMessage("COUNTER_PROJECTS_MAJOR")]=t[s.Loc.getMessage("COUNTER_PROJECTS_MAJOR")];delete t[s.Loc.getMessage("COUNTER_PROJECTS_MAJOR")];r=true}if(!s.Type.isUndefined(t[s.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")])){this.workgroupsCounterData[s.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")]=t[s.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")];delete t[s.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")];r=true}if(r){t["workgroups"]=Object.entries(this.workgroupsCounterData).reduce((function(e,t){var n=babelHelpers.slicedToArray(t,2),r=n[1];return e+Number(r)}),0)}if(t["live-feed"]){if(t["live-feed"]<=0){babelHelpers.classPrivateFieldSet(this,j,0)}else{t["live-feed"]-=babelHelpers.classPrivateFieldGet(this,j)}}this.getItemsController().updateCounters(t,n);BX.Intranet.Account.setCounters(t)}}]);return e}();e.DescktopMenu=F})(this.BX.Intranet=this.BX.Intranet||{},BX.Main,BX.Event,BX.Messenger.v2.Lib,BX);
//# sourceMappingURL=script.map.js