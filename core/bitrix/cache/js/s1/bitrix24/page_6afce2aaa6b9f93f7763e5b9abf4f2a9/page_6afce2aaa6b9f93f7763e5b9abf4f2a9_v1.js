
; /* Start:"a:4:{s:4:"full";s:96:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?17287331815071";s:6:"source";s:77:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.js";s:3:"min";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.map.js";}"*/
(function(){BX.namespace("BX.UI.SidePanel");if(BX.UI.SidePanel.Wrapper){return}function t(t){}t.prototype.init=function(t){this.container=BX(t.containerId);this.isCloseAfterSave=t.isCloseAfterSave||false;this.isReloadGridAfterSave=t.isReloadGridAfterSave||false;this.isReloadPageAfterSave=t.isReloadPageAfterSave||false;this.skipNotification=t.skipNotification||false;this.useLinkTargetsReplacing=t.useLinkTargetsReplacing||false;this.notification=t.notification||{};var e=BX.SidePanel.Instance.getPreviousSlider(BX.SidePanel.Instance.getSliderByWindow(window));this.parentWindow=e?e.getWindow():top;this.initEditableTitle(t);if(this.isReloadGridAfterSave){if(this.getParam("reloadGridAfterSave")){this.reloadGridOnParentPage()}this.setParam("reloadGridAfterSave",true)}if(this.isCloseAfterSave){if(this.getParam("closeAfterSave")){var i;if(this.notification.content&&top.BX&&!this.getParam("skipNotification")){i=function(){top.BX.loadExt("ui.notification").then(function(){top.BX.UI.Notification.Center.notify(this.notification)}.bind(this))}.bind(this)}else if(this.isReloadPageAfterSave){i=function(){this.parentWindow.location.reload()}.bind(this)}BX.SidePanel.Instance.close(false,i)}if(this.skipNotification){this.setParam("skipNotification",true)}this.setParam("closeAfterSave",true)}if(this.useLinkTargetsReplacing){this.initLinkTargetsReplacing()}};t.prototype.initEditableTitle=function(t){if(!t.title||!t.title.selector||!t.title.defaultTitle){return}var i=this.container.querySelector(t.title.selector);if(!i){return}var n=i.querySelector('input[type="text"]');if(!n){return}i.style.display="none";e.init({dataContainer:i,dataNode:n,defaultTitle:t.title.defaultTitle})};t.prototype.initLinkTargetsReplacing=function(){this.replaceLinkTargets();if(!window.MutationObserver){return}var t=new MutationObserver(this.domMutationHandler.bind(this));t.observe(this.container,{childList:true,subtree:true})};t.prototype.domMutationHandler=function(t){t.forEach(function(t){for(var e=0;e<t.addedNodes.length;++e){var i=t.addedNodes.item(e);if(!i){continue}this.replaceLinkTargets(i)}},this)};t.prototype.replaceLinkTargets=function(t){if(!t){t=document.body}var e=[];if(t.tagName==="A"){e=[t]}else if(t.nodeName!=="#text"){e=BX.convert.nodeListToArray(t.querySelectorAll("a"))}if(e.length===0){return}BX.convert.nodeListToArray(e).filter(function(t){return!t.target}).forEach(function(t){t.target="_top"})};t.prototype.setParam=function(t,e){var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.getData().set(t,e)}};t.prototype.getParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){return e.getData().get(t)}return undefined};t.prototype.removeParam=function(t){var e=BX.SidePanel.Instance.getSliderByWindow(window);if(e){e.getData().delete(t)}};t.prototype.reloadGridOnParentPage=function(){var t=this.parentWindow;var e=BX.type.isString(this.isReloadGridAfterSave)?this.isReloadGridAfterSave:null;if(!t.BX.Main||!t.BX.Main.gridManager){return}if(e==="all"){t.BX.Main.gridManager.data.forEach(function(t){t.instance.reload()});return}if(!e&&t.BX.Main.gridManager.data){var i=t.BX.Main.gridManager.data;e=i.length>0?i[0].id:null}if(!e){return}var n=t.BX.Main.gridManager.getById(e);if(!n){return}n.instance.reload()};var e={isInit:false,init:function(t){this.dataNode=t.dataNode;this.titleNode=document.querySelector(".ui-side-panel-wrap-title-name");this.inputNode=document.querySelector(".ui-side-panel-wrap-title-input");this.buttonNode=document.querySelector(".ui-side-panel-wrap-title-edit-button");this.initialTitle=this.titleNode.textContent;this.defaultTitle=t.defaultTitle;BX.bind(this.dataNode,"bxchange",this.onDataNodeChange.bind(this));BX.bind(this.buttonNode,"click",this.startEdit.bind(this));BX.bind(this.inputNode,"keyup",this.onKeyUp.bind(this));BX.bind(this.inputNode,"blur",this.endEdit.bind(this));this.isInit=true;if(!t.disabled){this.enable()}if(!this.dataNode.value){this.dataNode.value=this.defaultTitle}},enable:function(t){t=t||false;if(!this.isInit){return}this.changeDisplay(this.buttonNode,!t);this.titleNode.textContent=!t?this.dataNode.value?this.dataNode.value:this.defaultTitle:this.initialTitle},disable:function(){this.enable(true)},onDataNodeChange:function(){this.titleNode.textContent=this.dataNode.value},onKeyUp:function(t){t=t||window.event;if(t.keyCode===10||t.keyCode===13){this.endEdit();t.preventDefault();return false}},getTitle:function(){var t=this.dataNode.value;if(!t){t=this.titleNode.textContent}return t},startEdit:function(){this.inputNode.value=this.getTitle();this.changeDisplay(this.titleNode,false);this.changeDisplay(this.buttonNode,false);this.changeDisplay(this.inputNode,true);this.inputNode.focus()},endEdit:function(){this.dataNode.value=this.inputNode.value;this.titleNode.textContent=this.inputNode.value;this.changeDisplay(this.inputNode,false);this.changeDisplay(this.buttonNode,true);this.changeDisplay(this.titleNode,true)},changeDisplay:function(t,e){return t.style.display=e?"":"none"}};BX.UI.SidePanel.Wrapper=new t})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/bizproc.automation/templates/.default/script.min.js?172873318442199";s:6:"source";s:73:"/bitrix/components/bitrix/bizproc.automation/templates/.default/script.js";s:3:"min";s:77:"/bitrix/components/bitrix/bizproc.automation/templates/.default/script.min.js";s:3:"map";s:77:"/bitrix/components/bitrix/bizproc.automation/templates/.default/script.map.js";}"*/
if(!BX.getClass("BX.Bizproc.Automation.Component"))(function(t){"use strict";t.namespace("BX.Bizproc.Automation");const e=function(e){if(!t.type.isDomNode(e)){throw"baseNode must be Dom Node Element"}this.node=e;l.getInstance().component=this;r.component=this;c.component=this};e.ViewMode={None:0,View:1,Edit:2,Manage:3};const i=function(e){e=e||"/bitrix/components/bitrix/bizproc.automation/ajax.php";return t.util.add_url_param(e,{site_id:t.Loc.getMessage("SITE_ID"),sessid:t.bitrix_sessid()})};const o=function(e){let i;if(t.type.isArray(e)){for(const t of e){if(t.Id==="ASSIGNED_BY_ID"||t.Id==="RESPONSIBLE_ID"){i="{{"+t.Name+"}}";break}}}return i};e.prototype={init:function(i,o){this.viewMode=o||e.ViewMode.Edit;if(t.Type.isUndefined(i)){i={}}this.data=i;this.initData();this.initTracker();this.initContext();this.initActionPanel();this.initSearch();this.initTriggerManager();this.initTemplateManager();this.initButtons();this.initButtonsPosition();this.initHelpTips();this.initSelectors();const n=new t.Bizproc.Automation.Statuses(this.node);n.init(this.templateManager.templates);n.fixColors();this.initRobotSelector();this.initHowCheckAutomationTourGuide();if(!this.embeddedMode){window.onbeforeunload=()=>{if(this.isNeedSave()){return t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_NEED_SAVE")}}}if(this.frameMode){this.subscribeOnSliderClose()}},isNeedSave:function(){return this.templateManager.needSave()||this.triggerManager.needSave()},initData:function(){this.document=new t.Bizproc.Automation.Document({rawDocumentType:this.data.DOCUMENT_TYPE,documentId:this.data.DOCUMENT_ID,categoryId:this.data.DOCUMENT_CATEGORY_ID,statusList:this.data.DOCUMENT_STATUS_LIST,documentFields:this.data.DOCUMENT_FIELDS,title:this.data.ENTITY_NAME});this.documentSigned=this.data.DOCUMENT_SIGNED;this.bizprocEditorUrl=this.data.WORKFLOW_EDIT_URL;this.constantsEditorUrl=this.data.CONSTANTS_EDIT_URL||null;this.parametersEditorUrl=this.data.PARAMETERS_EDIT_URL||null;this.setDocumentStatus(this.data.DOCUMENT_STATUS);let e={};if(t.type.isPlainObject(this.data.USER_OPTIONS)){e=this.data.USER_OPTIONS}this.userOptions=new t.Bizproc.Automation.UserOptions(e);this.frameMode=t.type.isBoolean(this.data.FRAME_MODE)?this.data.FRAME_MODE:false;this.embeddedMode=this.data.IS_EMBEDDED===true},initContext:function(){const e=new t.Bizproc.Automation.Context({document:this.document,signedDocument:this.documentSigned,ajaxUrl:this.getAjaxUrl(),availableRobots:t.type.isArray(this.data.AVAILABLE_ROBOTS)?this.data.AVAILABLE_ROBOTS:[],availableTriggers:t.Type.isArray(this.data.AVAILABLE_TRIGGERS)?this.data.AVAILABLE_TRIGGERS:[],canManage:this.data.IS_TEMPLATES_SCHEME_SUPPORTED,canEdit:this.canEdit(),userOptions:this.userOptions,tracker:this.tracker,bizprocEditorUrl:this.bizprocEditorUrl,constantsEditorUrl:this.constantsEditorUrl,parametersEditorUrl:this.parametersEditorUrl,isFrameMode:this.isFrameMode,marketplaceRobotCategory:this.data.MARKETPLACE_ROBOT_CATEGORY,showTemplatePropertiesMenuOnSelecting:this.data.SHOW_TEMPLATE_PROPERTIES_MENU_ON_SELECTING===true,automationGlobals:new t.Bizproc.Automation.AutomationGlobals({variables:this.data.GLOBAL_VARIABLES,constants:this.data.GLOBAL_CONSTANTS})});e.set("TRIGGER_CAN_SET_EXECUTE_BY",this.data.TRIGGER_CAN_SET_EXECUTE_BY);e.set("IS_WORKTIME_AVAILABLE",this.data.IS_WORKTIME_AVAILABLE);t.Bizproc.Automation.setGlobalContext(e)},setDocumentStatus:function(t){this.document.setStatus(t);return this},isPreviousStatus:function(t){const e=this.document.getPreviousStatusIdList();for(const i of e){if(t===i){return true}}return false},isCurrentStatus:function(t){return t===this.document.getCurrentStatusId()},isNextStatus:function(t){const e=this.document.getNextStatusIdList();for(const i of e){if(t===i){return true}}return false},initActionPanel:function(){const e=document.querySelector('[data-role="automation-actionpanel"]');if(!e){return}this.actionPanel=new t.UI.ActionPanel({renderTo:e,removeLeftPosition:true,maxHeight:58,parentPosition:"bottom",autoHide:false});this.actionPanel.draw();const i="/bitrix/js/ui/icon-set/main/images/";const o="/bitrix/js/ui/icon-set/crm/images/";const n="/bitrix/js/ui/icon-set/actions/images/";this.actionPanel.appendItem({id:"automation_choose_all",text:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ACTIONPANEL_CHOOSE_ALL"),icon:`${i}complete.svg`,onclick:function(){const t=this.templateManager.targetManageModeStatus;const e=this.triggerManager.findTriggersByDocumentStatus(t);e.forEach((t=>t.selectNode()));const i=this.templateManager.getTemplateByStatusId(t);if(i){i.robots.forEach((t=>{t.selectNode()}))}}.bind(this)});this.actionPanel.appendItem({id:"automation_copy_to",text:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ACTIONPANEL_COPY_1"),icon:`${n}copy-plates.svg`,onclick:this.onCopyMoveButtonClick.bind(this,"copy")});this.actionPanel.appendItem({id:"automation_move_to",text:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ACTIONPANEL_MOVE_1"),icon:`${o}stages.svg`,onclick:this.onCopyMoveButtonClick.bind(this,"move")});this.actionPanel.appendItem({id:"automation_deactivate",text:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ACTIONPANEL_DEACTIVATE"),icon:`${i}switch.svg`,onclick:this.onDeactivateActionPanelButtonClick.bind(this)});this.actionPanel.appendItem({id:"automation_activate",text:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ACTIONPANEL_ACTIVATE"),icon:`${i}switch.svg`,hide:true,onclick:this.onDeactivateActionPanelButtonClick.bind(this)});this.actionPanel.appendItem({id:"automation_delete",text:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ACTIONPANEL_DELETE_1"),icon:`${i}trash-bin.svg`,onclick:this.onDeleteButtonClick.bind(this)});t.addCustomEvent("BX.UI.ActionPanel:hidePanel",(()=>{if(this.templateManager.isManageModeEnabled()){this.disableManageMode()}}))},onCopyMoveButtonClick:function(i){this.viewMode=e.ViewMode.Edit;const o=this.templateManager.targetManageModeStatus;const n=this.templateManager.getTemplateByStatusId(o);const a=n.getSelectedRobotNames();const s=this.triggerManager.getSelectedTriggers().map((t=>t.getId()));if(a.length+s.length===0){this.showNotification({content:t.Loc.getMessage("BIZPOC_AUTOMATION_NO_ROBOT_OR_TRIGGER_SELECTED"),autoHideDelay:4e3});return}t.SidePanel.Instance.open("/bitrix/components/bitrix/bizproc.automation.scheme/index.php",{width:569,cacheable:false,requestMethod:"post",requestParams:{documentSigned:this.documentSigned,templateStatus:this.templateManager.targetManageModeStatus,action:i,selectedRobots:a,selectedTriggers:s},events:{onCloseComplete:function(e){const o=e.slider;if(o){const e=o.getData();const n=e.get("targetScope");if(t.type.isNil(n)){return}const a=e=>t.type.isPlainObject(e)?e:{};const s=e=>t.type.isArray(e)?e:[];const r=a(e.get("robots"));const c=a(e.get("triggers"));const l=s(i==="copy"?r.copied:r.moved);const d=s(r.denied);const u=l.length+d.length;const h=s(i==="copy"?c.copied:c.moved);const g=s(c.denied);const p=h.length+g.length;let m="BIZPROC_AUTOMATION_CMP_";const f=[];if(u>0&&p===0){f.push("ROBOTS")}else if(p>0&&u===0){f.push("TRIGGERS")}else{f.push("ROBOTS","AND","TRIGGERS")}if(i==="copy"){f.push("COPIED")}else{f.push("MOVED")}m+=f.join("_");let T=t.Loc.getMessage(m);T=T.replace("#ACCEPTED_COUNT#",l.length+h.length);T=T.replace("#TOTAL_COUNT#",l.length+d.length+h.length+g.length);t.UI.Notification.Center.notify({content:T,actions:[{title:t.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),events:{click:function(e,i){e.preventDefault();if(t.type.isArray(r.restoreData)){this.saveTemplates(r.restoreData,c.restoreData);i.close()}}.bind(this)}}]});const M=[];const b=this.templateManager.targetManageModeStatus;if(i==="move"){M.push(b)}if(n&&this.data.DOCUMENT_TYPE_SIGNED===n.documentType.Type&&this.templateManager.getTemplateByStatusId(n.status.Id)){M.push(n.status.Id)}this.triggerManager.fetchTriggers(M).then((()=>{g.forEach((e=>{const i=this.triggerManager.findTriggerById(parseInt(e,10));if(i){t.Dom.addClass(i.node,"--denied");setTimeout(t.Dom.removeClass.bind(null,i.node,"--denied"),10*1e3)}}))}));this.templateManager.updateTemplates(M).onload=function(){const e=this.templateManager.getTemplateByStatusId(b);d.forEach((i=>{const o=e.getRobotById(i);if(o&&!o.isInvalid()){t.Dom.addClass(o.node,"--denied");setTimeout(t.Dom.removeClass.bind(null,o.node,"--denied"),10*1e3)}}))}.bind(this)}this.disableManageMode()}.bind(this)}})},onDeleteButtonClick:function(){this.viewMode=e.ViewMode.Edit;const i=this.templateManager.targetManageModeStatus;const o=this.templateManager.getTemplateByStatusId(i);if(!o){return}const n=this.templateManager.templatesData.findIndex((t=>t.ID===o.getId()));const a=o.getSelectedRobotNames();const s=this.triggerManager.getSelectedTriggers().map((t=>t.getId()));if(a.length+s.length===0){this.showNotification({content:t.Loc.getMessage("BIZPOC_AUTOMATION_NO_ROBOT_OR_TRIGGER_SELECTED"),autoHideDelay:4e3});return}t.ajax({method:"POST",dataType:"json",url:this.getAjaxUrl(),data:{ajax_action:"delete_robots",document_signed:this.documentSigned,selected_status:o.getStatusId(),robot_names:u.toJsonString(a),trigger_names:u.toJsonString(s)},onsuccess:function(e){const i=[];if(a.length>0&&s.length===0){i.push("ROBOTS")}else if(s.length>0&&a.length===0){i.push("TRIGGERS")}else{i.push("ROBOTS","AND","TRIGGERS")}let r=t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_"+i.join("_")+"_DELETED");r=r.replace("#TOTAL_COUNT#",a.length+s.length);if(e.SUCCESS){this.triggerManager.fetchTriggers().then();o.reInit(e.DATA.template,this.viewMode);this.templateManager.templatesData[n]=e.DATA.template;this.disableManageMode();r=r.replace("#ACCEPTED_COUNT#",a.length+s.length);var c=e.DATA.restoreData}else{r=r.replace("#ACCEPTED_COUNT#",0)}t.UI.Notification.Center.notify({content:r,actions:[{title:t.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),events:{click:function(e,i){e.preventDefault();if(t.type.isPlainObject(c)){this.saveTemplates([c.template],c.triggers);i.close()}}.bind(this)}}]})}.bind(this)})},onDeactivateActionPanelButtonClick:function(){const e=this.templateManager.targetManageModeStatus;const i=this.templateManager.getTemplateByStatusId(e);const o=i.getSelectedRobotNames();if(o.length===0){this.showNotification({content:t.Loc.getMessage("BIZPOC_AUTOMATION_NO_ROBOT_SELECTED"),autoHideDelay:4e3});return}const n=this.triggerManager.getSelectedTriggers().map((t=>t.getId()));if(n.length>0){this.showNotification({autoHideDelay:4e3,content:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DEACTIVATE_TRIGGER_ALERT_MESSAGE")})}const a=i.getDeactivatedRobotNames();const s=o.every((t=>a.includes(t)));this.disableManageMode();i.markModified(true);o.forEach((t=>{const e=i.getRobotById(t);if(e){e.setActivated(s).reInit()}}))},initTriggerManager:function(){this.triggerManager=new h(this.node,{userOptions:this.userOptions});this.subscribeTriggerManagerEvents();this.triggerManager.init(this.data,t.Bizproc.Automation.ViewMode.fromRaw(this.viewMode));this.triggerManager.onTriggerEvent("Trigger:selected",(()=>{const t=this.templateManager.getTemplateByStatusId(this.templateManager.targetManageModeStatus);const e=t.getSelectedRobotNames().length+this.triggerManager.getSelectedTriggers().length;this.actionPanel.setTotalSelectedItems(e)}));this.triggerManager.onTriggerEvent("Trigger:unselected",(()=>{const e=this.templateManager.getTemplateByStatusId(this.templateManager.targetManageModeStatus);const i=t.type.isNil(e)?[]:e.getSelectedRobotNames();const o=i.length+this.triggerManager.getSelectedTriggers().length;this.actionPanel.setTotalSelectedItems(o)}));t.Event.EventEmitter.subscribe(this,"BX.Bizproc.Automation.Component:onSearch",this.triggerManager.onSearch.bind(this.triggerManager))},subscribeTriggerManagerEvents:function(){this.triggerManager.subscribe("TriggerManager:dataModified",(()=>{this.markModified()}));this.triggerManager.subscribe("TriggerManager:trigger:delete",(e=>{const i=e.getData().trigger;t.ajax.runAction("bizproc.analytics.push",{analyticsLabel:{automation_trigger_delete:"Y",delete_trigger:i.getCode().toLowerCase()}})}))},reInitTriggerManager:function(e){if(t.type.isArray(e)){this.data.TRIGGERS=e}this.triggerManager.reInit(this.data,t.Bizproc.Automation.ViewMode.fromRaw(this.viewMode))},initTemplateManager:function(){this.templateManager=new n(this);this.templateManager.init(this.data,this.viewMode)},reInitTemplateManager:function(e){if(t.type.isArray(e)){this.data.TEMPLATES=e}this.templateManager.reInit(this.data,this.viewMode)},initButtons:function(){if(t.Bizproc.Automation.ViewMode.fromRaw(this.viewMode).isEdit()){this.initAddButtons()}const e=this.node.querySelector('[data-role="automation-buttons"]');if(e){this.bindSaveButton();this.bindCancelButton()}this.bindCreationButton()},initAddButtons:function(){const e=this.node.querySelectorAll('[data-role="add-button-container"]');e.forEach((e=>{const i=this.templateManager.getTemplateByStatusId(e.dataset.statusId);if(!i){return}const o=t.Dom.create("span",{events:{click:()=>{if(this.canEdit()){this.robotSelector.setStageId(e.dataset.statusId);this.robotSelector.show()}else{t.Bizproc.Automation.HelpHint.showNoPermissionsHint(o)}}},attrs:{className:"bizproc-automation-robot-btn-add"},children:[t.Dom.create("span",{attrs:{className:"bizproc-automation-btn-add-text"},text:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ADD")})]});t.Dom.append(o,e)}))},initButtonsPosition:function(){const e=this.node.querySelector('[data-role="automation-buttons"]');if(e&&this.frameMode){t.addClass(e,"bizproc-automation-buttons-fixed-slider")}},initSearch:function(){const e=this.node.querySelector('[data-role="automation-search"]');if(e){t.bind(e,"input",t.debounce(this.onSearch.bind(this,e),255));t.Event.EventEmitter.setMaxListeners(this,"BX.Bizproc.Automation.Component:onSearch",500);const i=this.node.querySelector('[data-role="automation-search-clear"]');if(i){t.bind(i,"click",this.onClearSearch.bind(this,e))}}},reInitSearch:function(){const t=this.node.querySelector('[data-role="automation-search"]');if(t){this.onSearch(t)}},onSearch:function(e){t.Event.EventEmitter.emit(this,"BX.Bizproc.Automation.Component:onSearch",{queryString:e.value.toLowerCase()})},onClearSearch:function(t){if(t.value!==""){t.value="";this.onSearch(t)}},initHelpTips:function(){t.UI.Hint.init(this.node)},initSelectors:function(){t.Event.EventEmitter.subscribe("BX.Bizproc.Automation:Template:onSelectorMenuOpen",(e=>{const i=e.getData().template;const o=e.getData().selector;const n=e.getData().isMixedCondition;if(t.Type.isBoolean(n)&&!n){return}const a=new m({triggerResultFields:this.triggerManager.getReturnProperties(i.getStatusId())});a.groupsWithChildren.forEach((t=>{o.addGroup(t.id,t)}))}))},reInitButtons:function(){const t=this.node.querySelector('[data-role="automation-btn-change-view"]');if(t){t.innerHTML=t.getAttribute("data-label-"+(this.viewMode===e.ViewMode.View?"edit":"view"))}},enableDragAndDrop:function(){this.templateManager.enableDragAndDrop();this.triggerManager.enableDragAndDrop()},disableDragAndDrop:function(){this.templateManager.disableDragAndDrop();this.triggerManager.disableDragAndDrop()},initTracker:function(){this.tracker=new d(this.document,this.getAjaxUrl());this.tracker.init(this.data.LOG)},bindSaveButton:function(){const e=t("ui-button-panel-save");if(e){t.Event.bind(e,"click",(i=>{i.preventDefault();this.saveAutomation();t.Dom.removeClass(e,"ui-btn-wait")}))}},bindCancelButton:function(){const e=this.node.querySelector('[data-role="automation-btn-cancel"]');if(e){t.bind(e,"click",this.onCancelButtonClick.bind(this))}},onCancelButtonClick:function(t){if(t){t.preventDefault()}this.reInitTriggerManager();this.reInitTemplateManager();this.reInitSearch();this.markModified(false)},bindCreationButton:function(){const e=this.node.querySelector('[data-role="automation-btn-create"]');if(e&&this.canEdit()){t.bind(e,"click",(()=>{this.robotSelector.setStageId(this.templateManager.templates[0]?.getStatusId());this.robotSelector.show()}));const i=new t.Bizproc.LocalSettings.Settings("aut-cmp");if(i.get("beginning-guide-shown")!==true){const i=this.document.getRawType();const o=i[0];const n=i[2];const a=o==="crm"&&["LEAD","DEAL","INVOICE","SMART_INVOICE","QUOTE"].includes(n);new t.Bizproc.Automation.BeginningGuide({target:e,text:a?t.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_SUBTITLE_SELLING_DOCUMENT_TYPE"):null,article:a?"16547606":null}).start()}i.set("beginning-guide-shown",true)}},getAjaxUrl:function(){return i(this.data.AJAX_URL)},getLimits:function(){const t=this.data.ROBOTS_LIMIT;if(t<=0){return false}const e=this.triggerManager.countAllTriggers();const i=this.templateManager.countAllActivatedRobots();return e+i>t?[t,e,i]:false},saveAutomation:function(e){if(this.savingAutomation){return}const i=this.getLimits();if(i){if(top.BX.UI&&top.BX.UI.InfoHelper){top.BX.UI.InfoHelper.show("limit_crm_robots");return}t.UI.Dialogs.MessageBox.show({title:t.Loc.getMessage("BIZPROC_AUTOMATION_ROBOTS_LIMIT_ALERT_TITLE"),message:t.Loc.getMessage("BIZPROC_AUTOMATION_ROBOTS_LIMIT_SAVE_ALERT",{"#LIMIT#":i[0],"#SUM#":i[1]+i[2],"#TRIGGERS#":i[1],"#ROBOTS#":i[2]}),modal:true,buttons:t.UI.Dialogs.MessageBoxButtons.OK,okCaption:t.Loc.getMessage("BIZPROC_AUTOMATION_CLOSE_CAPTION")});return}const o=this;const n={ajax_action:"save_automation",document_signed:this.documentSigned,triggers_json:u.toJsonString(this.triggerManager.serialize()),templates_json:u.toJsonString(this.templateManager.serializeModified())};const a={automation_save:"Y",robots_count:this.templateManager.countAllActivatedRobots(),triggers_count:this.triggerManager.countAllTriggers(),automation_module:this.document.getRawType()[0],automation_entity:this.document.getRawType()[2]+"_"+this.document.getCategoryId()};this.savingAutomation=true;return t.ajax({method:"POST",dataType:"json",url:t.Uri.addParam(this.getAjaxUrl(),{analyticsLabel:a}),data:n,onsuccess:function(i){o.savingAutomation=null;i.DATA.templates.forEach((t=>{const e=o.data.TEMPLATES.findIndex((e=>e.ID===t.ID));o.data.TEMPLATES[e]=t}));if(i.SUCCESS){o.reInitTriggerManager(i.DATA.triggers);o.reInitTemplateManager();o.reInitSearch();o.markModified(false);t.Event.EventEmitter.emit("BX.Bizproc.Component.Automation.Component:onSuccessAutomationSave",new t.Event.BaseEvent({data:{analyticsLabel:a}}));if(e){e(i.DATA)}}else{alert(i.ERRORS[0])}}})},subscribeOnSliderClose:function(){const e=t.SidePanel.Instance.getSliderByWindow(window);if(e){const i=t.UI.Dialogs.MessageBox.create({message:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ON_CLOSE_SLIDER_MESSAGE"),okCaption:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ON_CLOSE_SLIDER_OK_TITLE"),onOk:()=>{if(e.isCacheable()){this.onCancelButtonClick()}e.getData().set("ignoreChanges",true);e.close();return true},buttons:t.UI.Dialogs.MessageBoxButtons.OK_CANCEL});t.addCustomEvent(e,"SidePanel.Slider:onClose",(t=>{if(this.isNeedSave()&&e.getData()?.get("ignoreChanges")!==true){t.denyAction();i.show();return}e.getData()?.set("ignoreChanges",false)}))}},initHowCheckAutomationTourGuide(){const e=this.document.getRawType();const i=e[0];const o=e[2];const n=this.document.getCategoryId();const a=this.data.DOCUMENT_ID;if(i==="crm"){const e=t.Type.isPlainObject(this.data.USER_OPTIONS)?this.data.USER_OPTIONS:{};const i=t.Type.isPlainObject(e.crm_check_automation)?Object.keys(e.crm_check_automation).length>0:false;if(this.canEdit()&&!i){t.Bizproc.Automation.CrmCheckAutomationGuide.startCheckAutomationTour(o,Number(n))}if(i&&t.Type.isStringFilled(a)){t.Bizproc.Automation.CrmCheckAutomationGuide.showSuccessAutomation(o,n,e.crm_check_automation)}}},saveTemplates:function(e,i){if(this.savingAutomation){return}const o={ajax_action:"save_automation",document_signed:this.documentSigned,templates_json:u.toJsonString(e),triggers_json:u.toJsonString(i)};this.savingAutomation=true;const n=this;return t.ajax({method:"POST",dataType:"json",url:this.getAjaxUrl(),data:o,onsuccess:function(t){n.savingAutomation=null;if(t.SUCCESS){n.triggerManager.fetchTriggers().then();e.forEach((t=>{const e=n.templateManager.getTemplateById(t.ID);if(e){e.reInit(t,n.viewMode)}}))}else{alert(t.ERRORS[0])}}})},changeViewMode:function(i,o){if(!o&&this.isNeedSave()){alert(t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_NEED_SAVE"));return}if(i!==e.ViewMode.View&&i!==e.ViewMode.Edit){throw"Unknown view mode"}this.viewMode=i;this.reInitTriggerManager();this.reInitTemplateManager();this.reInitButtons()},enableManageMode:function(t){if(!this.isNeedSave()){this.viewMode=e.ViewMode.Manage;this.templateManager.enableManageMode(t);this.triggerManager.enableManageMode(t)}},disableManageMode:function(){this.viewMode=e.ViewMode.Edit;this.templateManager.disableManageMode();this.triggerManager.disableManageMode()},markModified:function(i){i=i!==false;const o=this.robotSelector&&this.robotSelector.isShown();const n=this.node.querySelector('[data-role="automation-buttons"]');if(!n){return}if(i&&this.canEdit()&&this.viewMode===e.ViewMode.Edit){if(!o){t.show(n)}}else{t.hide(n)}},canEdit:function(){return this.data.CAN_EDIT},updateTracker:function(){this.tracker.update(this.documentSigned).onload=function(){if(this.viewMode===e.ViewMode.View){this.templateManager.reInit()}}.bind(this)},onGlobalHelpClick:function(t){t.preventDefault();const e=t.target.closest('[name="bizproc_automation_robot_dialog"]')?"#after":"";if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=14889274"+e)}},getUserOption:function(t,e,i){return this.userOptions.get(t,e,i)},setUserOption:function(t,e,i){this.userOptions.set(t,e,i);return this},getConstants:function(){const e=t.Bizproc.Automation.getGlobalContext();return e.automationGlobals.globalConstants},getConstant:function(t){return this.getConstants().find((e=>e.Id===t))||null},getGVariables:function(){const e=t.Bizproc.Automation.getGlobalContext();return e.automationGlobals.globalVariables},getGVariable:function(t){return this.getGVariables().find((e=>e.Id===t))||null},getDocumentFields:function(){return this.document.getFields()},initRobotSelector(){if(!this.robotSelector){const e=this;const i=new t.Bizproc.LocalSettings.Settings("aut-cmp");const o=new t.Bizproc.Automation.AutomationGuide({isShownRobotGuide:i.get("robot-guide-shown")===true,isShownTriggerGuide:i.get("trigger-guide-shown")===true});this.robotSelector=new t.Bizproc.Automation.RobotSelector({context:t.Bizproc.Automation.getGlobalContext(),stageId:this.templateManager.templates[0]?.getStatusId(),events:{robotSelected:n=>{if(!this.canEdit()){return}const a=n.getData().item;const s=n.getData().stageId;const r=t.Runtime.clone(a.customData.robotData);const c=n.getData().originalEvent;r.NAME=a.title;r.DIALOG_CONTEXT={addMenuGroup:a.groupIds[0]};const l=this.templateManager.getTemplateByStatusId(s);if(!l){return}if(l.isExternalModified()){this.showNotification({content:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT_STAGE_TEXT")})}else{l.addRobot(r,(n=>{const a=t.Type.isBoolean(r.ROBOT_SETTINGS.IS_SUPPORTING_ROBOT)?"setShowSupportingRobotGuide":"setShowRobotGuide";this.notifyAboutNewRobot(l,n);if(!(c.ctrlKey||c.metaKey)){e.robotSelector.close();l.openRobotSettingsDialog(n);l.subscribeOnce("Template:robot:closeSettings",(()=>{o[a](true,n.node);o.start();i.set("robot-guide-shown",o.isShownRobotGuide);i.set("trigger-guide-shown",o.isShownTriggerGuide)}))}}))}},triggerSelected:n=>{if(!this.canEdit()){return}const a=n.getData().item;const s=n.getData().stageId;const r=t.Runtime.clone(a.customData.triggerData);const c=n.getData().originalEvent;r.DOCUMENT_STATUS=s;this.triggerManager.addTrigger(r,(t=>{t.setName(a.title);this.triggerManager.insertTriggerNode(s,t.node);this.triggerManager.insertTrigger(t);this.notifyAboutNewTrigger(t);if(!(c.ctrlKey||c.metaKey)){e.robotSelector.close();this.triggerManager.openTriggerSettingsDialog(t);this.triggerManager.subscribeOnce("TriggerManager:onCloseTriggerSettingsDialog",(()=>{o.setShowTriggerGuide(true,t.node);o.start();i.set("robot-guide-shown",o.isShownRobotGuide);i.set("trigger-guide-shown",o.isShownTriggerGuide)}))}}))},onAfterShow:()=>{t.Dom.addClass(this.node,"automation-base-blocked");if(!this.isOpenRobotSelectorAnalyticsPushed){const e=this.document;t.ajax.runAction("bizproc.analytics.push",{analyticsLabel:{automation_enter_dialog:"Y",start_module:e.getRawType()[0],start_entity:e.getRawType()[2]+"_"+e.getCategoryId()}});this.isOpenRobotSelectorAnalyticsPushed=true}},onAfterClose:()=>{t.Dom.removeClass(this.node,"automation-base-blocked");if(this.isNeedSave()){this.markModified()}}}})}},notifyAboutNewRobot(e,i){const o=e.getStatus()??{};const n=t.Bizproc.Automation.getGlobalContext();let a="BIZPROC_AUTOMATION_ROBOT_SELECTOR_NEW_ROBOT_ADDED";if(n.document.statusList.length>1){a+="_ON_STAGE"}this.showNotification({content:t.Loc.getMessage(a,{"#ROBOT_NAME#":t.Text.encode(i.getTitle()),"#STAGE_NAME#":t.Text.encode(o.NAME||o.TITLE)}),actions:[{title:t.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),events:{click:function(t,o){t.preventDefault();e.deleteRobot(i);i.destroy();o.close()}}}]})},notifyAboutNewTrigger(e){const i=this;const o=e.getStatus()??{};const n=t.Bizproc.Automation.getGlobalContext();let a="BIZPROC_AUTOMATION_ROBOT_SELECTOR_NEW_TRIGGER_ADDED";if(n.document.statusList.length>1){a+="_ON_STAGE"}this.showNotification({content:t.Loc.getMessage(a,{"#TRIGGER_NAME#":t.Text.encode(e.getName()),"#STAGE_NAME#":t.Text.encode(o.NAME||o.TITLE)}),actions:[{title:t.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),events:{click:function(o,n){o.preventDefault();i.triggerManager.deleteTrigger(e);t.Dom.remove(e.node);n.close()}}}]})},showNotification(e){const i={autoHideDelay:3e3};t.UI.Notification.Center.notify(Object.assign(i,e))}};const n=function(t){this.component=t};n.prototype={init:function(i,o){if(!t.type.isPlainObject(i)){i={}}this.viewMode=o||e.ViewMode.Edit;this.availableRobots=t.type.isArray(i.AVAILABLE_ROBOTS)?i.AVAILABLE_ROBOTS:[];this.templatesData=t.type.isArray(i.TEMPLATES)?i.TEMPLATES:[];this.initTemplates()},reInit:function(i,o){if(!t.type.isPlainObject(i)){i={}}this.viewMode=o||e.ViewMode.Edit;if(t.type.isArray(i.TEMPLATES)){this.templatesData=i.TEMPLATES}if(this.viewMode!==e.ViewMode.Edit){this.targetManageModeStatus=""}this.reInitTemplates(this.templatesData);if(this.isManageModeEnabled()){this.enableManageMode(this.targetManageModeStatus)}else{this.disableManageMode()}},isManageModeSupported:function(){return this.component.data.IS_TEMPLATES_SCHEME_SUPPORTED},isManageModeEnabled:function(){return t.type.isString(this.targetManageModeStatus)&&this.targetManageModeStatus!==""},enableManageMode:function(t){this.viewMode=e.ViewMode.Manage;this.targetManageModeStatus=t;this.templates.forEach((e=>{if(e.getStatusId()===t){e.enableManageMode(true)}else{e.enableManageMode(false)}}));this.component.disableDragAndDrop();this.component.actionPanel.showPanel()},disableManageMode:function(){this.viewMode=e.ViewMode.Edit;this.targetManageModeStatus="";this.component.actionPanel.hidePanel();this.templates.forEach((t=>{t.disableManageMode()}));this.component.enableDragAndDrop()},enableDragAndDrop:function(){this.templates.forEach((t=>{t.enableDragAndDrop()}))},disableDragAndDrop:function(){this.templates.forEach((t=>{t.disableDragAndDrop()}))},initTemplates:function(){this.templates=[];this.templatesMap={};for(let t=0;t<this.templatesData.length;++t){const e=this.createTemplate(this.templatesData[t]);this.templates.push(e);this.templatesMap[e.getStatusId()]=e}},createTemplate:function(e){const i=new t.Bizproc.Automation.Template({constants:{},variables:{},templateContainerNode:this.component.node,delayMinLimitM:this.component.data.DELAY_MIN_LIMIT_M,userOptions:this.component.userOptions});i.init(e,this.viewMode);t.Event.EventEmitter.subscribe(this.component,"BX.Bizproc.Automation.Component:onSearch",i.onSearch.bind(i));this.subscribeTemplateEvents(i);this.subscribeRobotEvents(i);return i},subscribeTemplateEvents:function(t){this.getTemplateEventListeners(t).forEach((e=>{t.subscribe(e.eventName,e.listener)}))},subscribeRobotEvents:function(t){this.getRobotEventListeners(t).forEach((e=>{t.subscribeRobotEvents(e.eventName,e.listener)}))},getTemplateEventListeners:function(i){return[{eventName:"Template:help:show",listener:function(t){this.component.onGlobalHelpClick(t.data)}.bind(this)},{eventName:"Template:robot:showSettings",listener:function(){t.Dom.addClass(this.component.node,"automation-base-blocked")}.bind(this)},{eventName:"Template:robot:closeSettings",listener:function(){t.Dom.removeClass(this.component.node,"automation-base-blocked")}.bind(this)},{eventName:"Template:robot:add",listener:function(t){const e=t.getData().robot;this.getRobotEventListeners(i).forEach((t=>{e.subscribe(t.eventName,t.listener)}))}.bind(this)},{eventName:"Template:robot:delete",listener:function(e){const i=e.getData().robot;t.ajax.runAction("bizproc.analytics.push",{analyticsLabel:{automation_robot_delete:"Y",delete_robot:i.data.Type.toLowerCase()}})}.bind(this)},{eventName:"Template:modified",listener:function(){this.component.markModified()}.bind(this)},{eventName:"Template:enableManageMode",listener:function(t){if(this.viewMode===e.ViewMode.Edit){this.component.enableManageMode(t.getData().documentStatus)}}.bind(this)}]},getRobotEventListeners:function(e){return[{eventName:"Robot:selected",listener:function(){const t=this.component.triggerManager.getSelectedTriggers().length+e.getSelectedRobotNames().length;this.component.actionPanel.setTotalSelectedItems(t);this.toggleActionDeactivateItem(e)}.bind(this)},{eventName:"Robot:unselected",listener:function(){const t=this.component.triggerManager.getSelectedTriggers().length+e.getSelectedRobotNames().length;this.component.actionPanel.setTotalSelectedItems(t);this.toggleActionDeactivateItem(e)}.bind(this)},{eventName:"Robot:title:editStart",listener:function(){t.addClass(this.component.node,"automation-base-blocked")}.bind(this)},{eventName:"Robot:title:editCompleted",listener:function(){t.removeClass(this.component.node,"automation-base-blocked")}.bind(this)},{eventName:"Robot:manage",listener:function(i){const o=this.getTemplateByColumnNode(i.getData().templateNode);const n=i.getData().droppableItem;const a=i.getData().robot;let s;if(!t.Type.isNil(n)){s=o.getRobotById(n.getAttribute("data-id"))}if(e){if(i.getData().isCopy){p.copyRobotTo(o,a,s)}else if(a!==s){a.moveTo(o,s)}}}.bind(this)},{eventName:"Robot:onAfterActivated",listener:function(){if(e){e.markModified(true)}}},{eventName:"Robot:onAfterDeactivated",listener:function(){if(e){e.markModified(true)}}}]},toggleActionDeactivateItem(t){const e=this.component.actionPanel?.getItemById("automation_deactivate");const i=this.component.actionPanel?.getItemById("automation_activate");if(e&&i){const o=t.getSelectedRobotNames();let n=false;if(o.length>0){const e=t.getDeactivatedRobotNames();n=o.every((t=>e.includes(t)))}i[n?"showAsInlineBlock":"hide"]();e[n?"hide":"showAsInlineBlock"]()}},reInitTemplates:function(t){for(let e=0;e<this.templates.length;++e){if(t[e]){this.templates[e].reInit(t[e],this.viewMode);this.subscribeRobotEvents(this.templates[e])}}},updateTemplates:function(e){return t.ajax({method:"POST",dataType:"json",url:this.component.getAjaxUrl(),data:{ajax_action:"update_templates",document_signed:this.component.documentSigned,statuses:e},onsuccess:function(t){if(t.SUCCESS){const e=t.DATA.templates;for(const t in e){if(e.hasOwnProperty(t)){const i=this.getTemplateByStatusId(t);const o=this.templatesData.findIndex((t=>t.ID===i.getId()));i.reInit(e[t],this.viewMode);this.templatesData[o]=e[t]}}}}.bind(this)})},getAvailableRobots:function(){return this.availableRobots},getRobotDescription:function(t){return this.availableRobots.find((e=>e.CLASS===t))},serialize:function(){const t=[];for(let e=0;e<this.templates.length;++e){t.push(this.templates[e].serialize())}return t},serializeModified:function(){const t=[];this.templates.forEach((e=>{if(e.isModified()){t.push(e.serialize())}}));return t},countAllRobots:function(){let t=0;this.templates.forEach((e=>{t+=e.robots.length}));return t},countAllActivatedRobots:function(){let t=0;this.templates.forEach((e=>{t+=e.getActivatedRobotNames().length}));return t},getTemplateByColumnNode:function(t){const e=t.getAttribute("data-status-id");return this.getTemplateByStatusId(e)},getTemplateById:function(t){return this.templates.find((e=>e.getId()===t))},getTemplateByStatusId:function(t){return this.templatesMap[t]||null},canEdit:function(){return this.component&&this.component.canEdit()},needSave:function(){let t=false;for(let e=0;e<this.templates.length;++e){if(this.templates[e].isModified()){t=true;break}}return t}};const a=function(e,i){let o;const n=i.getAttribute("data-config");if(n){o=t.parseJSON(n)}if(!t.type.isPlainObject(o)){o={}}this.container=i;this.type=o.type||a.Type.File;if(o.selected&&o.selected.length===0){this.type=a.Type.None}this.multiple=o.multiple||false;this.required=o.required||false;this.valueInputName=o.valueInputName||"";this.typeInputName=o.typeInputName||"";this.useDisk=o.useDisk||false;this.label=o.label||"Attachment";this.labelFile=o.labelFile||"File";this.labelDisk=o.labelDisk||"Disk";const s=e.template?e.template.robots:[];this.setFileFields(e.getDocument().getFields(),s);this.createDom();if(o.selected&&o.selected.length>0){this.addItems(t.clone(o.selected))}};a.Type={None:"",Disk:"disk",File:"file"};a.prototype={setFileFields:function(e,i){const o=[];const n={};for(const t of e){if(t.Type==="file"){o.push(t)}}if(t.type.isArray(i)){i.forEach((t=>{t.getReturnFieldsDescription().forEach((e=>{if(e.Type==="file"){const i="{{~"+t.getId()+":"+e.Id+"}}";o.push({Id:i,Name:t.getTitle()+": "+e.Name,Type:"file",Expression:i});n[i]=t.getTitle()+": "+e.Name}}))}))}this.fileFields=o;this.fileLabels=n;return this},createDom:function(){t.Dom.append(this.createBaseNode(),this.container);this.showTypeControllerLayout(this.type)},createBaseNode:function(){const e=t.Bizproc.Automation.Helper.generateUniqueId();let i=null;if(this.fileFields.length>0){i=t.create("input",{attrs:{className:"bizproc-automation-popup-select-input",type:"radio",id:"type-1"+e,name:this.typeInputName,value:a.Type.File}});if(this.type===a.Type.File){i.setAttribute("checked","checked")}}const o=t.create("input",{attrs:{className:"bizproc-automation-popup-select-input",type:"radio",id:"type-2"+e,name:this.typeInputName,value:a.Type.Disk}});if(this.type===a.Type.Disk){o.setAttribute("checked","checked")}const n=[t.create("span",{attrs:{className:"bizproc-automation-popup-settings-title"},text:this.label+":"})];if(i){n.push(i,t.create("label",{attrs:{className:"bizproc-automation-popup-settings-link",for:"type-1"+e},text:this.labelFile,events:{click:this.onTypeChange.bind(this,a.Type.File)}}))}n.push(o,t.create("label",{attrs:{className:"bizproc-automation-popup-settings-link",for:"type-2"+e},text:this.labelDisk,events:{click:this.onTypeChange.bind(this,a.Type.Disk)}}));return t.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[t.create("div",{attrs:{className:"bizproc-automation-popup-settings-block"},children:n})]})},showTypeControllerLayout:function(t){if(t===a.Type.Disk){this.hideFileControllerLayout();this.showDiskControllerLayout()}else if(t===a.Type.File){this.hideDiskControllerLayout();this.showFileControllerLayout()}else{this.hideFileControllerLayout();this.hideDiskControllerLayout()}},showDiskControllerLayout:function(){if(this.diskControllerNode){t.show(this.diskControllerNode)}else{this.diskControllerNode=t.create("div");t.Dom.append(this.diskControllerNode,this.container);const e=this.getDiskUploader();e.layout(this.diskControllerNode);e.show(true)}},hideDiskControllerLayout:function(){if(this.diskControllerNode){t.hide(this.diskControllerNode)}},showFileControllerLayout:function(){if(this.fileControllerNode){t.show(this.fileControllerNode)}else{this.fileItemsNode=t.create("span");this.fileControllerNode=t.create("div",{children:[this.fileItemsNode]});t.Dom.append(this.fileControllerNode,this.container);const e=t.create("a",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-popup-settings-link-thin"},text:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ADD")});t.Dom.append(e,this.fileControllerNode);t.bind(e,"click",this.onFileFieldAddClick.bind(this,e))}},hideFileControllerLayout:function(){if(this.fileControllerNode){t.hide(this.fileControllerNode)}},getDiskUploader:function(){if(!this.diskUploader){this.diskUploader=t.Bizproc.Automation.DiskUploader.create("",{msg:{diskAttachFiles:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_ATTACH_FILE"),diskAttachedFiles:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_ATTACHED_FILES"),diskSelectFile:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE"),diskSelectFileLegend:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE_LEGEND_MSGVER_1"),diskUploadFile:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE"),diskUploadFileLegend:t.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE_LEGEND")}});this.diskUploader.setMode(1)}return this.diskUploader},onTypeChange:function(t){if(this.type!==t){this.type=t;this.showTypeControllerLayout(this.type)}},isFileItemSelected:function(t){const e=this.fileItemsNode.querySelector('[data-file-id="'+t.id+'"]');return!!e},addFileItem:function(e){if(this.isFileItemSelected(e)){return false}const i=this.createFileItemNode(e);if(!this.multiple){t.cleanNode(this.fileItemsNode)}t.Dom.append(i,this.fileItemsNode)},addItems:function(t){if(this.type===a.Type.File){for(const e of t){this.addFileItem(e)}}else{this.getDiskUploader().setValues(this.convertToDiskItems(t))}},convertToDiskItems:function(t){const e=[];for(const i of t){e.push({ID:i.id,NAME:i.name,SIZE:i.size,VIEW_URL:""})}return e},removeFileItem:function(t){const e=this.fileItemsNode.querySelector('[data-file-id="'+t.id+'"]');if(e){this.fileItemsNode.removeChild(e)}},onFileFieldAddClick:function(e,i){const o=this;const n=[];const a=this.fileFields;for(const e of a){n.push({text:t.util.htmlspecialchars(e.Name),field:e,onclick:function(t,e){this.popupWindow.close();o.onFieldSelect(e.field)}})}if(!this.menuId){this.menuId=t.Bizproc.Automation.Helper.generateUniqueId()}t.PopupMenu.show(this.menuId,e,n,{autoHide:true,offsetLeft:t.pos(e).width/2,angle:{position:"top",offset:0}});this.menu=t.PopupMenu.currentItem;i.preventDefault()},onFieldSelect:function(t){this.addFileItem({id:t.Id,expression:t.Expression,name:t.Name,type:a.Type.File})},destroy:function(){if(this.menu){this.menu.popupWindow.close()}},createFileItemNode:function(e){let i=e.name||"";if(this.fileLabels[i]){i=this.fileLabels[i]}return t.create("span",{attrs:{className:"bizproc-automation-popup-autocomplete-item","data-file-id":e.id,"data-file-expression":e.expression},children:[t.create("span",{attrs:{className:"bizproc-automation-popup-autocomplete-name"},text:i}),t.create("span",{attrs:{className:"bizproc-automation-popup-autocomplete-delete"},events:{click:this.removeFileItem.bind(this,e)}})]})},onBeforeSave:function(){let e=[];if(this.type===a.Type.Disk){e=this.getDiskUploader().getValues()}else if(this.type===a.Type.File){this.fileItemsNode.childNodes.forEach((t=>{const i=t.getAttribute("data-file-expression");if(i!==""){e.push(i)}}))}for(const i of e){this.container.appendChild(t.create("input",{props:{type:"hidden",name:this.valueInputName+(this.multiple?"[]":""),value:i}}))}}};const s={documentName:null,documentType:null,documentFields:null,documentSigned:null,showRobotSettings:function(o,n,a,s){const r=new t.Bizproc.Automation.Document({rawDocumentType:n,statusId:a,documentFields:this.documentFields,title:this.documentName});const c=new g({document:r,isFrameMode:false});const l=new t.Bizproc.Automation.AutomationGlobals({variables:[],constants:[]});c.init(o,t.Bizproc.Automation.ViewMode.none());t.Bizproc.Automation.setGlobalContext(new t.Bizproc.Automation.Context({document:r,signedDocument:this.documentSigned,ajaxUrl:i(),automationGlobals:l}));const d={document:r,documentSigned:this.documentSigned,ajaxUrl:i()};const u=new p({config:d});u.init({DOCUMENT_FIELDS:this.documentFields},e.ViewMode.None);u.subscribe("Template:help:show",(t=>{t.preventDefault();if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=14889274")}}));u.openRobotSettingsDialog(c,null,s)}};const r={showVariables:function(){const e=this.component.data.DOCUMENT_TYPE_SIGNED;const i=t.Bizproc.Globals.Manager.Instance.mode.variable;t.Bizproc.Globals.Manager.Instance.showGlobals(i,e).then(this.onAfterSliderClose.bind(this,i))},showConstants:function(){const e=this.component.data.DOCUMENT_TYPE_SIGNED;const i=t.Bizproc.Globals.Manager.Instance.mode.constant;t.Bizproc.Globals.Manager.Instance.showGlobals(i,e).then(this.onAfterSliderClose.bind(this,i))},onAfterSliderClose:function(e,i){if(!this.isCorrectMode(e)||!i){return}const o=i.getData().get("upsert");const n=i.getData().get("delete");const a=t.Bizproc.Automation&&t.Bizproc.Automation.tryGetGlobalContext();if(!a){return}const s=a.automationGlobals;if(!s){return}if(t.Type.isPlainObject(o)){s.updateGlobals(e,o)}if(t.Type.isArrayFilled(n)){s.deleteGlobals(e,n)}},isCorrectMode:function(e){return t.Type.isStringFilled(e)&&Object.values(t.Bizproc.Globals.Manager.Instance.mode).includes(e)}};const c={showStartPage:function(){t.Bizproc.Debugger.Manager.Instance.openDebuggerStartPage(this.component.documentSigned).then()},showDebugSessions:function(){const t={documentSigned:this.component.documentSigned};this.openSlider("bizproc.debugger.session.list",t,{width:1150})},openSlider(e,i,o){const n={width:850,cacheable:false};const a=t.Type.isPlainObject(o)?Object.assign(n,o):n;const s=t.Uri.addParam("/bitrix/components/bitrix/"+e,t.Type.isPlainObject(i)?i:{});t.SidePanel.Instance.open(s,a)}};const l=t.Bizproc.Automation.Designer;const d=t.Bizproc.Automation.Tracker;const u=t.Bizproc.Automation.Helper;const h=t.Bizproc.Automation.TriggerManager;const g=t.Bizproc.Automation.Robot;const p=t.Bizproc.Automation.Template;const m=t.Bizproc.Automation.SelectorItemsManager;t.Bizproc.Automation.Component=e;t.Bizproc.Automation.API=s;t.Bizproc.Automation.showGlobals=r;t.Bizproc.Automation.Debugger=c;t.namespace("BX.Bizproc.Automation.Selector");t.Bizproc.Automation.Selector.InlineSelectorCondition=t.Bizproc.Automation.InlineSelectorCondition})(window.BX||window.top.BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/bizproc.automation/templates/.default/disk_uploader.min.js?172873318418192";s:6:"source";s:80:"/bitrix/components/bitrix/bizproc.automation/templates/.default/disk_uploader.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
if(!BX.getClass("BX.Bizproc.Automation.DiskUploader"))(function(e){"use strict";e.namespace("BX.Bizproc.Automation");var t=function(){this._id="";this._settings={};this._messages={};this._agent=null;this._form=this._wrapper=this._switchContainer=this._container=this._fileInput=this._fileSelector=this._label=this._dropZoneWrapper=this._dropZone=this._itemContainer=null;this._mode=t.InterfaceMode.edit;this._items=[];this._fileUploadStartHandler=e.delegate(this._onFileUploadStart,this);this._fileUploadProgressHandler=e.delegate(this._onFileUploadProgress,this);this._fileUploadCompleteHandler=e.delegate(this._onFileUploadComplete,this);this._fileUploadErrorHandler=e.delegate(this._onFileUploadError,this);this._fileSelectButtonClickHandler=e.delegate(this._onFileSelectButtonClick,this);this._fileDialogInitHandler=e.delegate(this._onFileDialogInit,this);this._dropZoneMouseOverHandler=e.delegate(this._onDropZoneMouseOver,this);this._dropZoneMouseOutHandler=e.delegate(this._onDropZoneMouseOut,this);this._agentErrorHandler=e.delegate(this._onAgentError,this);this._agentFileInputReinitHandler=e.delegate(this._onAgentFileInputReinit,this);this._agentFileInitHandler=e.delegate(this._onAgentFileInit,this);this._uploadFileUrl="/bitrix/tools/disk/uf.php?action=uploadfile";this._selectFileUrl="/bitrix/tools/disk/uf.php?action=selectFile";this._isShown=false;this._hasLayout=false};t.InterfaceMode={edit:1,view:2};t.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._messages=this.getSetting("msg",{})},getId:function(){return this._id},getSetting:function(e,t){return typeof this._settings[e]!="undefined"?this._settings[e]:t},getMessages:function(){return this.getSetting("msg",{})},getMessage:function(e,t){if(typeof t==="undefined"){t=""}return this._messages.hasOwnProperty(e)?this._messages[e]:t},getFileInputName:function(){return this._fileInput},getPlaceHolder:function(){return this._itemContainer},getMode:function(){return this._mode},setMode:function(e){if(this._mode===e){return}if(this._hasLayout){throw"Could not set mode while control has layout."}this._mode=e},getAgent:function(){return this._agent},getItems:function(){return this._items},getItem:function(e){for(var t=0;t<this._items.length;t++){var i=this._items[t];if(i.getId()===e){return i}}return null},hasItems:function(){return this._items.length>0},getFileIds:function(){var e=[];for(var t=0;t<this._items.length;t++){var i=this._items[t].getFileId();if(i>0){e.push(i)}}return e},getValues:function(){return this.getFileIds()},setValues:function(t){for(var i=0;i<t.length;i++){var s=t[i];var a=typeof s["ID"]!=="undefined"?parseInt(s["ID"]):0;var r=this.addItem(a.toString(),{fileId:a,name:s["NAME"],size:s["SIZE"],viewUrl:e.type.isNotEmptyString(s["VIEW_URL"])?s["VIEW_URL"]:"",progress:100});if(this._hasLayout){r.setContainer(this._itemContainer);r.layout()}}if(this.hasItems()){this.show(true)}},clearValues:function(){this.removeAllItems()},removeItem:function(e){for(var t=0;t<this._items.length;t++){if(this._items[t]===e){e.cleanLayout();this._items.splice(t,1);return}}},removeAllItems:function(){for(var e=0;e<this._items.length;e++){this._items[e].cleanLayout()}this._items=[]},layout:function(i){var s=this._mode;if(s===t.InterfaceMode.edit){this.prepareEditLayout(i);this._agent=e.Uploader.getInstance({id:this._id,allowUpload:"A",uploadMethod:"immediate",uploadFileUrl:this._uploadFileUrl,deleteFileOnServer:true,filesInputMultiple:true,filesInputName:this.getFileInputName(),input:this._fileInput,dropZone:this._dropZone,showImage:false,fields:{preview:{params:{width:212,height:119}}}});e.addCustomEvent(this._agent,"onError",this._agentErrorHandler);e.addCustomEvent(this._agent,"onFileinputIsReinited",this._agentFileInputReinitHandler);e.addCustomEvent(this._agent,"onFileIsInited",this._agentFileInitHandler);this._container.style.display=this._isShown?"block":"none";this._switchContainer.style.display=this._isShown?"none":"block";this._label.style.display=this.hasItems()?"":"none"}else if(s===t.InterfaceMode.view){this._prepareViewLayout(i)}for(var a=0;a<this._items.length;a++){var r=this._items[a];r.setContainer(this._itemContainer);r.layout()}this._hasLayout=true},cleanLayout:function(){if(!this._hasLayout){return}if(this._agent){e.removeCustomEvent(this._agent,"onError",this._agentErrorHandler);e.removeCustomEvent(this._agent,"onFileinputIsReinited",this._agentFileInputReinitHandler);e.removeCustomEvent(this._agent,"onFileIsInited",this._agentFileInitHandler)}if(this._dropZoneWrapper){e.unbind(this._dropZoneWrapper,"mouseover",this._dropZoneMouseOverHandler);e.unbind(this._dropZoneWrapper,"mouseout",this._dropZoneMouseOutHandler)}if(this._fileSelector){e.unbind(this._fileSelector,"click",this._fileSelectButtonClickHandler)}if(this._wrapper){e.cleanNode(this._wrapper,true)}for(var t=0;t<this._items.length;t++){var i=this._items[t];i.cleanLayout();i.setContainer(null)}this._form=this._wrapper=this._switchContainer=this._container=this._fileInput=this._label=this._dropZone=this._itemContainer=null;this._hasLayout=false},show:function(e){e=!!e;if(this._isShown===e){return}this._isShown=e;if(this._hasLayout){this._container.style.display=e?"block":"none";this._switchContainer.style.display=e?"none":"block"}},showLabel:function(e){if(this._hasLayout){this._label.style.display=!!e?"":"none"}},prepareEditLayout:function(t){if(!e.type.isElementNode(t)){return}this._form=e.create("FORM",{});t.appendChild(this._form);this._form.appendChild(e.create("INPUT",{props:{type:"hidden",name:"sessid",value:e.bitrix_sessid()}}));this._switchContainer=e.create("DIV",{attrs:{className:"bx-crm-add-file-link"},children:[e.create("SPAN",{attrs:{className:"bx-crm-add-file-link-text"},text:this.getMessage("diskAttachFiles"),events:{click:e.delegate(this._onSwitchButtonClick,this)}})]});this._form.appendChild(this._switchContainer);this._container=e.create("DIV",{attrs:{className:"bx-crm-dialog-activity-diskuf-container"}});this._form.appendChild(this._container);this._container.style.height="auto";this._innerContainer=e.create("DIV",{attrs:{className:"bx-crm-dialog-activity-diskuf-container-inner"}});this._container.appendChild(this._innerContainer);this._wrapper=e.create("DIV",{attrs:{className:"diskuf-selectdialog"}});this._innerContainer.appendChild(this._wrapper);this._wrapper.style.display="block";this._wrapper.style.opacity="1";var i=e.create("DIV",{attrs:{className:"diskuf-files-block"}});i.style.display="block";this._wrapper.appendChild(i);this._label=e.create("DIV",{attrs:{className:"diskuf-label"},children:[e.create("SPAN",{text:this.getMessage("diskAttachedFiles")+":"}),e.create("SPAN",{attrs:{className:"diskuf-label-icon"}})]});i.appendChild(this._label);var s=e.create("DIV",{attrs:{className:"diskuf-placeholder"}});i.appendChild(s);this._itemContainer=e.create("TABLE",{attrs:{className:"files-list",cellspacing:"0",cellpadding:"0",border:"0"}});s.appendChild(this._itemContainer);var a=e.create("DIV",{attrs:{className:"diskuf-extended"}});a.style.display="block";this._wrapper.appendChild(a);var r=e.create("TABLE",{attrs:{className:"diskuf-selector-table wd-fa-add-file-light-table",cellspacing:"0",cellpadding:"0",border:"0"}});a.appendChild(r);var n=r.insertRow(-1);var l=n.insertCell(-1);l.className="wd-fa-add-file-light-cell";this._fileSelector=e.create("DIV",{attrs:{className:"wd-fa-add-file-light-title-text diskuf-selector-link"},text:this.getMessage("diskSelectFile")});e.bind(this._fileSelector,"click",this._fileSelectButtonClickHandler);l.appendChild(e.create("SPAN",{attrs:{className:"wd-fa-add-file-light"},children:[e.create("SPAN",{attrs:{className:"wd-fa-add-file-light-text"},children:[e.create("SPAN",{attrs:{className:"wd-fa-add-file-light-title"},children:[this._fileSelector]}),e.create("SPAN",{attrs:{className:"wd-fa-add-file-light-descript"},text:this.getMessage("diskSelectFileLegend")})]})]}));l=n.insertCell(-1);l.className="wd-fa-add-file-form-light-separate-cell";l.appendChild(e.create("DIV",{attrs:{className:"wd-fa-add-file-form-light-spacer"}}));l=this._dropZoneWrapper=n.insertCell(-1);l.className="diskuf-selector wd-fa-add-file-light-cell wd-fa-add-file-from-main";this._fileInput=e.create("INPUT",{attrs:{className:"diskuf-fileUploader wd-test-file-light-inp "},props:{type:"file",size:1,multiple:"multiple",name:this.getFileInputName()}});if(e.browser.IsIE()){this._dropZone=e.create("DIV",{attrs:{className:"wduf-selector"},children:[e.create("SPAN",{attrs:{className:"wduf-uploader"},children:[e.create("SPAN",{attrs:{className:"wduf-uploader-left"}}),e.create("SPAN",{attrs:{className:"wduf-but-text"},text:this.getMessage("loadFiles")}),e.create("SPAN",{attrs:{className:"wduf-uploader-right"}}),this._fileInput]})]})}else{this._dropZone=e.create("DIV",{attrs:{className:"diskuf-uploader"},children:[e.create("SPAN",{attrs:{className:"wd-fa-add-file-light"},children:[e.create("SPAN",{attrs:{className:"wd-fa-add-file-light-text"},children:[e.create("SPAN",{attrs:{className:"wd-fa-add-file-light-title"},children:[e.create("SPAN",{attrs:{className:"wd-fa-add-file-light-title-text"},text:this.getMessage("diskUploadFile")})]}),e.create("SPAN",{attrs:{className:"wd-fa-add-file-light-descript"},text:this.getMessage("diskUploadFileLegend")})]})]}),this._fileInput]})}l.appendChild(this._dropZone);e.bind(l,"mouseover",this._dropZoneMouseOverHandler);e.bind(l,"mouseout",this._dropZoneMouseOutHandler)},_prepareViewLayout:function(t){if(!e.type.isElementNode(t)){return}this._form=e.create("FORM",{});t.appendChild(this._form);this._form.appendChild(e.create("INPUT",{props:{type:"hidden",name:"sessid",value:e.bitrix_sessid()}}));this._container=e.create("DIV",{attrs:{className:"bx-crm-dialog-activity-diskuf-container"}});this._form.appendChild(this._container);this._container.style.height="auto";this._innerContainer=e.create("DIV",{attrs:{className:"bx-crm-dialog-activity-diskuf-container-inner"}});this._container.appendChild(this._innerContainer);this._wrapper=e.create("DIV",{attrs:{className:"diskuf-selectdialog"}});this._innerContainer.appendChild(this._wrapper);this._wrapper.style.display="block";this._wrapper.style.opacity="1";var i=e.create("DIV",{attrs:{className:"diskuf-files-block"}});i.style.display="block";this._wrapper.appendChild(i);this._label=e.create("DIV",{attrs:{className:"diskuf-label"},children:[e.create("SPAN",{text:this.getMessage("diskAttachedFiles")+":"}),e.create("SPAN",{attrs:{className:"diskuf-label-icon"}})]});i.appendChild(this._label);var s=e.create("DIV",{attrs:{className:"diskuf-placeholder"}});i.appendChild(s);this._itemContainer=e.create("TABLE",{attrs:{className:"files-list",cellspacing:"0",cellpadding:"0",border:"0"}});s.appendChild(this._itemContainer)},processItemDeletion:function(e){this.removeItem(e);if(!this.hasItems()){this.showLabel(false)}},_onSwitchButtonClick:function(t){this.show(true);return e.PreventDefault(t)},_onAgentFileInputReinit:function(e){if(e||this._agent.fileInput){this._fileInput=e?e:this._agent.fileInput}},_onAgentError:function(e,t,i){},_onAgentFileInit:function(t,i,s){e.addCustomEvent(i,"onUploadStart",this._fileUploadStartHandler);e.addCustomEvent(i,"onUploadProgress",this._fileUploadProgressHandler);e.addCustomEvent(i,"onUploadDone",this._fileUploadCompleteHandler);e.addCustomEvent(i,"onUploadError",this._fileUploadErrorHandler)},addItem:function(t,s){var a=i.create(t,{uploader:this,container:this._itemContainer,name:e.type.isNotEmptyString(s.name)?s.name:"",size:e.type.isNotEmptyString(s.size)?s.size:"",fileId:e.type.isNumber(s.fileId)?s.fileId:0,viewUrl:e.type.isNotEmptyString(s.viewUrl)?s.viewUrl:"",progress:e.type.isNumber(s.progress)?s.progress:0});this._items.push(a);return a},_onFileUploadStart:function(e,t,i,s){var a=this.addItem(e.id,{name:e.name,size:e.size,fileId:0,progress:parseInt(t)});a.layout()},_onFileUploadProgress:function(e,t,i,s){var a=this.getItem(e.id);if(a){if(t>=100)t=99;a.setProgress(t)}},_onFileUploadComplete:function(t,i,s,a){var r=this.getItem(t.id);if(!r){return}r.setProgress(100);e.removeCustomEvent(t,"onUploadStart",this._fileUploadStartHandler);e.removeCustomEvent(t,"onUploadProgress",this._fileUploadProgressHandler);e.removeCustomEvent(t,"onUploadDone",this._fileUploadCompleteHandler);e.removeCustomEvent(t,"onUploadError",this._fileUploadErrorHandler);var n=0;if(typeof i.file!=="undefined"){if(typeof i.file["fileId"]!=="undefined"){n=parseInt(i.file["fileId"])}else if(typeof i.file["originalId"]!=="undefined"){n=parseInt(i.file["originalId"])}}if(n>0){r.setFileId(n)}this.showLabel(true)},_onFileUploadError:function(t,i,s,a){var r=this.getItem(t.id);if(r){r.remove()}e.removeCustomEvent(t,"onUploadStart",this._fileUploadStartHandler);e.removeCustomEvent(t,"onUploadProgress",this._fileUploadProgressHandler);e.removeCustomEvent(t,"onUploadDone",this._fileUploadCompleteHandler);e.removeCustomEvent(t,"onUploadError",this._fileUploadErrorHandler)},_onFileSelectButtonClick:function(t){e.addCustomEvent(e.DiskFileDialog,"inited",this._fileDialogInitHandler);e.ajax({url:this._selectFileUrl,method:"GET",timeout:30});return e.PreventDefault(t)},_onFileDialogInit:function(t){e.removeCustomEvent(e.DiskFileDialog,"inited",this._fileDialogInitHandler);this.flagFileDialogInited=true;e.DiskFileDialog.obCallback[t]={saveButton:e.delegate(this._onFileSelect,this)};e.DiskFileDialog.openDialog(t)},_onFileSelect:function(t,i,s){for(var a in s){if(!s.hasOwnProperty(a)){return}var r=s[a];var n=e.type.isNotEmptyString(r["type"])?r["type"]:"";if(n!=="file"){continue}var l=e.type.isNotEmptyString(r["id"])?r["id"]:"";if(l===""){continue}var o=/^n(\d+)$/;var d=o.exec(l);if(d&&d.length>1){var h=parseInt(d[1]);if(h>0){var p=e.type.isNotEmptyString(r["name"])?r["name"]:l;var c=e.type.isNotEmptyString(r["size"])?r["size"]:0;this.addItem(l,{fileId:h,name:p,size:c,progress:100}).layout()}}}},_onDropZoneMouseOver:function(t){e.addClass(this._dropZoneWrapper,"wd-fa-add-file-light-hover")},_onDropZoneMouseOut:function(t){e.removeClass(this._dropZoneWrapper,"wd-fa-add-file-light-hover")}};t.items={};t.create=function(i,s){if(!e.type.isNotEmptyString(i)){i="BX_BP_ATM_FILEUPLOADER_"+Math.random()}var a=new t;a.initialize(i,s);this.items[i]=a;return a};var i=function(){this._id="";this._settings={};this._fileId=0;this._name="";this._size="";this._viewUrl="";this._progress=0;this._uploader=this._container=this._wrapper=null;this._progressContainer=this._progressWrap=this._progressTerminateBtn=this._progressBar=this._progressText=this._deleteButton=null;this._deleteButtonClickHandler=e.delegate(this._onDeleteButtonClick,this);this._hasLayout=false};i.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._uploader=this.getSetting("uploader");this._container=this.getSetting("container");this._fileId=parseInt(this.getSetting("fileId",0));this._name=this.getSetting("name","");this._size=this.getSetting("size","");this._viewUrl=this.getSetting("viewUrl","");this.setProgress(this.getSetting("progress",0))},getId:function(){return this._id},getSetting:function(e,t){return typeof this._settings[e]!="undefined"?this._settings[e]:t},getFileId:function(){return this._fileId},setFileId:function(e){this._fileId=e},getName:function(){return this._name},getSize:function(){return this._size},getProgress:function(){return this._progress},setProgress:function(e){e=parseInt(e);if(isNaN(e)||e<0){e=0}if(e>100){e=100}if(this._progress===e){return}this._progress=e;if(this._hasLayout){this._progressBar.style.width=this._progress+"%";this._progressText.innerHTML=this._progress+"%";this._progressWrap.style.display=e<100?"":"none"}},getContainer:function(){return this._container},setContainer:function(e){this._container=e},layout:function(){if(this._hasLayout){return}if(!this._container){throw"Error: Could not find container."}var i=this._wrapper=this._container.insertRow(-1);var s=i.insertCell(-1);s.className="files-name";if(this._viewUrl!==""){s.appendChild(e.create("A",{attrs:{className:"files-text",href:this._viewUrl},text:this._name}))}else{s.appendChild(e.create("SPAN",{attrs:{className:"files-text"},text:this._name}))}s=i.insertCell(-1);s.className="files-size";s.innerHTML=this._size;s=this._progressContainer=i.insertCell(-1);s.className="files-storage";this._progressWrap=e.create("SPAN",{attrs:{className:"feed-add-post-loading-wrap"}});s.appendChild(this._progressWrap);this._progressTerminateBtn=e.create("SPAN",{attrs:{className:"feed-add-post-loading-cancel del-but"}});e.bind(this._progressTerminateBtn,"click",this._deleteButtonClickHandler);this._progressWrap.appendChild(e.create("SPAN",{attrs:{className:"feed-add-post-loading"},children:[this._progressTerminateBtn]}));this._progressBar=e.create("SPAN",{attrs:{className:"feed-add-post-load-indicator"},style:{width:this._progress+"%"}});this._progressWrap.appendChild(this._progressBar);this._progressText=e.create("SPAN",{attrs:{className:"feed-add-post-load-number"},text:this._progress+"%"});this._progressBar.appendChild(this._progressText);if(this._progress===100){this._progressWrap.style.display="none"}s=i.insertCell(-1);s.className="files-del-btn";if(this._uploader.getMode()===t.InterfaceMode.edit){this._deleteButton=e.create("SPAN",{attrs:{className:"del-but"}});e.bind(this._deleteButton,"click",this._deleteButtonClickHandler);s.appendChild(this._deleteButton)}this._hasLayout=true},cleanLayout:function(){if(!this._hasLayout){return}e.unbind(this._progressTerminateBtn,"click",this._deleteButtonClickHandler);if(this._deleteButton){e.unbind(this._deleteButton,"click",this._deleteButtonClickHandler)}this._container.deleteRow(this._wrapper.rowIndex);this._wrapper=this._progressContainer=this._progressWrap=this._progressTerminateBtn=this._progressBar=this._progressText=this._deleteButton=null;this._hasLayout=false},remove:function(){if(this._uploader.getMode()!==t.InterfaceMode.edit){return}var e=this._uploader.getAgent();if(e){var i=e.queue.items.getItem(this._id);if(i){i.deleteFile()}}this._uploader.processItemDeletion(this)},_onDeleteButtonClick:function(e){this.remove()}};i.create=function(e,t){var s=new i;s.initialize(e,t);return s};e.Bizproc.Automation.DiskUploader=t})(window.BX||window.top.BX);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:95:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?17287331811655";s:6:"source";s:76:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.js";s:3:"min";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Intranet.Binding.Menu");BX.Intranet.Binding.Menu=function(i,t,n){n=n||{};this.id=i||"intranet_binding_menu";this.idTop=this.id+"_top";this.items=t;this.menu=null;this.menuShowed=false;this.sections=n.sections||{};this.frequencyItem=n.frequencyItem||{};this.ajaxPath=n.ajaxPath||"";this.bindingId=n.bindingId||""};BX.Intranet.Binding.Menu.prototype={binding:function(){if(BX(this.id)){BX.bind(BX(this.id),"click",BX.delegate(this.clickMenuButton,this));if(BX(this.idTop)&&BX(this.idTop).getAttribute("href")==="#"){BX.bind(BX(this.idTop),"click",BX.delegate(this.clickMenuButton,this))}}},onItemClick:function(id,onclick){this.menu.close();if(BX.type.isString(onclick)){eval(onclick)}BX.ajax({url:this.ajaxPath,method:"POST",data:{action:"openingLog",payload:{bindingId:this.bindingId,menuItemId:id},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(i){}.bind(this)})},buildMenu:function(i){var t=[];for(var n=0,e=i.length;n<e;n++){i[n]["text"]=i[n]["text"];if(typeof i[n]["items"]!=="undefined"){i[n]["items"]=this.buildMenu(i[n]["items"])}else if(!i[n]["system"]){i[n]["onclick"]=this.onItemClick.bind(this,i[n]["id"],i[n]["onclick"])}t.push(i[n])}return t},clickMenuButton:function(i){if(!this.menu){this.menu=new BX.PopupMenuWindow(this.id,i.target===BX(this.idTop)?BX(this.idTop):BX(this.id),this.buildMenu(this.items),{autoHide:true,events:{onClose:function(){this.menuShowed=false;if(i&&i.target){i.target.blur()}}.bind(this)}})}if(this.menu){if(this.menuShowed){this.menu.close()}else{this.menuShowed=true;this.menu.show()}}BX.PreventDefault()}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?172873318163299";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js";s:3:"map";s:81:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.map.js";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeparator="main-buttons-submenu-delimiter";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="--over";this.classMenuShown="--menu-shown";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="--locked";this.classExtraItemLink="";this.classExtraItemText="";this.classExtraItemIcon="";this.classExtraItemCounter="";this.submenuIdPrefix="main_buttons_popup_";this.childMenuIdPrefix="main_buttons_popup_child_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classDefaultSubmenuDelimimeter="popup-window-delimiter-section";this.classInner="main-buttons-inner-container";this.listContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.ajaxSettings=null;this.enableItemMouseEnter=true;this.menuShowTimeout=null;this.isMoreMenuShown=false;this.onDragStarted=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.isEditEnabledState=false;this.theme=BX.Type.isStringFilled(e.theme)?e.theme:"default";this.maxItemLength=BX.Type.isNumber(e.maxItemLength)&&e.maxItemLength>6?e.maxItemLength:20;this.tmp={};this.itemData=new WeakMap;this.handleMoreMenuItemMouseEnter=this.handleMoreMenuItemMouseEnter.bind(this);this.init(t,e);return{addMenuItem:this.addMenuItem.bind(this),deleteMenuItem:this.deleteMenuItem.bind(this),updateMenuItemText:this.updateMenuItemText.bind(this),getItemById:this.getItemById.bind(this),getAllItems:this.getAllItems.bind(this),getHiddenItems:this.getHiddenItems.bind(this),getVisibleItems:this.getVisibleItems.bind(this),getDisabledItems:this.getDisabledItems.bind(this),getMoreButton:this.getMoreButton.bind(this),adjustMoreButtonPosition:this.adjustMoreButtonPosition.bind(this),getItemData:this.getItemData.bind(this),getSubmenu:this.getMoreMenu.bind(this),showSubmenu:this.showMoreMenu.bind(this),closeSubmenu:this.closeMoreMenu.bind(this),refreshSubmenu:this.refreshMoreMenu.bind(this),getMoreMenu:this.getMoreMenu.bind(this),showMoreMenu:this.showMoreMenu.bind(this),closeMoreMenu:this.closeMoreMenu.bind(this),refreshMoreMenu:this.refreshMoreMenu.bind(this),getCurrentSettings:this.getCurrentSettings.bind(this),saveSettings:this.saveSettings.bind(this),updateCounter:this.updateCounter.bind(this),getActive:this.getActive.bind(this),isDisabled:this.isDisabled.bind(this),isVisibleItem:this.isVisibleItem.bind(this),isEditEnabled:this.isEditEnabled.bind(this),isActiveInMoreMenu:this.isActiveInMoreMenu.bind(this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,menuShown:this.classMenuShown,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.Type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.Type.isStringFilled(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.Type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.Type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.Type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.Type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.initSaving(e.ajaxSettings);this.moreButton=this.getMoreButton();this.listChildItems={};this.initItems();this.adjustMoreButtonPosition();this.bindEventsOnMoreButton();this.bindOnResizeFrame();BX.Event.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}const s=this.getHomeItem();if(s){const{url:t}=s;this.lastHomeLink=t}const i=Array.from(this.container.querySelectorAll(".main-buttons-item-child-button"));i.forEach((function(t){const e=t.closest(".main-buttons-item-child");if(e.dataset.isOpened){this.realChildButton=e;const t=e.closest(".main-buttons-item-child-button-cloned");if(t){this.clonedChildButton=t}}BX.Event.bind(t,"click",this.onShowChildButtonClick.bind(this))}),this)},calculateChildListWidth:function(){if(this.realChildButton){const t=this.realChildButton.querySelectorAll(".main-buttons-item-child-list-inner .main-buttons-item");const e=10;return Array.from(t).reduce((function(t,e){const s=BX.Text.toNumber(BX.Dom.style(e,"width"));const i=BX.Text.toNumber(BX.Dom.style(e,"margin-left"));const n=BX.Text.toNumber(BX.Dom.style(e,"margin-right"));return t+s+i+n}),e)}return 0},onShowChildButtonClick:function(t){t.preventDefault();if(!this.realChildButton){this.realChildButton=t.currentTarget.closest(".main-buttons-item-child")}const e=this.realChildButton.querySelector(".main-buttons-item-child-list");this.enableItemMouseEnter=false;setTimeout((()=>{this.enableItemMouseEnter=true}),200);const s=BX.Dom.attr(this.realChildButton,"data-child-items");const i=BX.Dom.attr(this.realChildButton,"data-is-opened");let n={};if(i){BX.Dom.attr(this.realChildButton,"data-is-opened",null);s.forEach((function(t){const e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.style(e,"display",null);if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="N"}}),this);if(this.clonedChildButton){BX.Dom.remove(this.clonedChildButton)}BX.Dom.style(e,{overflow:null,"max-width":null});n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}else{BX.Dom.attr(this.realChildButton,"data-is-opened",true);BX.Dom.style(e,"max-width",this.calculateChildListWidth()+"px");this.cloneChildButton(this.realChildButton);s.forEach((t=>{const e=this.getContainer().querySelector('[data-id="'+t+'"]');BX.Dom.insertBefore(e,this.realChildButton);BX.Dom.style(e,"display","inline-block");if(t.hasOwnProperty("PARENT_ITEM_ID")){n[t["PARENT_ITEM_ID"]]="Y"}}));setTimeout((()=>{BX.Dom.style(e,"overflow","unset")}),200);n=JSON.stringify(n);this.saveOptions("expanded_lists",n)}setTimeout((()=>{this._onResizeHandler()}),200)},cloneChildButton:function(t){this.clonedChildButton=BX.Runtime.clone(t);const e=this.clonedChildButton.querySelector(".main-buttons-item-child-list");if(e){BX.Dom.remove(e)}BX.Dom.addClass(this.clonedChildButton,"main-buttons-item-child-button-cloned");BX.Dom.style(this.clonedChildButton,"transition","none");BX.Dom.insertBefore(this.clonedChildButton,t);BX.Event.bind(this.clonedChildButton,"click",this.onShowChildButtonClick.bind(this));setTimeout((()=>{BX.Dom.style(this.clonedChildButton,"transition",null)}),0)},_onDocumentClick:function(t){if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}let e=this.getItem(t);if(BX.Type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isEditButton(t.target)){this.handleEditButtonClick(t);return false}if(this.isSetHide(e)){const t=this.getVisibleItems();const e=BX.Type.isArray(t)?t.length:null;const s=this.editItemData.ID.replace(this.listContainer.id+"_","");let i=this.getItemById(s);const n=this.getItemAlias(i);i=this.isVisibleItem(i)?i:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&e>2){this.disableItem(n)}if(e===1){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[i,this])}this.refreshMoreMenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit()}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){const t=this.editItemData.ID.replace(this.listContainer.id+"_","");const e=this.getItemById(t);const s=this.getItemAlias(e);if(this.isDisabled(s)){this.enableItem(s)}this.listContainer.insertBefore(e,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshMoreMenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit()}this.editMenu.popupWindow.close();return false}if(!this.isDragButton(t.target)&&!this.isEditButton(t.target)){const s=this.getItemData(e);let i=s["ON_CLICK"];if(this.isSublink(t.target)){i=BX.Type.isPlainObject(s["SUB_LINK"])?s["SUB_LINK"]["ON_CLICK"]:""}if(BX.Type.isStringFilled(i)){t.preventDefault();this.execScript(i,t)}}}if(this.isEditEnabled()&&this.getMoreMenu()){this.getMoreMenu().getPopupWindow().setAutoHide(false)}},isActiveInMoreMenu:function(){const t=this.getHiddenItems();const e=this.getDisabledItems();const s=t.concat(e);return s.some((function(t){const e=this.getItemData(t);return e["IS_ACTIVE"]===true}),this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){const t=e[BX.message("SITE_ID")];for(const e in t){if(t.hasOwnProperty(e)){this.updateCounter(e,t[e])}}}},getActive:function(){let t=this.getAllItemsData();let e=null;let s=null;while(BX.Type.isArrayFilled(t)){const i=t.shift();if(i["IS_ACTIVE"]===true){if(s===null){s=i}e=i;t=BX.Type.isArrayFilled(i["ITEMS"])?[...i["ITEMS"]]:null}}if(e!==null&&s!==null){const t=BX(s.ID);if(BX.Type.isDomNode(t)){e.NODE=t}else{e.NODE=null}}return e},isSetHome:function(t){return BX.Dom.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.Dom.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.Dom.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){const t=this.getMoreMenu();if(t){const e=t.getPopupWindow();e.setAutoHide(false);BX.Dom.addClass(e.getPopupContainer(),this.classEditState)}BX.Dom.addClass(this.listContainer,this.classEditState);this.isEditEnabledState=true},disableEdit:function(){const t=this.getMoreMenu();if(t){const e=t.getPopupWindow();e.setAutoHide(true);BX.Dom.removeClass(e.getPopupContainer(),this.classEditState)}BX.Dom.removeClass(this.listContainer,this.classEditState);this.isEditEnabledState=false;this.destroyItemEditMenu()},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.Type.isPlainObject(t)&&"ID"in t){const s=[this.listContainer.id,"_edit_item"].join("");let i=BX.Main.MenuManager.getMenuById(s);if(i){BX.Main.MenuManager.destroy(s)}i=this.createItemEditMenu(t,s,e);i.popupWindow.show()}},destroyItemEditMenu:function(){const t=[this.listContainer.id,"_edit_item"].join("");const e=BX.Main.MenuManager.getMenuById(t);if(e){BX.Main.MenuManager.destroy(t)}},getContainer:function(){if(!BX.Type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode.parentNode}return this.container},getItemEditMenu:function(){return BX.Main.MenuManager.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,s){const i=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];const n=t["ID"].replace(this.listContainer.id+"_","");const o=this.getItemById(n);if(this.isDisabled(o)){i.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{i.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}if(t["IS_PINNED"]){const e=this.getParentItem(t["ID"]);i.push({text:this.message("MIB_UNPIN_ITEM").replace("#NAME#",e?e["TEXT"]:""),onclick:(e,s)=>{this.handleItemUnpin(t,o);s.getMenuWindow().close()}})}const a=BX.pos(s);const u={menuId:e,anchor:s,menuItems:i,settings:{autoHide:true,offsetTop:0,offsetLeft:a.width/2,zIndex:20,angle:{position:"top",offset:a.width/2}}};const r=BX.Main.MenuManager.create(u.menuId,u.anchor,u.menuItems,u.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in r&&BX.Type.isArray(r.menuItems)){r.menuItems.forEach((function(t){BX.Event.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))}),this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[r,t,this]);this.editMenu=r;return r},prepareMenuItemData:function(t){const e={CLASS:"",CLASS_SUBMENU_ITEM:"",COUNTER:0,COUNTER_ID:t.counterId,DATA_ID:t.dataId,HAS_CHILD:false,HAS_MENU:false,HTML:"",ID:t.id,IS_ACTIVE:false,IS_DISABLED:"false",IS_LOCKED:false,IS_PASSIVE:false,MAX_COUNTER_SIZE:99,NODE:BX.Tag.render`<div id="${t.id}" class="main-buttons-item"></div>`,ON_CLICK:t.onClick,SUB_LINK:false,SUPER_TITLE:false,TEXT:t.text,TITLE:"",URL:t.url};return e},addMenuItem:function(t){const e=this.getCurrentSettings();const s=Object.keys(e);const i=this.prepareMenuItemData(t);const n=this.createRootItem(i);const o=this.getItemById(s[s.length-1]);BX.Dom.insertAfter(n,o);this.initItems()},deleteMenuItem:function(t){this.itemData.delete(t);BX.Dom.remove(t)},updateMenuItemText:function(t,e){if(!t||!e){return}const s=this.getItemData(t);s.TEXT=e;const i=this.getItemById(s.ID);const n="main-buttons-item-text-box";const o=BX.Buttons.Utils.getByClass(i,n);o.innerText=e},getHomeItem:function(){const t=this.getVisibleItems();const e=BX.Type.isArray(t)&&t.length>0?t[0]:null;if(!e){return null}const s=this.getItemData(e);const i=this.normalizeUrl(s["URL"]);if(this.canBeHomed(i,s)){return{itemData:s,url:i,firstVisibleItem:e}}if(BX.Type.isArrayFilled(s["ITEMS"])){for(let t=0;t<s["ITEMS"].length;t++){const i=s["ITEMS"][t];if(i["IS_PINNED"]||i["IS_DISBANDED"]||i["IS_DELIMITER"]){continue}const n=this.normalizeUrl(i["URL"]);if(this.canBeHomed(n,i)){return{itemData:i,url:n,firstVisibleItem:e}}}}return null},normalizeUrl:function(t){if(!BX.Type.isStringFilled(t)){return""}if(t.charAt(0)==="?"){const e=document.createElement("a");e.href=t;t=e.pathname+e.search}return t},canBeHomed:function(t,e){if(!BX.Type.isStringFilled(t)||BX.Type.isStringFilled(e["ON_CLICK"])){return false}if(BX.Reflection.getClass("BX.SidePanel.Instance")){const e=BX.SidePanel.Instance.getUrlRule(t);if(e){return false}}const s=new BX.Event.BaseEvent({data:{itemLink:t,itemData:e}});BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onBeforeFirstItemChange",s);return!s.isDefaultPrevented()},isEditButton:function(t){return BX.Dom.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.Dom.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.Dom.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){const t=this.getAllItems().map((function(t){const e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)}));return Math.max.apply(Math,t)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){let e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.Type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classMenuShown=t.menuShown||this.classMenuShown;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeparator=t.separator||this.classSeparator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked;this.classExtraItemLink=t.extraItemLink||this.classExtraItemLink;this.classExtraItemText=t.extraItemText||this.classExtraItemText;this.classExtraItemIcon=t.extraItemIcon||this.classExtraItemIcon;this.classExtraItemCounter=t.extraItemCounter||this.classExtraItemCounter},setMessages:function(t){if(!BX.Type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.Type.isStringFilled(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){let e=null;if(BX.Type.isStringFilled(t)){const s=t.startsWith(this.listContainer.id)?t:this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+s.replaceAll(":","\\:"))}return e},getItemCounterObject:function(t){let e=null;if(BX.Type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}this.updateItemsByCounterId(this.getAllItemsData(),t,e);this.updateMoreButtonCounter()},updateItemsByCounterId:function(t,e,s,i=[]){for(let n=0;n<t.length;n++){const o=t[n];if(o["COUNTER_ID"]===e){o["COUNTER"]=Number(s);this.setCounterValueById(e,o["COUNTER"]);for(let t=i.length-1;t>=0;t--){const e=i[t];e["COUNTER"]=e["ITEMS"].reduce(((t,e)=>{const s=e["IS_PINNED"]===true;const i=BX.Type.isNumber(e["COUNTER"])&&!s?e["COUNTER"]:0;return t+i}),0);this.setCounterValueById(e["COUNTER_ID"],e["COUNTER"])}}if(o["ITEMS"]){this.updateItemsByCounterId(o["ITEMS"],e,s,[...i,o])}}},recalculateItemsCounters:function(t,e=[]){let s=0;for(let i=0;i<t.length;i++){const n=t[i];if(n["ITEMS"]){n["COUNTER"]=this.recalculateItemsCounters(n["ITEMS"],[...e,n])}const o=n["IS_PINNED"]===true;s+=BX.Type.isNumber(n["COUNTER"])&&!o?n["COUNTER"]:0}for(let t=e.length-1;t>=0;t--){const s=e[t];s["COUNTER"]=s["ITEMS"].reduce(((t,e)=>{const s=e["IS_PINNED"]===true;const i=BX.Type.isNumber(e["COUNTER"])&&!s?e["COUNTER"]:0;return t+i}),0);this.setCounterValueById(s["COUNTER_ID"],s["COUNTER"])}return s},setCounterValueById:function(t,e){if(!BX.Type.isStringFilled(t)){return}const s=e>99?"99+":e>0?e:"";const i=document.querySelectorAll(`[data-mib-counter-id="${t}"]`);Array.from(i).forEach((t=>{t.textContent=s}))},setMoreButtonCounter:function(t){const e=this.getItemCounterObject(this.moreButton);e.textContent=t>99?"99+":t>0?t:""},bindEventsOnMoreButton:function(){BX.Event.bind(this.moreButton,"click",this.handleMoreButtonClick.bind(this));BX.Event.bind(this.moreButton,"mouseenter",this.handleMoreButtonMouseEnter.bind(this));BX.Event.bind(this.moreButton,"mouseleave",this.handleMoreButtonMouseLeave.bind(this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getAllItemsData:function(){return this.getAllItems().map((t=>this.getItemData(t)))},getVisibleItems:function(){const t=this.getAllItems();let e=[];if(t&&t.length){e=t.filter((t=>this.isVisibleItem(t)&&!this.isDisabled(t)))}return e},getHiddenItems:function(){const t=this.getAllItems();let e=[];if(t&&t.length){e=t.filter((t=>!this.isVisibleItem(t)&&!this.isDisabled(t)))}return e},getDisabledItems:function(){return this.getAllItems().filter((t=>this.isDisabled(t)))},getMoreButton:function(){const t=this.getContainer().getElementsByClassName(this.classItemMore);return t[0]||null},getLastVisibleItem:function(){const t=this.getVisibleItems();let e=null;if(BX.Type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.Type.isDomNode(e)){e=null}return e},getLastDisabledItem:function(){const t=this.getDisabledItems();let e=null;if(BX.Type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.Type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){this.updateMoreButtonCounter();if(this.getMoreMenu()){this.getMoreMenu().getPopupWindow().adjustPosition()}},getMoreMenuId:function(t){let e="";if(BX.Type.isDomNode(this.listContainer)&&BX.Type.isStringFilled(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getChildMenuId:function(){let t="";if(BX.Type.isDomNode(this.listContainer)&&BX.Type.isStringFilled(this.listContainer.id)){t=this.childMenuIdPrefix+this.listContainer.id}return t},getMenuItemText:function(t,e=null){const s=BX.Type.isElementNode(t)?this.getItemData(t):t;return BX.Tag.render`
				<span class="main-buttons-menu-popup-item">${[BX.Tag.render`<span class="${this.classItemIcon}"></span>`,this.createItemText(s),this.createItemCounter(s),e&&this.isEditEnabled()?this.createItemPin(s,e):""]}</span>
			`},createRootItem:function(t){let e=this.classItem;e+=BX.Type.isStringFilled(t["CLASS"])?" "+t["CLASS"]:"";if(t["IS_PASSIVE"]){e+=" --passive"}else if(t["IS_ACTIVE"]){if(BX.Type.isStringFilled(this.classItemActive)){e+=" "+this.classItemActive}else{e+=" main-buttons-item-active"}}if(t["HAS_MENU"]){e+=" --has-menu"}if(t["IS_LOCKED"]){e+=" --locked"}const s=BX.Tag.render`
				<div
					id="${t["ID"]}"
					class="${e}"
					data-disabled="${t["IS_DISABLED"]}"
					data-class="${t["CLASS_SUBMENU_ITEM"]}"
					data-id="${t["DATA_ID"]}"
					data-top-menu-id="${this.getId()}"
					title=""
				>${[this.createItemLink(t,true),BX.Type.isPlainObject(t["SUB_LINK"])?this.createItemSubLink(t["SUB_LINK"]):""]}</div>
			`;this.setItemData(s,t);return s},createItemLink:function(t,e=false){t=BX.Type.isPlainObject(t)?t:{};let s;const i=["main-buttons-item-link",this.classExtraItemLink].join(" ").trim();if(BX.Type.isStringFilled(t["URL"])){s=BX.Tag.render`<a class="${i}" href="${BX.Text.encode(t["URL"])}"></a>`}else{s=BX.Tag.render`<span class="${i}"></span>`}BX.Dom.append(this.createItemIcon(t),s);BX.Dom.append(this.createItemText(t,e),s);BX.Dom.append(this.createItemCounter(t),s);return s},createItemSubLink:function(t){t=BX.Type.isPlainObject(t)?t:{};const e=BX.Type.isStringFilled(t["CLASS"])?" "+t["CLASS"]:"";const s=BX.Type.isStringFilled(t["URL"])?BX.Text.encode(t["URL"]):"";return BX.Tag.render`
				<a class="${this.classItemSublink}${e}" href="${s}"></a>
			`},createItemIcon:function(t){const e=[this.classItemIcon,this.classExtraItemIcon].join(" ").trim();return BX.Tag.render`<span class="${e}"></span>`},createItemText:function(t,e=false){t=BX.Type.isPlainObject(t)?t:{};const s=[this.classItemText,this.classExtraItemText].join(" ").trim();let i=BX.Type.isStringFilled(t["TEXT"])?t["TEXT"]:"";if(e&&i.length>this.maxItemLength){i=i.substring(0,this.maxItemLength-3)+"..."}let n="";if(BX.Type.isPlainObject(t["SUPER_TITLE"])){let{TEXT:e,CLASS:s,COLOR:i}=t["SUPER_TITLE"];s=BX.Type.isStringFilled(s)?` ${s}`:"";const o=BX.Type.isStringFilled(i)?` style="color:${i}"`:"";n=BX.Tag.render`
					<span class="main-buttons-item-super-title${s}"${o}>${e}</span>
				`}return BX.Tag.render`
				<span class="${s}">${[BX.Tag.render`<span 
						class="main-buttons-item-drag-button"
						onclick="${this.handleDragButtonClick.bind(this)}" 
						data-slider-ignore-autobinding="true"
					></span>`,n,BX.Tag.render`
						<span class="main-buttons-item-text-title">
							<span class="main-buttons-item-text-box">${BX.Text.encode(i)}<span class="main-buttons-item-menu-arrow"></span></span>
						</span>
					`,BX.Tag.render`<span 
						class="main-buttons-item-edit-button"
						onclick="${this.handleEditButtonClick.bind(this)}" 
						data-slider-ignore-autobinding="true"
					></span>`,BX.Tag.render`<span class="main-buttons-item-text-marker"></span>`]}</span>
			`},createItemCounter:function(t){t=BX.Type.isPlainObject(t)?t:{};const e=[this.classItemCounter,this.classExtraItemCounter].join(" ").trim();let s="";const i=BX.Type.isNumber(t["MAX_COUNTER_SIZE"])?t["MAX_COUNTER_SIZE"]:99;if(BX.Type.isNumber(t["COUNTER"])&&t["COUNTER"]>0){s=t["COUNTER"]>i?`${i}+`:t["COUNTER"]}const n=BX.Type.isStringFilled(t["COUNTER_ID"])?t["COUNTER_ID"]:"";return BX.Tag.render`<span data-mib-counter-id="${n}" class="${e}">${s}</span>`},createItemPin:function(t,e){return BX.Tag.render`
				<span class="main-buttons-item-pin" 
					data-slider-ignore-autobinding="true"
					onclick="${this.handleItemPin.bind(this,t,e)}"
					onmouseenter="${this.handleItemPinEnter.bind(this)}"
					onmouseleave="${this.handleItemPinLeave.bind(this)}"
				></span>
			`},getLockedClass:function(t){let e="";if(BX.Type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getMoreMenuItems:function(){const t=this.getAllItems();const e=this.getHiddenItems();const s=this.getDisabledItems();const i=[];if(t.length){t.forEach((t=>{if(e.indexOf(t)===-1&&s.indexOf(t)===-1){const e=this.getItemData(t);i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}}))}if(e.length){e.forEach((t=>{const e=this.getItemData(t);const s=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(e["IS_ACTIVE"]===true){s.push(this.classItemActive)}i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:s.join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}))}if(this.isSettingsEnabled){i.push({delimiter:true,html:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeparator,this.classSubmenuItem,this.classManage].join(" ")});i.push({html:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});const t=["ui-btn",this.theme==="default"?"ui-btn-sm":"ui-btn-xs","ui-btn-success-light","ui-btn-no-caps","ui-btn-round","ui-btn-icon-main-buttons-apply"];i.push({html:`\n\t\t\t\t\t<span class="${t.join(" ")}">\n\t\t\t\t\t\t<span class="ui-btn-text">${this.message("MIB_APPLY_SETTING_MENU_ITEM")}</span>\n\t\t\t\t\t</span>`,className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});i.push({html:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")});i.push({delimiter:true,html:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeparator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!s.length){i.push({html:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(s.length){s.forEach((t=>{const e=this.getItemData(t);const s=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(e["IS_ACTIVE"]===true){s.push(this.classItemActive)}i.push({id:e["DATA_ID"],html:this.getMenuItemText(t),href:e["URL"],onclick:e["ON_CLICK"],title:t.getAttribute("title"),className:s.join(" "),items:this.getMoreMenuSubItems(t),events:{onMouseEnter:this.handleMoreMenuItemMouseEnter}})}))}}return i},getMenuItems:function(t){return this.createMenuItems(this.getItemData(t),t)},getMoreMenuSubItems:function(t){return this.createMenuItems(this.getItemData(t),null)},createMenuItems:function(t,e=null){if(!BX.Type.isArrayFilled(t["ITEMS"])){return[]}const s=t["ITEMS"];const i=[];for(let t=0;t<s.length;t++){const n=s[t];if(n["IS_PINNED"]||n["IS_DISBANDED"]){continue}const o=n["IS_DELIMITER"]===true;if(o){const t=i.length===0;const e=i[i.length-1];if(t||e&&e["delimiter"]===true){continue}}const a=["menu-popup-no-icon","main-buttons-menu-item"];if(n["IS_ACTIVE"]===true){a.push("main-buttons-menu-item-active")}const u=BX.Text.toBoolean(n["IS_LOCKED"]);if(u){a.push(this.classItemLocked)}if(this.isEditEnabled()){a.push(this.classEditState)}let r;if(o){r={delimiter:true,className:a.join(" "),text:n["TEXT"]}}else{r={html:this.getMenuItemText(n,e),href:n["URL"],onclick:n["ON_CLICK"],title:n["TITLE"],className:a.join(" ")}}const l=n.hasOwnProperty("AJAX_OPTIONS");if(l){r.cacheable=true;r.events=this._getEvents(n["AJAX_OPTIONS"]);r.items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}else if(BX.Type.isArrayFilled(n["ITEMS"])&&!this.isEditEnabled()){const t=this.createMenuItems(n,e);if(t.length){r.items=t}}i.push(r)}if(i.length&&i[i.length-1]["delimiter"]===true){i.pop()}return i},_setAjaxMode:function(t){for(let e in t){if(!t.hasOwnProperty(e)){continue}if(t[e].hasOwnProperty("ajaxOptions")){t[e].cacheable=true;t[e].events=this._getEvents(t[e]["ajaxOptions"]);t[e].items=[{id:"loading",text:this.message("MIB_MAIN_BUTTONS_LOADING")}]}}},_getEvents:function(t){return{onSubMenuShow:()=>{if(this.subMenuLoaded){return}const e=this.getSubMenu();e.removeMenuItem("loading");const s=e.getMenuItem("loading");this.getSubItems(t).then((t=>{this._setAjaxMode(t);this.subMenuLoaded=true;this.addSubMenu(t);this.showSubMenu()})).catch((t=>{if(s){s.getLayout().text.innerText=t}}))}}},getSubItems:function(t){return new Promise((function(e,s){if(this.progress){s(this.message("MIB_MAIN_BUTTONS_LOADING"));return}if(t.mode==="component"){this.progress=true;BX.ajax.runComponentAction(t.component,t.action,{mode:t.componentMode,signedParameters:t.signedParameters?t.signedParameters:{},data:t.data}).then((t=>{this.progress=false;e(t.data)}))}else{this.progress=true;BX.ajax.runAction(t.action,{data:t.data}).then((t=>{this.progress=false;e(t.data)}))}}))},getMoreMenuArgs:function(){const t=this.getMoreMenuId();const e=this.moreButton;const s=this.getMoreMenuItems();let i;const n=800;if(this.theme==="default"){const t=350;const s=25;i={autoHide:false,compatibleMode:false,offsetLeft:-s,offsetTop:4,cacheable:false,className:"main-buttons-menu-popup main-buttons-more-menu-popup",minWidth:240,maxWidth:t,maxHeight:n,subMenuOptions:{className:"main-buttons-menu-popup main-buttons-more-menu-popup --sub-menu",minWidth:150,maxWidth:t,events:{onFirstShow:this.handleMoreMenuFirstShow.bind(this)}},bindOptions:{position:"bottom",forceTop:true},events:{onClose:this.handleMoreMenuClose.bind(this),onDestroy:this.handleMoreMenuClose.bind(this),onFirstShow:this.handleMoreMenuFirstShow.bind(this),onShow:this.handleMoreMenuShow.bind(this),onBeforeAdjustPosition:this.handleAdjustPosition.bind(this,e)}}}else{const t=this.moreButton.querySelector(".main-buttons-item-text-title");const e=t.offsetWidth;const s=250;const o=e/2-s/2+BX.Main.Popup.getOption("angleLeftOffset");const a=BX.Main.Popup.getOption("angleLeftOffset")-BX.Main.Popup.getOption("angleMinTop");const u=s/2-a;i={autoHide:false,compatibleMode:false,offsetTop:4,offsetLeft:o,minWidth:s,maxWidth:s,maxHeight:n,angle:{position:"top",offset:u},className:"main-buttons-default-menu-popup main-buttons-more-menu-popup",subMenuOptions:{className:"main-buttons-default-menu-popup main-buttons-more-menu-popup --sub-menu",minWidth:null,events:{onFirstShow:this.handleMoreMenuFirstShow.bind(this)}},cacheable:false,bindOptions:{position:"bottom",forceTop:true},events:{onClose:this.handleMoreMenuClose.bind(this),onDestroy:this.handleMoreMenuClose.bind(this),onFirstShow:this.handleMoreMenuFirstShow.bind(this),onShow:this.handleMoreMenuShow.bind(this)}}}if(this.isEditEnabled()){i.className+=" "+this.classEditState}return[t,e,s,i]},getChildMenuArgs:function(t){const e=800;if(this.theme==="default"){const s=25;const i=350;return{autoHide:false,compatibleMode:false,offsetLeft:-s,offsetTop:4,cacheable:false,className:"main-buttons-menu-popup",maxWidth:i,minWidth:t.offsetWidth+s*2+30,maxHeight:e,subMenuOptions:{className:"main-buttons-menu-popup --sub-menu",minWidth:null,events:{onFirstShow:this._onChildMenuFirstShow.bind(this)}},bindOptions:{position:"bottom",forceTop:true},events:{onFirstShow:this._onChildMenuFirstShow.bind(this),onShow:this._onChildMenuShow.bind(this,t),onClose:this._onChildMenuClose.bind(this,t),onDestroy:this._onChildMenuClose.bind(this,t),onBeforeAdjustPosition:this.handleAdjustPosition.bind(this,t)}}}else{const s=250;return{autoHide:false,compatibleMode:false,offsetTop:4,cacheable:false,className:"main-buttons-default-menu-popup",minWidth:Math.min(t.offsetWidth+25*2+30,s),maxWidth:s,maxHeight:e,bindOptions:{position:"bottom",forceTop:true},subMenuOptions:{className:"main-buttons-default-menu-popup --sub-menu",minWidth:null,events:{onFirstShow:this._onChildMenuFirstShow.bind(this)}},events:{onFirstShow:this._onChildMenuFirstShow.bind(this),onShow:this._onChildMenuShow.bind(this,t),onClose:this._onChildMenuClose.bind(this,t),onDestroy:this._onChildMenuClose.bind(this,t)}}}},centerPopupArrow(t,e){const s=e.offsetWidth;const i=t.getPopupContainer().offsetWidth;const n=s/2-i/2;const o=BX.Main.Popup.getOption("angleLeftOffset")-BX.Main.Popup.getOption("angleMinTop");t.setAngle({offset:i/2-o});t.setOffset({offsetLeft:n+BX.Main.Popup.getOption("angleLeftOffset")})},visibleControlMoreButton:function(){const t=this.getHiddenItems();if(!t.length){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createMoreMenu:function(){const t=BX.Main.MenuManager.create(...this.getMoreMenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.getMenuItems().forEach((function(t){const e=t.getLayout().item;BX.Event.bind(e,"click",BX.delegate(this._onDocumentClick,this))}),this);return t},createChildMenu:function(t){const e=this.getMenuItems(t);if(e.length){const s=BX.Main.MenuManager.create(this.getChildMenuId(),t,e,this.getChildMenuArgs(t));if(!this.isEditEnabled()&&this.isSettingsEnabled){const e=()=>{this.showMoreMenu();this.enableEdit();this.destroyChildMenu();this.showChildMenu(t)};s.getMenuItems().forEach((t=>{const s=t.getLayout().item;s.draggable=true;BX.Event.bind(s,"dragstart",e)}))}return s}return null},showMoreMenu:function(){clearTimeout(this.submenuLeaveTimeout);if(!this.isEditEnabled()){this.closeChildMenu()}let t=this.getMoreMenu();if(t!==null){t.getPopupWindow().show()}else{this.destroyMoreMenu();t=this.createMoreMenu();t.getPopupWindow().show()}this.setMoreMenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.getPopupWindow().setAutoHide(false)}},showChildMenu:function(t){clearTimeout(this.childMenuLeaveTimeout);if(!this.isEditEnabled()){this.closeMoreMenu()}if(!this.isVisibleItem(t)){return}const e=BX.Main.MenuManager.getMenuById(this.getChildMenuId());if(e&&e.bindElement===t){e.getPopupWindow().show();this.destroyItemEditMenu()}else{this.destroyChildMenu(t);const e=this.createChildMenu(t);if(e){e.getPopupWindow().show();this.destroyItemEditMenu()}}},closeMoreMenu:function(){const t=this.getMoreMenu();if(t===null){return}t.getPopupWindow().close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setMoreMenuShown(false)},closeChildMenu:function(){const t=this.getChildMenu();if(t===null){return}this.closePinHint();t.close()},getMoreMenu:function(){return BX.Main.MenuManager.getMenuById(this.getMoreMenuId())},getChildMenu:function(){return BX.Main.MenuManager.getMenuById(this.getChildMenuId())},destroyMoreMenu:function(){BX.Main.MenuManager.destroy(this.getMoreMenuId())},destroyChildMenu:function(){BX.Main.MenuManager.destroy(this.getChildMenuId())},refreshMoreMenu:function(){const t=this.getMoreMenu();if(t===null){return}const e=this.getMoreMenuArgs();if(BX.Type.isArray(e)){this.destroyMoreMenu();this.createMoreMenu();this.showMoreMenu()}},setMoreMenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}if(this.isSubmenuShown){BX.Dom.addClass(this.moreButton,this.classMenuShown)}else{BX.Dom.removeClass(this.moreButton,this.classMenuShown)}},activateItem:function(t){if(!BX.Type.isDomNode(t)){return}if(!BX.Dom.hasClass(t,this.classItemActive)){BX.Dom.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.Type.isDomNode(t)){return}if(BX.Dom.hasClass(t,this.classItemActive)){BX.Dom.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){const t={};this.getAllItems().forEach(((e,s)=>{t[e.id]={sort:s,isDisabled:this.isDisabled(e),isPinned:this.isPinned(e)}}));return t},initSaving:function(t){this.sendOptions=this.sendOptions.bind(this);this.optionsToSave=[];this.debouncedSendOptions=BX.debounce(this.sendOptions,5e3);if(BX.Type.isPlainObject(t)){this.ajaxSettings={componentName:t.componentName,signedParams:t.signedParams}}},sendOptions:function(){if(this.optionsToSave.length<=0){return}const t={};this.optionsToSave.forEach((function(e){t[e.name]=e.value}));this.optionsToSave=[];window.removeEventListener("beforeunload",this.sendOptions);BX.removeCustomEvent("SidePanel.Slider:onClose",this.sendOptions);return BX.ajax.runComponentAction(this.ajaxSettings.componentName,"save",{mode:"class",signedParameters:this.ajaxSettings.signedParams,data:{options:t}})},saveOptions:function(t,e){if(this.ajaxSettings){if(this.optionsToSave.length<=0){window.addEventListener("beforeunload",this.sendOptions);BX.addCustomEvent("SidePanel.Slider:onClose",this.sendOptions)}this.optionsToSave.push({name:t,value:e});this.debouncedSendOptions()}else if(this.listContainer.id){BX.userOptions.save("ui",this.listContainer.id,t,e)}},saveSettings:function(){const t=this.getCurrentSettings();const e="settings";if(!BX.Type.isPlainObject(t)){return}if(BX.Type.isDomNode(this.listContainer)&&"id"in this.listContainer){this.saveOptions(e,JSON.stringify(t));const s=this.getHomeItem();if(s){const{itemData:t,url:e,firstVisibleItem:i}=s;if(t){if(this.lastHomeLink!==e){this.saveOptions("firstPageLink",e);this.sendOptions();BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[e,i])}this.lastHomeLink=e}}}},resetSettings:function(){let t=null;const e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:()=>{if(BX.Dom.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.Dom.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings((s=>{if(s){BX.Dom.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(s)}else{this.saveOptions("settings",JSON.stringify({}));this.saveOptions("firstPageLink","");this.sendOptions().then((function(){window.location.reload()})).catch((function(){window.location.reload()}))}}))}}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){const e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);let s=new BX.Promise;const i=s;for(let t=0;t<e.length;t++){s=s.then(e[t])}s.then((function(e){t(null,e)}),(function(e){t(e,null)}));i.fulfill()},moveButtonAlias:function(t,e){if(!t||!this.dragItem){return}const s=this.getItemAlias(this.dragItem);const i=this.getItemAlias(t);if(this.isListItem(s)){if(i){if(e){BX.Dom.insertAfter(s,i)}else{this.listContainer.insertBefore(s,i)}}else{this.listContainer.appendChild(s)}}if(this.getMoreMenu()){this.getMoreMenu().getPopupWindow().adjustPosition()}},moveButton:function(t,e){if(!BX.Type.isDomNode(t)||!BX.Type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.Type.isDomNode(t)){if(e){BX.Dom.insertAfter(this.dragItem,t)}else{this.listContainer.insertBefore(this.dragItem,t)}}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(e){BX.Dom.insertAfter(this.dragItem,t)}else{this.getMoreMenuContainer().insertBefore(this.dragItem,t)}}},getMoreMenuContainer:function(){const t=this.getMoreMenu();let e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){const s=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.Dom.hasClass(t,e)&&t!==s){return t}}else{return null}}return null},findChildrenByClassName:function(t,e){let s=null;if(BX.Type.isDomNode(t)&&BX.Type.isStringFilled(e)){s=BX.Buttons.Utils.getByClass(t,e)}return s},initItems:function(){this.getAllItems().forEach((t=>{this.initItem(t)}))},initItem:function(t){if(this.isSettingsEnabled){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");BX.Event.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.Event.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.Event.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.Event.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.Event.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.Event.bind(t,"drop",BX.delegate(this._onDrop,this));t.dataset.link="item-"+BX.Text.getRandom().toLowerCase()}BX.Event.bind(t,"click",this._handleItemClick.bind(this));BX.Event.bind(t,"mouseenter",this.handleItemMouseEnter.bind(this));BX.Event.bind(t,"mouseleave",this.handleItemMouseLeave.bind(this))},dragAndDropInitInSubmenu:function(){const t=this.getMoreMenu();if(!t){return}const e=t.menuItems;e.forEach((t=>{if(this.isSeparator(t.layout.item)||this.isSettings(t.layout.item)||this.isApplySettingsButton(t.layout.item)||this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=false}else{t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.Event.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.Event.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.Event.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.Event.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.Event.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.Event.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.Dom.hasClass(t.layout.item,this.classHiddenLabel)||BX.Dom.hasClass(t.layout.item,this.classManage)){BX.Event.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}}))},getItem:function(t){if(!BX.Type.isDomNode(t)){if(!t||!BX.Type.isDomNode(t.target)){return null}}else{t={target:t}}let e=t.target.closest("."+this.classItem);if(!BX.Type.isDomNode(e)){e=t.target.closest("."+this.classDefaultSubmenuItem+", ."+this.classDefaultSubmenuDelimimeter)}return e},getItemData:function(t){if(!BX.Type.isDomNode(t)){return{}}const e=this.itemData.get(t);if(e){return e}let s;try{s=JSON.parse(t.dataset.item)}catch(t){s={}}this.setItemData(t,s);return s},setItemData(t,e){if(BX.Type.isElementNode(t)&&BX.Type.isPlainObject(e)){e.NODE=t;this.itemData.set(t,e)}},setOpacity:function(t){if(!BX.Type.isDomNode(t)){return}BX.style(t,"opacity",.5)},unsetOpacity:function(t){if(!BX.Type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.Dom.addClass(this.listContainer,this.classOnDrag);BX.Dom.addClass(BX(this.getMoreMenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){const t=this.getMoreMenu();this.getAllItems().forEach((t=>{this.unsetOpacity(t);BX.Dom.removeClass(t,this.classItemOver)}));if(t&&BX.Type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach((t=>{this.unsetOpacity(t);BX.Dom.removeClass(t.layout.item,this.classItemOver)}))}BX.Dom.removeClass(this.listContainer,this.classOnDrag);BX.Dom.removeClass(BX(this.getMoreMenuId(true)),this.classOnDrag)},getIconClass:function(t){let e="";if(BX.Type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.Type.isStringFilled(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){const e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){let e;if(!BX.Type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.Dom.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.Type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){let e=null;if(!BX.Type.isDomNode(t)){return e}const s=this.getAllItems();const i=this.isSubmenuItem(t);const n=this.isListItem(t);if(!i&&!n){return e}if(i){s.forEach((function(s){BX.Dom.hasClass(t,this.getAliasLink(s))&&(e=s)}),this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.Dom.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.Dom.removeClass(t,this.classSecret)},fakeDragItem:function(){if(!BX.Type.isDomNode(this.dragItem)||!BX.Type.isDomNode(this.overItem)){return}let t=null;if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateMoreMenuItems:function(){const t=this.getMoreMenu();if(t===null){return}const e=t.menuItems;if(!BX.Type.isArray(e)||!e.length){return}const s=this.getHiddenItems();const i=this.getDisabledItems();const n=i.concat(s);e.forEach((t=>{const e=[].some.call(n,(e=>BX.Dom.hasClass(t.layout.item,this.dataValue(e,"link"))||this.isDisabled(t.layout.item)||this.isSeparator(t.layout.item)||this.isDropzone(t.layout.item)));if(e||(this.isSettings(t.layout.item)||this.isApplySettingsButton(t.layout.item)||this.isResetSettingsButton(t.layout.item)||this.isNotHiddenItem(t.layout.item)||this.isSeparator(t.layout.item)||t.layout.item===this.dragItem)&&!this.isMoreButton(t.layout.item)){this.showItem(t.layout.item)}else{this.hideItem(t.layout.item)}}))},isNotHiddenItem:function(t){return BX.Dom.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.Type.isDomNode(t)&&!BX.Dom.hasClass(t,this.classItemOver)){BX.Dom.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItemOver)){BX.Dom.removeClass(t,this.classItemOver)}},dataValue:function(t,e){let s="";if(BX.Type.isDomNode(t)){const i=BX.data(t,e);if(typeof i!=="undefined"){s=i}}return s},execScript:function(t,e){if(BX.Type.isStringFilled(t)){const s=new Function("event",t);s(e)}},showLicenseWindow:function(){if(!B24.licenseInfoPopup){return}const t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_handleItemClick:function(t){if(!this.isEditEnabled()){const e=this.getItem(t);this.showChildMenu(e)}},handleEditButtonClick:function(t){t.preventDefault();t.stopPropagation();let e=this.getItem(t);if(!BX.Type.isDomNode(e)){return}if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}const s=this.getItemData(e);const i=this.getItemEditMenu();if(i&&i.popupWindow.isShown()&&this.lastEditNode===e){i.popupWindow.close()}else{this.showItemEditMenu(s,t.target)}this.lastEditNode=e},handleDragButtonClick:function(t){t.preventDefault();t.stopPropagation()},handleItemPinEnter:function(t){const e=this.getChildMenu();if(e){this.showPinHint(t.currentTarget)}},showPinHint:function(t){const e=48;const s=BX.Main.PopupManager.create({id:"main-buttons-pin-hint",closeByEsc:true,padding:15,className:"main-buttons-pin-hint-popup",height:e,cacheable:false,autoHide:true,bindOptions:{forceBindPosition:true},content:this.message("MIB_PIN_HINT"),darkMode:true,events:{onAfterShow:function(e){const s=e.getTarget();const i=BX.Dom.getPosition(t);const n=BX.Dom.getPosition(s.getPopupContainer());if(n.left<i.left+i.width){s.setAngle({position:"top",offset:0});s.setOffset({offsetLeft:20,offsetTop:5});s.adjustPosition()}}}});s.setAngle({position:"left",offset:0});s.setOffset({offsetLeft:t.offsetWidth+5,offsetTop:-t.offsetHeight/2-e/2-2});s.setBindElement(t);s.show();s.adjustPosition()},closePinHint:function(){const t=BX.Main.PopupManager.getPopupById("main-buttons-pin-hint");if(t){t.close()}},handleItemPinLeave:function(t){this.closePinHint()},handleItemPin:function(t,e,s){s.stopPropagation();s.preventDefault();const i=this.createRootItem(t);BX.Dom.addClass(i,"main-buttons-item-insert-animation");BX.Dom.insertBefore(i,e);requestAnimationFrame((()=>{requestAnimationFrame((()=>{BX.Dom.style(i,{width:i.scrollWidth+"px",opacity:1})}))}));const n=()=>{BX.Dom.removeClass(i,"main-buttons-item-insert-animation");BX.Dom.style(i,"width",null);BX.Dom.style(i,"opacity",null);const t=this.getItemData(e);this.recalculateItemsCounters([t]);this.showMoreMenu();this.updateMoreButtonCounter();this.showChildMenu(e);this.saveSettings()};setTimeout(n,300);this.initItem(i);this.pinItem(t);this.destroyMoreMenu();this.destroyChildMenu()},handleItemUnpin:function(t,e){BX.Dom.style(e,{width:e.offsetWidth+"px"});BX.Dom.addClass(e,"main-buttons-item-insert-animation");requestAnimationFrame((()=>{requestAnimationFrame((()=>{BX.Dom.style(e,{width:0,margin:0,opacity:0})}))}));const s=()=>{BX.Dom.remove(e);this.showMoreMenu();this.updateMoreButtonCounter();this.saveSettings()};setTimeout(s,300);this.pinItem(t,false);const i=[];let n="";const o=t["ID"].split(":");o.forEach((t=>{n+=`${n===""?"":":"}${t}`;const e=this.getItemById(n);if(e){i.push(this.getItemData(e))}}));this.destroyMoreMenu();this.recalculateItemsCounters(i)},pinItem:function(t,e=true){const s=t["ID"];const i=s.split(":");let n="";i.forEach(((t,o)=>{n+=`${n===""?"":":"}${t}`;const a=this.getItemById(n);if(!a){return}const u=this.getItemData(a);let r=u["ITEMS"];let l=n;const h=i.slice(o+1);const m=[u];while(BX.Type.isArrayFilled(h)&&BX.Type.isArrayFilled(r)){l=l+":"+h.shift();for(let t=0;t<r.length;t++){const i=r[t];if(i["ID"]===s){i["IS_PINNED"]=e;for(let t=m.length-1;t>=0;t--){const s=m[t];const i=t===0;if(e){const t=s["ITEMS"].some((t=>{const e=t["IS_PINNED"]===true;const s=t["IS_DISBANDED"]===true;const i=t["IS_DELIMITER"]===true;return!e&&!s&&!i}));if(!t){s["IS_DISBANDED"]=true;if(i){a.dataset.disbanded=true}}}else{if(i){a.dataset.disbanded=false}s["IS_DISBANDED"]=false}const n=s["ITEMS"].some((t=>t["IS_ACTIVE"]===true&&t["IS_PINNED"]!==true&&t["IS_DELIMITER"]!==true));if(n){s["IS_ACTIVE"]=true;if(i){this.activateItem(a)}}else{s["IS_ACTIVE"]=false;if(i){this.deactivateItem(a)}}}return}else if(i["ID"]===l){r=i["ITEMS"];l=i["ID"];m.push(i);break}}}}))},getParentItem:function(t){const e=t.split(":");let s="";for(let i=0;i<e.length;i++){s+=`${s===""?"":":"}${e[i]}`;const n=this.getItemById(s);if(!n){continue}const o=this.getItemData(n);let a=o["ITEMS"];let u=s;const r=e.slice(i+1);let l=null;while(BX.Type.isArrayFilled(r)&&BX.Type.isArrayFilled(a)){u=u+":"+r.shift();for(let e=0;e<a.length;e++){const s=a[e];if(s["ID"]===t){return l===null?o:l}else if(s["ID"]===u){a=s["ITEMS"];u=s["ID"];l=s;break}}}}return null},_onDragStart:function(t){const e=this.getVisibleItems();const s=BX.Type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.Type.isDomNode(this.dragItem)){return}if(s===1&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)||BX.Dom.attr(this.dragItem,"data-parent-item-id")||BX.Dom.attr(this.dragItem,"data-has-child")){t.preventDefault();return}this.onDragStarted=true;this.closeChildMenu();this.destroyItemEditMenu();if(this.isListItem(this.dragItem)){this.showMoreMenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();const e=this.getItem(t);this.onDragStarted=false;if(!BX.Type.isDomNode(e)){return}this.unsetDragStyles();this.refreshMoreMenu();if(!this.isEditEnabled()){this.closeMoreMenu()}const s=BX.findNextSibling(this.dragItem,(t=>this.isVisibleItem(t)));const i=BX.findPreviousSibling(this.dragItem,(t=>this.isVisibleItem(t)));if(BX.Dom.hasClass(i,this.classHiddenLabel)||this.isDisabled(i)&&this.isSubmenuItem(i)||this.isDisabled(s)&&this.isSubmenuItem(s)){this.disableItem(this.dragItem);this.refreshMoreMenu()}if(this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){let t=this.getHiddenItems();const e=this.getDisabledItems();t=t.concat(e);let s=0;if(BX.Type.isArray(t)){t.forEach((t=>{const e=this.getItemData(t);const i=BX.Type.isNumber(e["COUNTER"])&&e["COUNTER"]>0?e["COUNTER"]:0;s+=i}))}if(BX.Type.isNumber(s)){this.setMoreButtonCounter(s)}},_onDragEnter:function(t){const e=this.getItem(t);if(BX.Type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();this.overItem=this.getItem(t);if(!BX.Type.isDomNode(this.overItem)||!BX.Type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)||BX.Dom.attr(this.overItem,"data-parent-item-id")||BX.Dom.attr(this.overItem,"data-has-child")){return}this.fakeDragItem();const e=this.isNext(t);const s=this.isGoodPosition(t);if(e&&s){let t;let e=false;if(this.isListItem(this.overItem)){t=this.findNextSiblingByClass(this.overItem,this.classItem);if(t===null&&this.getLastVisibleItem()===this.overItem){t=this.overItem;e=true}}else{t=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem);if(this.isSettings(t)||this.isApplySettingsButton(t)||this.isResetSettingsButton(t)){return}if(t===null&&this.getItemAlias(this.getLastDisabledItem())===this.overItem){t=this.overItem;e=true}}if(BX.Type.isDomNode(t)){this.moveButton(t,e);this.moveButtonAlias(t,e);this.adjustMoreButtonPosition();this.updateMoreMenuItems()}}else if(!e&&s&&!BX.Dom.hasClass(this.overItem,this.classHiddenLabel)){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateMoreMenuItems()}},_onDragLeave:function(t){const e=this.getItem(t);if(BX.Type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){const e=this.getItem(t);if(!BX.Type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}const s=this.getItemAlias(this.dragItem);if(this.isListItem(s)){s.dataset.disabled="false"}this.unsetDragStyles();t.preventDefault()},handleMoreMenuFirstShow:function(t){const e=t.getTarget();BX.Event.bind(e.getPopupContainer(),"mouseenter",this.handleMoreMenuMouseEnter.bind(this));BX.Event.bind(e.getPopupContainer(),"mouseleave",this.handleMoreMenuMouseLeave.bind(this))},handleMoreMenuMouseEnter:function(){clearTimeout(this.submenuLeaveTimeout)},handleMoreMenuMouseLeave:function(){this.tryCloseMoreMenuOnTimeout()},tryCloseMoreMenuOnTimeout:function(){clearTimeout(this.submenuLeaveTimeout);if(!this.isEditEnabled()){this.submenuLeaveTimeout=setTimeout((()=>{this.closeMoreMenu()}),500)}},handleMoreMenuShow:function(t){BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onMenuShow");BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onMoreMenuShow",{event:t});setTimeout((()=>{if(!this.isEditEnabled()){t.getTarget().setAutoHide(true)}}),500)},handleMoreMenuClose:function(){BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onMoreMenuClose");this.setMoreMenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}this.destroyItemEditMenu()},_onChildMenuFirstShow:function(t){const e=t.getTarget();BX.Event.bind(e.getPopupContainer(),"mouseenter",this._onChildMenuMouseEnter.bind(this));BX.Event.bind(e.getPopupContainer(),"mouseleave",this._onChildMenuMouseLeave.bind(this))},_onChildMenuMouseEnter:function(){clearTimeout(this.childMenuLeaveTimeout)},_onChildMenuMouseLeave:function(){this.tryCloseChildMenuOnTimeout()},tryCloseChildMenuOnTimeout:function(){if(this.isEditEnabled()){return}clearTimeout(this.childMenuLeaveTimeout);this.childMenuLeaveTimeout=setTimeout((()=>{this.closeChildMenu()}),500)},_onChildMenuShow:function(t,e){BX.Dom.addClass(t,this.classMenuShown);BX.Event.EventEmitter.emit("BX.Main.InterfaceButtons:onMenuShow");BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onSubMenuShow",{item:t,event:e});if(this.theme!=="default"){this.centerPopupArrow(e.getTarget(),t)}setTimeout((()=>{e.getTarget().setAutoHide(true)}),500)},_onChildMenuClose:function(t){BX.Event.EventEmitter.emit(this,"BX.Main.InterfaceButtons:onSubMenuClose");BX.Dom.removeClass(t,this.classMenuShown);this.closePinHint()},handleAdjustPosition:function(t,e){const s=25;const i=BX.Dom.getPosition(t);const n=e.getTarget();if(e.left<i.left-s){const t=n.getPopupContainer().offsetWidth;const o=i.right-t+s;if(o>0){e.left=o;BX.Dom.addClass(n.getPopupContainer(),"--left-handed")}}else{BX.Dom.removeClass(n.getPopupContainer(),"--left-handed")}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateMoreMenuItems();this.closeChildMenu();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},handleMoreButtonClick:function(t){t.preventDefault();this.showMoreMenu()},handleMoreButtonMouseEnter:function(t){if(this.enableItemMouseEnter){clearTimeout(this.menuShowTimeout);this.menuShowTimeout=setTimeout((()=>{this.showMoreMenu()}),100)}clearTimeout(this.submenuLeaveTimeout)},handleMoreButtonMouseLeave:function(){clearTimeout(this.menuShowTimeout);this.tryCloseMoreMenuOnTimeout()},handleItemMouseEnter:function(t){if(!this.enableItemMouseEnter){return}if(this.onDragStarted){return}const e=this.getItem(t);clearTimeout(this.childMenuLeaveTimeout);clearTimeout(this.menuShowTimeout);this.menuShowTimeout=setTimeout((()=>{this.showChildMenu(e)}),100);BX.Dom.addClass(e,this.classItemOver)},handleItemMouseLeave:function(t){clearTimeout(this.menuShowTimeout);if(!this.enableItemMouseEnter){return}if(this.onDragStarted){return}const e=this.getItem(t);BX.Dom.removeClass(e,this.classItemOver);this.tryCloseChildMenuOnTimeout()},handleMoreMenuItemMouseEnter:function(t){if(this.isEditEnabled()){t.preventDefault()}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getMoreMenuContainer(),this.classSettingsResetButton)},isDisabled:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.Dom.hasClass(t,this.classItemDisabled)}return e},isPinned:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.getItemData(t)["IS_PINNED"]===true}return e},isSettings:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){let e=false;if(BX.Type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.Dom.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.Dom.hasClass(t,this.classDropzone)},isNext:function(t){const e=this.dragItem.getBoundingClientRect();const s=this.overItem.getBoundingClientRect();const i=getComputedStyle(this.dragItem);const n=parseInt(i.marginRight.replace("px",""));let o=null;if(this.isListItem(this.overItem)){o=t.clientX>s.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){o=t.clientY>e.top}return o},isGoodPosition:function(t){const e=this.overItem;if(!BX.Type.isDomNode(e)){return false}let s;const i=e.getBoundingClientRect();if(this.isListItem(e)){s=this.isNext(t)&&t.clientX>=i.left+i.width/2||!this.isNext(t)&&t.clientX<=i.left+i.width/2}if(this.isSubmenuItem(e)){s=this.isNext(t)&&t.clientY>=i.top+i.height/2||!this.isNext(t)&&t.clientY<=i.top+i.height/2}return s},isSubmenuItem:function(t){return BX.Dom.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.Type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){let e=false;if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){let e=false;if(BX.Type.isDomNode(t)&&BX.Dom.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){let e=false;if(BX.Type.isDomNode(t)){e=BX.Dom.hasClass(t,this.classSeparator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){let e=null;if(!BX.Type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.Type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate((function(){e=BX(t.containerId);if(!BX.Type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}),this))}},getById:function(t){let e=null;if(BX.type.isString(t)&&BX.Type.isStringFilled(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1728733181575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js?17287331821189";s:6:"source";s:70:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.js";s:3:"min";s:74:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/ui.button.panel/templates/.default/script.map.js";}"*/
(function(){"use strict";BX.namespace("BX.UI");var t=function(){this.layout={container:null}};t.prototype={init:function(t){this.layout.container=BX(t.containerId);this.isFrame=t.isFrame||false;this.hasHints=t.hasHints||false;this.pinnerContainer=t.pinnerContainer||false;this.pinner=new BX.UI.Pinner(this.layout.container,{fixBottom:this.isFrame,fullWidth:this.isFrame,anchorBottom:this.pinnerContainer});if(this.hasHints){BX.UI.Hint.init(this.layout.container)}t.buttons.forEach(this.initButton,this)},getContainer:function(){return this.layout.container},hide:function(){if(!this.layout.container){return}this.layout.container.classList.add("ui-button-panel-wrapper-hide")},show:function(){this.layout.container.classList.remove("ui-button-panel-wrapper-hide")},initButton:function(t){if(!t.ID){return}t.node=BX(t.ID);if(!t.node){return}BX.bind(t.node,"click",this.onButtonClick.bind(this,t))},onButtonClick:function(t,n){BX.onCustomEvent(this,"button-click",[t]);if(t.WAIT){BX.addClass(BX(t.ID),"ui-btn-wait")}if(this.isFrame&&(t.TYPE==="close"||t.TYPE==="cancel")){n.preventDefault();top.BX.SidePanel.Instance.close()}}};BX.UI.ButtonPanel=new t})();
/* End */
;; /* /bitrix/components/bitrix/ui.sidepanel.wrapper/templates/.default/template.min.js?17287331815071*/
; /* /bitrix/components/bitrix/bizproc.automation/templates/.default/script.min.js?172873318442199*/
; /* /bitrix/components/bitrix/bizproc.automation/templates/.default/disk_uploader.min.js?172873318418192*/
; /* /bitrix/components/bitrix/intranet.binding.menu/templates/.default/script.min.js?17287331811655*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?172873318163299*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1728733181575*/
; /* /bitrix/components/bitrix/ui.button.panel/templates/.default/script.min.js?17287331821189*/

//# sourceMappingURL=page_6afce2aaa6b9f93f7763e5b9abf4f2a9.map.js