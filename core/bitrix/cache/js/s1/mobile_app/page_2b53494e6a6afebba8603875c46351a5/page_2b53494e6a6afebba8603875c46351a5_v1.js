
; /* Start:"a:4:{s:4:"full";s:62:"/bitrix/templates/mobile_app/tasks/logic.min.js?17287331809326";s:6:"source";s:43:"/bitrix/templates/mobile_app/tasks/logic.js";s:3:"min";s:47:"/bitrix/templates/mobile_app/tasks/logic.min.js";s:3:"map";s:47:"/bitrix/templates/mobile_app/tasks/logic.map.js";}"*/
BX.namespace("BX.Mobile.Tasks");window.Application=window.Application||window.BXMobileAppContext;BX.Mobile.Tasks.widget=function(e){BX.merge(this,{opts:{scope:false,controls:{},instances:{},instanceCode:false,bindEvents:{},removeTemplates:true,useSpawn:false,initializeByGlobalEvent:false,globalEventScope:"document",registerDispatcher:true,usePull:false,setTitle:true,setPullDown:true},vars:{},ctrls:{A:{},S:{}},tmpls:{},sys:{scope:null,stack:{init:[]},instances:{},classCode:"widget",instanceCode:false,initialized:false}});this.pushFuncStack("init",BX.Mobile.Tasks.widget);this.isuiWidget=true};BX.merge(BX.Mobile.Tasks.widget.prototype,{preInit:function(){var e=this,t=this.opts,s=this.ctrls,i=this.sys.classCode;if(!("querySelector"in document))throw new Error("Your browser does not support querySelector");if(!i.match(/^[a-zA-Z0-9-_]+$/))throw new Error('Only letters, digitis, "-" and "_" allowed in code');if(BX.type.isNotEmptyString(t.instanceCode)){this.sys.instanceCode=t.instanceCode}},init:function(){var e=this,t=this.ctrls,s=this.opts,i=this.sys,n=this.sys.classCode,o;if(s.scope!==false){i.scope=BX.type.isNotEmptyString(s.scope)?BX(s.scope):s.scope;if(!BX.type.isElementNode(i.scope))throw new Error("Bad scope: invalid node passed");if(s.useSpawn&&i.scope)e.tmpls["scope"]=i.scope.outerHTML;this.findTemplates()}if(typeof s.bindEvents=="object"){for(o in s.bindEvents){if(BX.type.isFunction(s.bindEvents[o]))this.bindEvent(o,s.bindEvents[o])}}s.bindEvents=null},destroy:function(){},option:function(e,t){if(typeof t=="undefined"){return this.opts[e]}else{this.opts[e]=t}},variable:function(e,t){if(typeof t=="undefined"){return this.vars[e]}else{this.vars[e]=t}},control:function(e,t,s){if(!BX.type.isNotEmptyString(e))throw new Error("Requested control id is incorrect");if(t!==false&&typeof t!=="undefined"&&t!==null){if(!BX.type.isDomNode(t))throw new TypeError("Bad control instance to keep");this.ctrls["S"]=t;return}if(!BX.type.isPlainObject(s))s={};if(typeof s.scope!="undefined"){if(!BX.type.isDomNode(s.scope))throw new Error("Scope provided is not a valid dom node")}else{if(!BX.type.isDomNode(this.sys.scope))throw new Error("Widget scope is not a valid dom node")}var i=s.scope||this.sys.scope,n=!!s.all,o=!!s.reCache,r=!!s.noCache;if(BX.type.isElementNode(this.opts.controls[e]))return this.opts.controls[e];var a=n?"A":"S";if(typeof this.ctrls[a][e]==="undefined"||o){var l=i[n?"querySelectorAll":"querySelector"](this.getControlSearchString(e));if(l!==null)this.ctrls[a][e]=l}var c=this.ctrls[a][e];if(r)delete this.ctrls[a][e];return c},getRequiredControl:function(e,t){return this.controlR.apply(this,[e,t])},controlR:function(e,t){var s=this.control(e,false,t);if(typeof s=="undefined"||s===null)throw new ReferenceError("Requested control can not be found: "+this.getControlSearchValue(e));return s},instance:function(e,t){if(typeof t!="undefined"){if(typeof t=="undefined"||typeof t===null)throw new TypeError("Bad instance reference");if(typeof this.sys.instances[e]!="undefined")throw new ReferenceError("Instance is already defined under code: "+e);this.sys.instances[e]=t}return this.sys.instances[e]},find:function(e){if(!BX.type.isNotEmptyString(e))return null;return this.sys.scope.querySelector(e)},findAll:function(e){if(!BX.type.isNotEmptyString(e))return[];return Array.prototype.slice.call(this.sys.scope.querySelectorAll(e))},template:function(e,t){if(typeof t=="undefined"){return this.tmpls[e]}else{if(!BX.type.isString(t))throw new TypeError("Bad template html");this.tmpls[e]=t}},findTemplates:function(){var e=this.scope().querySelectorAll('script[type="text/html"]');for(var t=0;t<e.length;t++){var s=BX.data(e[t],"bx-template-id");if(typeof s=="string"&&s.length>0&&s.search(this.classCode())==0){s=s.replace(this.classCode()+"-","");this.tmpls[s]=e[t].innerHTML;if(this.opts.removeTemplates)BX.remove(e[t])}}},getHTMLByTemplate:function(e,t){var s=this.tmpls[e];if(!BX.type.isNotEmptyString(s))return"";for(var i in t){if(typeof t[i]!="undefined"&&t.hasOwnProperty(i)){var n="";if(i.toString().indexOf("=")==0){n=t[i].toString();i=i.toString().substr(1)}else n=BX.util.htmlspecialchars(t[i]).toString();var o="{{"+i.toString().toLowerCase()+"}}";if(n.search(o)>=0)n="";while(s.search(o)>=0)s=s.replace(o,n)}}return s},createNodesByTemplate:function(e,t,s){var i=this.tmpls[e];if(!BX.type.isNotEmptyString(i))return null;i=i.replace(/^\s\s*/,"").replace(/\s\s*$/,"");var n=this.getHTMLByTemplate(e,t);var o=false;var r=false;if(i.search(/^<\s*(tr|th)[^<]*>/)>=0)o=true;else if(i.search(/^<\s*td[^<]*>/)>=0)r=true;var a=document.createElement("div");if(o||r){if(o){a.innerHTML="<table><tbody>"+n+"</tbody></table>";a=a.childNodes[0].childNodes[0]}else{a.innerHTML="<table><tbody><tr>"+n+"</tr></tbody></table>";a=a.childNodes[0].childNodes[0].childNodes[0]}}else a.innerHTML=n;if(s){var l=a.childNodes;var c=[];for(var p=0;p<l.length;p++)if(BX.type.isElementNode(l[p]))c.push(l[p]);return c}else return Array.prototype.slice.call(a.childNodes)},parentConstruct:function(e,t){var s=e.superclass;if(typeof s=="object")s.constructor.apply(this,[t,true])},handleInitStack:function(e,t,s){this.pushFuncStack("init",t);if(!e){BX.merge(this.opts,s);BX.Mobile.Tasks.widget.prototype.preInit.call(this);var i=function(){if(this.sys.initialized)return;this.resolveFuncStack("init");for(var e in this.sys.stack){if(e!="init")this.resolveFuncStack(e,true)}this.sys.initialized=true;this.fireEvent("init",[this])};if(BX.type.isString(this.opts.initializeByGlobalEvent)&&this.opts.initializeByGlobalEvent.length>0){var n=this.opts.globalEventScope=="window"?window:document;BX.addCustomEvent(n,this.opts.initializeByGlobalEvent,BX.proxy(i,this))}else i.call(this)}},pushFuncStack:function(e,t){if(BX.type.isFunction(t.prototype[e])){if(typeof this.sys.stack[e]=="undefined")this.sys.stack[e]=[];this.sys.stack[e].push({owner:t,f:t.prototype[e]})}},disableInFuncStack:function(e,t){var s=this.sys.stack[e];if(typeof s=="undefined")return;for(var i=0;i<s.length;i++){if(s[i].owner==t)s[i].f=BX.DoNothing}},resolveFuncStack:function(e,t){var s=this.sys.stack[e];if(typeof s=="undefined")return;for(var i=0;i<s.length;i++){s[i].f.call(this)}if(t)this.fireEvent(e,[this],document);this.sys.stack[e]=null},fireEvent:function(e,t,s){s=s||this;t=t||[];BX.onCustomEvent(s,"bx-tasks-ui-"+this.sys.classCode+"-"+e,t);return this},bindEvent:function(e,t){BX.addCustomEvent(this,"bx-tasks-ui-"+this.sys.classCode+"-"+e,t);return this},getControlSearchValue:function(e){return this.sys.classCode+"-"+(this.sys.instanceCode===false?"":this.sys.instanceCode.toLowerCase()+"-")+e},getControlSearchString:function(e){return'[data-bx-id~="'+this.getControlSearchValue(e)+'"]'},getClassCode:function(){return this.sys.classCode},classCode:function(){return this.getClassCode()},getInstanceCode:function(){return this.sys.instanceCode},getScope:function(){return this.sys.scope},scope:function(){return this.getScope()},passCtx:function(e,t){return function(){var s=Array.prototype.slice.call(arguments);s.unshift(t);e.apply(this,s)}}});BX.Mobile.Tasks.page=function(e,t){this.parentConstruct(BX.Mobile.Tasks.page,e);BX.merge(this,{sys:{classCode:"page"},vars:{userId:false},appCtrls:{menu:false}});this.handleInitStack(t,BX.Mobile.Tasks.page,e)};BX.extend(BX.Mobile.Tasks.page,BX.Mobile.Tasks.widget);BX.merge(BX.Mobile.Tasks.page.prototype,{init:function(){if(typeof window.BXMobileApp!="undefined"){var e=BX.message("PAGE_TITLE");if(BX.type.isNotEmptyString(e)&&this.option("setTitle")){window.BXMobileApp.UI.Page.TopBar.title.setText(e);window.BXMobileApp.UI.Page.TopBar.title.show()}}else throw new ReferenceError("BXMobileApp is not defined, no init is possible");if(typeof window.app=="undefined")throw new ReferenceError("app is not defined, no init is possible");else if(this.option("setPullDown")){window.app.pullDown({enable:false,pulltext:BX.message("MB_TASKS_PULLDOWN_PULL"),downtext:BX.message("MB_TASKS_PULLDOWN_DOWN"),loadtext:BX.message("MB_TASKS_PULLDOWN_LOADING"),action:"RELOAD",callback:function(){window.app.reload()}});BX.addCustomEvent("onOpenPageBefore",BX.delegate(this.getPageParameters,this));BX.ready(BX.delegate(this.getPageParameters,this))}if(this.option("usePull")){BX.addCustomEvent("onPull",BX.delegate(this.pullHandler,this))}},addFastClick:function(e){if(BX.type.isElementNode(e)&&typeof window.FastButton!="undefined"){document.addEventListener("DOMContentLoaded",(function(){new window.FastButton(e,(function(e){e.target.click()}))}),false)}},pullHandler:function(e){},pageOpenHandler:function(e){},dynamicActionsCustom:function(e){},getDefaultMenu:function(){return[]},resetMenu:function(e){var t="";if(BX.type.isArray(e)&&e.length>0){this.appCtrls.menu=new window.BXMobileApp.UI.Menu({items:e});t=BX.delegate(this.appCtrls.menu.show,this.appCtrls.menu)}window.BXMobileApp.UI.Page.TopBar.title.setCallback(t)},setUser:function(e){if(+e>0)this.variable("userId",+e)},getUser:function(){return this.variable("userId")},dynamicActions:function(e){try{this.setUser(e.userId)}catch(e){}this.dynamicActionsCustom(e)},getPageParameters:function(){if(typeof window.app=="undefined")throw new ReferenceError("app is not defined, pageOpenHandler() wont work");window.app.getPageParams({callback:BX.delegate(this.pageOpenHandler,this)})}});
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/tasksmobile.comments/templates/.default/script.min.js?17287331865154";s:6:"source";s:75:"/bitrix/components/bitrix/tasksmobile.comments/templates/.default/script.js";s:3:"min";s:79:"/bitrix/components/bitrix/tasksmobile.comments/templates/.default/script.min.js";s:3:"map";s:79:"/bitrix/components/bitrix/tasksmobile.comments/templates/.default/script.map.js";}"*/
(function(e,t,s,n){"use strict";var i=t.Reflection.namespace("BX.TasksMobile");var o=function(){babelHelpers.createClass(e,null,[{key:"block",get:function e(){return{comments:"comments",stub:"stub"}}}]);function e(t){babelHelpers.classCallCheck(this,e);this.userId=t.userId;this.taskId=t.taskId;this.guid=t.guid;this.isTabsMode=t.isTabsMode;this.canReadCommentsOnInit=true;this.timeout=0;this.timeoutSec=2e3;this.commentsList=null;this.unreadComments=new Map;this.commentsToRead=new Map;this.initTextField();this.initCommentsBlock();this.initTaskResultManager(t);this.sendEvents(t);this.bindEvents()}babelHelpers.createClass(e,[{key:"initTextField",value:function e(){if(BX.MobileUI.TextField.defaultParams){window.BX.MobileUI.TextField.show()}else{s.EventEmitter.subscribe(BX.MobileUI.events.MOBILE_UI_TEXT_FIELD_SET_PARAMS,(function(){return window.BX.MobileUI.TextField.show()}))}}},{key:"initCommentsBlock",value:function t(){this.stub=BX("commentsStub");this.commentsBlock=BX("task-comments-block");var s=BX("post-comments-wrap").querySelector(".post-comment-block");this.resolveVisibility(s?e.block.comments:e.block.stub)}},{key:"resolveVisibility",value:function s(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:e.block.stub;var i="--hidden";if(n===e.block.stub){if(t.Dom.hasClass(this.stub,i)){t.Dom.removeClass(this.stub,i)}if(!t.Dom.hasClass(this.commentsBlock,i)){t.Dom.addClass(this.commentsBlock,i)}}else if(n===e.block.comments){if(t.Dom.hasClass(this.commentsBlock,i)){t.Dom.removeClass(this.commentsBlock,i)}if(!t.Dom.hasClass(this.stub,i)){t.Dom.addClass(this.stub,i)}}}},{key:"initTaskResultManager",value:function e(t){var s=t.resultComments,i=t.isClosed;n.ResultManager.getInstance().initResult({context:"task",taskId:this.taskId,comments:s,isClosed:i})}},{key:"sendEvents",value:function e(t){if(t.logId){var s={log_id:t.logId,ts:t.currentTs,bPull:false};BXMobileApp.onCustomEvent("onLogEntryRead",s,true)}}},{key:"bindEvents",value:function n(){var i=this;s.EventEmitter.subscribe("OnUCHasBeenInitialized",(function(e){var t=e.getData(),s=babelHelpers.slicedToArray(t,2),n=s[0],o=s[1];if(n==="TASK_".concat(i.taskId)){i.commentsList=o;i.commentsList.canCheckVisibleComments=!i.isTabsMode;i.unreadComments=new Map(i.commentsList.unreadComments)}}));s.EventEmitter.subscribe("onUCFormSubmit",(function(){return i.resolveVisibility(e.block.comments)}));s.EventEmitter.subscribe("OnUCCommentWasPulled",(function(t){var s=t.getData(),n=babelHelpers.slicedToArray(s,2),o=n[0],a=n[1];if(o[0]==="TASK_".concat(i.taskId)){var m=a.messageFields.AUTHOR;if(Number(m.ID)!==Number(i.userId)){i.unreadComments.set(o[1],new Date)}i.resolveVisibility(e.block.comments)}}));s.EventEmitter.subscribe("OnUCommentWasDeleted",(function(t){var s=t.getData(),n=babelHelpers.slicedToArray(s,2),o=n[0],a=n[1];var m=a[1];if(o==="TASK_".concat(i.taskId)){if(i.commentsList.getCommentsCount()<=0){i.resolveVisibility(e.block.stub)}i.unreadComments["delete"](m)}}));s.EventEmitter.subscribe("OnUCCommentWasRead",(function(e){var t=e.getData(),s=babelHelpers.slicedToArray(t,2),n=s[0],o=s[1];var a=o[1];if(n==="TASK_".concat(i.taskId)&&i.unreadComments.has(a)){i.commentsToRead.set(a,i.unreadComments.get(a));i.unreadComments["delete"](a);i.sendOnCommentsReadEvent(i.unreadComments.size);if(i.timeout<=0){i.timeout=setTimeout((function(){return i.readComments()}),i.timeoutSec)}}}));BXMobileApp.addCustomEvent("onPull-tasks",(function(){}));if(this.isTabsMode){BXMobileApp.addCustomEvent("tasks.task.tabs:onTabSelected",(function(e){if(e.guid===i.guid&&i.commentsList){i.setCanCheckVisibleComments(e.tab==="tasks.task.comments")}}))}else{t.Event.bind(document,"visibilitychange",(function(){return i.setCanCheckVisibleComments(!document.hidden)}));t.Event.bind(window,"pagehide",(function(){return i.setCanCheckVisibleComments(false)}));t.Event.bind(window,"pageshow",(function(){return i.setCanCheckVisibleComments(true)}))}BX.MobileUI.addLivefeedLongTapHandler(this.commentsBlock,{likeNodeClass:"post-comment-control-item-like"})}},{key:"setCanCheckVisibleComments",value:function e(s){if(!this.isTabsMode&&s&&this.canReadCommentsOnInit){this.canReadCommentsOnInit=false;this.readComments()}if(!this.commentsList){return}this.commentsList.canCheckVisibleComments=s;if(s){var n=t.GetWindowScrollPos();var i={top:n.scrollTop,bottom:n.scrollTop+t.GetWindowInnerSize().innerHeight};this.commentsList.checkVisibleComments(i);if(this.canReadCommentsOnInit){this.canReadCommentsOnInit=false;this.readComments()}}}},{key:"sendOnCommentsReadEvent",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var s={newCommentsCount:t,taskId:this.taskId};BXMobileApp.Events.postToComponent("tasks.task.comments:onCommentsRead",s);BXMobileApp.Events.postToComponent("task.view.onCommentsRead",s,"tasks.list")}},{key:"readComments",value:function e(){this.timeout=0;this.commentsToRead.clear();void BX.ajax.runAction("tasks.task.view.update",{data:{taskId:this.taskId,parameters:{IS_REAL_VIEW:"Y"}}})}}]);return e}();i.Comments=o;e.default=o})(this.window=this.window||{},BX,BX.Event,BX.Tasks);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:61:"/bitrix/templates/mobile_app/log_mobile.min.js?17287331802637";s:6:"source";s:42:"/bitrix/templates/mobile_app/log_mobile.js";s:3:"min";s:46:"/bitrix/templates/mobile_app/log_mobile.min.js";s:3:"map";s:46:"/bitrix/templates/mobile_app/log_mobile.map.js";}"*/
(function(){if(BX.MSL)return;BX.MobileSonetLog=function(){};BX.MobileSonetLog.prototype.DBCheck=function(e){if(app.db!=undefined){app.db.createTable({tableName:"b_default",fields:[{name:"KEY",unique:true},"VALUE"],success:function(t){e.success()},fail:function(t){e.fail()}})}else return false};BX.MobileSonetLog.prototype.DBDelete=function(e){if(parseInt(e)<=0){e=false}if(app.db!=undefined){var t=false;this.DBCheck({success:function(){app.db.deleteRows({tableName:"b_default",filter:{KEY:"post_unsent"+(e?"_"+e:"")},success:function(e){},fail:function(e){}})},fail:function(){}})}else return false};BX.MobileSonetLog.prototype.DBSave=function(e,t){if(parseInt(t)<=0){t=false}for(x in e){if(x==="sessid"){delete e[x];break}}if(app.db!=undefined){this.DBCheck({success:function(){app.db.getRows({tableName:"b_default",filter:{KEY:"post_unsent"+(t?"_"+t:"")},success:function(n){text=JSON.stringify(e);if(n.items.length>0){app.db.updateRows({tableName:"b_default",updateFields:{VALUE:text},filter:{KEY:"post_unsent"+(t?"_"+t:"")},success:function(e){},fail:function(e){}})}else{app.db.addRow({tableName:"b_default",insertFields:{KEY:"post_unsent"+(t?"_"+t:""),VALUE:text},success:function(e){},fail:function(e){}})}},fail:function(e){}})},fail:function(){}})}else return false};BX.MobileSonetLog.prototype.DBLoad=function(e,t){if(parseInt(t)<=0){t=false}if(app.db!=undefined){this.DBCheck({success:function(){app.db.getRows({tableName:"b_default",filter:{KEY:"post_unsent"+(t?"_"+t:"")},success:function(t){if(t.items.length>0&&t.items[0].VALUE.length>0){var n=JSON.parse(t.items[0].VALUE);if(typeof n=="object")e.onLoad(n);else e.onEmpty()}else e.onEmpty()},fail:function(t){e.onEmpty()}})},fail:function(){e.onEmpty()}})}else{e.onEmpty();return null}};BX.MobileSonetLog.prototype.viewImageBind=function(e,t){if(app.enableInVersion(6)){e=BX(e);if(!!e){BX.bindDelegate(e,"click",t,function(n){var i=BX.findChildren(e,t,true),o=[],a=false,f=false;var s=[];for(var l=0;l<i.length;l++){a=i[l].getAttribute("data-bx-image");if(!BX.util.in_array(a,o)){f=i[l].getAttribute("data-bx-preview");o[o.length]=i[l].getAttribute("data-bx-image");s[s.length]={url:a,preview:typeof f!="undefined"&&f!==null&&f.length>0?f:"",description:""}}}var u={photos:s};if(this.tagName.toUpperCase()=="IMG"){a=this.getAttribute("data-bx-image");if(typeof a!="undefined"&&a.length>0){u.default_photo=a}f=this.getAttribute("data-bx-preview");if(typeof f!="undefined"&&f!==null&&f.length>0){u.default_preview=f}}BXMobileApp.UI.Photo.show(u);return BX.PreventDefault(n)})}}};BX.MSL=new BX.MobileSonetLog;window.BX.MSL=BX.MSL})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.post.list/templates/mobile_app/script.min.js?172873318520122";s:6:"source";s:71:"/bitrix/components/bitrix/main.post.list/templates/mobile_app/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.post.list/templates/mobile_app/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.post.list/templates/mobile_app/script.map.js";}"*/
(function(){if(!window.BX||window.BX.MPLForm||!window.app){return}var t=window.BX;var e={entityId:0,text:"",form:{},list:{},comments:{}};function i(i){e.text=t.type.isNotEmptyString(i)?i:"";if(t.localStorage&&e.entityId){var n=t.localStorage.get("main.post.list/text");n=n||{};if(t.type.isNotEmptyString(e.text)){n[e.entityId]=e.text}else{delete n[e.entityId]}t.localStorage.set("main.post.list/text",n)}}function n(e){var i="";if(t.localStorage&&e){var n=t.localStorage.get("main.post.list/text");if(n){i=n[e]||"";delete n[e];t.localStorage.set("main.post.list/text",n)}}return i}t.addCustomEvent(window,"OnUCFormSubmit",(function(){i("")}));t.addCustomEvent("main.post.form/text",(function(e){e=t.type.isArray(e)?e[0]:e;i(e)}));var o={keyBoardIsShown:false,mention:{}};window.app.exec("enableCaptureKeyboard",true);t.addCustomEvent("onKeyboardWillShow",(function(){o.keyBoardIsShown=true}));t.addCustomEvent("onKeyboardDidHide",(function(){o.keyBoardIsShown=false}));function s(e,i,n){if(t.type.isPlainObject(n)){for(var o in n){if(n.hasOwnProperty(o)){s(e,i+"["+o+"]",n[o])}}}else if(t.type.isArray(n)){for(var r=0;r<n.length;r++){s(e,i+"[]",n[r])}}else{e.append(i,!!n?n:"")}}var r=function(t,e,i){this.id=t;this.text=e||"";this.attachments=i||[];this.node=null;this.mentions={}};r.prototype={getText:function(){return this.text}};r.getInstance=function(i,n,o){var s;if(t.type.isArray(i)&&e["comments"][i.join("-")]){s=e["comments"][i.join("-")]}else if(t.type.isArray(i)){s=new r(i,n,o);s.savedInRepoId=i.join("-");e["comments"][i.join("-")]=s}else if(t.type.isObject(i)&&t.type.isNotEmptyString(i["savedInRepoId"])&&e["comments"][i["savedInRepoId"]]){s=i}return s};r.removeInstance=function(t){if(t&&t["savedInRepoId"]){delete e["comments"][t["savedInRepoId"]]}};var a=function(i){this.bindEvents();e["form"][this.handlerId]=this;this.entitiesId={};this.comment=null;this.handlerId=i;this.handler=null;this.handlerEvents={onMPFUserIsWriting:t.delegate(this.writing,this),onMPFHasBeenDestroyed:t.delegate(this.reboot,this)};this.visible=false;this.bindHandler=t.delegate(this.bindHandler,this);t.addCustomEvent(window,"onMPFIsInitialized",this.bindHandler);if(t["MPF"])this.bindHandler(t["MPF"].getInstance(this.handlerId));this.jsCommentId=t.util.getRandomString(20)};a.prototype={bindHandler:function(e){if(e&&e.id==this.handlerId){this.handler=e;t.removeCustomEvent(window,"onMPFIsInitialized",this.bindHandler);for(var i in this.handlerEvents){if(this.handlerEvents.hasOwnProperty(i)){t.addCustomEvent(this.handler,i,this.handlerEvents[i])}}this.closeWait();t.onCustomEvent(this,"OnUCFormInit",[this])}},bindEvents:function(){this.windowEvents={OnUCReply:function(t,e,i){if(this.entitiesId[t]){var n=[t,0];e=parseInt(e);if(e>0&&i){n=this.initComment(n,"",false);n.mentions[i]="[USER="+e+"]"+i+"[/USER]";var o=this.handler&&this.handler.simpleForm?this.handler.simpleForm.writingParams["~text"]:n.text;n.text=o+(o==""?"":" ")+"[USER="+e+"]"+i+"[/USER]"+", "}this.show(n,n.text,false)}}.bind(this),OnUCAfterRecordEdit:t.delegate((function(e,i,n,o){if(this.entitiesId[e]){if(o==="EDIT"){this.show([e,i],n["messageBBCode"],n["messageFields"])}else if(o==="MODERATE"){t.onCustomEvent(window,"OnUCAfterRecordAdd",[n.messageId[0],n,{node:t("record-"+n.messageId[0]+"-"+n.messageId[1])}])}else if(n["errorMessage"]){this.showError([e,i],n["errorMessage"])}else if(n["okMessage"]){this.showNote([e,i],n["okMessage"])}}}),this),OnUploadQueueError:function(i){if(i.analyticsData){t.Runtime.loadExtension("ui.analytics").then((({sendData:t})=>{t({...i.analyticsData,status:"error"})}))}if(!e.list[i.entityId]){return}var n=e.list[i.entityId].getCommentNode(document.getElementById(i.commentData.commentNodeId).getAttribute("bx-mpl-entity-id"));if(n){this.showError({node:n,attachments:[{fieldValue:"do not bind click"}]},i.errorText)}}.bind(this)};t.addCustomEvent(window,"OnUCReply",this.windowEvents.OnUCReply);t.addCustomEvent(window,"OnUCAfterRecordEdit",this.windowEvents.OnUCAfterRecordEdit);t.addCustomEvent(window,"OnUploadQueueError",this.windowEvents.OnUploadQueueError)},reboot:function(e,i,n){for(var o in this.handlerEvents){if(this.handlerEvents.hasOwnProperty(o)){t.removeCustomEvent(this.handler,o,this.handlerEvents[o])}}this.bindHandler(n)},linkEntity:function(i,o){if(this.handler===null){this._linkEntity=t.delegate((function(){this.linkEntity(i,o)}),this);t.addCustomEvent(this,"OnUCFormInit",this._linkEntity)}else{if(this["_linkEntity"])t.removeCustomEvent(this,"OnUCFormInit",this["_linkEntity"]);this.entitiesId[i]=o;e.entityId=i;var s=function(t){this.comment=this.reinitComment({id:[i,0],text:t});this.comment.text=t;this.handler.init(this.comment)}.bind(this);s(n(i))}},writing:function(e){t.onCustomEvent(window,"OnUCUserIsWriting",[e["id"][0],e["id"][1],this.jsCommentId])},reinitComment:function(t){var e=[t["id"][0],0],i=t["text"]||"";r.removeInstance(t);return this.initComment(e,i,[])},initComment(e,i,n){var o=r.getInstance(e,i,n);if(o["bound"]!=="Y"){t.addCustomEvent(o,"onCancel",this.submitClear.bind(this));t.addCustomEvent(o,"onStart",this.submitStart.bind(this));t.addCustomEvent(o,"onSubmit",this.submit.bind(this));t.addCustomEvent(o,"onError",function(t,e){this.showError(o,e);this.submitClear(o)}.bind(this));o["bound"]="Y"}return o},show(i,n,o){this.comment=this.initComment(i,n,o);this.jsCommentId=t.util.getRandomString(20);t.onCustomEvent(this.handler,"OnUCFormBeforeShow",[this,n,o]);e.entityId=i[0];this.handler.show(this.comment,!!o);t.onCustomEvent(this.handler,"OnUCFormAfterShow",[this,n,o]);return true},submitClear(i){r.removeInstance(i);this.jsCommentId=t.util.getRandomString(20);if(this.comment==i){this.comment=this.initComment([i.id[0],0],"",[]);e.entityId=i.id[0];this.handler.init(this.comment,{clear:true})}},submitStart(e,i,n){t.onCustomEvent(window,"OnUCFormBeforeSubmit",[e.id[0],e.id[1],e,this,i,n])},submit(i,n=null){var o=i.getText(),r=i.attachments,a=this.entitiesId[i.id[0]],d=this.handler.getForm({ENTITY_XML_ID:i.id[0],REVIEW_TEXT:o,NOREDIRECT:"Y",MODE:"RECORD",AJAX_POST:"Y",id:i.id,sessid:t.bitrix_sessid(),SITE_ID:t.message("SITE_ID"),LANGUAGE_ID:t.message("LANGUAGE_ID")}),m=new window.MobileAjaxWrapper,l=new window.FormData,h;if(i.id[1]>0){d["REVIEW_ACTION"]="EDIT";d["FILTER"]={ID:i.id[1]};d["ACTION"]="EDIT";d["ID"]=i.id[1];if(d["act"]){d["act"]="edit";d["edit_id"]=i.id[1]}}if(a["fields"]){for(h in a["fields"]){if(a["fields"].hasOwnProperty(h)){d[h]=a["fields"][h]}}}t.onCustomEvent(window,"OnUCFormSubmit",[i.id[0],i.id[1],this,d]);for(h in d){if(d.hasOwnProperty(h)){s(l,h,d[h])}}if(r){for(var u=0;u<r.length;u++){s(l,r[u]["fieldName"],r[u]["fieldValue"])}}var c=a.url;c=t.util.add_url_param(c,{b24statAction:i.id[1]>0?"editComment":"addComment",b24statContext:"mobile"});let p=null;const f=e=>{if(t.UI.Analytics){t.UI.Analytics.sendData(e)}else{t.Runtime.loadExtension("ui.analytics").then((()=>{t.UI.Analytics.sendData(e)}))}};m.Wrap({method:"POST",url:c,data:{},formData:l,type:"json",processData:true,start:false,preparePost:false,callback:t.proxy((function(o){t.onCustomEvent(window,"OnUCFormResponse",[i.id[0],i.id[1],this,o,i]);if(o.errorMessage){this.showError(i,o.errorMessage);p="error"}else{if(o.warningCode&&o.warningCode==="COMMENT_DUPLICATED"){var s=e.list[o.messageId[0]].getCommentNode(o.messageId[1]);if(s){this.showError(i,o.warningMessage)}else{t.onCustomEvent(window,"OnUCAfterRecordAdd",[i.id[0],o,i])}}else{t.onCustomEvent(window,"OnUCAfterRecordAdd",[i.id[0],o,i])}p="success"}if(n){f({...n,status:p})}}),this),callback_failure:t.delegate((function(e){this.showError(i,t.message("INCORRECT_SERVER_RESPONSE_2"));t.onCustomEvent(window,"OnUCFormResponse",[i.id[0],i.id[1],this,e,i]);if(n){f({...n,status:"error"})}}),this)});m.xhr.send(l);this.submitClear(i)},showError(e,i){if(t.type.isArray(e))e=this.initComment(e,"",[]);if(e&&e.node){e.node.classList.add("feed-com-block-cover-undelivered");var n=e.node.querySelector(".post-comment-error-text");if(n){n.innerHTML=i}var o=typeof e.attachments=="undefined"||e.attachments.length<=0;if(!o&&t.type.isArray(e.attachments)){o=true;for(var s=0;s<e.attachments.length;s++){if(t.type.isNotEmptyString(e.attachments[s].fieldValue)||t.type.isNotEmptyString(e.attachments[s].url)){o=false;break}}}if(o){t.bind(e.node,"click",t.proxy((function(i){t.unbindAll(e.node);e.node.classList.remove("feed-com-block-cover-undelivered");this.handler.comment=e;this.handler.simpleForm.handleAppData(e.text,true)}),this))}}},showNote:function(t,e){},showWait:function(){this.handler.hide();this.handler.showWait()},closeWait:function(){this.handler.closeWait()}};a.link=function(t,i){var n=i["id"];e["form"][n]=e["form"][n]||new a(n);e["form"][n].linkEntity(t,i)};window.mobileShowActions=function(e,i,n){n=n||window.event;var s=window.app.enableInVersion(14)&&window.platform=="ios"?window.BXMobileAppContext.isKeyboardShown():o.keyBoardIsShown;if(s){return true}if(n&&n.target&&n.target.tagName&&(n.target.tagName.toUpperCase()==="A"||n.target.tagName.toUpperCase()==="VIDEO"||n.target.tagName.toUpperCase()==="IMG"&&t.type.isNotEmptyString(n.target.getAttribute("data-bx-image")))){return true}t.eventCancelBubble(n);n.preventDefault();var r=t(["record",e,i].join("-")),a=[],d;t.MPL.addMenuItems(a,r,e,i);if(a.length>0){d=new window.BXMobileApp.UI.ActionSheet({buttons:a},"commentSheet");d.show()}return false};window.mobileReply=function(i,n){t.eventCancelBubble(n);n.preventDefault();e["list"][i].reply(n.target);return false};window.mobileExpand=function(e,i){t.eventCancelBubble(i);i.preventDefault();var n=t(e)?t.findChild(e.previousSibling,{className:"post-comment-text"},true):null;if(t(n)){var o=n.parentNode,s=200,r=parseInt(n.offsetHeight),a={height:s},d={height:r};t.remove(e);var m=(r-s)/(2e3-s);m=m<.3?.3:m>.8?.8:m;o.style.maxHeight=a.height+"px";o.style.overflow="hidden";new t["easing"]({duration:m*1e3,start:a,finish:d,transition:t.easing.makeEaseOut(t.easing.transitions.quart),step:function(t){o.style.maxHeight=t.height+"px";o.style.opacity=t.opacity/100},complete:function(){o.style.cssText="";o.style.maxHeight="none";t.onCustomEvent(window,"OnUCRecordWasExpanded",[o]);t.LazyLoad.showImages(true)}}).animate()}return false};window.mobileIOSVersion=function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var t=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3]||0,10)]}else{return false}};var d=function(){t.MPL=function(i,n,o){t.MPL.superclass.constructor.apply(this,arguments);this.thumb=t.message("MPL_RECORD_THUMB");this.scope="mobile";t.removeCustomEvent(window,"OnUCFormBeforeShow",this.windowEvents["OnUCFormBeforeShow"]);t.removeCustomEvent(window,"OnUCFormAfterShow",this.windowEvents["OnUCFormAfterShow"]);t.removeCustomEvent(window,"OnUCFormAfterHide",this.windowEvents["OnUCFormAfterHide"]);t.removeCustomEvent(window,"OnUCFormBeforeHide",this.windowEvents["OnUCFormBeforeHide"]);this.windowEvents["OnUCFormBeforeSubmit"]=function(e,i,n,o,s,r){if(this.ENTITY_XML_ID===e){this.makeThumb([e,i>0?i:t.util.getRandomString(6)],n,s,r)}}.bind(this);t.addCustomEvent(window,"OnUCFormBeforeSubmit",this.windowEvents["OnUCFormBeforeSubmit"]);t.removeCustomEvent(window,"OnUCFormResponse",this.windowEvents["OnUCFormResponse"]);this.windowEvents["OnUCFormResponse"]=t.delegate((function(t,e,i,n,o){if(this.ENTITY_XML_ID===t){this.clearThumb(o)}}),this);t.addCustomEvent(window,"OnUCFormResponse",this.windowEvents["OnUCFormResponse"]);t.removeCustomEvent(window,"OnUCAfterRecordAdd",this.windowEvents["OnUCAfterRecordAdd"]);this.windowEvents["OnUCAfterRecordAdd"]=function(e,i,n){if(this.ENTITY_XML_ID===e){if(n&&t(n.node)){n["node"].setAttribute("id","record-"+i["messageId"].join("-")+"-cover")}this.add(i["messageId"],i,true,"simple")}}.bind(this);t.addCustomEvent(window,"OnUCAfterRecordAdd",this.windowEvents["OnUCAfterRecordAdd"]);if(n["SHOW_POST_FORM"]=="Y"){a.link(this.ENTITY_XML_ID,o)}e["list"][this.ENTITY_XML_ID]=this;return this};t.extend(t.MPL,window["FCList"]);t.MPL.prototype.init=function(){};t.MPL.prototype.url["activity"]=t.message("SITE_DIR")+"mobile/?mobile_action=comment_activity";t.MPL.prototype.makeThumb=function(e,i,n,s){var r=i.node||t("record-"+e.join("-")+"-cover");if(!r){var a=t.type.isString(n)?n:"";a=t.util.htmlspecialchars(a).replace(/\n/gi,"<br />");a=a.replace(/\001/,"").replace(/(\[\/user\])/gi,"\x01").replace(/\[user=(\d+)\]([^\001].+?)(\001)/gi,"$2").replace(/\001/,"[/user]");var d=window.fcParseTemplate({messageFields:{FULL_ID:e,POST_MESSAGE_TEXT:a,POST_TIMESTAMP:(new Date).getTime()/1e3}},{DATE_TIME_FORMAT:this.params.DATE_TIME_FORMAT,RIGHTS:this.rights},this.thumb),m;m=t.processHTML(d,false);r=t.create("DIV",{attrs:{id:`record-${e.join("-")}-cover`,className:"feed-com-block-cover post-comment-active-progress","bx-mpl-xml-id":this.getXmlId(),"bx-mpl-entity-id":e[1],"bx-mpl-read-status":"old"},style:{opacity:0,height:0,overflow:"hidden"},html:m.HTML});this.node.newComments.appendChild(r);var l=r,h=t.pos(l),u=h.top,c=t.GetWindowInnerSize(),p=false,f=0,w=window.mobileIOSVersion();if(window.platform=="ios"&&t.type.isArray(w)){w=w[0];p=w>=11&&o.keyBoardIsShown;f=260}if(!p||u>c.innerHeight-f){window.scrollTo(0,u-f)}new t["easing"]({duration:500,start:{opacity:0,height:0},finish:{opacity:100,height:l.scrollHeight},transition:t.easing.makeEaseInOut(t.easing.transitions.quad),step:function(t){l.style.height=t.height+"px";l.style.opacity=t.opacity/100;if(!p||u+t.height>c.innerHeight-f){window.scrollTo(0,u+t.height-f)}},complete:function(){if(l.style.display!=="none"){l.style.cssText=""}}}).animate();var E=0,g=function(){E++;if(E<100){var i=t("record-"+e.join("-")+"-cover");if(i&&i.childNodes.length>0)t.ajax.processScripts(m.SCRIPT);else t.defer(g,this)()}};t.defer(g,this)()}t.addClass(r,"post-comment-active-progress");i.node=r;return r};t.MPL.prototype.clearThumb=function(e){if(e&&t(e.node)){t.removeClass(e.node,"post-comment-active-progress")}};t.MPL.prototype.add=function(e,i){t.MPL.superclass.add.apply(this,[e,i]);if(window["BitrixMobile"]&&window["BitrixMobile"]["LazyLoad"])setTimeout((function(){window.BitrixMobile.LazyLoad.showImages()}),500)};t.MPL.prototype.markCommentAsRead=function(e){if(!this.unreadComments.has(e)){return}var i=this.unreadComments.get(e);var n=t.findChild(i,{attrs:{id:["record",this.getXmlId(),e].join("-")}},true,false);if(n){t.removeClass(n,"post-comment-block-new");t.addClass(n,"post-comment-block-old")}t.MPL.superclass.markCommentAsRead.apply(this,[e])};t.MPL.prototype.sendPagenavigation=function(){if(t(this.node.navigation)){var e=this.node.navigationLoader;if(e){t.adjust(this.node.navigationLoader,{style:{display:"flex"}})}}t.MPL.superclass.sendPagenavigation.apply(this,arguments)};t.MPL.prototype.buildPagenavigation=function(){if(window["BitrixMobile"]&&window["BitrixMobile"]["LazyLoad"])setTimeout((function(){window.BitrixMobile.LazyLoad.showImages()}),1e3);t.MPL.superclass.buildPagenavigation.apply(this,arguments)};t.MPL.prototype.completePagenavigation=function(){t.MPL.superclass.completePagenavigation.apply(this,arguments)};t.MPL.prototype.showWait=function(e){var i=t("record-"+this.ENTITY_XML_ID+"-"+e+"-cover");if(e>0&&i)t.addClass(i,"post-comment-active-progress")};t.MPL.prototype.closeWait=function(e){var i=t("record-"+this.ENTITY_XML_ID+"-"+e+"-cover");if(e>0&&i)t.removeClass(i,"post-comment-active-progress")};t.MPL.prototype.showError=function(t,e){};t.MPL.createInstance=function(e,i,n){return new t.MPL(e,i,n)};t.MPL.getInstance=function(t){return e["list"][t]};t.MPL.addMenuItems=function(i,n,o,s){if(!t.type.isArray(i)||!t.type.isDomNode(n)){return}if(n.getAttribute("bx-mpl-menu-show")==="N"){return}if(n.getAttribute("bx-mpl-reply-show")==="Y"){i.push({title:t.message("BLOG_C_REPLY"),callback(){e.list[o].reply(t(["record",o,s,"reply-action"].join("-")))}})}var r;if(n.getAttribute("bx-mpl-vote-id")!=="#VOTE_ID#"&&window.RatingLikeComments&&(r=window.RatingLikeComments.getById(n.getAttribute("bx-mpl-vote-id")))&&r){r.__delegatedVoteFunc=r.__delegatedVoteFunc||t.delegate(r.vote,r);i.push({title:r.voted?t.message("BPC_MES_VOTE2"):t.message("BPC_MES_VOTE1"),callback:r.__delegatedVoteFunc});i.push({title:t.message("BPC_MES_VOTE"),callback(){window.RatingLikeComments.List(n.getAttribute("bx-mpl-vote-id"))}})}if(n.getAttribute("bx-mpl-edit-show")==="Y"){i.push({title:t.message("BPC_MES_EDIT"),callback(){e.list[o].act(n.getAttribute("bx-mpl-edit-url"),s,"EDIT")}})}if(n.getAttribute("bx-mpl-moderate-show")==="Y"){var a=n.getAttribute("bx-mpl-moderate-approved")==="hidden";i.push({title:a?t.message("BPC_MES_SHOW"):t.message("BPC_MES_HIDE"),callback(){var i=n.getAttribute("bx-mpl-moderate-url").replace("#action#",a?"show":"hide").replace("#ACTION#",a?"SHOW":"HIDE");if(t.type.isNotEmptyString(i)){i=t.util.add_url_param(i,{b24statAction:a?"showComment":"hideComment",b24statContext:"mobile"})}e.list[o].act(i,s,a?"SHOW":"HIDE")}})}if(n.getAttribute("bx-mpl-delete-show")==="Y"){i.push({title:t.message("BPC_MES_DELETE"),callback(){e.list[o].act(n.getAttribute("bx-mpl-delete-url"),s,"DELETE")}})}var d=n.getAttribute("bx-mpl-comment-entity-type"),m=n.getAttribute("bx-mpl-post-entity-type");if(n.getAttribute("bx-mpl-createtask-show")==="Y"&&typeof oMSL!=="undefined"){i.push({title:t.message("BPC_MES_CREATETASK"),callback:function(){oMSL.createTask({postEntityType:t.type.isNotEmptyString(m)?m:"BLOG_POST",entityType:t.type.isNotEmptyString(d)?d:"BLOG_COMMENT",entityId:s})}})}if(typeof oMSL!=="undefined"&&t.type.isFunction(oMSL.copyLink)){i.push({title:t.message("BPC_MES_COPYLINK"),callback(){oMSL.copyLink({postEntityType:t.type.isNotEmptyString(m)?m:"BLOG_POST",entityType:t.type.isNotEmptyString(d)?d:"BLOG_COMMENT",entityId:s})}})}if(n.getAttribute("bx-mpl-edit-show")==="Y"&&t.Tasks&&t.Tasks.ResultAction&&o.indexOf("TASK_")===0&&t.Tasks.ResultAction.getInstance().canCreateResult(+/\d+/.exec(o))){var l=+/\d+/.exec(o);var h=t.Tasks.ResultManager.getInstance().getResult(l);if(h&&h.context==="task"&&h.canSetAsResult&&h.canSetAsResult(s)){i.push({title:t.message("BPC_MES_RESULT_V2"),callback(){t.Tasks.ResultAction.getInstance().createFromComment(s,true)}})}}};t.MPL.getMenuItems=function(e){var i=e.getData(),n=i.menuItems,s=i.targetNode,r=window.app.enableInVersion(14)&&window.platform==="ios"?window.BXMobileAppContext.isKeyboardShown():o.keyBoardIsShown;if(r){return}if(!t.type.isDomNode(s)||!t.type.isArray(n)){return}if(s.tagName&&(s.tagName.toUpperCase()==="A"||s.tagName.toUpperCase()==="IMG"&&t.type.isNotEmptyString(s.getAttribute("data-bx-image")))){return}var a=s.classList.contains("post-comment-block")?s:t.findParent(s,{className:"post-comment-block"});if(!a){return}var d=a.getAttribute("bx-mpl-entity-xml-id"),m=parseInt(a.getAttribute("bx-mpl-comment-id"),10);if(!t.type.isNotEmptyString(d)||m<=0){return}t.MPL.addMenuItems(n,a,d,m)};t.Event.EventEmitter.subscribe("BX.MPL:onGetMenuItems",t.MPL.getMenuItems);t.addCustomEvent(window,"OnUCHasBeenDestroyed",(t=>{delete e.list[t]}));t.onCustomEvent("main.post.list/mobile",["script.js"]);t.removeCustomEvent("main.post.list/default",d)};t.addCustomEvent("main.post.list/default",d);if(window.FCList){d()}BXMobileApp.addCustomEvent(window,"onPull-unicomments",(i=>{var n=i.params;var o=i.command;if(n.AUX&&!t.util.in_array(n.AUX,["createtask","fileversion","TASKINFO"])||e.list[n.ENTITY_XML_ID]<=0){return}if(o==="comment_mobile"){if(n.NEED_REQUEST==="Y"){}else if(n.ACTION==="DELETE"){t.onCustomEvent(window,"OnUCommentWasDeleted",[n.ENTITY_XML_ID,[n.ENTITY_XML_ID,n.ID],n]);t.onCustomEvent(window,"OnUCFeedChanged",[n.ID])}else if(n.ACTION==="HIDE"){t.onCustomEvent(window,"OnUCommentWasHidden",[n.ENTITY_XML_ID,[n.ENTITY_XML_ID,n.ID],n]);t.onCustomEvent(window,"OnUCFeedChanged",[n.ID])}else{if(n.ACTION==="REPLY")n.NEW=!n.AUTHOR||n.AUTHOR.ID!=t.message("USER_ID")?"Y":"N";t.onCustomEvent(window,"OnUCCommentWasPulled",[[n.ENTITY_XML_ID,n.ID],{messageFields:n},n])}}else if(o==="answer"&&Number(n.USER_ID)!==Number(t.message("USER_ID"))){t.onCustomEvent(window,"OnUCUsersAreWriting",[n.ENTITY_XML_ID,n.USER_ID,n.NAME,n.AVATAR])}}))})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?172873318560094";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.list/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.list/templates/.default/script.map.js";}"*/
(function(){window["UC"]=window["UC"]||{};if(window["FCList"]){return}var quoteData=null,repo={listById:new Map,listByXmlId:new Map};window.FCList=function(t,e){this.exemplarId=t["EXEMPLAR_ID"];this.ENTITY_XML_ID=t["ENTITY_XML_ID"];this.template=t["template"];this.scope="web";this.node={main:t["mainNode"],navigation:t["navigationNode"],navigationLoader:t["navigationNodeLoader"],history:t["nodeForOldMessages"],newComments:t["nodeForNewMessages"],formHolder:t["nodeFormHolder"],writersBlock:BX.findChild(t["nodeFormHolder"],{attrs:{id:["record",this.getXmlId(),"writers-block"].join("-")}},true),writers:BX.findChild(t["nodeFormHolder"],{attrs:{id:["record",this.getXmlId(),"writers"].join("-")}},true)};this.ajax=t["ajax"]||null;this.eventNode=this.node.main;this.form=BX.type.isNotEmptyString(t["FORM_ID"])?UCForm.bindFormToEntity(t["FORM_ID"],this):null;this.order=t["order"];this.mid=parseInt(t["mid"]);this.operationIds=[];this.canCheckVisibleComments=true;this.status="ready";this.msg=this.node.navigation?this.node.navigation.innerHTML:"";this.params=e||{};this.rights=t["rights"];this.DATE_TIME_FORMAT=this.params["DATE_TIME_FORMAT"]||null;this.unreadComments=new Map;this.comments=new Map;this.blankComments=new Map;this.blankCommentsForAjax=new Map;this.bindEvents=[];this.registerNewComment=this.registerNewComment.bind(this);this.registerBlankComment=this.registerBlankComment.bind(this);this.privateEvents={onShowActions:function(t,e){fcShowActions(this.node.main,e,t)}.bind(this),OnUCCommentIsInDOM:this.registerNewComment,OnUCBlankCommentIsInDOM:this.registerBlankComment,onExpandComment:fcCommentExpand};this.windowEvents={OnUCCommentWasPulled:function(t,e,i){if(this.getXmlId()!==i["ENTITY_XML_ID"]||this.isOwnOperationId(i["OPERATION_ID"])){return}this.setOperationId(i["OPERATION_ID"]);this.add(t,e,null,null,{live:true});if(this.params["NOTIFY_TAG"]&&this.params["NOTIFY_TEXT"]){window["UC"]["Informer"].check(t,e,this.params["NOTIFY_TAG"],this.params["NOTIFY_TEXT"])}}.bind(this),OnUCommentWasDeleted:function(t,e,i){if(this.getXmlId()!==i["ENTITY_XML_ID"]||this.isOwnOperationId(i["OPERATION_ID"])||!this.getCommentNode(e[1])){return}this.setOperationId(i["OPERATION_ID"]);BX.hide(this.getCommentNode(e[1]));this.comments.delete(e[1])}.bind(this),OnUCommentWasHidden:function(t,e,i){if(this.getXmlId()!==i["ENTITY_XML_ID"]||this.isOwnOperationId(i["OPERATION_ID"])||!this.getCommentNode(e[1])){return}this.setOperationId(i["OPERATION_ID"]);if(this.rights["MODERATE"]==="Y"||this.rights["MODERATE"]==="ALL"||Number(i["USER_ID"])===Number(BX.message("USER_ID"))){var n=BX.findChild(this.getCommentNode(e[1]),{tagName:"DIV",className:"feed-com-block"});if(BX(n)){BX.addClass(n,"feed-com-block-hidden");BX.removeClass(n,"feed-com-block-approved")}}else{BX.hide(this.getCommentNode(e[1]))}}.bind(this),OnUCUserIsWriting:function(e,i){if(i.sent===true){return}if(this.form!==null&&this!==e){return}if(this.form===null&&e!==this.ENTITY_XML_ID){return}i.sent=true;BX.ajax({url:this.url.activity,method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,COMMENT_EXEMPLAR_ID:this.exemplarId,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),sign:t["sign"],PATH_TO_USER:this.params["PATH_TO_USER"],AVATAR_SIZE:this.params["AVATAR_SIZE"],NAME_TEMPLATE:this.params["NAME_TEMPLATE"],SHOW_LOGIN:this.params["SHOW_LOGIN"]}})}.bind(this),OnUCAfterRecordAdd:function(t,e){if(this.ENTITY_XML_ID===e["messageId"][0]){this.add(e["messageId"],e,true,"simple")}}.bind(this),OnUCFormSubmit:BX.delegate((function(t,e,i,n){if(!i||this.form===null&&t!==this.getXmlId()||this.form!==null&&i.currentEntity!==this){return}n["EXEMPLAR_ID"]=this.exemplarId;n["OPERATION_ID"]=this.getOperationId()}),this),OnUCFormResponse:function(t,e,i){},OnUCFormBeforeShow:function(t){var e=0;if(this.form===null&&t.id[0]===this.getXmlId()){e=t.id[1]}else if(this.form!==null&&t.currentEntity===this){e=t.currentEntity.messageId}else{return}if(e<=0){BX.addClass(this.node.formHolder,"feed-com-add-box-outer-form-shown")}if(BX(this.node.writersBlock)){var i=BX("lhe_buttons_"+t.form.id);if(!i||i.style.display==="none"){i=t.form}if(!this.node.writersBlockPointer){this.node.writersBlockPointer=BX.create("DIV",{style:{display:"none"}});this.node.writersBlock.parentNode.insertBefore(this.node.writersBlockPointer,this.node.writersBlock)}i.appendChild(this.node.writersBlock)}}.bind(this),OnUCFormAfterShow:function(t){if(t.id[0]!==this.getXmlId()){return}var e=BX.findParent(this.node.main,{className:"feed-comments-block"});if(e){BX.addClass(e,"feed-comments-block-editor-shown")}}.bind(this),OnUCFormBeforeHide:function(t){if(this.form===null&&(!t.id||t.id[0]!==this.getXmlId())||this.form!==null&&t.currentEntity!==this){return}var e=BX.findParent(this.node.main,{className:"feed-comments-block"});if(e){BX.removeClass(e,"feed-comments-block-editor-shown")}}.bind(this),OnUCFormAfterHide:function(t){if(this.form===null&&(!t.id||t.id[0]!==this.getXmlId())||this.form!==null&&t.currentEntity!==this){return}BX.removeClass(this.node.formHolder,"feed-com-add-box-outer-form-shown");BX.focus(this.node.formHolder.firstChild);if(this.node.writersBlock&&this.node.writersBlockPointer){this.node.writersBlockPointer.parentNode.insertBefore(this.node.writersBlock,this.node.writersBlockPointer)}}.bind(this),OnUCUsersAreWriting:function(t,e,i,n,s){if(this.getXmlId()===t){this.addWriter(e,i,n,s)}}.bind(this),OnUCCommentRecalculate:function(t){if(this.getXmlId()!==t){return}var e;var i=BX.findChild(this.node.main,{attrs:{"bx-mpl-xml-id":this.ENTITY_XML_ID}},false,true);for(e=0;e<i.length;e++){this.recalcMoreButtonComment(i[e].getAttribute("bx-mpl-entity-id"))}}.bind(this),"BX.BXUrlPreview.onImageLoaded":function(t){if(!BX.type.isPlainObject(t)||!BX.type.isDomNode(t.imageNode)){return}var e=BX.findParent(t.imageNode,{className:"feed-com-block-cover"});if(BX.type.isDomNode(e)){this.recalcMoreButtonComment(e.getAttribute("bx-mpl-entity-id"))}}.bind(this)};if(this.params["NOTIFY_TAG"]&&this.params["NOTIFY_TEXT"]&&window["UC"]["Informer"]){window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]=window["UC"]["InformerTags"][this.params["NOTIFY_TAG"]]||[]}else{this.params["NOTIFY_TAG"]=null;this.params["NOTIFY_TEXT"]=null}this.initialize();this.checkHash();this.registerComments();BX.onCustomEvent(this.eventNode,"OnUCInitialized",[this.exemplarId]);BX.addCustomEvent(this.eventNode,"OnUCInitialized",this.destroy.bind(this));this.windowEvents["OnUCInitialized"]=this.checkAndDestroy.bind(this);BX.Event.EventEmitter.incrementMaxListeners("OnUCInitialized");BX.addCustomEvent(window,"OnUCInitialized",this.windowEvents["OnUCInitialized"]);BX.ready(function(){setTimeout(function(){BX.onCustomEvent(window,"OnUCHasBeenInitialized",[this.ENTITY_XML_ID,this])}.bind(this),100)}.bind(this));repo.listById.set(this.exemplarId,this);repo.listByXmlId.set(this.getXmlId(),this);return this};window.FCList.prototype={getId:function(){return this.exemplarId},getXmlId:function(){return this.ENTITY_XML_ID},getOperationId:function(){var t=BX.util.getRandomString(20);this.operationIds.push(t);return t},setOperationId:function(t){if(BX.type.isNotEmptyString(t)){this.operationIds.push(t)}},isOwnOperationId:function(t){for(var e=0;e<this.operationIds.length;e++){if(this.operationIds[e]===t){return true}}return false},initialize:function(){this.checkVisibleComments=this.checkVisibleComments.bind(this);this.recalcMoreButtonComment=this.recalcMoreButtonComment.bind(this);this.sendCommentAsBlank=this.sendCommentAsBlank.bind(this);BX.Event.EventEmitter.incrementMaxListeners(scrSpy,"onRead");BX.addCustomEvent(scrSpy,"onRead",this.checkVisibleComments);scrSpy.watchNode(this.node.main);this.initNavigationEvents();this.initPostFormActivity();for(var t=0;t<this.bindEvents.length;t++){BX.bind(this.bindEvents[t][0],this.bindEvents[t][1],this.bindEvents[t][2])}for(t in this.privateEvents){if(this.privateEvents.hasOwnProperty(t)){BX.Event.EventEmitter.incrementMaxListeners(this.eventNode,t);BX.addCustomEvent(this.eventNode,t,this.privateEvents[t])}}if(!BX.type.isBoolean(this.params["USE_LIVE"])||this.params["USE_LIVE"]){for(t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.Event.EventEmitter.incrementMaxListeners(t);BX.addCustomEvent(window,t,this.windowEvents[t])}}}if(BX.DD&&!this.node.main.hasAttribute("dropzone")){new BX.DD.dropFiles(this.node.main)}},initNavigationEvents:function(){if(!BX(this.node.navigation)){return}this.bindEvents.unshift([this.node.navigation,"click",function(t){BX.eventCancelBubble(t);t.preventDefault();this.getPagenavigation();return false}.bind(this)])},initPostFormActivity:function(){this.privateEvents["onAct"]=this.act.bind(this);if(this.params["SHOW_POST_FORM"]!=="Y"){return}this.privateEvents["onReply"]=this.reply.bind(this);this.privateEvents["onQuote"]=this.quote.bind(this);this.hideWriter=this.hideWriter.bind(this);this.quoteShow=this.quoteShow.bind(this);this.bindEvents.unshift([this.eventNode,"mouseup",this.privateEvents["onQuote"]]);var t=0;var e=function(e){if(e&&e.currentTarget.contains(e.relatedTarget)){return}if(t>0){clearTimeout(t);t=0}}.bind(this);var i=function(){e();this.reply.apply(this,arguments)}.bind(this);var n=function(){if(t<=0){t=setTimeout(i,200)}}.bind(this);this.bindEvents.unshift([this.node.main,"dragover",n]);this.bindEvents.unshift([this.node.main,"dragenter",n]);this.bindEvents.unshift([this.node.main,"dragleave",e]);this.bindEvents.unshift([this.node.main,"dragexit",e]);this.bindEvents.unshift([this.node.main,"drop",e])},url:{activity:"/bitrix/components/bitrix/main.post.list/activity.php"},destroy:function(){BX.removeCustomEvent(scrSpy,"onRead",this.checkVisibleComments);var t,e;while((e=this.bindEvents.pop())&&e){BX.unbindAll(e[0]);delete e[0];delete e[2]}for(t in this.privateEvents){if(this.privateEvents.hasOwnProperty(t)){BX.removeCustomEvent(this.eventNode,t,this.privateEvents[t]);BX.Event.EventEmitter.decrementMaxListeners(this.eventNode,t);this.privateEvents[t]=null}}this.privateEvents=null;for(t in this.windowEvents){if(this.windowEvents.hasOwnProperty(t)){BX.removeCustomEvent(window,t,this.windowEvents[t]);this.windowEvents[t]=null;BX.Event.EventEmitter.decrementMaxListeners(t)}}this.windowEvents=null;for(t in this.node){if(this.node.hasOwnProperty(t)){this.node[t]=null}}this.unreadComments.clear();this.comments.clear();BX.onCustomEvent(window,"OnUCHasBeenDestroyed",[this.ENTITY_XML_ID,this]);repo.listById.delete(this.exemplarId);if(repo.listByXmlId.get(this.ENTITY_XML_ID)===this){repo.listByXmlId.delete(this.ENTITY_XML_ID)}},checkAndDestroy:function(t){if(this.exemplarId===t||!document.body.contains(this.eventNode)){this.destroy()}},quotePopup:null,quoteCheck:function(){var t="";var e;var i=null;if(window.getSelection){e=window.getSelection();t=e.toString()}else if(document.selection){e=document.selection;t=e.createRange().text}if(t!==""){var n=BX.findParent(e.focusNode,{tagName:"DIV",className:"feed-com-block-cover"},this.node.main);var s=BX.findParent(e.anchorNode,{tagName:"DIV",className:"feed-com-block-cover"},this.node.main);if(n!==s||BX(n)&&!n.hasAttribute("id")){t=""}else if(BX(n)){var o=BX(n.getAttribute("id").replace(/\-cover$/,"-actions-reply"));if(o){i={id:parseInt(o.getAttribute("bx-mpl-author-id")),name:o.getAttribute("bx-mpl-author-name"),gender:o.getAttribute("bx-mpl-author-gender")}}}}if(t===""){if(this.quotePopup){this.quotePopup.hide()}return false}return{text:t,author:i}},quoteShow:function(t,e){e=e||this.quoteCheck()||{};if(!BX.type.isNotEmptyString(e["text"])){return}quoteData=e;if(this.quotePopup==null){this.__quoteShowClick=function(){if(this.form){BX.onCustomEvent(this.form,"onQuote",[this,e["author"],e["text"]])}else{BX.onCustomEvent(window,"OnUCQuote",[this.ENTITY_XML_ID,e["author"],e["text"],true])}}.bind(this);this.__quoteShowHide=function(){quoteData=null;BX.removeCustomEvent(this.quotePopup,"onQuote",this.__quoteShowClick);BX.removeCustomEvent(this.quotePopup,"onHide",this.__quoteShowHide);this.quotePopup=null}.bind(this);this.quotePopup=new MPLQuote;BX.addCustomEvent(this.quotePopup,"onQuote",this.__quoteShowClick);BX.addCustomEvent(this.quotePopup,"onHide",this.__quoteShowHide)}this.quotePopup.show(t,e)},displayPagenavigation:function(t,e){var i;var n=0;var s;var o=this.node.history;t=t=="hide"?"hide":"show";if(t=="hide"){i=parseInt(this.node.history.offsetHeight);s=i/2e3;s=s<.3?.3:s>.5?.5:s;o.style.overflow="hidden";new BX["easing"]({duration:s*1e3,start:{height:i,opacity:100},finish:{height:n,opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){o.style.maxHeight=t.height+"px";o.style.opacity=t.opacity/100},complete:BX.proxy((function(){o.style.cssText="";o.style.display="none";BX.onCustomEvent(this,"OnUCListWasHidden",[this,[],o])}),this)}).animate()}else{i=parseInt(e||20);o.style.display="block";o.style.overflow="hidden";o.style.maxHeight=i;n=parseInt(this.node.history.offsetHeight);s=(n-i)/(2e3-i);s=s<.3?.3:s>.8?.8:s;new BX["easing"]({duration:s*1e3,start:{height:i,opacity:i>0?100:0},finish:{height:n,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){o.style.maxHeight=t.height+"px";o.style.opacity=t.opacity/100},complete:BX.proxy((function(){o.style.cssText="";o.style.maxHeight="none";BX.onCustomEvent(this,"OnUCListWasShown",[this,[],o])}),this)}).animate()}},getPagenavigation:function(){if(this.status=="done"){if(this.node.navigation.getAttribute("bx-visibility-status")=="visible"){this.displayPagenavigation("hide");BX.adjust(this.node.navigation,{attrs:{"bx-visibility-status":"none"},html:this.msg})}else{this.displayPagenavigation("show");BX.adjust(this.node.navigation,{attrs:{"bx-visibility-status":"visible"},html:BX.message("BLOG_C_HIDE")})}}else if(this.status=="ready"){this.sendPagenavigation()}return false},sendPagenavigation:function(){this.status="busy";BX.addClass(this.node.navigation,"feed-com-all-hover");var t={AJAX_POST:"Y",ENTITY_XML_ID:this.ENTITY_XML_ID,EXEMPLAR_ID:this.exemplarId,MODE:"LIST",FILTER:this.order=="ASC"?{">ID":this.mid}:{"<ID":this.mid},sessid:BX.bitrix_sessid()},e=BX.util.htmlspecialcharsback(this.node.navigation.getAttribute("href"));e=e.indexOf("#")!==-1?e.substr(0,e.indexOf("#")):e;var i={url:e,data:t};BX.onCustomEvent(this,"OnUCListHasToBeEnlarged",[this,i]);e=i.url;t=i.data;t.scope=this.scope;var n=this.buildPagenavigation.bind(this);var s=this.completePagenavigation.bind(this);if(this.ajax["navigateComment"]===true){e=e.indexOf("?")>=0?e.substr(e.indexOf("?")+1):"";e.split("&").forEach((function(e){var i=e.split("=");t[i[0]]=i[1]}));BX.ajax.runComponentAction(this.ajax.componentName,"navigateComment",{mode:"class",data:t,signedParameters:this.ajax.params}).then(n,s)}else{BX.adjust(this.node.navigationLoader,{style:{display:"flex"}});BX.ajax({url:e+(e.indexOf("?")!==-1?"&":"?")+BX.ajax.prepareData(t),method:"GET",dataType:"json",data:"",onsuccess:n,onfailure:s})}},buildPagenavigation:function(t){if(t["status"]!=="success"){return this.completePagenavigation()}this.status="ready";this.wait("hide");BX.adjust(this.node.navigationLoader,{style:{display:"none"}});BX.removeClass(this.node.navigation,"feed-com-all-hover");var e=BX.processHTML(t["messageList"],false);var i=this.node.history.offsetHeight;var n=BX.create("DIV",{html:e.HTML});if(this.order==="ASC"||!this.node.history.firstChild){this.node.history.appendChild(n)}else{this.node.history.insertBefore(n,this.node.history.firstChild)}BX.onCustomEvent(window,"OnUCFeedChanged",[[this.ENTITY_XML_ID,this.mid]]);this.displayPagenavigation("show",i);if(BX.type.isNotEmptyString(t["navigation"])){var s=BX.create("DIV",{html:t["navigation"]}).firstChild;BX.adjust(this.node.navigation,{attrs:{href:s.getAttribute("href"),"bx-mpl-comments-count":s.getAttribute("bx-mpl-comments-count")},html:s.innerHTML})}else{BX.adjust(this.node.navigation,{attrs:{href:"#","bx-visibility-status":"visible","bx-mpl-comments-count":0},html:BX.message("BLOG_C_HIDE"),events:{click:function(t){BX.eventCancelBubble(t);t.preventDefault();return false}}});this.status="done"}var o=0;var a=function(){o++;if(o>100){return}if(n.childNodes.length<=0){setTimeout(a,500);return}BX.ajax.processScripts(e.SCRIPT);BX.onCustomEvent(this,"OnUCListWasBuilt",[this,t,n])}.bind(this);setTimeout(a,500)},completePagenavigation:function(){this.status="done";BX.removeClass(this.node.navigation,"feed-com-all-hover");this.wait("hide");BX.adjust(this.node.navigationLoader,{style:{display:"none"}})},getCommentsCount:function(){var t=0;if(BX(this.node.navigation)){t=Number(this.node.navigation.getAttribute("bx-mpl-comments-count"))}return this.comments.size+t},wait:function(t){t=t==="show"?"show":"hide";return t},quote:function(t,e){if(t.hasOwnProperty("UCDone")){return}t["UCDone"]=true;setTimeout(this.quoteShow,50,t,e)},reply:function(t){var e={id:undefined,name:undefined};if(BX.type.isElementNode(t)){e.id=t.getAttribute("bx-mpl-author-id");e.name=t.getAttribute("bx-mpl-author-name")}else if(BX.type.isPlainObject(t)){e.id=t.id;e.name=t.name}if(this.form){if(this.form.handler&&this.form.handler.htmlEditor&&this.form.handler.htmlEditor.IsVisible()&&this.form.handler.htmlEditor.GetContent()!==""){return}BX.onCustomEvent(this.form,"onReply",[this,e])}else{var i={caught:false};BX.onCustomEvent(window,"OnUCReply",[this.ENTITY_XML_ID,e.id,e.name,true,i])}},getPlaceholder:function(t){if(!this.node["placeholderFor"+t]||!document.body.contains(this.node["placeholderFor"+t])){this.node["placeholderFor"+t]=BX.findChild(this.node.main,{attrs:{id:["record",this.getXmlId(),t,"placeholder"].join("-")}},true)}return this.node["placeholderFor"+t]},addWriter:function(t,e,i,n){if(!this.node.writersBlock||!this.node.writers){return}t=t>0?t:0;if(t<=0){return}var s=["writer",this.exemplarId,t].join("-");var o=BX(s);var a=setTimeout(this.hideWriter,n>0?n:40500,t);if(o){clearTimeout(o.getAttribute("bx-check-timeout"))}else{o=BX.create("DIV",{attrs:{id:s,className:"feed-com-avatar ui-icon ui-icon-common-user ",title:e},children:[i&&i.length>0?BX.create("I",{style:{background:"url('"+i+"')",backgroundSize:"cover"}}):null]});this.node.writers.appendChild(o)}o.setAttribute("bx-check-timeout",a+"");BX.show(this.node.writersBlock);if(this.objAnswering&&this.objAnswering.name!=="show"){this.objAnswering.stop()}if(!this.objAnswering||this.objAnswering.name!=="show"){this.node.writersBlock.style.display="inline-block";this.objAnswering=new BX["easing"]({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){this.node.writersBlock.style.opacity=t.opacity/100}.bind(this)});this.objAnswering.name="show";this.objAnswering.animate()}},hideWriter:function(t){if(!this.node.writers||!this.node.writersBlock){return}var e=["writer",this.exemplarId,t].join("-");var i=BX(e);if(this.node.writers.childNodes.length>1){new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX["easing"].transitions.quart),step:function(t){if(i)i.style.opacity=t.opacity/100},complete:function(){if(i&&i.parentNode){i.parentNode.removeChild(i)}}.bind(this)}).animate()}else{if(this.objAnswering&&this.objAnswering.name!=="hide"){this.objAnswering.stop()}if(!this.objAnswering||this.objAnswering.name!=="hide"){this.objAnswering=new BX["easing"]({duration:500,start:{opacity:100},finish:{opacity:0},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quart),step:function(t){this.node.writersBlock.style.opacity=t.opacity/100}.bind(this),complete:function(){this.node.writersBlock.style.display="none";if(i&&i.parentNode){i.parentNode.removeChild(i)}}.bind(this)});this.objAnswering.name="hide";this.objAnswering.animate()}}},getCommentNode:function(t){if(!this.node[t]||!document.body.contains(this.node[t])){this.node[t]=BX.findChild(this.node.main,{attrs:{id:["record",this.getXmlId(),t,"cover"].join("-")}},true)}return this.node[t]},add:function(t,e,i,n,s){if(!t||!t[1]||!BX.type.isPlainObject(e)){return false}var o=e["AUTHOR"]||(e["messageFields"]?e["messageFields"]["AUTHOR"]:null);if(o){this.hideWriter(o["ID"])}var a=this.getCommentNode(t[1]);if(!a&&t[1]<this.mid){return false}var r=t.join("-");var d=e.message||window.fcParseTemplate({messageFields:e.messageFields},{EXEMPLAR_ID:this.exemplarId,RIGHTS:this.rights,DATE_TIME_FORMAT:this.DATE_TIME_FORMAT,VIEW_URL:this.params.VIEW_URL,EDIT_URL:this.params.EDIT_URL,MODERATE_URL:this.params.MODERATE_URL,DELETE_URL:this.params.DELETE_URL,AUTHOR_URL:this.params.AUTHOR_URL,AUTHOR_URL_PARAMS:this.params.AUTHOR_URL_PARAMS,NAME_TEMPLATE:this.params.NAME_TEMPLATE,SHOW_LOGIN:this.params.SHOW_LOGIN,CLASSNAME:BX.type.isPlainObject(s)&&s.live?"feed-com-block-live":""},this.getTemplate());var l=BX.processHTML(d,false);var h;var m=this.node.newComments;var c=["MODERATE","EDIT","DELETE"];var u=false;var p=0;for(var E in c){if(c.hasOwnProperty(E)&&this.rights[c[E]]==="OWNLAST"){u=true;break}}if(u){h=m.lastChild&&BX.hasClass(m.lastChild,"feed-com-block-cover")?[m.lastChild]:[];var f;var T;if(this.addCheckPreviousNodes!==true){h=BX.findChildren(this.node.main,{tagName:"DIV",className:"feed-com-block-cover"},false)||[];h.concat(BX.findChildren(m,{tagName:"DIV",className:"feed-com-block-cover"},false)||[]);this.addCheckPreviousNodes=true}while((f=h.pop())&&f){T=BX.findChild(f,{attrs:{id:f.id.replace("-cover","-actions")}},true);if(T){if(this.rights["EDIT"]==="OWNLAST"){T.setAttribute("bx-mpl-edit-show","N")}if(this.rights["MODERATE"]==="OWNLAST"){T.setAttribute("bx-mpl-moderate-show","N")}if(this.rights["DELETE"]==="OWNLAST"){T.setAttribute("bx-mpl-delete-show","N")}}}}var B=false;if(!a){a=BX.create("DIV",{attrs:{id:"record-"+r+"-cover",className:"feed-com-block-cover","bx-mpl-xml-id":this.getXmlId(),"bx-mpl-entity-id":t[1],"bx-mpl-read-status":Number(o["ID"])!==Number(BX.message("USER_ID"))?"new":"old","bx-mpl-block":"main"},style:{opacity:0,height:0,overflow:"hidden",marginBottom:0},html:l.HTML});m.appendChild(a);B=true}else{var X=BX.create("DIV",{attrs:{id:"record-"+r+"-cover",className:"feed-com-block-cover"},style:{display:"none"},html:l.HTML});var I=a;var g=BX.findChild(I,{tag:"div",className:"feed-com-text-inner"},true);var v=g&&g.classList.contains("feed-com-text-inner-expanded");if(v){g=BX.findChild(X,{tag:"div",className:"feed-com-text-inner"},true);if(g){g.classList.add("feed-com-text-inner-expanded")}}a.parentNode.insertBefore(X,a);a.removeAttribute("id");p=a.scrollHeight;BX.hide(a);BX.show(X);a=X;this.node[t[1]]=a;setTimeout((function(){BX.remove(I)}),1e3)}if(n!=="simple"&&BX.Type.isUndefined(window.BXMobileApp)&&!(window.top===window&&BX.getClass("BX.SidePanel.Instance")&&BX.SidePanel.Instance.isOpen())&&!(BX.type.isNotEmptyObject(BXRL)&&BX.type.isNotEmptyObject(BXRL.render)&&BX.type.isDomNode(BXRL.render.reactionsPopup)&&!BXRL.render.reactionsPopup.classList.contains("feed-post-emoji-popup-invisible"))){var A=BX.pos(a);var _=BX.GetWindowScrollPos();var b=BX.GetWindowInnerSize();new BX["easing"]({duration:1e3,start:{opacity:B?0:100,height:p},finish:{opacity:100,height:a.scrollHeight+10},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){a.style.height=t.height+"px";a.style.opacity=t.opacity/100;if(_.scrollTop>0&&A.top<_.scrollTop+b.innerHeight){window.scrollTo(0,_.scrollTop+t.height)}},complete:function(){a.style.cssText="";BX.onCustomEvent(this,"OnUCRecordWasShown",[this.ENTITY_XML_ID,r,a])}.bind(this)}).animate()}else{new BX["easing"]({duration:500,start:{opacity:B?0:100,height:p},finish:{opacity:100,height:a.scrollHeight+10},transition:BX.easing.makeEaseOut(BX.easing.transitions.cubic),step:function(t){a.style.height=t.height+"px";a.style.opacity=t.opacity/100},complete:BX.proxy((function(){a.style.cssText="";BX.onCustomEvent(this,"OnUCRecordWasShown",[this.ENTITY_XML_ID,r,a])}),this)}).animate()}var w=0,C=function(){if(100<++w){return}if(this.getCommentNode(t[1]).childNodes.length>0){BX.ajax.processScripts(l.SCRIPT);if(this.params["BIND_VIEWER"]==="Y"&&BX["viewElementBind"]){BX.viewElementBind(this.getCommentNode(t[1]),{},(function(t){return BX.type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))}))}}else{setTimeout(C,500)}BX.onCustomEvent(window,"OnUCRecordHasDrawn",[this.ENTITY_XML_ID,t,e["messageFields"]||e]);BX.onCustomEvent(window,"OnUCCommentWasAdded",[this.ENTITY_XML_ID,t,e["messageFields"]||e]);BX.onCustomEvent(window,"OnUCFeedChanged",[t])}.bind(this);setTimeout(C,500);return true},act:function(url,id,act){if(this.ajax["processComment"]!==true&&BX.type.isNotEmptyString(url)&&url.substr(0,1)!=="/"){try{eval(url);return false}catch(t){}if(BX.type.isFunction(url)){url(this,id,act);return false}}this.showWait(id);id=parseInt(id);var data={sessid:BX.bitrix_sessid(),MODE:"RECORD",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:id},ACTION:act==="EDIT"?"GET":act,ID:id,ENTITY_XML_ID:this.ENTITY_XML_ID,OPERATION_ID:this.getOperationId(),EXEMPLAR_ID:this.exemplarId,scope:this.scope};url=url.indexOf("#")!==-1?url.substr(0,url.indexOf("#")):url;var onsuccess=function(t){this.closeWait(id);if(t["status"]==="error"){this.showError(id,t["message"]||"Unknown error.");return}var e=this.getCommentNode(id);if(e){if(act==="DELETE"){BX.hide(e);this.comments.delete(id.toString());BX.onCustomEvent(window,"OnUCommentWasDeleted",[this.ENTITY_XML_ID,[this.ENTITY_XML_ID,id],t])}else if(act!=="EDIT"&&!!t["message"]){var i=BX.processHTML(t["message"],false);e.innerHTML=i.HTML;var n=0,s=function(){n++;if(n<100){if(e.childNodes.length>0)BX.ajax.processScripts(i.SCRIPT);else BX.defer(s)()}};BX.defer(s)();t["okMessage"]=""}}if(this.form!==null){BX.onCustomEvent(this.form,"onEdit",[this,id,t,act])}else{BX.onCustomEvent(window,"OnUCAfterRecordEdit",[this.ENTITY_XML_ID,id,t,act])}BX.onCustomEvent(window,"OnUCFeedChanged",[id])}.bind(this);var onfailure=function(t){this.closeWait(id);var e=t;if(BX.type.isNotEmptyObject(t)){if(BX.type.isArray(t.errors)&&BX.type.isNotEmptyString(t.errors[0].message)){e=t.errors[0].message}else if(BX.type.isNotEmptyObject(t.data)&&BX.type.isNotEmptyString(t.data.message)){e=t.data.message}}this.showError(id,e)}.bind(this);if(this.ajax["processComment"]===true){BX.ajax.runComponentAction(this.ajax.componentName,"processComment",{mode:"class",data:data,signedParameters:this.ajax.params}).then(onsuccess,onfailure)}else{BX.ajax({method:"GET",url:url+(url.indexOf("?")!==-1?"&":"?")+BX.ajax.prepareData(data),data:"",dataType:"json",onsuccess:onsuccess,onfailure:onfailure})}},showError:function(t,e){if(this.errorWindow){this.errorWindow.close()}this.errorWindow=new BX.PopupWindow("bx-comments-error",null,{autoHide:false,zIndex:200,overlay:{opacity:50,backgroundColor:"#000000"},buttons:[new BX.PopupWindowButton({text:BX.message("MPL_CLOSE"),events:{click:BX.delegate((function(){if(this.errorWindow)this.errorWindow.close()}),this)}})],closeByEsc:true,titleBar:{content:BX.create("span",{props:{className:"popup-window-titlebar-text feed-error-title"},html:'<div class="feed-error-icon"></div>'+BX.message("MPL_ERROR_OCCURRED")})},closeIcon:true,contentColor:"white",content:'<div class="feed-error-block">'+e+"</div>"});this.errorWindow.show()},checkHash:function(){if(repo["hashHasBeenFound"]===true){return}var t=/%23com(\d+)/gi.exec(location.href);var e=parseInt(location.hash&&location.hash.indexOf("#com")>=0?location.hash.replace("#com",""):t?t[1]:0);if(e>0){var i=BX.findChild(this.node.main,{attrs:{id:"record-"+[this.ENTITY_XML_ID,e].join("-")+"-cover"}},true,false);if(i){var n=BX.findParent(i,{attrs:{"data-bx-role":"collapsed-block"}},this.node.main);if(n){var s=n.querySelector("input[type=checkbox]");if(!s.checked){s.click(true)}}repo["hashHasBeenFound"]=true;var o=BX.pos(i);window.scrollTo(0,o["top"]);var a=BX.findChild(i,{className:"feed-com-main-content"},true,false);BX.removeClass(a,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(a,"feed-com-block-pointer")}}},registerComments:function(){var t;var e=BX.findChild(this.node.main,{tag:"DIV",attrs:{"bx-mpl-block":"main","bx-mpl-xml-id":this.ENTITY_XML_ID}},true,true);for(t=0;t<e.length;t++){if(e[t].getAttribute("bx-mpl-blank-status")==="blank"){this.blankComments.set(e[t].getAttribute("bx-mpl-entity-id"),e[t]);scrSpy.set([this.getXmlId(),e[t].getAttribute("bx-mpl-entity-id")].join("-"))}else{if(e[t].getAttribute("bx-mpl-read-status")==="new"){this.unreadComments.set(e[t].getAttribute("bx-mpl-entity-id"),e[t]);scrSpy.set([this.getXmlId(),e[t].getAttribute("bx-mpl-entity-id")].join("-"))}this.recalcMoreButtonComment(e[t].getAttribute("bx-mpl-entity-id"));this.comments.set(e[t].getAttribute("bx-mpl-entity-id"),[])}}},registerBlankComment:function(t,e){if(e!==true){setTimeout(this.registerBlankComment,1e3,t,true);return}var i=this.getCommentNode(t);if(!i||this.comments.has(t)||this.blankComments.has(t)){return}this.blankComments.set(t,i);scrSpy.set([this.getXmlId(),t].join("-"))},registerNewComment:function(t,e){if(e!==true){setTimeout(this.registerNewComment,1e3,t,true);return}var i=this.getCommentNode(t);if(!i||this.comments.has(t)){return}this.comments.set(t,[]);if(i.getAttribute("bx-mpl-read-status")==="new"){scrSpy.set([this.getXmlId(),t].join("-"),i);this.unreadComments.set(t,i)}this.recalcMoreButtonComment(t)},recalcMoreButtonComment:function(t){var e=this.getCommentNode(t);if(!BX(e)){return}var i=e.bodyBlock||BX.findChild(e,{attrs:{"bx-mpl-block":"body"}},true);if(!i){return}e.bodyBlock=i;var n=e.textBlock||BX.findChild(i,{attrs:{"bx-mpl-block":"text"}},true);if(!n){return}e.textBlock=n;var s=e.moreButtonBlock||BX.findChild(e,{attrs:{"bx-mpl-block":"more-button"}},true);e.moreButtonBlock=s;var o=BX.pos(i);var a=BX.pos(n);if(o.height>=a.height){s.style.display="none"}else if(s.style.display!=="block"){s.style.display="block"}var r=null;var d=BX.findChildren(i,{attr:{"data-bx-onload":"Y"}},true);var l=function(){this.recalcMoreButtonComment(t)}.bind(this);if(BX.type.isArray(d)){for(r=0;r<d.length;r++){d[r].addEventListener("load",l);d[r].setAttribute("data-bx-onload","N")}}var h=i.querySelectorAll("video");for(r=0;r<h.length;r++){h[r].addEventListener("loadedmetadata",l)}if(!e.hasOwnProperty("__boundOnForumSpoilerToggle")){e.__boundOnForumSpoilerToggle=true;BX.addCustomEvent(e,"onForumSpoilerToggle",l)}},checkVisibleComments:function(t){if(!this.canCheckVisibleComments){return}var e=this.getVisibleCommentIds(this.unreadComments,t);var i;while(i=e.shift()){this.markCommentAsRead(i)}window.fclistdebug=true;e=this.getVisibleCommentIds(this.blankComments,t);while(i=e.shift()){this.markCommentAsBlank(i)}},getVisibleCommentIds:function(t,e){var i=[];if(t.size<=0){return i}var n=BX.pos(this.node.main);if(n.top>e.bottom||n.bottom<e.top||n.top===0&&n.bottom===0){return i}var s=t.keys();var o=s.next();var a;while(o.done!==true){a=t.get(o.value);if(a.offsetWidth||a.offsetHeight||a.getClientRects().length){n=a.pos||BX.pos(a);a.pos=n;if(e.top<=n.top&&n.top<=e.bottom&&a.offsetParent!==null){i.push(o.value)}}o=s.next()}return i},markCommentAsRead:function(t){if(!this.unreadComments.has(t)){return}var e=this.unreadComments.get(t);e.setAttribute("bx-mpl-read-status","old");this.unreadComments.delete(t);scrSpy.unset([this.getXmlId(),t].join("-"));if(this.node.newComments.contains(e)){this.sendCommentAsRead(t)}BX.removeClass(e,"comment-new-answer");if(this.__checkNodeCorner!==true){this.__checkNodeCorner=true;var i=BX.findChild(this.node.main,{className:"feed-com-corner"});if(i){BX.addClass(i,"feed-post-block-corner-fade")}}var n=BX.findChild(e,{className:"feed-com-main-content"},true,false);if(n){BX.removeClass(n,"feed-com-block-pointer-to-new feed-com-block-new");BX.addClass(n,"feed-com-block-read")}var s=BX.findChild(e,{className:"feed-com-block"},true);BX.onCustomEvent(window,"OnUCCommentWasRead",[this.getXmlId(),[this.getXmlId(),t],{live:s&&s.classList.contains("feed-com-block-live"),new:!n||!n.classList.contains("feed-com-block-old")}])},sendCommentAsRead:function(t){if(this.ajax["readComment"]!==true){return}if(!this.sendCommentAsReadData){this.sendCommentAsReadData={mid:0,timeoutId:0,func:function(){BX.unbind(window,"beforeunload",this.sendCommentAsReadData.func);BX.removeCustomEvent(window,"onHidePageBefore",this.sendCommentAsReadData.func);this.sendCommentAsReadData.timeoutId=0;BX.ajax.runComponentAction(this.ajax.componentName,"readComment",{mode:"class",data:{ID:this.sendCommentAsReadData.mid},signedParameters:this.ajax.params})}.bind(this)}}if(this.sendCommentAsReadData.mid>t){return}this.sendCommentAsReadData.mid=t;if(this.sendCommentAsReadData.timeoutId<=0){BX.bind(window,"beforeunload",this.sendCommentAsReadData.func);BX.addCustomEvent(window,"onHidePageBefore",this.sendCommentAsReadData.func);this.sendCommentAsReadData.timeoutId=setTimeout(this.sendCommentAsReadData.func,6e3)}},markCommentAsBlank:function(t){if(!this.blankComments.has(t)){return}var e=this.blankComments.get(t);var i=e.parentNode;if(i&&!i.bxwaiter){fcShowWait(i)}this.blankComments.delete(t);scrSpy.unset([this.getXmlId(),t].join("-"));this.blankCommentsForAjax.set(t,e);setTimeout(this.sendCommentAsBlank,1e3)},sendCommentAsBlank:function(){if(this.ajax["getComment"]!==true||this.blankCommentsForAjax.size<=0){return}var t=Array.from(this.blankCommentsForAjax.keys());var e=new Map(this.blankCommentsForAjax);this.blankCommentsForAjax.clear();var i=function(t){e.forEach(function(e,i){fcCloseWait(e.parentNode);var n=t["messageList"][i];if(!n){e.parentNode.removeChild(e)}else{var s=BX.processHTML(n["message"],false);e.innerHTML=s.HTML;var o=function(t){if(e.childNodes.length>0){BX.ajax.processScripts(s.SCRIPT)}else if(t<100){setTimeout(o,500,t+1)}};o(0)}}.bind(this))}.bind(this);BX.ajax.runComponentAction(this.ajax.componentName,"getComment",{mode:"class",data:{sessid:BX.bitrix_sessid(),MODE:"RECORDS",NOREDIRECT:"Y",AJAX_POST:"Y",FILTER:{ID:t},ACTION:"GET",ID:t,ENTITY_XML_ID:this.ENTITY_XML_ID,OPERATION_ID:this.getOperationId(),EXEMPLAR_ID:this.exemplarId,scope:this.scope},signedParameters:this.ajax.params}).then(i,i)},getTemplate:function(){return this.template},showWait:function(t){fcShowWait(BX("record-"+this.ENTITY_XML_ID+"-"+t+"-actions"))},closeWait:function(t){fcCloseWait(BX("record-"+this.ENTITY_XML_ID+"-"+t+"-actions")||null)}};window.FCList.getQuoteData=function(){return quoteData};window.FCList.getInstance=function(t,e){if(!repo.listByXmlId.has(t["ENTITY_XML_ID"])&&e!==undefined){new window.FCList(t,e)}return repo.listByXmlId.get(t["ENTITY_XML_ID"])};var lastWaitElement=null;var fcShowWait=function(t){if(t&&!BX.type.isElementNode(t)){t=null}t=t||this;if(BX.type.isElementNode(t)){BX.defer((function(){t.disabled=true}))();var e=BX.findParent(t,BX.is_relative);t.bxwaiter=(e||document.body).appendChild(BX.create("DIV",{props:{className:"feed-com-loader"},style:{position:"absolute"}}));lastWaitElement=t;return t.bxwaiter}return true};var fcCloseWait=function(t){if(t&&!BX.type.isElementNode(t)){t=null}t=t||lastWaitElement||this;if(BX.type.isElementNode(t)){if(t.bxwaiter&&t.bxwaiter.parentNode){t.bxwaiter.parentNode.removeChild(t.bxwaiter);delete t.bxwaiter}t.disabled=false;if(lastWaitElement==t)lastWaitElement=null}};var fcShowActions=function(t,e,i){var n=[];var s=BX.util.getRandomString(20);if(i.getAttribute("bx-mpl-view-show")=="Y"){n.push({text:BX.message("MPL_MES_HREF"),href:i.getAttribute("bx-mpl-view-url").replace(/\\#(.+)$/gi,"")+"#com"+e,target:"_top"});n.push({html:'<span id="record-popup-'+s+'-link-text">'+BX.message("B_B_MS_LINK")+"</span>"+'<span id="record-popup-'+s+'-link-icon-animate" class="comment-menu-link-icon-wrap">'+'<span class="comment-menu-link-icon" id="record-popup-'+s+'-link-icon-done" style="display: none;">'+"</span>"+"</span>",onclick:function(){var t="record-popup-"+s+"-link",n=i.getAttribute("bx-mpl-view-url").replace(/#(.+)$/gi,"")+"#com"+e,o=BX(t+"-text"),a=BX(t+"-icon-done");n=(n.indexOf("http")<0?location.protocol+"//"+location.host:"")+n;if(BX.clipboard.isCopySupported()){if(o&&o.getAttribute("data-block-click")=="Y"){return}BX.clipboard.copy(n);if(o&&a){a.style.display="inline-block";BX.removeClass(BX(t+"-icon-animate"),"comment-menu-link-icon-animate");BX.adjust(BX(t+"-text"),{attrs:{"data-block-click":"Y"}});setTimeout((function(){BX.addClass(BX(t+"-icon-animate"),"comment-menu-link-icon-animate")}),1);setTimeout((function(){BX.adjust(BX(t+"-text"),{attrs:{"data-block-click":"N"}})}),500)}return}var r=BX.proxy_context;var d=parseInt(!!r.getAttribute("bx-height")?r.getAttribute("bx-height"):r.offsetHeight);if(r.getAttribute("bx-status")!="shown"){r.setAttribute("bx-status","shown");if(!BX(t)&&!!BX(t+"-text")){var l=BX(t+"-text"),h=BX.pos(l),m=BX.pos(l.parentNode),c=BX.findChildren(l.parentNode.parentNode.parentNode,{className:"menu-popup-item-text"},true);h["height"]=m["height"]-1;if(c){var u=0,p;for(var E=0;E<c.length;E++){p=BX.pos(c[E]);u=Math.max(u,p["width"])}m["width"]=u}BX.adjust(r,{attrs:{"bx-height":r.offsetHeight},style:{overflow:"hidden",display:"block"},children:[BX.create("BR"),BX.create("DIV",{attrs:{id:t},children:[BX.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),BX.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[BX.create("INPUT",{attrs:{id:t+"-input",type:"text",value:n},style:{height:m["height"]+"px",width:m["width"]+"px"},events:{click:function(t){this.select();t.preventDefault()}}})]})]}),BX.create("SPAN",{className:"menu-popup-item-right"})]})}new BX["fx"]({time:.2,step:.05,type:"linear",start:d,finish:d*2,callback:BX.delegate((function(t){this.style.height=t+"px"}),r)}).start();BX.fx.show(BX(t),.2);BX(t+"-input").select()}else{r.setAttribute("bx-status","hidden");new BX["fx"]({time:.2,step:.05,type:"linear",start:r.offsetHeight,finish:d,callback:BX.delegate((function(t){this.style.height=t+"px"}),r)}).start();BX.fx.hide(BX(t),.2)}}})}if(i.getAttribute("bx-mpl-edit-show")=="Y"){n.push({text:BX.message("BPC_MES_EDIT"),onclick:function(){BX.onCustomEvent(t,"onAct",[i.getAttribute("bx-mpl-edit-url"),e,"EDIT"]);this.popupWindow.close();return false}})}if(i.getAttribute("bx-mpl-moderate-show")=="Y"){var o=i.getAttribute("bx-mpl-moderate-approved")=="hidden";n.push({text:o?BX.message("BPC_MES_SHOW"):BX.message("BPC_MES_HIDE"),onclick:function(){var n=i.getAttribute("bx-mpl-moderate-url").replace("#action#",o?"show":"hide").replace("#ACTION#",o?"SHOW":"HIDE");if(BX.type.isNotEmptyString(n)){n=BX.util.add_url_param(n,{b24statAction:o?"showComment":"hideComment"})}BX.onCustomEvent(t,"onAct",[n,e,o?"SHOW":"HIDE"]);this.popupWindow.close()}})}if(i.getAttribute("bx-mpl-delete-show")=="Y"){n.push({text:BX.message("BPC_MES_DELETE"),onclick:function(){if(window.confirm(BX.message("BPC_MES_DELETE_POST_CONFIRM"))){BX.onCustomEvent(t,"onAct",[i.getAttribute("bx-mpl-delete-url"),e,"DELETE"])}this.popupWindow.close();return false}})}var a=i.getAttribute("bx-mpl-post-entity-xml-id");if(i.getAttribute("bx-mpl-edit-show")=="Y"&&BX.Tasks&&BX.Tasks.ResultAction&&a.indexOf("TASK_")===0&&BX.Tasks.ResultAction.getInstance().canCreateResult(+/\d+/.exec(a))){var r=+/\d+/.exec(a);var d=BX.Tasks.ResultManager.getInstance().getResult(r);if(d&&d.context==="task"&&d.canUnsetAsResult&&d.canUnsetAsResult(parseInt(e,10))){n.push({text:BX.message("BPC_MES_DELETE_TASK_RESULT"),onclick:function(){BX.Tasks.ResultAction.getInstance().deleteFromComment(e);this.popupWindow.close();return false}})}else if(d&&d.context==="task"&&d.canSetAsResult&&d.canSetAsResult(parseInt(e,10))){n.push({text:BX.message("BPC_MES_CREATE_TASK_RESULT"),onclick:function(){BX.Tasks.ResultAction.getInstance().createFromComment(e);this.popupWindow.close();return false}})}}if(i.getAttribute("bx-mpl-createtask-show")==="Y"&&!BX.type.isUndefined(BX.Livefeed)){var l=i.getAttribute("bx-mpl-comment-entity-type");var h=i.getAttribute("bx-mpl-post-entity-type");n.push({text:BX.message("BPC_MES_CREATE_TASK"),onclick:function(){BX.Livefeed.TaskCreator.create({postEntityType:BX.type.isNotEmptyString(h)?h:"BLOG_POST",entityType:BX.type.isNotEmptyString(l)?l:"BLOG_COMMENT",entityId:e});this.popupWindow.close();return false}})}if(i.getAttribute("bx-mpl-createsubtask-show")==="Y"&&!BX.type.isUndefined(BX.Livefeed)){var m=i.getAttribute("bx-mpl-post-entity-xml-id");var c=m.match(/^TASK_(\d+)$/i);if(c){n.push({text:BX.message("BPC_MES_CREATE_SUBTASK"),onclick:function(){BX.Livefeed.TaskCreator.create({postEntityType:h,entityType:l,entityId:e,parentTaskId:parseInt(c[1])});this.popupWindow.close();return false}})}}if(n.length>0){for(var u in n){if(n.hasOwnProperty(u)){n[u]["className"]="blog-comment-popup-menu"}}var p={offsetLeft:-18,offsetTop:2,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupClose:function(){this.destroy();BX.PopupMenu.Data["action-"+s]=null}}};BX.onCustomEvent("OnUCCommentActionsShown",[t,e,n,p]);BX.PopupMenu.show("action-"+s,i,n,p)}};var fcCommentExpand=function(t){BX.UI.Animations.expand({moreButtonNode:t,type:"comment",classBlock:"feed-com-block",classOuter:"feed-com-text-inner",classInner:"feed-com-text-inner-inner",heightLimit:200,callback:function(t){BX.onCustomEvent(window,"OnUCRecordWasExpanded",[t]);t.classList.add("feed-com-text-inner-expanded");var e=t.getAttribute("bx-content-view-xml-id");if(BX.type.isNotEmptyString(e)){BX.onCustomEvent(window,"OnUCFeedChanged",[e.split("-")])}}})};window.fcParseTemplate=function(t,e,i){e=e||{};e.RIGHTS=e.RIGHTS||{};for(var n=0,s=["MODERATE","EDIT","DELETE"];n<s.length;n++){e.RIGHTS[s[n]]=BX.util.in_array(e.RIGHTS[s[n]],["Y","ALL","OWN","OWNLAST"])?e.RIGHTS[s[n]]:"N"}e.DATE_TIME_FORMAT=e.DATE_TIME_FORMAT?e.DATE_TIME_FORMAT:"d F Y G:i";e.TIME_FORMAT=e.DATE_TIME_FORMAT&&e.DATE_TIME_FORMAT.includes("a")?"g:i a":"G:i";e.VIEW_URL=e.VIEW_URL||"";e.EDIT_URL=e.EDIT_URL||"";e.MODERATE_URL=e.MODERATE_URL||"";e.DELETE_URL=e.DELETE_URL||"";e.AUTHOR_URL=e.AUTHOR_URL||"";e.NAME_TEMPLATE=e.NAME_TEMPLATE||"";e.SHOW_LOGIN=e.SHOW_LOGIN||"";var o=t&&t.messageFields?t.messageFields:t;var a={ID:"",FULL_ID:"",CONTENT_ID:"",ENTITY_XML_ID:"",EXEMPLAR_ID:"",NEW:"old",APPROVED:"Y",DATE:"",TEXT:"",CLASSNAME:"",VIEW_URL:"",VIEW_SHOW:"N",EDIT_URL:"",EDIT_SHOW:"N",MODERATE_URL:"",MODERATE_SHOW:"N",DELETE_URL:"",DELETE_SHOW:"N",CREATETASK_SHOW:"N",BEFORE_HEADER:"",BEFORE_ACTIONS:"",AFTER_ACTIONS:"",AFTER_HEADER:"",BEFORE:"",AFTER:"",BEFORE_RECORD:"",AFTER_RECORD:"",AUTHOR_ID:"",AUTHOR_AVATAR_IS:"N",AUTHOR_AVATAR:"",AUTHOR_URL:"",AUTHOR_NAME:"",AUTHOR_EXTRANET_STYLE:"",SHOW_POST_FORM:"Y",SHOW_MENU:"Y",VOTE_ID:"",AUTHOR_TOOLTIP_PARAMS:"","background:url('') no-repeat center;":"",LIKE_REACT:"",RATING_NONEMPTY_CLASS:"",MOBILE_HINTS:""};if(!!o&&!!t["messageFields"]){o["AUTHOR"]=!!o["AUTHOR"]?o["AUTHOR"]:{};var r=parseInt(o["POST_TIMESTAMP"])+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET"));var d=[["today",e["TIME_FORMAT"]],["yesterday",e["TIME_FORMAT"].indexOf("yesterday")<0?"yesterday, "+e["TIME_FORMAT"]:e["TIME_FORMAT"]],["",e["DATE_TIME_FORMAT"]]];var l="";if(!BX.Type.isUndefined(o["AUTHOR"]["TYPE"])){if(o["AUTHOR"]["TYPE"]==="EMAIL"){l=" feed-com-name-email"}else if(o["AUTHOR"]["TYPE"]==="EXTRANET"){l=" feed-com-name-extranet"}}else if(o["AUTHOR"]["IS_EXTRANET"]=="Y"){l=" feed-com-name-extranet"}var h=o["POST_MESSAGE_TEXT"].replace(/\001/gi,"").replace(/#/gi,"\x01");o.AUX_LIVE_PARAMS=BX.type.isPlainObject(o.AUX_LIVE_PARAMS)?o.AUX_LIVE_PARAMS:{};if(!!o.AUX&&(BX.util.in_array(o.AUX,["createentity","createtask","fileversion"])||o.AUX==="TASKINFO"&&BX.type.isNotEmptyObject(o.AUX_LIVE_PARAMS))){h=BX.CommentAux.getLiveText(o.AUX,o.AUX_LIVE_PARAMS)}a={ID:o["ID"],FULL_ID:o["FULL_ID"].join("-"),CONTENT_ID:o["RATING"]&&o["RATING"]["ENTITY_TYPE_ID"]&&o["RATING"]["ENTITY_ID"]?o["RATING"]["ENTITY_TYPE_ID"]+"-"+o["RATING"]["ENTITY_ID"]:"",ENTITY_XML_ID:o["ENTITY_XML_ID"],EXEMPLAR_ID:e["EXEMPLAR_ID"],NEW:o["NEW"]=="Y"?"new":"old",APPROVED:o["APPROVED"]!="Y"?"hidden":"approved",DATE:BX.date.format(d,r,parseInt(Date.now()/1e3)+parseInt(BX.message("USER_TZ_OFFSET"))+parseInt(BX.message("SERVER_TZ_OFFSET")),true),TEXT:h,CLASSNAME:(o["CLASSNAME"]?" "+o["CLASSNAME"]:"")+(BX.type.isNotEmptyString(e["CLASSNAME"])?" "+e["CLASSNAME"]:""),VIEW_URL:e["VIEW_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),VIEW_SHOW:e["VIEW_URL"]!==""?"Y":"N",EDIT_URL:e["EDIT_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),EDIT_SHOW:(!o.AUX||o.AUX.length<=0)&&(e["RIGHTS"]["EDIT"]=="Y"||e["RIGHTS"]["EDIT"]=="ALL"||e["RIGHTS"]["EDIT"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"])?"Y":"N",MODERATE_URL:e["MODERATE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),MODERATE_SHOW:e["RIGHTS"]["MODERATE"]=="Y"||e["RIGHTS"]["MODERATE"]=="ALL"||e["RIGHTS"]["MODERATE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N",DELETE_URL:e["DELETE_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]),DELETE_SHOW:(!o["CAN_DELETE"]||o["CAN_DELETE"]==="Y")&&(e["RIGHTS"]["DELETE"]=="Y"||e["RIGHTS"]["DELETE"]=="ALL"||e["RIGHTS"]["DELETE"]=="OWN"&&BX.message("USER_ID")==o["AUTHOR"]["ID"]?"Y":"N"),CREATETASK_SHOW:(!o.AUX||o.AUX.length<=0)&&e["RIGHTS"]["CREATETASK"]=="Y"?"Y":"N",CREATESUBTASK_SHOW:(!o.AUX||o.AUX.length<=0)&&BX.type.isNotEmptyString(e.RIGHTS.CREATESUBTASK)&&e.RIGHTS.CREATESUBTASK==="Y"?"Y":"N",BEFORE_HEADER:o["BEFORE_HEADER"],BEFORE_ACTIONS:o["BEFORE_ACTIONS"],AFTER_ACTIONS:o["AFTER_ACTIONS"],AFTER_HEADER:o["AFTER_HEADER"],BEFORE:o["BEFORE"],AFTER:o["AFTER"],BEFORE_RECORD:o["BEFORE_RECORD"],AFTER_RECORD:o["AFTER_RECORD"],AUTHOR_ID:o["AUTHOR"]["ID"],AUTHOR_AVATAR_IS:!!o["AUTHOR"]["AVATAR"]?"Y":"N",AUTHOR_AVATAR:!!o["AUTHOR"]["AVATAR"]?encodeURI(o["AUTHOR"]["AVATAR"]):"/bitrix/images/1.gif",AUTHOR_AVATAR_BG:!!o["AUTHOR"]["AVATAR"]?"background-image:url('"+encodeURI(o["AUTHOR"]["AVATAR"])+"')":"",AUTHOR_URL:e["AUTHOR_URL"].replace("#ID#",o["ID"]).replace("#id#",o["ID"]).replace("#USER_ID#",o["AUTHOR"]["ID"]).replace("#user_id#",o["AUTHOR"]["ID"])+(!BX.Type.isUndefined(o["AUTHOR"]["EXTERNAL_AUTH_ID"])&&o["AUTHOR"]["EXTERNAL_AUTH_ID"]==="email"&&!BX.Type.isUndefined(e["AUTHOR_URL_PARAMS"])?(e["AUTHOR_URL"].indexOf("?")>=0?"&":"?")+"entityType="+e["AUTHOR_URL_PARAMS"]["entityType"]+"&entityId="+e["AUTHOR_URL_PARAMS"]["entityId"]:""),AUTHOR_NAME:BX.formatName(o["AUTHOR"],e["NAME_TEMPLATE"],e["SHOW_LOGIN"]),AUTHOR_EXTRANET_STYLE:l,VOTE_ID:o["RATING"]&&o["RATING"]["VOTE_ID"]?o["RATING"]["VOTE_ID"]:"",AUTHOR_PERSONAL_GENDER:BX.type.isNotEmptyString(o["AUTHOR"]["PERSONAL_GENDER"])?o["AUTHOR"]["PERSONAL_GENDER"]:"",AUTHOR_TOOLTIP_PARAMS:!BX.Type.isUndefined(o["AUTHOR_TOOLTIP_PARAMS"])?o["AUTHOR_TOOLTIP_PARAMS"]:"{}","background:url('') no-repeat center;":"",LIKE_REACT:!!o["LIKE_REACT"]?o["LIKE_REACT"]:"",RATING_NONEMPTY_CLASS:o["RATING"]&&o["RATING"]["TOTAL_VOTES"]?"comment-block-rating-nonempty":"",POST_ENTITY_TYPE:!!e["POST_CONTENT_TYPE_ID"]?e["POST_CONTENT_TYPE_ID"]:"",COMMENT_ENTITY_TYPE:!!e["COMMENT_CONTENT_TYPE_ID"]?e["COMMENT_CONTENT_TYPE_ID"]:"",MOBILE_HINTS:""}}else{for(n in a){if(a.hasOwnProperty(n)){a[n]=!!t[n]?t[n]:a[n]}}}for(n in a){if(a.hasOwnProperty(n)){a[n]=!!a[n]?a[n]:""}}a["SHOW_POST_FORM"]=BX("record-"+a["ENTITY_XML_ID"]+"-0-placeholder")?"Y":"N";for(var m in a){if(a.hasOwnProperty(m)){i=i.replace(new RegExp("#"+m+"#","g"),function(){return a[this]}.bind(m))}}return i.replace("background:url('') no-repeat center;","").replace(/\001/gi,"#")};window["fcPull"]=function(t,e){BX.ajax({url:"/bitrix/components/bitrix/main.post.list/templates/.default/component_epilog.php",method:"POST",data:{AJAX_POST:"Y",ENTITY_XML_ID:t,MODE:"PUSH&PULL",sessid:BX.bitrix_sessid(),DATA:e}})};var MPLQuote=function(){this.closeByEsc=true;this.autoHide=true;this.autoHideTimeout=5e3;this.checkEsc=this.checkEsc.bind(this);this.hide=this.hide.bind(this)};MPLQuote.prototype={show:function(t,e){if(window.getSelection().toString()===""){return}this.render(t,e);if(this.closeByEsc&&this.closeByEscBound!==true){this.closeByEscBound=true;BX.bind(document,"keyup",this.checkEsc)}if(this.autoHide&&this.autoHideBound!==true){this.autoHideBound=true;setTimeout(function(){BX.bind(document,"click",this.hide)}.bind(this),10)}if(this.autoHideTimeoutPointer>0){clearTimeout(this.autoHideTimeoutPointer);this.autoHideTimeoutPointer=0}if(this.autoHideTimeout>0&&this.autoHideTimeoutBound!==true){this.autoHideTimeoutBound=true;this.autoHideTimeoutPointer=setTimeout(this.hide,this.autoHideTimeout)}},render:function(t,e){if(this.wrap){BX.ZIndexManager.unregister(this.wrap);this.wrap.remove()}const i=e?.options?.copilotParams;this.wrap=i?this.renderQuoteWithCopilot(i):this.renderQuote();document.body.appendChild(this.wrap);BX.ZIndexManager.register(this.wrap);const n=this.getPosition(this.wrap,t);BX.adjust(this.wrap,{style:{top:`${n.y}px`,left:`${n.x}px`,display:"block"}});BX.addClass(this.wrap,"mpl-quote-block-show");BX.ZIndexManager.bringToFront(this.wrap)},renderQuote:function(){const t=BX.Tag.render`
				<a class="mpl-quote-block" href="#" style="display: none;"></a>
			`;t.addEventListener("click",this.fire.bind(this));return t},renderQuoteWithCopilot:function(t){const e=BX.Tag.render`
				<div class="mpl-quote-block-quote">
					<div class="ui-icon-set --quote"></div>
				</div>
			`;e.addEventListener("click",this.fire.bind(this));const i=BX.Tag.render`
				<div class="mpl-quote-block-copilot">
					<div class="ui-icon-set --copilot-ai"></div>
					<div class="mpl-quote-block-copilot-text">${BX.message("MPL_QUOTE_COPILOT")}</div>
				</div>
			`;i.addEventListener("click",this.onCopilotButtonClickHandler.bind(this,t));const n=BX.Tag.render`
				<a class="mpl-quote-block mpl-quote-block-with-copilot" href="#" style="display: none;">
					<div class="mpl-quote-block-with-copilot-container">
						${e}
						<div class="mpl-quote-block-separator"></div>
						${i}
					</div>
				</a>
			`;n.addEventListener("click",this.emptyClick.bind(this));return n},onCopilotButtonClickHandler:function(t,e){this.emptyClick(e);this.getCopilot(t).then((t=>{this.showCopilot(t)}))},showCopilot:function(t){const e=window.getSelection();const i=e.toString();const n=e.getRangeAt(0);const s=n.cloneRange();let o=true;const a=()=>{if(o&&window.getSelection().toString()!==i){window.getSelection().removeAllRanges();window.getSelection().addRange(s)}};const r=()=>new BX.easing({duration:1e3,start:{},finish:{},transition:BX.easing.makeEaseOut(BX.easing.transitions.linear),step:()=>{if(t.isShown()){t.adjust({position:this.getBindElement(s)})}}}).animate();document.addEventListener("mouseup",a);document.addEventListener("mousedown",a);BX.Event.EventEmitter.subscribe("onPullEvent-unicomments",r);const d=()=>{o=false;window.getSelection().removeAllRanges();document.removeEventListener("mouseup",a);document.removeEventListener("mousedown",a);BX.Event.EventEmitter.unsubscribe("onPullEvent-unicomments",r);BX.Event.EventEmitter.unsubscribe("AI.Copilot:hide",d);BX.Event.EventEmitter.unsubscribe("AI.Copilot.Menu:open",a)};BX.Event.EventEmitter.subscribe("AI.Copilot:hide",d);BX.Event.EventEmitter.subscribe("AI.Copilot.Menu:open",a);t.setContext(i);t.show({bindElement:this.getBindElement(s)})},getBindElement:function(t){const e=t.getBoundingClientRect();return{top:e.bottom+window.scrollY+10,left:e.x+window.scrollX}},getCopilot:async function(t){const e=JSON.stringify(t);MPLQuote.copilots??={};if(MPLQuote.copilots[e]){return MPLQuote.copilots[e]}const{Copilot:i}=await BX.Runtime.loadExtension("ai.copilot");MPLQuote.copilots[e]=new i({readonly:true,autoHide:true,...t});return new Promise((t=>{MPLQuote.copilots[e].subscribe("finish-init",(()=>t(MPLQuote.copilots[e])));MPLQuote.copilots[e].init()}))},emptyClick:function(t){t.preventDefault();this.cancelBubble(t);this.wrap.style.display="none"},fire:function(t){t.preventDefault();if(!this.isShown()){return}if(t&&!(BX.getEventButton(t)&BX.MSLEFT)){return}this.cancelBubble(t);this.wrap.style.display="none";BX.onCustomEvent(this,"onQuote",[t,this]);setTimeout(this.hide,50);return false},hide:function(){BX.unbind(document,"keyup",this.checkEsc);this.closeByEscBound=false;BX.unbind(document,"click",this.hide);this.autoHideBound=false;if(this.autoHideTimeoutPointer>0){clearTimeout(this.autoHideTimeoutPointer)}this.autoHideTimeoutPointer=0;this.autoHideTimeoutBound=false;BX.onCustomEvent(this,"onHide",[this]);BX.remove(this.wrap)},getPosition:function(t,e){var i;if(e.pageX==null){var n=document.documentElement,s=document.body;var o=e.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n.clientLeft||0);var a=e.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n.clientTop||0);i={x:o,y:a}}else{i={x:e.pageX,y:e.pageY}}return{x:i.x+5,y:i.y-16}},isShown:function(){return this.wrap.style.display==="block"},cancelBubble:function(t){if(!t){t=window.event}if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}},checkEsc:function(t){t=t||window.event;if(t.keyCode==27){this.hide(t)}}};var checkEntitiesActuality=function(t){var e=repo.listById.values();var i=e.next();while(i.done!==true){if(i.value.getXmlId()===t&&!document.body.contains(i.value.node.main)){BX.onCustomEvent(window,"OnUCInitialized",[i.value.getId()])}i=e.next()}};var getActiveEntitiesByXmlId=function(t){checkEntitiesActuality(t);var e=repo.listById.values();var i=e.next();var n=new Map;while(i.done!==true){if(i.value.getXmlId()===t){n.set(i.value.getId(),i.value)}i=e.next()}return n};window.mplCheckForQuote=function(t,e,i,n,s=null){t=document.all?window.event:t;var o="",a,r=null;if(window.getSelection){a=window.getSelection();o=a.toString()}else if(document.selection){a=document.selection;o=a.createRange().text}if(o.length<=0){return}var d=BX.findParent(a.focusNode,{tagName:e.tagName,className:e.className},e),l=BX.findParent(a.anchorNode,{tagName:e.tagName,className:e.className},e);if(d!==l||d!==e){return}var h=getActiveEntitiesByXmlId(i);if(h.size<=0){return}if(n&&BX(n,true)){var m=BX(n,true);if(m&&m.hasAttribute("bx-post-author-id")){r={id:parseInt(m.getAttribute("bx-post-author-id")),gender:m.getAttribute("bx-post-author-gender"),name:m.innerHTML}}}var c=null;if(e.__boundXmlCheckQuote===true){c=repo.listById.get(e.__boundXmlEntityId)||null}if(c===null){e.__boundXmlCheckQuote=true;var u=e;while(u){h.forEach((function(t,e){if(c===null&&u.contains(t.node.main)){c=t;return true}}));if(c!==null){break}u=u.parentNode}if(c===null){c=h.values().next().value}e.__boundXmlEntityId=c.getId();BX.addCustomEvent(window,"OnUCHasBeenDestroyed",(function(t,i){if(i.getId()===e.__boundXmlEntityId){delete e.__boundXmlEntityId;delete e.__boundXmlCheckQuote}}))}if(c!==null){BX.onCustomEvent(c.eventNode,"onQuote",[t,{text:o,author:r,options:s}])}};window.mplReplaceUserPath=function(t){if(!BX.Type.isStringFilled(t)){return""}if(BX("MPL_IS_EXTRANET_SITE")==="Y"){t=t.replace("/company/personal/user/","/extranet/contacts/personal/user/")}else{t=t.replace("/extranet/contacts/personal/user/","/company/personal/user/")}t=t.replace(new RegExp("[\\w/]*/mobile/users/\\?user_id=(\\d+)","igm"),BX("MPL_IS_EXTRANET_SITE")=="Y"?"/extranet/contacts/personal/user/$1/":"/company/personal/user/$1/");return t};BX.addCustomEvent(window,"BX.Livefeed:recalculateComments",(function(t){if(!BX.type.isPlainObject(t)||!BX.type.isDomNode(t.rootNode)){return}var e=t.rootNode.querySelectorAll(".feed-comments-block");var i=null;for(var n=0;n<e.length;n++){i=e[n].getAttribute("data-bx-comments-entity-xml-id");if(BX.type.isNotEmptyString(i)){BX.onCustomEvent(window,"OnUCCommentRecalculate",[i])}}}));BX.addCustomEvent(window,"BX.Forum.Spoiler:toggle",(function(t){if(!t.node){return}var e=BX.findParent(t.node,{attrs:{"bx-mpl-block":"main"}});if(e){BX.onCustomEvent(e,"onForumSpoilerToggle",[e.getAttribute("bx-mpl-entity-id")])}}));var ScreenSpy=function(){this.timeoutSec=2e3;this.check=this.check.bind(this);this.change=this.change.bind(this);this.scroll=this.scroll.bind(this);this.nodes=new Map;this.timeout=0;this.ready=true;this.window=BX.GetWindowInnerSize();this.screen={top:this.window.scrollTop,bottom:this.window.scrollTop+this.window.innerHeight};this.watchDimensionNodes=new WeakMap};ScreenSpy.prototype={watchNode:function(t){if(!this.watchDimensionNodes.has(t)){this.watchDimensionNodes.set(t,false);BX.bind(t,"click",this.check)}},set:function(t,e){this.nodes.set(t,e);this.start()},unset:function(t){this.nodes.delete(t);if(this.nodes.size<=0){this.stop()}},start:function(){if(this.ready!==true){return}this.ready=false;BX.bind(window,"resize",this.change);BX.bind(window,"scroll",this.scroll);this.scroll()},stop:function(){if(this.timeout>0){clearTimeout(this.timeout)}this.timeout=0;BX.unbind(window,"resize",this.change);BX.unbind(window,"scroll",this.scroll);this.ready=true},check:function(){this.timeout=0;var t=BX.GetWindowScrollPos();if(this.screen.bottom>t.scrollTop){var e={top:t.scrollTop,bottom:this.screen.bottom};BX.onCustomEvent(this,"onRead",[e])}if(this.screen.top!==t.scrollTop){this.scroll()}},change:function(){this.window=BX.GetWindowInnerSize()},scroll:function(){if(this.timeout<=0){var t=BX.GetWindowScrollPos();this.screen={top:t.scrollTop,bottom:t.scrollTop+this.window.innerHeight};this.timeout=setTimeout(this.check,this.timeoutSec)}}};var scrSpy=new ScreenSpy;BX.ready((function(){BX.addCustomEvent(window,"onPullEvent-unicomments",(function(t,e){if(e["AUX"]&&!BX.util.in_array(e["AUX"].toLowerCase(),BX.CommentAux.getLiveTypesList())||getActiveEntitiesByXmlId(e["ENTITY_XML_ID"]).size<=0){return}if(t==="comment"){if(e["NEED_REQUEST"]==="Y"){if(e["URL"]["LINK"].indexOf("#GROUPS_PATH#")>=0&&!!BX.message("MPL_WORKGROUPS_PATH")){e["URL"]["LINK"]=e["URL"]["LINK"].replace("#GROUPS_PATH#",BX.message("MPL_WORKGROUPS_PATH"))}var i=BX.ajax.prepareData({AJAX_POST:"Y",ENTITY_XML_ID:e["ENTITY_XML_ID"],MODE:"RECORD",FILTER:{ID:e["ID"]},sessid:BX.bitrix_sessid()});var n=e["URL"]["LINK"];n=n.indexOf("#")!==-1?n.substr(0,n.indexOf("#")):n;BX.ajax({url:n+(n.indexOf("?")!==-1?"&":"?")+i,method:"GET",dataType:"json",data:"",onsuccess:function(t){BX.onCustomEvent(window,"OnUCCommentWasPulled",[[e["ENTITY_XML_ID"],e["ID"]],t,e])}})}else if(e["ACTION"]==="DELETE"){BX.onCustomEvent(window,"OnUCommentWasDeleted",[e["ENTITY_XML_ID"],[e["ENTITY_XML_ID"],e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}else if(e["ACTION"]==="HIDE"){BX.onCustomEvent(window,"OnUCommentWasHidden",[e["ENTITY_XML_ID"],[e["ENTITY_XML_ID"],e["ID"]],e]);BX.onCustomEvent(window,"OnUCFeedChanged",[e["ID"]])}else{if(e["ACTION"]==="REPLY"){e["NEW"]=!e["AUTHOR"]||e["AUTHOR"]["ID"]!=BX.message("USER_ID")?"Y":"N"}BX.onCustomEvent(window,"OnUCCommentWasPulled",[[e["ENTITY_XML_ID"],e["ID"]],{messageFields:e},e])}}else if(t==="answer"&&Number(e["USER_ID"])!==Number(BX.message("USER_ID"))){BX.onCustomEvent(window,"OnUCUsersAreWriting",[e["ENTITY_XML_ID"],e["USER_ID"],e["NAME"],e["AVATAR"]])}}));BX.addCustomEvent(window,"OnUCUserReply",(function(t,e,i){var n=getActiveEntitiesByXmlId(t);if(n.size<=0){return}n.values().next().value.reply({id:e,name:i})}))}));BX.onCustomEvent("main.post.list/default",[]);class MobileButton{constructor(t){const{containerId:e}=t;const i=document.getElementById(`${e}`);if(!i){return}const n=Array.from(i.querySelectorAll(".feed__mobile_btn"));this.onButtonClickHandler=this.handleButtonClick.bind(this);n.forEach((t=>{t.addEventListener("click",this.onButtonClickHandler)}))}handleButtonClick(t){const e=new BX.PopupWindow({bindElement:t,content:BX.Tag.render`
					<div class="feed__mobile__popup_content">
						<div class="feed__mobile__popup_content__text">${BX.message("MPL_MOBILE_HINTS")}</div>
						<span onclick="${this.handleLinkClick.bind(this)}" class="feed__mobile__popup_content__link">${BX.message("MPL_MOBILE_HINTS_DETAILS")}</span>
					</div>`,bindOptions:{position:"top"},darkMode:true,autoHide:true,closeByEsc:true,animation:"fading"});e.show()}handleLinkClick(t){BX.Runtime.loadExtension("ui.qrauthorization").then((t=>{const{QrAuthorization:e}=t;const i=new e({title:{text:BX.message("MPL_MOBILE_POPUP_TITLE"),size:"sm"},bottomText:{text:BX.message("MPL_MOBILE_POPUP_BOTTOM_TEXT"),size:"sm"},popupParam:{overlay:true}});i.show()}))}}BX.namespace("BX.Main.PostList");BX.Main.PostList.MobileButton=MobileButton})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:91:"/bitrix/components/bitrix/main.post.form/templates/mobile_app/script.min.js?172873318119190";s:6:"source";s:71:"/bitrix/components/bitrix/main.post.form/templates/mobile_app/script.js";s:3:"min";s:75:"/bitrix/components/bitrix/main.post.form/templates/mobile_app/script.min.js";s:3:"map";s:75:"/bitrix/components/bitrix/main.post.form/templates/mobile_app/script.map.js";}"*/
(function(){if(!window.BX||window.BX.MPF||!window.app){return}var t={},e=function(){var t=function(t){if(BX.type.isNotEmptyString(t)){this.id=t;this.url=t;this.name=t.substr(t.lastIndexOf("/")+1);if(this.name.indexOf("?")>=0)this.name=this.name.substr(0,this.name.indexOf("?"));this.ext=this.name.lastIndexOf(".")>0?this.name.substr(this.name.lastIndexOf(".")+1).toLowerCase():""}else{for(var e in t){if(t.hasOwnProperty(e)){this[e]=t[e]}}}};t.prototype={getErrorText:function(t){return t||BX.message("MPFFileWasNotUploaded")}};return t}(),i=function(){var t=function(t,e,i){this.id=e;this.url=window.location.protocol+"//"+window.location.host+this.urlUpload;this.values={};this.params=i;this.propertyName=this.params["FIELD_NAME"];this.catchUF=BX.delegate(this.catchUF,this);this.parseUF=BX.delegate(this.parseUF,this);this.prepareToSaveUF=BX.delegate(this.prepareToSaveUF,this)};t.prototype={prefixHTMLNode:"disk-attach-",userTypeId:"disk_file",urlUpload:"/bitrix/tools/disk/uf.php?action=uploadFile&ncc=1",uploadBase64:function(t){var e=new window.FileUploadOptions,i=new window.FileTransfer,s=BX.proxy((function(e){e=BX.parseJSON(e.response);if(e==null)o();else this.uploadBase64Response(t,e)}),this),o=BX.proxy((function(){this.uploadBase64Failure(t,BX.message("MPFIncorrectResponse"))}),this);e.fileKey=this.userTypeId;e.fileName=t.name;e.params={sessid:BX.bitrix_sessid()};e.mimeType="image/jpeg";e.chunkedMode=false;i.upload(t.url,this.url,s,BX.proxy((function(){window.app.BasicAuth({success:BX.proxy((function(n){e.params.sessid=n.sessid_md5;i.upload(t.url,this.url,s,o,e)}),this),failure:o})}),this),e)},uploadBase64Failure:function(t,e){BX.onCustomEvent(t,"onUploadError",[t.getErrorText(e)])},uploadBase64Response:function(t,e){var i;if(e.status!="success"){i=e["message"];if(!i&&BX.type.isArray(e["errors"])){for(var s=0;s<e["errors"].length;s++){if(e["errors"][s]&&e["errors"][s]["message"]){i=(i||"")+e["errors"][s]["message"]}}}this.uploadBase64Failure(t,i)}else{e=e.data;var o=e["attachId"]||e["id"],n="blank";if(BX.util.in_array(t.ext,["jpg","bmp","jpeg","jpe","gif","png","webp"]))n="img";else if(BX.util.in_array(t.ext,["doc","pdf","ppt","rar","xls","zip"]))n=t.ext;BX.onCustomEvent(t,"onUploadOk",["[DISK FILE ID="+o+"]",{extension:e["ext"],iconUrl:"/bitrix/components/bitrix/mobile.disk.file.detail/images/"+n+".png",previewImageUrl:"",id:o,fileId:o,xmlID:"0",name:e["name"],type:e["ext"],propertyName:this.propertyName,fieldName:this.propertyName+(this.params["MULTIPLE"]=="Y"?"[]":""),fieldValue:o,url:(BX.message("MobileSiteDir")||"/")+"mobile/ajax.php?attachedId="+o+"&action=download&ncc=1&mobile_action=disk_uf_view&filename="+["name"]},this])}},catchUF:function(t,e,i){if(t&&t[this.propertyName]&&t[this.propertyName]["USER_TYPE_ID"]==this.userTypeId&&BX.type.isArray(t[this.propertyName]["VALUE"])){i["uf"]=i["uf"]||{};t=t[this.propertyName];var s=function(){var t="id"+Math.random();while(i["uf"][t])t="id"+Math.random();return t};for(var o=0,n,a,r,l,m,d,h;o<t["VALUE"].length;o++){a=t["VALUE"][o];n=BX(this.prefixHTMLNode+a);r=n&&n.getAttribute("data-bx-title")||"noname";l=r.lastIndexOf(".")>0?r.substr(r.lastIndexOf(".")+1).toLowerCase():"";m="blank";h=s();if(BX.util.in_array(l,["jpg","bmp","jpeg","jpe","gif","png","webp"]))m="img";else if(BX.util.in_array(l,["doc","pdf","ppt","rar","xls","zip"]))m=l;if(n){d={extension:l,iconUrl:"/bitrix/components/bitrix/mobile.disk.file.detail/images/"+m+".png",previewImageUrl:n.getAttribute("data-bx-src")||n.getAttribute("src")||undefined,id:h,fileId:n.getAttribute("bx-attach-file-id"),xmlID:n.getAttribute("bx-attach-xml-id"),name:r,type:l,propertyName:this.propertyName,fieldName:this.propertyName+(this.params["MULTIPLE"]=="Y"?"[]":""),fieldValue:a,url:(BX.message("MobileSiteDir")||"/")+"mobile/ajax.php?attachedId="+a+"&action=download&ncc=1&mobile_action=disk_uf_view&filename="+r};i["uf"][h]=d;e.push(d)}}}},parseUF:function(t,e){if(e&&e.length>0){var i=t.text,s,o;if(BX.type.isNotEmptyString(i)){for(s=0;s<e.length;s++){o=e[s];if(o.propertyName==this.propertyName){if(parseInt(o.fileId)>0){i=i.replace("[DISK FILE ID=n"+o.fileId+"]","[DISK FILE ID="+o.id+"]")}else if(e.length==1&&BX.util.in_array(o.type,["gif","jpg","jpeg","png","jpe","bmp","webp"])){i+="\n[DISK FILE ID="+(o.fieldValue?o.fieldValue:"n"+o.fileId)+"]"}}}}else{var n=null;var a=null;for(s=0;s<e.length;s++){o=e[s];if(o.propertyName===this.propertyName){a="&nbsp;";if(BX.type.isNotEmptyString(o.type)){n=BX.MobileUtils.getType(BX.MobileUtils.getFileMimeType(o.type));if(n==="image"||n==="video"){a="[DISK FILE ID="+(o.fieldValue?o.fieldValue:"n"+o.fileId)+"]"}}}i+=a}}t.text=i}},prepareToSaveUF:function(t,e){if(t.length>0){var i=[];t.forEach(function(t){t["propertyName"]=t["propertyName"]||this.propertyName;t["fieldName"]=t["fieldName"]||t["propertyName"]+(this.params["MULTIPLE"]==="Y"?"[]":"");if(!t["fieldValue"]){var e=t["VALUE"]?t:t["dataAttributes"]&&t["dataAttributes"]["VALUE"]?t["dataAttributes"]:null;if(e){t["name"]=e["NAME"];t["ext"]=t["name"].split(".").pop();t["ext"]=t["ext"]===t["name"]?"":t["ext"];t["id"]=e["ID"];t["fileId"]=e["ID"];t["xmlID"]=0;t["type"]=t["ext"];t["fieldValue"]=e["VALUE"];t["url"]=e["URL"]["URL"]}else if(!t["base64"]){return}}i.push(t)}.bind(this));if(i.length>0){e.add(this,i)}}else{t.push({fieldName:this.propertyName+(this.params["MULTIPLE"]=="Y"?"[]":""),fieldValue:""})}},upload:function(t){var e=t.pop();if(e){var i=BX.proxy((function(o,n){BX.removeCustomEvent(e,"onUploadOk",i);BX.removeCustomEvent(e,"onUploadError",s);for(var a in n){if(n.hasOwnProperty(a)){e[a]=n[a]}}this.upload(t)}),this),s=BX.proxy((function(t){BX.removeCustomEvent(e,"onUploadOk",i);BX.removeCustomEvent(e,"onUploadError",s);BX.onCustomEvent(this,"onUploadError",[t])}),this);BX.addCustomEvent(e,"onUploadOk",i);BX.addCustomEvent(e,"onUploadError",s);this.uploadBase64(e);return}BX.onCustomEvent(this,"onUploadOk",[])}};return t}(),s=function(){var t=function(){};t.prototype={files:[],queue:{},getId:function(){return"id"+Math.random()},add:function(t,e){if(!t["__queueId"]){t.__queueId=this.getId();t.__onUploadOk=BX.delegate((function(){this.start(t)}),this);t.__onUploadError=BX.delegate(this.error,this);BX.addCustomEvent(t,"onUploadOk",t.__onUploadOk);BX.addCustomEvent(t,"onUploadError",t.__onUploadError)}else{var i,s=(this.queue[t.__queueId]||[t,[]])[1];while((i=e.pop())&&i){s.push(i)}e=s}this.queue[t.__queueId]=[t,e]},start:function(t){if(t&&t.__queueId){this.clear(t)}var e;for(var i in this.queue){if(this.queue.hasOwnProperty(i)){e=this.queue[i];delete this.queue[i];if(e[0]&&e[0]["upload"]){e[0]["upload"](e[1])}else{this.start(e[0])}return}}BX.onCustomEvent(this,"onUploadOk",[])},clear:function(t){if(t.__queueId){delete this.queue[t.__queueId];delete t.__queueId;BX.removeCustomEvent(t,"onUploadOk",t.__onUploadOk);BX.removeCustomEvent(t,"onUploadError",t.__onUploadError);delete t.__onUploadOk;delete t.__onUploadError}},error(){var t=[],e;for(e in this.queue){if(this.queue.hasOwnProperty(e)){t.push(e)}}while((e=t.pop())&&e)this.clear(this.queue[e]);BX.onCustomEvent(this,"onUploadError",[BX.message("MPFFileWasNotUploaded")])}};return t}(),o=function(){var t=function(t,e={}){this.handler=t;this.id=BX.util.getRandomString(8);this.params={placeholder:BX.message("MPFPlaceholder"),onEvent:BX.delegate(this.handleAppCallback,this),onSend:BX.delegate(this.handleAppData,this)};this.analyticsData=e.analyticsData};t.prototype={handleAppData(t,i){t=BX.type.isNotEmptyString(t)?{text:t}:BX.type.isPlainObject(t)?t:{};var s=t.attachedFiles||[],o=t.text||"";if(!i){this.handler.comment.node=null}for(var n=0;n<s.length;n++){s[n]=new e(s[n])}this.stopCheckWriting();BX.onCustomEvent(this,"onFormSubmitted",[o,s,undefined,this.analyticsData])},handleAppFile(t,i){if(!i){this.handler.comment.node=null}this.stopCheckWriting();var s=this;window.BXMobileApp.UI.Page.TextPanel.getText((function(i){BX.onCustomEvent(s,"onFileSubmitted",[i,new e(t)])}))},handleAppCallback(t){if(this.writingParams.lastEvent!=t&&(!t||t.event!=="removeFocus")){this.writingParams.lastEvent=t;this.writingParams.text+=t.text;this.writingParams["~text"]=t.text;BX.onCustomEvent("main.post.form/text",[t.text]);if(this.writingParams.text.length>4){this.writingParams.text="";this.startCheckWriting()}}},init(t,e){t=t||"";this.params.text=t;if(BX.type.isNotEmptyObject(e)&&e.hideForm&&typeof window.BX.MobileUI.TextField.setDefaultParams==="function"){window.BX.MobileUI.TextField.setDefaultParams(this.params)}else{window.BX.MobileUI.TextField.show(this.params);if(!BX.type.isNotEmptyObject(e)||!e.clear){BX.onCustomEvent("main.post.form/mobile_simple",[])}}if(BX.type.isNotEmptyString(t)){this.writingParams["~text"]=t}else{this.writingParams["~text"]=""}this.writingParams.text=""},show(t){if(BX.type.isString(t)){window.BXMobileApp.UI.Page.TextPanel.setText(t);this.writingParams["~text"]=t}window.BXMobileApp.UI.Page.TextPanel.focus()},clear(){this.writingParams.text="";this.writingParams["~text"]="";window.BXMPage.TextPanel.clear()},writingParams:{lastFired:0,lastEvent:null,frequency:1e4,text:"","~text":""},stopCheckWriting(){this.writingParams.text=""},startCheckWriting(){var t=new Date;if(t-this.writingParams.lastFired>this.writingParams.frequency){BX.onCustomEvent(this,"onUserIsWriting",[this]);this.writingParams.lastFired=t}},showWait(){window.BXMobileApp.UI.Page.TextPanel.showLoading(true)},closeWait(){window.BXMobileApp.UI.Page.TextPanel.showLoading(false)}};return t}(),n=function(){var t=function(t,e){this.handler=t;this.formSettings={attachButton:{items:this.initFiles(e["CID"])},attachFileSettings:{resize:[40,1,1,1e3,1e3,0,2,false,true,false,null,0],sendLocalFileMethod:"base64",saveToPhotoAlbum:true},attachedFiles:[],extraData:{},mentionButton:{dataSource:{return_full_mode:"YES",outsection:"NO",okname:BX.message("MPFButtonSend"),cancelname:BX.message("MPFButtonCancel"),multiple:"NO",alphabet_index:"YES",url:BX.message("MobileSiteDir")+"mobile/index.php?mobile_action=get_user_list&use_name_format=Y"}},smileButton:{},message:{text:""},okButton:{callback:BX.delegate(this.applyExtendedForm,this),name:BX.message("MPFButtonSend")},cancelButton:{callback:BX.delegate(this.cancelExtendedForm,this),name:BX.message("MPFButtonCancel")}}};t.prototype={initFiles:function(t){this.controllers={};if(!t||typeof t!=="object")return[];var e,i=[],s;for(e in t){if(t.hasOwnProperty(e)){if(t[e]["USER_TYPE_ID"]=="disk_file"){s={id:"disk",name:BX.message("MPFPostFormDisk"),dataSource:{multiple:"NO",url:BX.message("SITE_DIR")+"mobile/?mobile_action=disk_folder_list&type=user&path=%2F&entityId="+BX.message("USER_ID")}};s.dataSource[window["platform"]=="ios"?"table_settings":"TABLE_SETTINGS"]={searchField:"YES",showtitle:"YES",modal:"YES",name:BX.message("MPFPostFormDiskTitle")};i.push(s)}}}if(i.length>0){i.push({id:"mediateka",name:BX.message("MPFPostFormPhotoGallery")});i.push({id:"camera",name:BX.message("MPFPostFormPhotoCamera")})}return i},applyExtendedForm:function(t){this.stopCheckWriting();t.text=t.text||"";t.attachedFiles=t.attachedFiles||[];for(var i=0;i<t.attachedFiles.length;i++){t.attachedFiles[i]=new e(t.attachedFiles[i])}t.extraData=t.extraData||{};BX.onCustomEvent(this,"onApplyComment",[t,t.attachedFiles]);BX.onCustomEvent(this,"onFormSubmitted",[t.text,t.attachedFiles,t.extraData])},cancelExtendedForm:function(){BX.onCustomEvent(this,"onCancelComment",[]);this.stopCheckWriting()},show:function(t,e){var i=document.createElement("textarea");i.innerHTML=t;this.formSettings.message={text:i.value};i.remove();this.formSettings.attachedFiles=[];this.formSettings.extraData={};if(e){BX.onCustomEvent(this,"onEditCommentUF",[e["UF"],this.formSettings.attachedFiles,this.formSettings.extraData]);BX.onCustomEvent(this,"onEditCommentFiles",[e["FILES"],this.formSettings.attachedFiles,this.formSettings.extraData])}window.app.exec("showPostForm",this.formSettings)},clear:function(){this.writingParams.text="";this.writingParams["~text"]=""},writingParams:{lastFired:0,lastEvent:null,frequency:1e4,text:""},stopCheckWriting:function(){this.writingParams.text=""},startCheckWriting:function(){var t=new Date;if(t-this.writingParams.lastFired>this.writingParams.frequency){this.writingParams.lastFired=t}},showWait:function(){},closeWait:function(){}};return t}();BX.MPF=function(){var e=function(e){if(!window.app.enableInVersion(4))throw this.errors["error00"];if(t[e["formId"]])t[e["formId"]].destroy();this.form=BX(e["formId"]);if(!this.form)throw this.errors["error01"];this.id=this.form.id;this.forumContext=e.forumContext||"";BX.hide(this.form);document.body.appendChild(this.form);this.text=this.form.elements[e.text.name];if(!this.text){this.text=BX.create("INPUT",{props:{type:"hidden",name:e.text.name,value:""}});this.form.appendChild(this.text)}this.block=BX.create("DIV",{className:"bx-additional-block-data"});this.form.appendChild(this.block);this.simpleForm=new o(this,e);this.extendedForm=new n(this,e);this.currentForm=null;this.uniqueId=BX.util.getRandomString(8);t[this.id]=this;this.initEvents();this.controllers={};this.initControllers(e["CID"]);BX.onCustomEvent(window,"onMPFIsInitialized",[this])};e.prototype={errors:{error00:"BX.MPL: Mobile Application is obsolete.",error01:"BX.MPL: form does not exist."},initEvents:function(){BX.addCustomEvent(this.simpleForm,"onFormSubmitted",BX.delegate(this.submitExtended,this));BX.addCustomEvent(this.simpleForm,"onUserIsWriting",BX.delegate(this.writing,this));BX.addCustomEvent(this.extendedForm,"onFormSubmitted",BX.delegate(this.submitExtended,this));BX.addCustomEvent(this.extendedForm,"onCancelComment",this.cancel.bind(this))},initControllers(t){if(t||typeof t==="object"){var e,s=false;for(e in t){if(t.hasOwnProperty(e)){if(t[e].USER_TYPE_ID==="disk_file"){this.controllers[e]=new i(this,e,t[e]);if(!s){BX.addCustomEvent(this,"onExtendedCheckUpload",this.controllers[e].prepareToSaveUF);BX.addCustomEvent(this,"onExtendedCheckData",this.controllers[e].parseUF);s=true}BX.addCustomEvent(this.extendedForm,"onEditCommentUF",this.controllers[e].catchUF);BX.addCustomEvent(this.extendedForm,"onApplyComment",this.controllers[e].parseUF)}}}}},destroy(){BX.remove(this.form);BX.onCustomEvent(this.handler,"onMPFHasBeenDestroyed",[this.id,t[this.id],this]);t[this.id]=null},writing(){BX.onCustomEvent(this,"onMPFUserIsWriting",[this.comment])},setForm(t){this.currentForm=t===true?this.extendedForm:this.simpleForm},init(t,e){this.comment=t;this.setForm(false);this.simpleForm.init(t.text,{hideForm:BX.type.isNotEmptyString(this.forumContext)&&this.forumContext.toLowerCase()==="task",clear:BX.type.isNotEmptyObject(e)&&BX.type.isBoolean(e.clear)&&e.clear})},show(t,e){BX.onCustomEvent(this,"onShow",[this,t]);this.comment=t;this.setForm(e);this.currentForm.show(t.text,t.attachments)},clear(){if(this.currentForm!==null){this.currentForm.clear()}},submitBase64(t,e){var i={filesToPost:false};BX.onCustomEvent(this,"onBase64Submitted",[e,i]);if(i.filesToPost!==false){BX.onCustomEvent(this.comment,"onStart",[this.comment,t,[e]]);BX.addCustomEvent(e,"onUploadOk",BX.proxy((function(e,i){this.submit(BX.type.isNotEmptyString(t)?t:e,[i])}),this));BX.addCustomEvent(e,"onUploadError",BX.proxy(this.error,this));BX.onCustomEvent(e,"onUploadStart",[e])}else{this.cancel()}},submitExtended(t,e,i,s){if(!(BX.type.isNotEmptyString(t)||BX.type.isArray(e)&&e.length>0)){this.cancel();return}if(typeof i!=="undefined"&&typeof i.uf!=="undefined"){for(var o=0,n,a;o<e.length;o++){if(e[o]&&e[o].id&&i.uf[e[o].id]){for(a in i.uf[e[o].id]){if(i.uf[e[o].id].hasOwnProperty(a)){if(!e[o][a]){e[o][a]=i.uf[e[o].id][a]}}}e[o].id=i.uf[e[o].id].fieldValue}}}var r={attachments:e,uploadTasks:[],taskIdList:[]};this.processAttachments(r).then((()=>{this.setForm(false);this.clear();this.comment.text=t;this.text.value=this.comment.getText();this.comment.attachments=e;this.comment.extraData=i;BXMobileApp.onCustomEvent("Comments.UploadQueue::setItem",{commentNodeId:this.comment.node.id,commentVirtualId:r.commentVirtualId,formId:this.form.id,formUniqueId:this.uniqueId,entityId:this.comment.id[0],text:t,attachments:BX.type.isArray(r.attachments)?r.attachments:[],taskIdList:BX.type.isArray(r.taskIdList)?r.taskIdList:[],extraData:typeof i==="undefined"?{}:i,analyticsData:s},true)}));BX.onCustomEvent(this.comment,"onStart",[this.comment,t,e])},cancel(){this.setForm(false);this.clear();BX.onCustomEvent(this.comment,"onCancel",[this.comment])},error(t){this.setForm(false);this.clear();BX.onCustomEvent(this.comment,"onError",[this.comment,t])},addComment(t,e){var i={text:t.text},o=t.attachments;var n=new s;BX.onCustomEvent(this,"onExtendedCheckUpload",[o,n]);BX.onCustomEvent(this,"onExtendedCheckData",[i,o]);if(BX.type.isNotEmptyString(i.text)){this.submit(i.text,o,null,e)}else{this.cancel()}},addError(t,e){this.cancel()},submit(t,e,i,s=null){this.setForm(false);this.clear();this.comment.text=t;this.text.value=this.comment.getText();this.comment.attachments=e;this.comment.extraData=i;BX.onCustomEvent(this.comment,"onSubmit",[this.comment,s])},getForm(t){return BX.ajax.prepareForm(this.form,t).data},showWait(){if(this.currentForm!==null){this.currentForm.showWait()}},closeWait(){if(this.currentForm!==null){this.currentForm.closeWait()}},processAttachments(t){var e=new Promise(function(e,i){t.commentVirtualId=parseInt(Math.random()*1e5);if(BX.type.isNotEmptyObject(t)&&BX.type.isArray(t.attachments)&&t.attachments.length>0){var s=null,o=null,n=null;for(var a=0;a<t.attachments.length;a++){o=t.attachments[a];if(o&&o.url&&o.url.match(/^file:\/\//)){s="commentTask_"+parseInt(Math.random()*1e5);n=BX.MobileUtils.getFileMimeType(o.type);t.uploadTasks.push({taskId:s,type:o.type,mimeType:n,folderId:parseInt(BX.message("MOBILE_EXT_UTILS_USER_FOLDER_FOR_SAVED_FILES")),params:{commentVirtualId:t.commentVirtualId},name:typeof BX.MobileUtils.getUploadFilename==="function"?BX.MobileUtils.getUploadFilename(o.name,o.type):o.name,url:o.url,previewUrl:o.previewUrl?o.previewUrl:null,resize:BX.MobileUtils.getResizeOptions(o.type)});t.taskIdList.push(s);delete t.attachments[a]}}t.attachments=t.attachments.filter((function(t){return t}));if(t.uploadTasks.length>0){BXMobileApp.onCustomEvent("onFileUploadTaskReceived",{files:t.uploadTasks},true)}e()}else{e()}}.bind(this));e.catch((function(t){console.error(t)}));return e}};return e}();BX.MPF.createInstance=function(e){if(!t[e.formId]){new BX.MPF(e)}return t[e.formId]};BX.MPF.getInstance=function(e){return t[e]};BX.MPF.onUploadQueueReady=function(e){var i=null;for(var s in t){if(s==e.formId){i=BX.MPF.getInstance(e.formId);if(i&&i.uniqueId&&e.formUniqueId&&i.uniqueId==e.formUniqueId&&i.comment.id[0]==e.entityId){i.addComment(e.commentData,e.analyticsData);break}}}};BX.MPF.onUploadQueueError=function(e){var i=null;for(var s in t){if(s==e.formId){i=BX.MPF.getInstance(e.formId);if(i.comment.id[0]==e.entityId){i.addError(e.commentData,e.errorText);BX.onCustomEvent(window,"OnUploadQueueError",[e]);break}}}};BX.onCustomEvent(window,"main.post.form/mobile",["mobile"]);BXMobileApp.addCustomEvent("Comments.UploadQueue::ready",BX.MPF.onUploadQueueReady);BXMobileApp.addCustomEvent("Comments.UploadQueue::error",BX.MPF.onUploadQueueError)})();
/* End */
;; /* /bitrix/templates/mobile_app/tasks/logic.min.js?17287331809326*/
; /* /bitrix/components/bitrix/tasksmobile.comments/templates/.default/script.min.js?17287331865154*/
; /* /bitrix/templates/mobile_app/log_mobile.min.js?17287331802637*/
; /* /bitrix/components/bitrix/main.post.list/templates/mobile_app/script.min.js?172873318520122*/
; /* /bitrix/components/bitrix/main.post.list/templates/.default/script.min.js?172873318560094*/
; /* /bitrix/components/bitrix/main.post.form/templates/mobile_app/script.min.js?172873318119190*/

//# sourceMappingURL=page_2b53494e6a6afebba8603875c46351a5.map.js