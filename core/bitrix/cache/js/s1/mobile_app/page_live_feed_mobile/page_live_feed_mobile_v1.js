
; /* Start:"a:4:{s:4:"full";s:107:"/bitrix/components/bitrix/mobile.socialnetwork.log.ex/templates/.default/mobile_files.min.js?17287331851673";s:6:"source";s:88:"/bitrix/components/bitrix/mobile.socialnetwork.log.ex/templates/.default/mobile_files.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";var n=function n(e,r){return new Promise(function(n,t){window.resolveLocalFileSystemURL(e,function(e){return r(e,n,t)},function(n){return t(n)})})};BX.FileUtils={getFileEntry:function e(r){if(r.indexOf("file://")<0){r="file://"+r}return n(r,function(n,e,r){if(n.isFile){e(n)}else{r(new FileError(100))}})},getFile:function n(e){return new Promise(function(n,r){return BX.FileUtils.getFileEntry(e).then(function(e){return e.file(function(e){return n(e)})}).catch(function(n){return r(n)})})},readFile:function n(e,r){return new Promise(function(n,t){if(e instanceof File){var i=new FileReader;var u=r?r:"readAsText";i.onloadend=function(e){return n(i.result)};i.onerror=function(n){return t({"Error reading":i})};i[u](e)}else{t(new BX.FileError(102,"Parameter 'file' is not instance of 'File'"))}})},readFileEntry:function n(e,r){return new Promise(function(n,t){if(e instanceof FileEntry){e.file(function(e){BX.FileUtils.readFile(e,r).then(function(e){return n(e)}).catch(function(n){return t(n)})})}else{t(new BX.FileError(102,"Parameter 'file' is not instance of 'File'"))}})},readFileByPath:function n(e,r){return new Promise(function(n,t){BX.FileUtils.getFileEntry(e).then(function(e){return BX.FileUtils.readFileEntry(e,r).then(function(e){return n(e)}).catch(function(n){return t(n)})}).catch(function(n){return t(n)})})},readDir:function e(r){return n(r,function(n,e,r){n.createReader().readEntries(function(n){return e(n)},function(n){return r(n)})})},fileForReading:function n(e){return new Promise(function(n,r){BX.FileUtils.getFile(e).then(function(r){var t=new BX.File(r);t.originalPath=e;n(t)}).catch(function(n){return r(n)})})}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:111:"/bitrix/components/bitrix/mobile.socialnetwork.log.ex/templates/.default/script_attached.min.js?172873318563383";s:6:"source";s:91:"/bitrix/components/bitrix/mobile.socialnetwork.log.ex/templates/.default/script_attached.js";s:3:"min";s:95:"/bitrix/components/bitrix/mobile.socialnetwork.log.ex/templates/.default/script_attached.min.js";s:3:"map";s:95:"/bitrix/components/bitrix/mobile.socialnetwork.log.ex/templates/.default/script_attached.map.js";}"*/
function __MSLOnFeedPreInit(e){}function __MSLOnFeedInit(e){logID=parseInt(e.logID);bAjaxCall=!!e.bAjaxCall;bReload=!!e.bReload;bEmptyPage=!!e.bEmptyPage;bFiltered=!!e.bFiltered;groupID=parseInt(e.groupID);groupImage=e.groupImage;tmstmp=parseInt(e.tmstmp);strCounterType=e.strCounterType;var t=!BX.type.isUndefined(e.canAddPost)?!!e.canAddPost:true;oMSL.groupID=parseInt(e.groupID);oMSL.ftMinTokenSize=parseInt(e.ftMinTokenSize);oMSL.bShowExpertMode=!!e.bShowExpertMode;oMSL.bExpertMode=!!e.bExpertMode;oMSL.bDetailEmptyPage=bEmptyPage;oMSL.curUrl=e.curUrl;oMSL.appCacheDebug=!!e.appCacheDebug;oMSL.pageType=logID<=0&&!bEmptyPage?"list":"detail";if(logID<=0&&!bEmptyPage&&!bAjaxCall){if(!bReload){BX.addCustomEvent("BX.MobileLF:onSearchBarRefreshStart",(function(e){BX.MobileLivefeed.PageInstance.refresh(true,{find:e.text})}));BX.addCustomEvent("BX.MobileLF:onSearchBarRefreshAbort",(function(){if(!BX.type.isNull(BX.MobileLivefeed.PageInstance.refreshXhr)){BX.MobileLivefeed.PageInstance.refreshXhr.abort()}}));BX.MobileLivefeed.SearchBarInstance.init({ftMinTokenSize:oMSL.ftMinTokenSize})}BX.MobileLivefeed.PageMenuInstance.listPageMenuItems=[];if(groupID>0){BX.ready((function(){if(t){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"addPost",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_ADD_POST"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){if(Application.getApiVersion()>=BX.MobileLivefeed.Instance.getApiVersion("layoutPostForm")){BX.MobileLivefeed.PostFormManagerInstance.show({pageId:BX.MobileLivefeed.Instance.getPageId(),groupId:groupID,postId:0})}else{oMSL.initPostForm({groupId:groupID,callback:function(){app.exec("showPostForm",BX.MobileLivefeed.PostFormOldManagerInstance.show({groupId:groupID}))}})}},arrowFlag:false})}if(Application.getApiVersion()<BX.MobileLivefeed.Instance.getApiVersion("tabs")){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"groupTasks",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_GROUP_TASKS"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_check.png",icon:"checkbox",arrowFlag:true,action:function(){BXMobileApp.Events.postToComponent("taskbackground::taskList::open",[{groupId:groupID,groupName:BX.message("MSLLogTitle"),groupImageUrl:groupImage,ownerId:BX.message("USER_ID")}],"background")}});BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"groupFiles",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_GROUP_FILES"),image:"/bitrix/templates/mobile_app/images/lenta/menu/files.png",action:function(){app.openBXTable({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/?mobile_action=disk_folder_list&type=group&path=/&entityId="+groupID,TABLE_SETTINGS:{type:"files",name:BX.message("MSLLogTitle"),useTagsInSearch:false}})},arrowFlag:true,icon:"file"})}if(BX.message("MSLPathToKnowledgeGroup")){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"knowledge",name:BX.message("MSLTitleKnowledgeGroup"),image:"/bitrix/templates/mobile_app/images/lenta/menu/knowledge_base.png",action:function(){window.BXMobileApp.PageManager.loadPageUnique({url:BX.message("MSLPathToKnowledgeGroup").replace(/ /g,"%20"),bx24ModernStyle:true,cache:false})}})}BX.MobileLivefeed.PageMenuInstance.init({type:"list"})}));setTimeout((function(){BX.MobileLivefeed.Instance.setPageId("list_group_"+groupID);BX.MobileLivefeed.Instance.setOptions({groupId:groupID})}),0)}else{BX.ready((function(){setTimeout((function(){if(!bFiltered){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"addPost",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_ADD_POST"),image:"/bitrix/templates/mobile_app/images/lenta/menu/pencil.png",action:function(){if(Application.getApiVersion()>=BX.MobileLivefeed.Instance.getApiVersion("layoutPostForm")){BX.MobileLivefeed.PostFormManagerInstance.show({pageId:BX.MobileLivefeed.Instance.getPageId(),postId:0})}else{oMSL.initPostForm({groupId:groupID,callback:function(){app.exec("showPostForm",BX.MobileLivefeed.PostFormOldManagerInstance.show())}})}},arrowFlag:false});if(BX.message("MOBILE_EXT_LIVEFEED_TASKS_INSTALLED")=="Y"||BX.message("MOBILE_EXT_LIVEFEED_TIMEMAN_INSTALLED")=="Y"){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetWork",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_WORK"),image:"/bitrix/templates/mobile_app/images/lenta/menu/work.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?work=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}})}BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetFavorites",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_FAVORITES"),image:"/bitrix/templates/mobile_app/images/lenta/menu/favorite.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?favorites=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetMy",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_MY"),image:"/bitrix/templates/mobile_app/images/lenta/menu/mine.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?my=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetImportant",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_IMPORTANT"),image:"/bitrix/templates/mobile_app/images/lenta/menu/important.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?important=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}});if(BX.message("MOBILE_EXT_LIVEFEED_LISTS_INSTALLED")=="Y"){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"presetBizproc",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_PRESET_BIZPROC"),image:"/bitrix/templates/mobile_app/images/lenta/menu/workflow.png",arrowFlag:true,action:function(){app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/index.php?bizproc=Y",cache:false,bx24ModernStyle:true,useSearchBar:true})}})}BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"refresh",name:BX.message("MOBILE_EXT_LIVEFEED_LIST_MENU_REFRESH"),image:"/bitrix/templates/mobile_app/images/lenta/menu/n_refresh.png",arrowFlag:false,action:function(){oMSL.pullDownAndRefresh()}});BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"followDefault",name:BX.MobileLivefeed.FollowManagerInstance.getFollowDefaultValue()?BX.message("MSLMenuItemFollowDefaultY"):BX.message("MSLMenuItemFollowDefaultN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/glasses.png",arrowFlag:false,feature:"follow",action:function(){BX.MobileLivefeed.FollowManagerInstance.setFollowDefault({value:!BX.MobileLivefeed.FollowManagerInstance.getFollowDefaultValue()})}});if(oMSL.bShowExpertMode){BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.push({id:"expertMode",name:oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN"),image:"/bitrix/templates/mobile_app/images/lenta/menu/expert.png",arrowFlag:false,feature:"expert",action:function(){oMSL.setExpertMode({value:!oMSL.bExpertMode})}})}BX.MobileLivefeed.PageMenuInstance.init({type:"list"})}}),1e3);BX.MobileLivefeed.Instance.setPageId("list")}))}setTimeout((function(){BX.MobileLivefeed.Instance.setOptions({signedParameters:BX.type.isNotEmptyString(e.signedParameters)?e.signedParameters:{},pathToEmptyPage:BX.type.isNotEmptyString(e.pathToEmptyPage)?e.pathToEmptyPage:"",pathToCalendarEvent:"/mobile/calendar/view_event.php?event_id=#EVENT_ID#",pathToTasksRouter:BX.type.isNotEmptyString(e.pathToTasksRouter)?e.pathToTasksRouter:"",destinationToAllDeny:BX.type.isBoolean(e.destinationToAllDeny)&&e.destinationToAllDeny,destinationToAllDefault:!BX.type.isBoolean(e.destinationToAllDefault)||e.destinationToAllDefault,backgroundImagesData:BX.type.isNotEmptyObject(e.backgroundImagesData)?e.backgroundImagesData:{},backgroundCommon:BX.type.isNotEmptyObject(e.backgroundCommon)?e.backgroundCommon:{},medalsList:BX.type.isNotEmptyObject(e.medalsList)?e.medalsList:{},importantData:BX.type.isNotEmptyObject(e.importantData)?e.importantData:{},postFormData:BX.type.isNotEmptyObject(e.postFormData)?e.postFormData:{}});BX.MobileLivefeed.FollowManagerInstance.setFollowDefaultValue(BX.type.isBoolean(e.bFollowDefault)?e.bFollowDefault:true)}),0);if(!bReload){setTimeout((function(){BX.MobileLivefeed.PublicationQueueInstance.emit("onFeedReady")}),0);oMSL.registerBlocksToCheck();if(typeof window.bFeedInitialized!="undefined"&&window.bFeedInitialized){BX.ready((function(){BX.MobileLivefeed.Instance.recalcMaxScroll();setTimeout((function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])}),1e3)}));return}else{BX.ready((function(){BX.onCustomEvent(window,"BX.UserContentView.onInitCall",[{mobile:true,ajaxUrl:BX.message("MSLSiteDir")+"mobile/ajax.php",commentsContainerId:"post-comments-wrap",commentsClassName:"post-comment-wrap"}])}));window.bFeedInitialized=true}window.arLikeRandomID={};window.LiveFeedID=parseInt(Math.random()*1e5);if(groupID<=0){BX.ready((function(){setTimeout((function(){if(!bFiltered){}else{BXMobileApp.UI.Page.TopBar.title.setText(BX.message("MSLLogTitle"));BXMobileApp.UI.Page.TopBar.title.setCallback("");BXMobileApp.UI.Page.TopBar.title.show()}}),1e3)}))}oMSL.initPostForm({groupId:groupID});BXMobileApp.addCustomEvent("onBlogPostDelete",(function(e){oMSL.pullDownAndRefresh()}));BX.ready((function(){if(bFiltered&&window.platform=="android"){BX.addCustomEvent("onOpenPageBefore",(function(){oMSL.pullDownAndRefresh()}))}}));BXMobileApp.addCustomEvent("onLogEntryRead",(function(e){__MSLLogEntryRead(e.log_id,e.ts,e.bPull===true||e.bPull==="YES")}));BXMobileApp.addCustomEvent("onCommentsGet",(function(e){if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){arLogTs["entry_"+e.log_id]=e.ts}}));BXMobileApp.addCustomEvent("onLogEntryCommentAdd",(function(e){BX.MobileLivefeed.CommentsInstance.onLogEntryCommentAdd(e.log_id)}));BXMobileApp.addCustomEvent("onLogEntryRatingLike",(function(e){oMSL.onLogEntryRatingLike({ratingId:e.rating_id,voteAction:e.voteAction,logId:e.logId})}));BXMobileApp.addCustomEvent("onLogEntryImpPostRead",(function(e){BX.MobileLivefeed.ImportantManagerInstance.renderRead({node:BX("important_post_"+e.postId),value:true})}));BXMobileApp.addCustomEvent("onLogEntryFollow",(function(e){BX.MobileLivefeed.FollowManagerInstance.setFollow({logId:e.logId,pageId:e.pageId,bOnlyOn:typeof e.bOnlyOn!="undefined"&&e.bOnlyOn=="Y",bRunEvent:false})}));BXMobileApp.addCustomEvent("onLogEntryFavorites",(function(e){oMSL.onLogEntryFavorites(e.log_id,e.page_id)}));BXMobileApp.addCustomEvent("onLogEntryCommentsNumRefresh",(function(e){BX.MobileLivefeed.CommentsInstance.onLogEntryCommentAdd(e.log_id,e.num)}));BXMobileApp.addCustomEvent("onLogEntryPostUpdated",(function(e){oMSL.onLogEntryPostUpdated(e)}));BX.MobileUI.addLivefeedLongTapHandler(BX("lenta_wrapper_global"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}BX.MobileLivefeed.RatingInstance.emit("onFeedInit")}else if(bEmptyPage){window.isDetailPullDownEnabled=false;oMSL.registerEmptyBlockToCheck();BX.ready((function(){__MSLDrawDetailPage();BX.addCustomEvent("onOpenPageBefore",(function(){__MSLDrawDetailPage()}));BXMobileApp.addCustomEvent("onEditedPostFailed",(function(){app.hidePopupLoader()}));BX.MobileImageViewer.viewImageBind("post_item_top_wrap","img[data-bx-image]")}))}else if(logID>0){window.isDetailPullDownEnabled=false;window.arCanUserComment={};BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:logID,ts:tmstmp,bPull:false},true);BX.ready((function(){BX.MobileLivefeed.Instance.setPageId("detail_"+logID);BX.MobileLivefeed.Instance.setOptions({logId:logID});oMSL.registerBlocksToCheck();setTimeout((function(){oMSL.checkNodesHeight()}),100)}))}if(bEmptyPage||logID>0){if(logID>0&&BX("post_item_top_wrap_"+logID)){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap_"+logID),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}else if(BX("post_item_top_wrap")){BX.MobileUI.addLivefeedLongTapHandler(BX("post_item_top_wrap"),{likeNodeClass:"post-item-informer-like",copyItemClass:"post-item-copyable",copyTextClass:"post-item-copytext"})}if(BX("post-comments-wrap")){BX.MobileUI.addLivefeedLongTapHandler(BX("post-comments-wrap"),{likeNodeClass:"post-comment-control-item-like",copyItemClass:"post-comment-block",copyTextClass:"post-comment-text"})}BX.ready((function(){BX.MobileLivefeed.Instance.setOptions({destinationToAllDeny:BX.type.isBoolean(e.destinationToAllDeny)&&e.destinationToAllDeny,destinationToAllDefault:!BX.type.isBoolean(e.destinationToAllDefault)||e.destinationToAllDefault,backgroundImagesData:BX.type.isNotEmptyObject(e.backgroundImagesData)?e.backgroundImagesData:{},backgroundCommon:BX.type.isNotEmptyObject(e.backgroundCommon)?e.backgroundCommon:{},medalsList:BX.type.isNotEmptyObject(e.medalsList)?e.medalsList:{},importantData:BX.type.isNotEmptyObject(e.importantData)?e.importantData:{},postFormData:BX.type.isNotEmptyObject(e.postFormData)?e.postFormData:{}})}))}if(!bAjaxCall&&!bReload){BX.ready((function(){BXMobileApp.addCustomEvent("onEditedPostInserted",(function(e){app.hidePopupLoader();oMSL.drawDetailPageText(e);BXMobileApp.onCustomEvent("onLogEntryPostUpdated",e,true)}))}))}if(!bAjaxCall){BX.ready((function(){if(logID<=0&&!bEmptyPage){setTimeout((function(){BX.MobileLivefeed.Instance.recalcMaxScroll();BX.MobileLivefeed.PageInstance.initScroll(true)}),0);if(!bReload){BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",(function(){var e=navigator.network.connection.type;if(e==Connection.UNKNOWN||e==Connection.NONE){app.exec("pullDownLoadingStop");BX.MobileLivefeed.PageInstance.initScroll(false,true)}else{__MSLPullDownInit(true,false);BX.MobileLivefeed.PageInstance.initScroll(true,true)}}))}if(!bFiltered&&!bReload){BXMobileApp.addCustomEvent("onUpdateSocnetCounters",oMSL.onUpdateSocnetCountersHandler);BXMobileApp.addCustomEvent("onImUpdateCounter",oMSL.onImUpdateCounterHandler);BXMobileApp.addCustomEvent("onUpdateUserCounters",oMSL.onUpdateCounterHandler);BX.MobileTools.requestUserCounters()}}if(bEmptyPage||logID>0){BX.MobileLivefeed.PageScrollInstance.init();setTimeout((function(){BX.MobileLivefeed.Instance.setOptions({importantData:BX.type.isNotEmptyObject(e.importantData)?e.importantData:{}})}),0);BX.addCustomEvent("UIApplicationDidBecomeActiveNotification",(function(e){var t=navigator.network.connection.type;if(t==Connection.UNKNOWN||t==Connection.NONE){app.exec("pullDownLoadingStop")}else{var o=BX.MobileLivefeed.Instance.getLastActivityDate();if(o>0){var i=Math.round((new Date).getTime()/1e3);if(i-o>1740){if(bEmptyPage){BXMobileApp.UI.Page.isVisible({callback:function(e){if(e.status=="visible"){app.getPageParams({callback:function(e){if(parseInt(e.log_id)>0){BX.MobileLivefeed.Instance.setLogId(e.log_id)}BX.MobileLivefeed.CommentsInstance.getList({ts:oMSL.iDetailTs,bPullDown:false,obFocus:{form:"NO",comments:"NO"}})}})}else{oMSL.emptyRefreshCommentsFlag=true}}})}else{document.location.reload(true)}}}}}));__MSLDetailPullDownInit(true)}else{setTimeout((function(){oMSL.checkNodesHeight();BX.onCustomEvent(window,"BX.UserContentView.onRegisterViewAreaListCall",[{containerId:"lenta_wrapper",className:"post-item-contentview",fullContentClassName:"post-item-full-content"}])}),1e3);if(logID<=0){__MSLPullDownInit(true)}}}))}BXMobileApp.addCustomEvent("onHidePageBefore",(function(){var e=document.getElementsByTagName("video"),t=null;for(t=0;t<e.length;t++){if(!e[t].paused){e[t].pause()}}var o=document.querySelectorAll("iframe.bx-mobile-video-frame");for(t=0;t<o.length;t++){var i=o[t].getAttribute("src");if(i){o[t].src=o[t].src}}}))}function __MSLOpenLogEntryNew(e,t){var o=typeof e.show_full!="undefined"?!!e.show_full:false;if(typeof e.path=="undefined"||e.path==null||e.path.length<=0){return false}else{var i=e.path}if(typeof e.log_id=="undefined"||e.log_id==null||parseInt(e.log_id)<=0){return false}e.follow=BX("log_entry_follow_"+e.log_id)?BX("log_entry_follow_"+e.log_id).getAttribute("data-follow"):"Y";e.fav=BX("log_entry_favorites_"+e.log_id)&&BX("log_entry_favorites_"+e.log_id).classList.contains("lenta-item-fav-active")?"Y":"N";e.feed_id=typeof window.LiveFeedID!="undefined"?window.LiveFeedID:"";e.can_user_comment=typeof arCanUserComment!="undefined"&&typeof arCanUserComment[e.log_id]!="undefined"&&arCanUserComment[e.log_id];if(typeof t!="undefined"&&t!=null&&t&&typeof t.target!="undefined"&&t.target!=null){if(typeof t.target.tagName!="undefined"&&t.target.tagName.toLowerCase()=="a"&&!BX.hasClass(t.target,"post-item-more")){return false}var n=BX.findParent(t.target,{tag:"A"},{tag:"div",className:"post-item-post-block"});if(n){return false}}e.RandomID=typeof arLikeRandomID["entry_"+e.log_id]!="undefined"&&arLikeRandomID["entry_"+e.log_id]!=null?arLikeRandomID["entry_"+e.log_id]:false;var a=document.getElementById("post_block_check_cont_"+e.log_id);if(BX.type.isDomNode(a)){var s=null;var l=null;e.detailText=a.innerHTML;e.hasTitle=a.getAttribute("bx-data-has-title")==="Y";e.bIsPhoto=a.classList.contains("post-item-post-img-block");e.bIsImportant=a.classList.contains("info-block-important");e.medal=false;if(a.classList.contains("info-block-gratitude")){s=null;for(l=0;l<a.classList.length;l++){s=a.classList[l].match(/info-block-gratitude-(.+)/i);if(s){e.medal=s[1];break}}}e.backgroundCode=false;if(a.classList.contains("ui-livefeed-background")){s=null;for(l=0;l<a.classList.length;l++){s=a.classList[l].match(/ui-livefeed-background-(.+)/i);if(s){e.backgroundCode=s[1];break}}}}var r=document.getElementById("lenta_item_"+e.log_id);if(r){var d=r.parentNode.querySelector("span[data-type='inline-script']");if(d){e.inlineScript=d.innerHTML}}if(BX("post_block_files_"+e.log_id)){e.filesBlockText=BX("post_block_files_"+e.log_id).innerHTML}if(BX("post_more_limiter_"+e.log_id)){e.showMoreButton=BX("post_more_limiter_"+e.log_id).style.visibility!="hidden"}if(BX("post_item_top_"+e.log_id)){e.topText=BX("post_item_top_"+e.log_id).innerHTML}if(BX("informer_comments_all_"+e.log_id)){e.commentsNumAll=BX("informer_comments_all_"+e.log_id).innerHTML;if(BX("informer_comments_new_"+e.log_id)){e.commentsNumNew=BX.findChild(BX("informer_comments_new_"+e.log_id),{className:"post-item-inform-right-new-value"},true,false).innerHTML}}else if(BX("informer_comments_"+e.log_id)){e.commentsNum=BX("informer_comments_"+e.log_id).innerHTML}if(BX("comments_control_"+e.log_id)){e.commentsControl=!!BX("comments_control_"+e.log_id)}if(BX("rating_block_"+e.log_id)){e.ratingText=BX("rating_block_"+e.log_id).innerHTML;e.ratingCounter=parseInt(BX("rating_block_"+e.log_id).getAttribute("data-counter"))}if(BX("rating-footer-wrap_"+e.log_id)){e.ratingFooter=BX("rating-footer-wrap_"+e.log_id).innerHTML}e.bShowFull=o;if(typeof window.arLogTs["entry_"+e.log_id]!="undefined"&&window.arLogTs["entry_"+e.log_id]!=null){e.TS=arLogTs["entry_"+e.log_id]}e.bSetFocusOnCommentForm=typeof e.focus_form!="undefined"?!!e.focus_form:false;e.bSetFocusOnCommentsList=typeof e.focus_comments!="undefined"?!!e.focus_comments:false;app.loadPageBlank({url:i,bx24ModernStyle:true,data:e});return typeof t!="undefined"&&t!=null&&t?t.preventDefault():false}function __MSLDrawDetailPage(){app.getPageParams({callback:function(e){if(parseInt(e.log_id)>0){BX.MobileLivefeed.Instance.setLogId(e.log_id)}BXMobileApp.onCustomEvent("onLogEntryRead",{log_id:e.log_id,ts:BX.message("MSLCurrentTime"),bPull:false},true);oMSL.drawDetailPage(e)}})}function __MSLLogEntryRead(e,t,o){o=!!o;if(typeof window.arLogTs["entry_"+e]!="undefined"&&window.arLogTs["entry_"+e]!=null){arLogTs["entry_"+e]=t;if(BX("informer_comments_"+e)&&BX("informer_comments_new_"+e)&&!o){var i=BX("informer_comments_all_"+e).innerHTML.length>0?parseInt(BX("informer_comments_all_"+e).innerHTML):0;var n=i+parseInt(BX.findChild(BX("informer_comments_new_"+e),{className:"post-item-inform-right-new-value"},true,false).innerHTML);BX.remove(BX("informer_comments_new_"+e));BX.remove(BX("informer_comments_all_"+e));BX("informer_comments_"+e).innerHTML=n;var a=BX("informer_comments_"+e).closest(".post-item-informers");if(a){a.classList.remove("post-item-inform-likes-active")}BX.MobileLivefeed.PinnedPanelInstance.adjustCollapsedPostsPanel()}}if(BX("lenta_item_"+e)){BX.removeClass(BX("lenta_item_"+e),"lenta-item-new")}}function __MSLGetHiddenDestinations(e,t,o){var i={sessid:BX.message("MSLSessid"),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),dlim:BX.message("MSLDestinationLimit"),log_id:parseInt(e),nt:BX.message("MSLNameTemplate"),sl:BX.message("MSLShowLogin"),p_user:BX.message("MSLPathToUser"),p_group:BX.message("MSLPathToGroup"),p_crmlead:BX.message("MSLPathToCrmLead"),p_crmdeal:BX.message("MSLPathToCrmDeal"),p_crmcontact:BX.message("MSLPathToCrmContact"),p_crmcompany:BX.message("MSLPathToCrmCompany"),action:"get_more_destination",mobile_action:"get_more_destination",author_id:parseInt(t)};BX.Mobile.Ajax.wrap({type:"json",method:"POST",url:BX.message("MSLSiteDir")+"mobile/ajax.php",data:i,callback:function(e){if(typeof e["arDestinations"]!="undefined"){var t=e["arDestinations"];if(typeof t=="object"){if(BX(o)){var i=o.parentNode;i.removeChild(o);for(var n=0;n<t.length;n++){if(typeof t[n]["TITLE"]!="undefined"&&t[n]["TITLE"].length>0){i.appendChild(BX.create("SPAN",{html:",&nbsp;"}));if(typeof t[n]["CRM_PREFIX"]!="undefined"&&t[n]["CRM_PREFIX"].length>0){i.appendChild(BX.create("SPAN",{props:{className:"post-item-dest-crm-prefix"},html:t[n]["CRM_PREFIX"]+":&nbsp;"}))}if(typeof t[n]["URL"]!="undefined"&&t[n]["URL"].length>0){i.appendChild(BX.create("A",{props:{className:"post-item-destination"+(typeof t[n]["STYLE"]!="undefined"&&t[n]["STYLE"].length>0?" post-item-dest-"+t[n]["STYLE"]:""),href:t[n]["URL"]},html:t[n]["TITLE"]}))}else{i.appendChild(BX.create("SPAN",{props:{className:"post-item-destination"+(typeof t[n]["STYLE"]!="undefined"&&t[n]["STYLE"].length>0?" post-item-dest-"+t[n]["STYLE"]:"")},html:t[n]["TITLE"]}))}}}if(typeof e["iDestinationsHidden"]!="undefined"&&parseInt(e["iDestinationsHidden"])>0){e["iDestinationsHidden"]=parseInt(e["iDestinationsHidden"]);var a=e["iDestinationsHidden"]%100>10&&e["iDestinationsHidden"]%100<20?5:e["iDestinationsHidden"]%10;i.appendChild(BX.create("SPAN",{html:"&nbsp;"+BX.message("MSLDestinationHidden"+a).replace("#COUNT#",e["iDestinationsHidden"])}))}oMSL.checkNodesHeight()}}}},callback_failure:function(){}})}function __MSLPullDownInit(e,t){if(typeof t=="undefined"){t=true}e=!!e;if(e){if(!BX.MobileLivefeed.Instance.isPullDownEnabled&&t){BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL"),backgroundColor:"#E7E9EB",downtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_RELEASE"),loadtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_LOADING"),callback:function(){if(!window.isPullDownLocked){BX.MobileLivefeed.PageInstance.refresh(true);BX.onCustomEvent("BX.MobileLivefeed.SearchBar::setHideByRefresh");app.exec("hideSearchBar");setTimeout((function(){BX.onCustomEvent("BX.MobileLivefeed.SearchBar::unsetHideByRefresh")}),1e3)}}});BXMobileApp.UI.Page.Refresh.setEnabled(true)}BX.MobileLivefeed.Instance.isPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);BX.MobileLivefeed.Instance.isPullDownEnabled=false}}function __MSLDetailPullDownInit(e){e=!!e;if(e){if(!isDetailPullDownEnabled){var t=function(){var e=true;if(e){var t=null;var o=null;if(BX("post_log_id")){t=parseInt(BX("post_log_id").getAttribute("data-log-id"));o=parseInt(BX("post_log_id").getAttribute("data-ts"))}else if(BX("lenta_wrapper")){var i=BX.findChild(BX("lenta_wrapper"),{className:"post-wrap"},true,false);if(i&&i.id.length>0){var n=i.id.match(/^lenta_item_([\d]+)$/i);if(n!=null){document.location.replace(document.location.href);isDetailPullDownEnabled=true;return}}}if(BX("post-comments-wrap")&&typeof t!=="undefined"&&t!=null){BX.MobileLivefeed.CommentsInstance.getList({ts:o,bPullDown:true,obFocus:{form:false}});oMSL.refreshPostDetail()}}};BXMobileApp.UI.Page.Refresh.setParams({pulltext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL"),backgroundColor:"#E7E9EB",downtext:BX.message("MOBILE_EXT_LIVEFEED_NEW_PULL_RELEASE"),loadtext:BX.message("MOBILE_EXT_LIVEFEED_DETAIL_NEW_PULL_LOADING"),callback:t});BXMobileApp.UI.Page.Refresh.setEnabled(true)}isDetailPullDownEnabled=true}else{BXMobileApp.UI.Page.Refresh.setEnabled(false);isDetailPullDownEnabled=false}}function __MSLSetFavorites(e,t,o){var i=BX.MobileLivefeed.Instance.getPostFromLogId(e);if(!i){return}return i.setFavorites({node:t,event:o})}function showHiddenDestination(e,t){BX.hide(t);BX("blog-destination-hidden-"+e).style.display="inline"}BitrixMSL=function(){this.scriptsAttached=[];this.counterTimeout=null;this.commentsType=false;this.entityXMLId="";this.commentTextCurrent="";this.arMention={};this.bShowExpertMode=true;this.bExpertMode=false;this.bKeyboardCaptureEnabled=false;this.keyboardShown=null;this.arBlockToCheck={};this.iDetailTs=0;this.arRatingLikeProcess={};this.bDetailEmptyPage=null;this.bCounterReceived=false;this.counterValue=0;this.blocksToCheckRegisteredList=[];this.menuData={};this.emptyRefreshCommentsFlag=false;this.detailPageFocus=null;this.classes={postItemBlockFull:"post-item-post-block-full"};this.xhr={refresh:null}};BitrixMSL.prototype.loadScripts=function(){for(var e=0;e<this.scriptsAttached.length;e++){BX.loadScript(this.scriptsAttached[e]+"?"+parseInt(Math.random()*1e5))}};BitrixMSL.prototype.pullDownAndRefresh=function(e){app.exec("pullDownLoadingStart");window.isPullDownLocked=true;BX.MobileLivefeed.PageInstance.refresh(true,e)};BitrixMSL.prototype.shareBlogPost=function(e){};BitrixMSL.prototype.drawDetailPage=function(e){var t=false;BX.MobileLivefeed.Instance.setPageId("detail_"+e.log_id);BX.MobileLivefeed.Instance.setOptions({logId:e.log_id});if(BX("post_log_id")){var o=parseInt(BX("post_log_id").getAttribute("data-log-id"))}if(typeof o==="undefined"||o!=e.log_id){app.clearInput()}if(BX("post_log_id")){if(typeof o!=="undefined"&&o==e.log_id){t=true}else{BX("post_log_id").setAttribute("data-log-id",e.log_id);BX("post_log_id").setAttribute("data-ts",e.TS);BX.message({MSLLogId:e.log_id})}}var i=false;window.entryType=e.entry_type;oMSL.InitDetail({commentsType:e.entry_type=="blog"?"blog":"log",detailPageId:(e.entry_type=="blog"?"blog":"log")+"_"+(e.entry_type=="blog"?e.post_id:e.log_id),logId:e.log_id,entityXMLId:e.entity_xml_id,bFollow:typeof e.follow=="undefined"||e.follow!="N",feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,entryParams:{destinations:typeof e.destinations!="undefined"?e.destinations:null,post_perm:typeof e.post_perm!="undefined"?e.post_perm:null,post_id:typeof e.post_id!="undefined"?e.post_id:null,post_content_type_id:BX.type.isNotEmptyString(e.post_content_type_id)?e.post_content_type_id:null,post_content_id:!BX.type.isUndefined(e.post_content_id)?e.post_content_id:null},TS:typeof e.TS!="undefined"?e.TS:null,readOnly:e.read_only!="undefined"?e.read_only:"N"});BX.MobileLivefeed.CommentsInstance.abortXhr();if(typeof e.commentsNumAll!="undefined"||typeof e.commentsNum!="undefined"){i=true}if(BX("comments_control")){BX("comments_control").style.display=typeof e.commentsControl!="undefined"&&e.commentsControl=="YES"?"inline-block":"none";BX("comments_control").removeEventListener("click",BX.MobileLivefeed.CommentsInstance.setFocusOnCommentForm);if(e.can_user_comment!=="NO"){BX("comments_control").addEventListener("click",BX.MobileLivefeed.CommentsInstance.setFocusOnCommentForm)}}if(!t){var n=document.getElementById("rating_text");if(typeof e.ratingText!="undefined"){if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="block"}if(n){if(typeof e.ratingCounter!="undefined"){n.setAttribute("data-counter",parseInt(e.ratingCounter))}if(BX.type.isNotEmptyString(e.ratingText)&&typeof RatingLike!=="undefined"){n.innerHTML=e.ratingText;n.style.display="inline-block";var a=n.querySelector("[data-rating-vote-id]");if(a){var s=a.getAttribute("data-rating-vote-id");var l=a.getAttribute("data-rating-entity-type-id");var r=parseInt(a.getAttribute("data-rating-entity-id"));if(BX.type.isNotEmptyString(s)&&BX.type.isNotEmptyString(l)&&r>0){RatingLike.Set({likeId:s,entityTypeId:l,entityId:r,available:"Y",userId:BX.message("USER_ID"),localize:{LIKE_Y:BX.message("MOBILE_EXT_LIVEFEED_RATING_TEXT_LIKE_Y"),LIKE_N:BX.message("MOBILE_EXT_LIVEFEED_RATING_TEXT_LIKE_Y"),LIKE_D:BX.message("MOBILE_EXT_LIVEFEED_RATING_TEXT_LIKE_D")},template:"like_react",pathToUserProfile:BX.message("MSLPathToUser"),mobile:true})}}}else{n.style.display="none"}}i=true;oMSL.parseAndExecCode(e.ratingText,0);BX.message({RVRunEvent:"Y"})}else{if(BX("rating-footer-wrap")){if(typeof e.ratingFooter!="undefined"){oMSL.drawRatingFooter(e.ratingFooter)}else{BX("rating-footer-wrap").innerHTML=""}BX("rating-footer-wrap").style.display="none"}if(BX("rating_button_cont")){BX("rating_button_cont").style.display="none"}if(n){n.style.display="none"}}}if(BX("log_entry_follow")){if(typeof e.use_follow!="undefined"&&e.use_follow=="N"||typeof e.follow=="undefined"){BX.unbindAll(BX("log_entry_follow"));BX("log_entry_follow").style.display="none"}else{i=true;BX.removeClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow-active":"post-item-follow");BX.addClass(BX("log_entry_follow"),e.follow=="N"?"post-item-follow":"post-item-follow-active");BX("log_entry_follow").setAttribute("data-follow",e.follow=="N"?"N":"Y");BX.unbindAll(BX("log_entry_follow"));BX.bind(BX("log_entry_follow"),"click",(function(){BX.MobileLivefeed.FollowManagerInstance.setFollow({logId:e.log_id,bAjax:true,bRunEvent:false})}))}}if(i){BX.removeClass(BX("lenta_item"),"post-without-informers")}else{BX.addClass(BX("lenta_item"),"post-without-informers")}if(BX("post_item_top_wrap")&&!BX.MobileLivefeed.FollowManagerInstance.getFollowDefaultValue()){if(typeof e.follow!="undefined"&&e.follow=="Y"){BX.addClass(BX("post_item_top_wrap"),"post-item-follow")}else{BX.removeClass(BX("post_item_top_wrap"),"post-item-follow")}}if(t&&BX.type.isNotEmptyString(e.fav)&&BX("log_entry_favorites_"+e.log_id)){if(e.fav=="Y"){BX("log_entry_favorites_"+e.log_id).classList.add("lenta-item-fav-active")}else{BX("log_entry_favorites_"+e.log_id).classList.remove("lenta-item-fav-active")}}var d=BX("post_block_check_cont");if(!t){if(BX("post-comments-wrap")){BX.cleanNode(BX("post-comments-wrap"))}this.drawDetailPageText(e);var p=BX.findChild(d,{className:"post-more-block"},true,false);if(p&&BX("post_more_limiter")){if(typeof e.showMoreButton!="undefined"&&e.showMoreButton=="YES"){BX("post_more_limiter").style.visibility="visible";BX.bind(BX("post_more_limiter"),"click",(function(){oMSL.expandText(e.log_id)}))}else{BX("post_more_limiter").style.visibility="hidden"}}if(e.bShowFull==="YES"){d.className=oMSL.classes.postItemBlockFull;if(BX("post_more_block_"+e.log_id)){BX("post_more_block_"+e.log_id).style.display="none"}if(BX("post_block_check_more_"+e.log_id)){BX("post_block_check_more_"+e.log_id).style.display="none"}BX("post_more_limiter").style.visibility="hidden";BitrixMobile.LazyLoad.showImages(false)}else{d.className=e.bIsPhoto=="YES"?"post-item-post-img-block":"post-item-post-block"}if(e.bIsImportant==="YES"||BX.type.isNotEmptyString(e.medal)&&e.medal!=="NO"){d.classList.add("info-block-background");if(e.hasTitle==="YES"){d.classList.add("info-block-background-with-title")}else{d.classList.remove("info-block-background-with-title")}if(e.bIsImportant==="YES"){d.classList.add("info-block-important")}else{d.classList.remove("info-block-important")}if(BX.type.isNotEmptyString(e.medal)&&e.medal!=="NO"){d.classList.add("info-block-gratitude");d.classList.add("info-block-gratitude-"+e.medal)}else{d.classList.remove("info-block-gratitude")}}else{d.classList.remove("info-block-background")}Array.from(d.classList).forEach((function(e){if(e.indexOf("ui-livefeed-background")>-1){d.classList.remove(e)}}));if(BX.type.isNotEmptyString(e.backgroundCode)&&e.backgroundCode!=="NO"){d.classList.add("ui-livefeed-background");d.classList.add("ui-livefeed-background-"+e.backgroundCode)}if(e.bSetFocusOnCommentForm!="YES"&&e.bSetFocusOnCommentsList!="YES"){BX.MobileLivefeed.Post.moveTop()}if(BX("post-comments-form-wrap")){if(e.can_user_comment!=="YES"){if(BX("empty_page_bottom_margin")){BX("empty_page_bottom_margin").style.display="none"}app.hideInput()}}}else{var f=BX("post_item_top");if(f){if(typeof e.topText!=="undefined"){f.innerHTML=e.topText;var m=oMSL.parseAndExecCode(e.topText,0,false,true);setTimeout((function(){BX.MobileLivefeed.Instance.sendErrorEval(m)}),0)}}}if(BX("post-comments-wrap")&&(!t||oMSL.emptyRefreshCommentsFlag)){BX.MobileLivefeed.CommentsInstance.getList({ts:e.TS,bPullDown:false,bPullDownTop:false,obFocus:{form:e.bSetFocusOnCommentForm,comments:e.bSetFocusOnCommentsList}});oMSL.emptyRefreshCommentsFlag=false}if(!t){if(e.bSetFocusOnCommentForm=="YES"){oMSL.detailPageFocus="form"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus="list"}else if(e.bSetFocusOnCommentsList=="YES"){oMSL.detailPageFocus=null}oMSL.adjustDetailPageFocus()}else{if(!BX.type.isUndefined(e.commentsNumNew)&&parseInt(e.commentsNumNew)>0){BX.MobileLivefeed.CommentsInstance.setFocusOnComments("list")}}BX.removeAllCustomEvents("main.post.form/mobile_simple");BX.addCustomEvent("main.post.form/mobile_simple",(function(){setTimeout(oMSL.adjustDetailPageFocus,150)}))};BitrixMSL.prototype.adjustDetailPageFocus=function(){if(!oMSL.detailPageFocus){return}BX.MobileLivefeed.CommentsInstance.setFocusOnComments(oMSL.detailPageFocus)};BitrixMSL.prototype.drawDetailPageText=function(e){var t="";var o=typeof e.logID!="undefined"?parseInt(e.logID):0;var i=o&&BX("post_block_check_cont_"+o)?BX("post_block_check_cont_"+o):BX("post_block_check_cont");var n=o&&BX("post_item_top_"+o)?BX("post_item_top_"+o):BX("post_item_top");var a=o&&BX("post_block_files_"+o)?BX("post_block_files_"+o):BX("post_block_files");if(i||a){BitrixMobile.LazyLoad.clearImages()}if(i){i.innerHTML="";if(BX.type.isNotEmptyString(e.detailText)){i.innerHTML=e.detailText;if(BX.type.isNotEmptyString(e.inlineScript)){i.innerHTML+=e.inlineScript}t+=oMSL.parseAndExecCode(i.innerHTML,0,false,true)}}if(a){a.innerHTML="";if(BX.type.isNotEmptyString(e.filesBlockText)){a.innerHTML=e.filesBlockText;t+=oMSL.parseAndExecCode(e.filesBlockText,0,false,true)}}if(n){n.innerHTML="";if(typeof e.topText!=="undefined"){n.innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}}setTimeout((function(){BX.MobileLivefeed.Instance.sendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}}),0)};BitrixMSL.prototype.onLogEntryPostUpdated=function(e){var t="";if(typeof e.logID!=="undefined"){if(typeof e.detailText!=="undefined"&&BX("post_block_check_cont_"+parseInt(e.logID))){BX("post_block_check_cont_"+parseInt(e.logID)).innerHTML=e.detailText;t+=oMSL.parseAndExecCode(e.detailText,0,false,true)}if(typeof e.filesBlockText!=="undefined"&&BX("post_block_files_"+parseInt(e.logID))){BX("post_block_files_"+parseInt(e.logID)).innerHTML=e.filesBlockText;t+=oMSL.parseAndExecCode(e.filesBlockText,0,false,true)}if(typeof e.topText!=="undefined"&&BX("post_item_top_"+parseInt(e.logID))){BX("post_item_top_"+parseInt(e.logID)).innerHTML=e.topText;t+=oMSL.parseAndExecCode(e.topText,0,false,true)}setTimeout((function(){BX.MobileLivefeed.Instance.sendErrorEval(t);BitrixMobile.LazyLoad.showImages();if(BX.message("MSLLoadScriptsNeeded")=="Y"&&typeof oMSL==="object"){oMSL.loadScripts()}}),0)}};BitrixMSL.prototype.changeCounter=function(e,t,o){if(this.counterTimeout!==null){clearTimeout(this.counterTimeout);this.counterTimeout=null}t=typeof t!="undefined"?parseInt(t):0;o=typeof o!="undefined"?parseInt(o):0;var i=t>0?t:o>0?o:0;this.counterValue=e;if(parseInt(oMSL.counterValue)>0){BX.MobileLivefeed.BalloonNotifierInstance.showNotifier({counterValue:oMSL.counterValue})}else{this.counterTimeout=setTimeout((function(){if(i>BX.MobileLivefeed.Instance.getOption("frameCacheTs",0)){BX.MobileLivefeed.Instance.setRefreshNeeded(true)}if(BX.MobileLivefeed.Instance.getRefreshNeeded()&&!BX.MobileLivefeed.Instance.getRefreshStarted()){BX.MobileLivefeed.BalloonNotifierInstance.showRefreshNeededNotifier()}else{BX.MobileLivefeed.BalloonNotifierInstance.hideNotifier()}clearTimeout(oMSL.counterTimeout)}),2e3)}};BitrixMSL.prototype.parseAndExecCode=function(e,t,o,i){if(typeof e!="string"||e.length<=0){return}t=typeof t=="undefined"?500:parseInt(t);o=typeof o=="undefined"?true:!!o;i=!!i;var n=BX.processHTML(e);var a="";if(n!=null&&n.SCRIPT!=null&&typeof n.SCRIPT!="undefined"){for(var s=0;s<n.SCRIPT.length;s++){if(n.SCRIPT[s].isInternal){a+=";"+n.SCRIPT[s].JS}}if(o&&a.length>0){setTimeout((function(){BX.MobileLivefeed.Instance.sendErrorEval(a)}),t)}}return i?a:false};BitrixMSL.prototype.replaceUserPath=function(e){if(typeof e!="string"||e.length<=0){return}if(BX("MSLIsExtranetSite")=="Y"){e=e.replace("/mobile/users/?user_id=",BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=")}else{e=e.replace(BX.message("MSLExtranetSiteDir")+"mobile/users/?user_id=","/mobile/users/?user_id=")}e=e.replace(new RegExp('[\\w/]+/personal/user/(\\d+)/"',"igm"),BX("MSLIsExtranetSite")=="Y"?BX.message("MSLExtranetSiteDir")+'mobile/users/?user_id=$1"':'/mobile/users/?user_id=$1"');return e};BitrixMSL.prototype.InitDetail=function(e){this.commentsType=typeof e.commentsType!="undefined"&&e.commentsType=="blog"?"blog":"log";this.entityXMLId=typeof e.entityXMLId!="undefined"?e.entityXMLId:"";this.commentTextCurrent="";this.arMention={};this.iDetailTs=typeof e.TS!="undefined"?e.TS:0;BX.MobileLivefeed.FollowManagerInstance.setFollowValue(!(!BX.Type.isUndefined(e.bFollow)&&!e.bFollow));if(!this.bKeyboardCaptureEnabled){app.enableCaptureKeyboard(true);this.bKeyboardCaptureEnabled=true;BX.addCustomEvent("onKeyboardWillShow",BX.delegate((function(){this.keyboardShown=true}),this));BX.addCustomEvent("onKeyboardDidHide",BX.delegate((function(){this.keyboardShown=false}),this))}if(BX.type.isNotEmptyString(e.detailPageId)&&BX.MobileLivefeed.Instance.getOption("detailPageId")!=e.detailPageId){BX.MobileLivefeed.Instance.setOptions({detailPageId:e.detailPageId});if(typeof e.logId!="undefined"&&parseInt(e.logId)>0){this.logId=parseInt(e.logId)}}this.menuData={entry_type:this.commentsType,destinations:typeof e.entryParams!="undefined"&&e.entryParams.destinations!="undefined"?e.entryParams.destinations:{},post_perm:typeof e.entryParams!="undefined"&&e.entryParams.post_perm!="undefined"?e.entryParams.post_perm:null,post_id:typeof e.entryParams!="undefined"&&e.entryParams.post_id!="undefined"?e.entryParams.post_id:null,feed_id:typeof e.feed_id!="undefined"?e.feed_id:null,read_only:typeof e.readOnly!="undefined"&&e.readOnly=="Y"?"Y":"N",post_content_type_id:typeof e.entryParams!="undefined"&&BX.type.isNotEmptyString(e.entryParams.post_content_type_id)?e.entryParams.post_content_type_id:null,post_content_id:typeof e.entryParams!="undefined"&&typeof e.entryParams.post_content_id!="undefined"?parseInt(e.entryParams.post_content_id):null};BX.MobileLivefeed.PageMenuInstance.detailPageMenuItems=BX.MobileLivefeed.PageMenuInstance.buildDetailPageMenu(this.menuData);BX.MobileLivefeed.PageMenuInstance.init({type:"detail"});setTimeout(function(){var e=BX.MobileLivefeed.Instance.getPostFromLogId(BX.MobileLivefeed.Instance.getLogId());if(e){e.initDetailPin()}}.bind(this),0)};BitrixMSL.prototype.setExpertMode=function(e){if(typeof e.value=="undefined"){return}var t=!!e.value;if(!BX.type.isNotEmptyString(BX.MobileLivefeed.Instance.getOption("detailPageId"))){oMSL.bExpertMode=t;this.setExpertModeMenuItemName()}var o={sessid:BX.bitrix_sessid(),site:BX.message("SITE_ID"),lang:BX.message("LANGUAGE_ID"),value:t?"Y":"N",action:"change_expert_mode",mobile_action:"change_expert_mode"};this.changeListMode(o,(function(e){oMSL.pullDownAndRefresh()}),(function(e){oMSL.bExpertMode=!(e.value=="Y");oMSL.setExpertModeMenuItemName()}))};BitrixMSL.prototype.changeListMode=function(e,t,o){app.showPopupLoader({text:""});var i=false,n="";if(e.action=="change_follow_default"){i="socialnetwork.api.livefeed.changeFollowDefault";n=e.value=="Y"?"setFollowType":"unsetFollowType"}else if(e.action=="change_expert_mode"){i="socialnetwork.api.livefeed.changeExpertMode";n=e.value=="Y"?"setExpertMode":"unsetExpertMode"}if(!i){return}BX.Mobile.Ajax.runAction(i,{data:{value:e.value},analyticsLabel:{b24statAction:n,b24statContext:"mobile"}}).then(function(i){app.hidePopupLoader();if(i.data.success){t(e)}else{if(!BX.type.isNotEmptyString(BX.MobileLivefeed.Instance.getOption("detailPageId"))){o(e)}}}.bind(this),function(t){app.hidePopupLoader();if(!BX.type.isNotEmptyString(BX.MobileLivefeed.Instance.getOption("detailPageId"))){o(e)}}.bind(this))};BitrixMSL.prototype.incrementCounters=function(e){e=parseInt(e);if(e>0){var t=0;var o=0;if(BX("informer_comments_"+e)&&!BX("informer_comments_new_"+e)){t=BX("informer_comments_"+e).innerHTML.length>0?parseInt(BX("informer_comments_"+e).innerHTML):0;o=t+1;BX("informer_comments_"+e).innerHTML=o}if(BX("comcntleave-all")){t=BX("comcntleave-all").innerHTML.length>0?parseInt(BX("comcntleave-all").innerHTML):0;o=t+1;BX("comcntleave-all").innerHTML=o}BXMobileApp.onCustomEvent("onLogEntryCommentAdd",{logId:e},true)}};BitrixMSL.prototype.showPostMenu=function(e){var t=null;if(BX.type.isString(e.target.getAttribute("data-menu-type"))&&e.target.getAttribute("data-menu-type")=="post"){t=e.target}else{t=BX.findParent(e.target,{className:"lenta-menu"},{className:"post-item-top"})}if(!BX(t)){return e.preventDefault()}BX.MobileLivefeed.PostMenuInstance.init({logId:parseInt(t.getAttribute("data-log-id")),postId:parseInt(t.getAttribute("data-post-id")),postPerms:t.getAttribute("data-post-perm"),useFavorites:t.getAttribute("data-use-favorites")==="Y",useFollow:t.getAttribute("data-use-follow")==="Y",usePinned:t.getAttribute("data-use-pinned")==="Y",favoritesValue:t.getAttribute("data-favorites")==="Y",followValue:t.getAttribute("data-follow")==="Y",pinnedValue:t.getAttribute("data-pinned")==="Y",contentTypeId:t.getAttribute("data-content-type-id"),contentId:parseInt(t.getAttribute("data-content-id")),target:t,context:"list"});var o=BX.MobileLivefeed.PostMenuInstance.getMenuItems();if(o.length<=0){return e.preventDefault()}var i={};for(var n=0;n<o.length;n++){i[o[n].id]=o[n].action}app.exec("setPopupMenuData",{position:"center",items:o,sections:[{id:"defaultSection"}],callback:function(e){if(e.eventName=="onDataSet"){app.exec("showPopupMenu")}else if(e.eventName=="onItemSelected"&&BX.type.isNotEmptyObject(e.item)&&BX.type.isNotEmptyString(e.item.id)&&typeof i[e.item.id]!="undefined"){i[e.item.id]()}}});return e.preventDefault()};BitrixMSL.prototype.copyPostLink=function(e){var t=BX.type.isNotEmptyString(e.contentTypeId)?e.contentTypeId:"";var o=BX.type.isNumber(e.contentId)&&e.contentId>0?e.contentId:0;if(!BX.type.isNotEmptyString(t)||o<=0){return}BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:t,entityId:o,logId:BX.MobileLivefeed.Instance.getLogId(),additionalParams:{getLivefeedUrl:"Y",absoluteUrl:"Y",returnFields:["LIVEFEED_URL"]}}}}).then(function(e){this.copyLinkSuccess(e.data)}.bind(this),(function(e){}))};BitrixMSL.prototype.setExpertModeMenuItemName=function(){var e=false;for(var t=0;t<BX.MobileLivefeed.PageMenuInstance.listPageMenuItems.length;t++){e=BX.MobileLivefeed.PageMenuInstance.listPageMenuItems[t];if(typeof e.feature!="undefined"&&e.feature=="expert"){e.name=oMSL.bExpertMode?BX.message("MSLMenuItemExpertModeY"):BX.message("MSLMenuItemExpertModeN");BX.MobileLivefeed.PageMenuInstance.listPageMenuItems[t]=e;BX.MobileLivefeed.PageMenuInstance.init({type:"list"});break}}};BitrixMSL.prototype.replyToComment=function(e,t,o){e=parseInt(e);var i=typeof this.commentTextCurrent!="undefined"?this.commentTextCurrent:"";this.arMention[t]="[USER="+e+"]"+t+"[/USER]";i=i+" "+t+", ";if(typeof this.commentTextCurrent!="undefined"){this.commentTextCurrent=i}BXMobileApp.UI.Page.TextPanel.setText(i);BXMobileApp.UI.Page.TextPanel.focus();return typeof o!="undefined"?o.preventDefault():false};BitrixMSL.prototype.buildCommentRatingNode=function(e,t){var o=e["EVENT"]["RATING_USER_VOTE_VALUE"]>0?"post-comment-likes-liked":"post-comment-likes";var i=parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])>1||parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])==1&&e["EVENT"]["RATING_USER_VOTE_VALUE"]<=0;return BX.create("DIV",{props:{id:"bx-ilike-button-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:o},children:[BX.create("DIV",{props:{className:"post-comment-likes-text"},html:i?BX.message("MSLLike2"):BX.message("MSLLike")}),BX.create("DIV",{props:{id:"bx-ilike-count-"+e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t,className:"post-comment-likes-counter"},style:{display:i?"inner-block":"none"},events:{click:function(o){RatingLikeComments.List(e["EVENT"]["RATING_TYPE_ID"]+"-"+e["EVENT"]["RATING_ENTITY_ID"]+"-"+t);o.preventDefault()}},html:""+parseInt(e["EVENT"]["RATING_TOTAL_POSITIVE_VOTES"])+""})]})};BitrixMSL.prototype.buildCommentReplyNode=function(e){return BX.create("DIV",{props:{className:"post-comment-reply"},children:[BX.create("DIV",{props:{className:"post-comment-reply-text"},events:{click:function(t){oMSL.replyToComment(e["EVENT"]["USER_ID"],e["CREATED_BY"]["FORMATTED"],t||window.event)}},html:BX.message("MSLReply")})]})};BitrixMSL.prototype.drawRatingFooter=function(e){if(BX("rating-footer-wrap")){BX("rating-footer-wrap").innerHTML=e;this.parseAndExecCode(e,0)}};BitrixMSL.prototype.unParseMentions=function(e){var t=e;t=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,(function(e,t,o){oMSL.arMention[o]=e;return o}));return t};BitrixMSL.prototype.expandText=function(e){if(!document.body.classList.contains("post-card")){return}var t=typeof e=="undefined"||e==null||!BX("post_block_check_cont_"+e)?BX("post_block_check_cont"):BX("post_block_check_cont_"+e);if(!t){return}if(BX.hasClass(t,"post-item-post-block")){BX.addClass(t,this.classes.postItemBlockFull);BX.removeClass(t,"post-item-post-block")}else if(BX.hasClass(t,"lenta-info-block-wrapp")){BX.addClass(t,"lenta-info-block-wrapp-full");BX.removeClass(t,"lenta-info-block-wrapp")}var o=t.querySelector(".post-more-block");if(o){o.style.display="none"}if(BX("post_more_limiter_"+e)){BX("post_more_limiter_"+e).style.visibility="hidden"}else if(BX("post_more_limiter")){BX("post_more_limiter").style.visibility="hidden"}var i=BX.findChildren(t,{tagName:"img"},true);if(BX.type.isArray(i)){for(var n=0;n<i.length;n++){if(BX.type.isString(i[n].getAttribute("data-src"))&&i[n].getAttribute("data-src").length>0&&!!i[n].id){BitrixMobile.LazyLoad.registerImage(i[n].id)}}BitrixMobile.LazyLoad.showImages(false)}};BitrixMSL.prototype.onLogEntryFavorites=function(e,t){var o=BX("log_entry_favorites_"+e);if(o&&(BX.message("MSLPageId")==undefined||BX.message("MSLPageId")!=t)){var i=o.getAttribute("data-favorites")=="Y"?"Y":"N";var n=i=="Y"?"N":"Y";if(i=="Y"){BX.removeClass(o,"lenta-item-fav-active")}else{BX.addClass(o,"lenta-item-fav-active")}o.setAttribute("data-favorites",n)}};BitrixMSL.prototype.onLogEntryRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout((function(){oMSL.onLogEntryRatingLike(e)}),100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var i=parseInt(e.logId);var n=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");if(i<=0&&this.isUserCurrent(n)){delete this.arRatingLikeProcess[t];return}var a=BX("bx-ilike-box-"+t);if(!a){delete this.arRatingLikeProcess[t];return}var s=BX("bx-ilike-button-"+t);if(!s){s=BX("rating_button")}if(!s||!BX.hasClass(s,"post-item-inform-likes")&&!BX.hasClass(s,"post-item-inform-likes-active")){delete this.arRatingLikeProcess[t];return}var l=null;var r=0;var d=0;var p=null;var f=i>0&&BX("rating_block_"+i)?BX("rating_block_"+i):BX("rating_button_cont");if(!f&&a){f=BX.findParent(a,{tag:"SPAN",className:"bx-ilike-block"})}if(a){l=BX.findChild(a,{className:"post-item-inform-right-text"},true,false);if(l&&f){r=parseInt(f.getAttribute("data-counter"));d=o=="plus"?r+1:r-1;l.innerHTML=d}if(this.isUserCurrent(n)){BX.removeClass(s,o=="plus"?"post-item-inform-likes":"post-item-inform-likes-active");BX.addClass(s,o=="plus"?"post-item-inform-likes-active":"post-item-inform-likes")}var m=BX.hasClass(s,"post-item-inform-likes-active")&&d>1||!BX.hasClass(s,"post-item-inform-likes-active")&&d>0;l=BX.findChild(s,{className:"post-item-inform-right"},true,false);if(l){l.innerHTML=d;l.style.display=m?"inline-block":"none";l=BX.findChild(s,{className:"post-item-inform-left"},true,false);l.innerHTML=m?BX.message("MSLLike2"):BX.message("MSLLike")}}if(f){f.setAttribute("data-counter",parseInt(d))}if(i>0&&BX("rating-footer_"+i)){p=BX("rating-footer-wrap_"+i)}else if(f){p=BX("rating-footer-wrap")}if(!p&&f&&typeof f.id!="undefined"){var c=f.id.match(/^rating_block_([\d]+)$/i);if(c!=null){p=BX("rating-footer-wrap_"+c[1])}}if(this.isUserCurrent(n)&&typeof BXRL!="undefined"&&typeof BXRL[t]!="undefined"){BXRL[t].lastVote=o=="plus"?"plus":"cancel"}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.onLogCommentRatingLike=function(e){var t=e.ratingId;if(typeof this.arRatingLikeProcess[t]!="undefined"){setTimeout((function(){oMSL.onLogCommentRatingLike(e)}),100);return}this.arRatingLikeProcess[t]=true;var o=e.voteAction;var i=typeof e.userId!="undefined"?parseInt(e.userId):BX.message("USER_ID");var n=BX("bx-ilike-count-"+t);if(!n){delete this.arRatingLikeProcess[t];return}var a=parseInt(n.innerHTML);var s=o=="plus"?a+1:a-1;if(this.isUserCurrent(i)){delete this.arRatingLikeProcess[t];return}var l=BX("bx-ilike-button-"+t);if(!l||!BX.hasClass(l,"post-comment-likes")&&!BX.hasClass(l,"post-comment-likes-liked")){delete this.arRatingLikeProcess[t];return}if(n){var r=BX.hasClass(l,"post-comment-likes-liked")&&s>1||!BX.hasClass(l,"post-comment-likes-liked")&&s>0;n.innerHTML=s;n.style.display=r?"inline-block":"none";var d=BX.findChild(l,{className:"post-comment-likes-text"},true,false);d.innerHTML=r?BX.message("MSLLike2"):BX.message("MSLLike")}delete this.arRatingLikeProcess[t]};BitrixMSL.prototype.checkVisibility=function(e){var t=e.node;if(BX.hasClass(document.body,"lenta-page")){var o=oMSL.checkImageOffset(t);if(o===false){e.status=BitrixMobile.LazyLoad.status.hidden}return o}else if(!oMSL.isPostFull()&&oMSL.isImageFromPost(e)){return oMSL.checkImageOffset(t)}return true};BitrixMSL.prototype.checkImageOffset=function(e){if(!BX.hasClass(e.parentNode,"post-item-attached-img-block")){return e.offsetTop<315}return true};BitrixMSL.prototype.isPostFull=function(){var e=BX("post_block_check_cont_"+this.logId)?BX("post_block_check_cont_"+this.logId):BX("post_block_check_cont",true);return BX.hasClass(e,this.classes.postItemBlockFull)||BX.hasClass(e,"lenta-info-block-wrapp-full")};BitrixMSL.prototype.isImageFromPost=function(e){if(typeof e.fromPost!="undefined"){return e.fromPost}var t=5;var o=e.node;while(o=o.parentNode){if(BX.hasClass(o,"post-item-post-block")){e.fromPost=true;return true}if(t<=0){e.fromPost=false;return false}t--}};BitrixMSL.prototype.isUserCurrent=function(e){return e==BX.message("USER_ID")};BitrixMSL.prototype.checkNodesHeight=function(){var e=false;var t=null;var o=null;for(var i in this.arBlockToCheck){if(!this.arBlockToCheck.hasOwnProperty(i)){continue}t=this.arBlockToCheck[i];o=BX(t.lenta_item_id)?BX(t.lenta_item_id).querySelector(".post-more-block"):false;if(o&&BX(t.text_block_id)){e=BX(t.text_block_id).offsetHeight;if(BX(t.title_block_id)){e+=BX(t.title_block_id).offsetHeight}if(t.title2_block_id&&BX(t.title2_block_id)){e+=BX(t.title2_block_id).offsetHeight}if(BX(t.files_block_id)){e+=BX(t.files_block_id).offsetHeight}var n=BX(t.text_block_id).parentNode.querySelector(".post-item-important");if(n){e+=n.offsetHeight}if(BX(t.more_button_id)&&BX(t.more_button_id).closest("[data-livefeed-pinned-panel]")){BX(t.more_button_id).style.visibility="visible"}else if(e>=320&&!BX.hasClass(t.text_block_id,this.classes.postItemBlockFull)){o.style.display="block";if(BX(t.lenta_item_id)){BX.removeClass(BX(t.lenta_item_id),"post-without-informers")}if(BX(t.more_button_id)){BX(t.more_button_id).style.visibility="visible"}}else{if(o){o.style.display="none"}if(BX(t.more_button_id)){BX(t.more_button_id).style.visibility="hidden"}}}}};BitrixMSL.prototype.refreshPostDetail=function(){BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.mobileGetDetail",{data:{logId:BX.MobileLivefeed.Instance.getLogId()}}).then(function(e){if(BX.type.isPlainObject(e.data)&&BX.type.isNotEmptyString(e.data.html)&&BX("post_block_check_cont")){BX.html(BX("post_block_check_cont"),e.data.html);this.registerEmptyBlockToCheck();setTimeout(function(){this.checkNodesHeight();BitrixMobile.LazyLoad.showImages()}.bind(this),500)}}.bind(this),(function(e){}))};BitrixMSL.prototype.formatTaskDescription=function(e,t,o,i){var n=e;i=BX.type.isNotEmptyString(i)?"_"+i:"";if(!!t&&!!o&&t.length>0){n+="\n\n"+BX.message("SONET_EXT_COMMENTAUX_CREATE_TASK_"+o+i).replace("#A_BEGIN#","[URL="+t+"]").replace("#A_END#","[/URL]")}return n};BitrixMSL.prototype.createTask=function(e){app.showPopupLoader();BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:e.entityType,entityId:e.entityId,logId:BX.type.isNumber(e.logId)?e.logId:null,additionalParams:{getSonetGroupAvailable:"Y",getLivefeedUrl:"Y",checkPermissions:{feature:"tasks",operation:"create_tasks"}}}}}).then(function(t){var o=t.data;if(typeof o.TITLE!="undefined"&&typeof o.DESCRIPTION!="undefined"&&typeof o.DISK_OBJECTS!="undefined"&&(BX.type.isNotEmptyString(o.TITLE)||BX.type.isNotEmptyString(o.DESCRIPTION))&&BX.type.isNotEmptyString(o.LIVEFEED_URL)){var i=this.formatTaskDescription(o.DESCRIPTION,o.LIVEFEED_URL,e.entityType,BX.type.isNotEmptyString(o.SUFFIX)?o.SUFFIX:"");var n={TITLE:o.TITLE,DESCRIPTION:i,RESPONSIBLE_ID:BX.message("USER_ID"),CREATED_BY:BX.message("USER_ID"),UF_TASK_WEBDAV_FILES:o.DISK_OBJECTS};var a=[];if(typeof o.GROUPS_AVAILABLE!="undefined"){for(var s in o.GROUPS_AVAILABLE){if(o.GROUPS_AVAILABLE.hasOwnProperty(s)){a.push(o.GROUPS_AVAILABLE[s])}}}if(a.length==1){n.GROUP_ID=parseInt(a[0])}BX.Mobile.Ajax.runComponentAction("bitrix:tasks.task","legacyAdd",{mode:"class",data:{data:n,parameters:{RETURN_ENTITY:true,PLATFORM:"mobile"}},onrequeststart:function(e){this.xhr=e}.bind(this)}).then(function(t){app.hidePopupLoader();if(typeof t.data!="undefined"&&typeof t.data.DATA!="undefined"&&typeof t.data.DATA.ID!="undefined"&&parseInt(t.data.DATA.ID)>0){this.createTaskSetContentSuccess(t.data.DATA.ID);BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.createTaskComment",{data:{params:{postEntityType:BX.type.isNotEmptyString(e.postEntityType)?e.postEntityType:e.entityType,entityType:e.entityType,entityId:e.entityId,taskId:t.data.DATA.ID,logId:BX.type.isNumber(e.logId)?e.logId:null}}}).then((function(e){}),(function(e){}))}}.bind(this),function(e){if(e.errors&&e.errors.length){var t=[];for(var o=0;o<e.errors.length;o++){t.push(e.errors[o]["message"])}this.createTaskSetContentFailure(t)}}.bind(this))}else{app.hidePopupLoader();this.createTaskSetContentFailure([BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}}.bind(this),function(e){app.hidePopupLoader();this.createTaskSetContentFailure([BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}.bind(this))};BitrixMSL.prototype.createTaskSetContentSuccess=function(e){app.confirm({title:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_TITLE"),text:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_DESCRIPTION"),buttons:[BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_BUTTON_CANCEL"),BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_SUCCESS_BUTTON_OK")],callback(t){if(t==2){BXMobileApp.Events.postToComponent("taskbackground::task::open",[{taskId:e},{analyticsLabel:{c_section:"feed",c_element:"view_button"}}])}}})};BitrixMSL.prototype.createTaskSetContentFailure=function(e){app.alert({title:BX.message("MOBILE_EXT_LIVEFEED_CREATE_TASK_FAILURE_TITLE"),text:e.join(". ")})};BitrixMSL.prototype.copyLink=function(e){var t=BX.type.isNotEmptyString(e.entityType)?e.entityType:"",o=parseInt(e.entityId)>0?parseInt(e.entityId):0;if(!BX.type.isNotEmptyString(t)||o<=0){return}BX.Mobile.Ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:t,entityId:o,additionalParams:{getLivefeedUrl:"Y",absoluteUrl:"Y",returnFields:["LIVEFEED_URL"]}}}}).then(function(e){this.copyLinkSuccess(e.data)}.bind(this),(function(e){}))};BitrixMSL.prototype.copyLinkSuccess=function(e){if(!BX.type.isNotEmptyString(e.LIVEFEED_URL)){return}app.exec("copyToClipboard",{text:e.LIVEFEED_URL});BX.MobileLivefeed.NotificationBarInstance.showInfo({id:"copy",text:BX.message("MOBILE_EXT_LIVEFEED_POST_MENU_GET_LINK_SUCCESS"),groupId:"clipboard",maxLines:1})};BitrixMSL.prototype.getDiskUploadFolder=function(){};BitrixMSL.prototype.buildSelectedDestinations=function(e,t){if(typeof e.SPERM=="undefined"||typeof e.SPERM_NAME=="undefined"){return}var o=key=null;if(typeof e.SPERM.U!="undefined"){for(key in e.SPERM.U){if(!e.SPERM.U.hasOwnProperty(key)){continue}if(e.SPERM.U[key]=="UA"){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(t,{type:"UA"})}else{o=e.SPERM.U[key].match(/^U([\d]+)$/);if(o!=null){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(t,{type:"U",id:o[1],name:e.SPERM_NAME.U[key]})}}}}if(typeof e.SPERM.SG!="undefined"){for(key in e.SPERM.SG){if(!e.SPERM.SG.hasOwnProperty(key)){continue}o=e.SPERM.SG[key].match(/^SG([\d]+)$/);if(o!=null){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(t,{type:"SG",id:o[1],name:e.SPERM_NAME.SG[key]})}}}};BitrixMSL.prototype.initPostForm=function(e){if(!BX.type.isNotEmptyObject(e)){e={}}var t=e.groupId?e.groupId:false,o=e.callback?e.callback:function(){},i={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(i,t);BX.MobileLivefeed.PostFormOldManagerInstance.setExtraDataArray({postId:false,postAuthorId:false,logId:false,messageUFCode:BX.message("MOBILE_EXT_LIVEFEED_POST_FILE_UF_CODE")});BX.MobileLivefeed.PostFormOldManagerInstance.setParams({selectedRecipients:i,messageText:"",messageFiles:[]});setTimeout((function(){BX.MobileLivefeed.DatabaseUnsentPostInstance.load({onLoad:function(e){var t=null;i={a_users:[],b_groups:[]};if(typeof e.SPERM!="undefined"&&typeof e.SPERM.U!="undefined"&&e.SPERM.U!=null){for(t=0;t<e.SPERM.U.length;t++){if(e.SPERM.U[t]=="UA"){if(BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DENIED")!="Y"){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(i,{type:"UA"})}}else{BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(i,{type:"U",id:e.SPERM.U[t].replace("U",""),name:typeof e.SPERM_NAME!="undefined"&&typeof e.SPERM_NAME.U!="undefined"&&typeof e.SPERM_NAME.U[t]!="undefined"&&e.SPERM_NAME.U[t]!=null?e.SPERM_NAME.U[t]:""})}}}if(typeof e.SPERM!="undefined"&&typeof e.SPERM.SG!="undefined"&&e.SPERM.SG!=null){for(t=0;t<e.SPERM.SG.length;t++){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(i,{type:"SG",id:e.SPERM.SG[t].replace("SG",""),name:typeof e.SPERM_NAME.SG[t]!="undefined"&&typeof e.SPERM_NAME.SG!="undefined"&&typeof e.SPERM_NAME.SG[t]!="undefined"&&e.SPERM_NAME.SG[t]!=null?e.SPERM_NAME.SG[t]:""})}}BX.MobileLivefeed.PostFormOldManagerInstance.setParams({selectedRecipients:i});if(typeof e.POST_MESSAGE!="undefined"&&e.POST_MESSAGE!=null){BX.MobileLivefeed.PostFormOldManagerInstance.setParams({messageText:oMSL.unParseMentions(e.POST_MESSAGE)})}o()},onEmpty:function(e){i={a_users:[],b_groups:[]};oMSL.clearPostFormDestination(i,t);o()}},t)}),0)};BitrixMSL.prototype.clearPostFormDestination=function(e,t){if(typeof t!="undefined"&&parseInt(t)>0){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(e,{type:"SG",id:parseInt(t),name:BX.message("MSLGroupName")})}else if(BX.MobileLivefeed.Instance.availableGroupList!==false){for(key in BX.MobileLivefeed.Instance.availableGroupList){if(!BX.MobileLivefeed.Instance.availableGroupList.hasOwnProperty(key)){continue}BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(e,{type:"SG",id:parseInt(BX.MobileLivefeed.Instance.availableGroupList[key]["entityId"]),name:BX.MobileLivefeed.Instance.availableGroupList[key]["name"]})}}else if(BX.message("MOBILE_EXT_LIVEFEED_DEST_TO_ALL_DEFAULT")=="Y"){BX.MobileLivefeed.PostFormOldManagerInstance.addDestination(e,{type:"UA"})}};BitrixMSL.prototype.onUpdateSocnetCountersHandler=function(e){oMSL.bCounterReceived=true;oMSL.changeCounter(parseInt(e[strCounterType]))};BitrixMSL.prototype.onUpdateCounterHandler=function(e){if(typeof e[BX.message("SITE_ID")]!="undefined"){oMSL.onImUpdateCounterHandler(e[BX.message("SITE_ID")])}};BitrixMSL.prototype.onImUpdateCounterHandler=function(e){oMSL.bCounterReceived=true;if(typeof e.obZeroDate!="undefined"){var t=e.obZeroDate;delete e.obZeroDate}oMSL.changeCounter(parseInt(e[strCounterType]),typeof t!="undefined"&&t[strCounterType]!="undefined"?parseInt(t[strCounterType]):null)};BitrixMSL.prototype.registerBlocksToCheck=function(){var e=null;var t=null;var o=null;e=document.querySelectorAll(".post-wrap");if(e.length<=0){e=document.querySelectorAll(".lenta-item")}if(e!=null){for(var i=0;i<e.length;i++){if(BX.type.isNotEmptyString(e[i].id)){o=e[i].id.match(/^lenta_item_([\d]+)$/i);if(o!=null){t=o[1];if(!BX.util.in_array(t,this.blocksToCheckRegisteredList)){this.arBlockToCheck[t]={lenta_item_id:"lenta_item_"+t,text_block_id:"post_block_check_"+t,title_block_id:"post_block_check_title_"+t,title2_block_id:"post_text_title_"+t,files_block_id:"post_block_check_files_"+t,more_button_id:"post_more_limiter_"+t};this.blocksToCheckRegisteredList.push(t)}}}}}};BitrixMSL.prototype.registerEmptyBlockToCheck=function(){oMSL.arBlockToCheck={0:{lenta_item_id:"lenta_item",text_block_id:"post_block_check_cont",title_block_id:"post_block_check_title",more_button_id:"post_more_limiter"}}};BitrixMSL.prototype.getCopyText=function(e){function t(e){var t=document.createElement("textarea");t.innerHTML=e;return t.value}var o=e.innerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<br\s*[\/]?>/gi,"~~~---~~~").replace(/~~~---~~~/g,"\n");o=o.replace(/<a\s+href="([^"]+)"[^>]*>([^<]+)<\/a>/gi,(function(e,t,o){if(o.match(/^http/gi)){return'<a href="'+t+'">'+t+"</a>"}else{return e}}));return t(BX.util.strip_tags(o))};if(!window.oMSL){oMSL=new BitrixMSL;window.oMSL=oMSL}function openTaskComponentByTaskId(e,t,o){o=o||{};o.selectedTab=o.selectedTab||"taskTab";BXMobileApp.Events.postToComponent("taskbackground::task::open",[{taskId:t,data:o}],"background");e.preventDefault();e.stopPropagation();return false}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:101:"/bitrix/templates/mobile_app/components/bitrix/voting.current/.userfield/script.min.js?17287331806722";s:6:"source";s:82:"/bitrix/templates/mobile_app/components/bitrix/voting.current/.userfield/script.js";s:3:"min";s:86:"/bitrix/templates/mobile_app/components/bitrix/voting.current/.userfield/script.min.js";s:3:"map";s:86:"/bitrix/templates/mobile_app/components/bitrix/voting.current/.userfield/script.map.js";}"*/
(function(e){if(BX&&BX["Mobile"]&&BX["Mobile"]["Vote"]&&BX["Mobile"]["Vote"]["init"])return;BX.namespace("BX.Mobile.Vote");var t={};e.voteGetID=function(){return"vote"+(new Date).getTime()};var s=function(){return app.hidePopupLoader()},i=function(){return app.showPopupLoader()},o=function(){var t=function(e){if(!e["url"])throw"Vote error: url is empty.";else if(!e["CID"])throw"Vote error: id is empty.";else if(!BX(e["controller"]))throw"Vote error: controller is absent.";this.CID=e["CID"];this.voteId=e["voteId"];this.url=e["url"];this.controller=e["controller"];this.form=e["form"];this.bind();this.period=[1,5,10,30];e["startCheck"]=parseInt(e["startCheck"]);this.lastVote=e["startCheck"]>0?e["startCheck"]/60:0;if(this.lastVote<=0)this.check()};t.prototype={status:"ready",check:function(e){var t=e===true?0:false,s;if(e!==true){for(s=0;s<this.period.length;s++){if(this.lastVote<=this.period[s]){t=this.period[s];break}}}if(t!==false)setTimeout(BX.proxy(function(){this.send()},this),t*60*1e3)},send:function(){BX.ajax({url:this.url.replace(/.AJAX_RESULT=Y/g,"").replace(/.AJAX_POST=Y/g,"").replace(/.sessid=[^&]*/g,"").replace(/.VOTE_ID=([\d]+)/,"").replace(/.view_form=Y/g,"").replace(/.view_result=Y/g,""),method:"POST",dataType:"json",data:{VOTE_ID:this.voteId,AJAX_RESULT:"Y",view_result:"Y",dataType:"json",sessid:BX.bitrix_sessid()},onsuccess:BX.proxy(function(e){this.start(e)},this),onfailure:function(e){}})},start:function(e){this.lastVote=parseInt(e["LAST_VOTE"]/60);this.changeData(e);this.check()},changeData:function(e){e=e["QUESTIONS"];var t,s;BX.onCustomEvent(this.controller,"OnBeforeChangeData");for(var i in e){if(e.hasOwnProperty(i)){t=BX.findChild(this.controller,{attr:{id:"question"+i}},true);if(t){for(var o in e[i]){if(e[i].hasOwnProperty(o)){s=BX.findChild(t,{attr:{id:"answer"+o}},true);if(s){BX.adjust(s,{attrs:{"bx-voters-count":e[i][o]["COUNTER"]}});BX.unbindAll(s,"click");if(!this.form)BX.bind(s,"click",n);BX.adjust(BX.findChild(s,{tagName:"DIV",className:"bx-vote-data-percent"},true),{html:"<span>"+parseInt(e[i][o]["PERCENT"])+'</span><span class="post-vote-color">%</span>'});BX.adjust(BX.findChild(s,{tagName:"DIV",className:"bx-vote-answer-bar"},true),{style:{width:parseInt(e[i][o]["PERCENT"])+"%"}})}}}}}}BX.adjust(BX.findChild(this.controller,{tagName:"TD",className:"bx-vote-events-count"},true),{html:"<span>"+parseInt(e["COUNTER"])+'</span><span class="post-vote-color">%</span>'});BX.onCustomEvent(this.controller,"OnAfterChangeData")},replace:function(e,t){e=e.replace(/.AJAX_RESULT=Y/g,"").replace(/.AJAX_POST=Y/g,"").replace(/.sessid=[^&]*/g,"").replace(/.VOTE_ID=([\d]+)/,"").replace(/.view_form=Y/g,"").replace(/.view_result=Y/g,"");this.post(e,t)},getXHR:function(){this.BMAjaxWrapper=this.BMAjaxWrapper||new MobileAjaxWrapper;return this.BMAjaxWrapper},post:function(e,t){if(this.status=="busy")return;var o=true,r;if(t){for(r in t){if(t.hasOwnProperty(r)){o=false;break}}}if(o)return;t["VOTE_ID"]=this.voteId;t["AJAX_POST"]="Y";t["sessid"]=BX.bitrix_sessid();i();this.status="busy";this.postRelease=BX.proxy(function(){s();this.status="ready"},this);this.getXHR().Wrap({type:"html",method:"POST",url:e,data:t,processData:false,callback:BX.proxy(function(s){this.postRelease();if(t&&(t=='{"status":"failed"}'||t.status=="failed")){app.BasicAuth({success:BX.proxy(function(){this.post(e,t)},this),failure:function(){}})}else{var i=BX.processHTML(s,false),o=this.node.block;o.innerHTML="";o.innerHTML=i.HTML;BX.removeClass(o,"bx-vote-block-result");BX.removeClass(o,"bx-vote-block-result-view");if(i.HTML.indexOf("<form")<0){BX.addClass(o,"bx-vote-block-result")}BX.defer(function(){BX.ajax.processScripts(i.SCRIPT)})()}},this),callback_failure:this.postRelease})},node:{revote:null,vote:null,results:null,block:null},bind:function(){this.node.revote=BX("vote-revote-"+this.CID);if(this.node.revote){BX.unbindAll(this.node.revote);BX.bind(this.node.revote,"click",BX.delegate(function(e){BX.eventCancelBubble(e);this.replace(e.target.getAttribute("href"),{view_form:"Y"});return BX.PreventDefault(e)},this))}this.node.vote=BX("vote-do-"+this.CID);if(this.node.vote&&this.form){BX.unbindAll(this.node.vote);BX.bind(this.node.vote,"click",BX.proxy(function(e){BX.eventCancelBubble(e);this.replace(this.form.action,BX.ajax.prepareForm(this.form).data);return BX.PreventDefault(e)},this))}this.node.results=BX("vote-view-"+this.CID);this.node.block=BX.findParent(this.controller,{tagName:"DIV",className:"bx-vote-block"});if(this.node.results){BX.unbindAll(this.node.results);BX.bind(this.node.results,"click",BX.proxy(function(e){BX.eventCancelBubble(e);i();this.node.resultsf=BX.proxy(function(){BX.addClass(this.node.block,"bx-vote-block-result");BX.addClass(this.node.block,"bx-vote-block-result-view");s();BX.removeCustomEvent(this.controller,"OnBeforeChangeData",this.node.resultsf)},this);BX.addCustomEvent(this.controller,"OnBeforeChangeData",this.node.resultsf);this.node.resultsf1=BX.proxy(function(){BX.hide(BX("vote-view-"+this.CID));BX.removeCustomEvent(this.controller,"OnAfterChangeData",this.node.resultsf1)},this);BX.addCustomEvent(this.controller,"OnAfterChangeData",this.node.resultsf1);this.lastVote=0;this.check(true);return BX.PreventDefault(e)},this))}this.onPullEvent=BX.delegate(function(e){var t=e.params;if(e.command=="voting"&&t["VOTE_ID"]==this.voteId){var s=BX.findParent(this.controller,{className:"bx-vote-block"});if(s&&BX.hasClass(s,"bx-vote-block-result")){this.changeData(t)}}},this);BX.addCustomEvent(e,"onPull-vote",this.onPullEvent);BXMobileApp.onCustomEvent("onPullExtendWatch",{id:"VOTE_"+this.voteId},true)},unbind:function(){delete this.form;BX.unbindAll(this.node.revote);delete this.node.revote;BX.unbindAll(this.node.vote);delete this.node.vote;BX.unbindAll(this.node.results);delete this.node.results;delete this.node.block;BX.removeCustomEvent(e,"onPull-vote",this.onPullEvent)}};return t}(),r=function(e,t){if(!t||!t.hasAttribute("bx-voters-count")||parseInt(t.getAttribute("bx-voters-count"))<=0)return false;BX.PreventDefault(e);var s=t.getAttribute("id").replace("answer",""),i="/bitrix/templates/mobile_app/components/bitrix/voting.current/.userfield/users.php?answer_id="+s+"&sessid="+BX.bitrix_sessid();app.openBXTable({url:i,TABLE_SETTINGS:{markmode:false,cache:false}})},n=function(e){r(e,this)};BX.Mobile.Vote.init=function(e){e["CID"]=e["id"];e["controller"]=BX("vote-"+e["id"]);e["form"]=BX("vote-form-"+e["id"]);if(t[e["id"]])t[e["id"]].unbind();t[e["id"]]=new o(e);var s=BX.findChildren(e.controller,{tagName:"TR",className:"bx-vote-answer-item"},true);if(!e["form"]&&s&&s.length>0){for(var i=0;i<s.length;i++){BX.unbindAll(s[i]);BX.bind(s[i],"click",n)}}}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:84:"/bitrix/components/bitrix/voting.uf/templates/.default/script.min.js?172873318511231";s:6:"source";s:64:"/bitrix/components/bitrix/voting.uf/templates/.default/script.js";s:3:"min";s:68:"/bitrix/components/bitrix/voting.uf/templates/.default/script.min.js";s:3:"map";s:68:"/bitrix/components/bitrix/voting.uf/templates/.default/script.map.js";}"*/
(function(t){var e=t.BX;if(e["Vote"])return;var i=t["app"]?e.message("SITE_DIR")+"mobile/?mobile_action=vote":"/bitrix/tools/vote/uf.php";e.Vote=function(){var a=function(i,s){this.node=i;this.form=e.findChild(this.node,{tagName:"FORM"},true);this.id=s["id"];this.voteId=s["voteId"];this.params=s;var a,o,r;this.errorNode=e.findChild(this.node,{attribute:{"data-bx-vote-role":"error"}},true);for(var n in this.buttons){if(this.buttons.hasOwnProperty(n)){a=e.findChild(this.node,{attribute:{"data-bx-vote-button":n}},true);if(a&&e.type.isFunction(this[n])){this[n]=e.delegate(this[n],this);this.buttons[n]=a;e.bind(a,"click",this[n])}}}a=e.findChildren(this.node,{tagName:"TR"},true);while(a&&(o=a.pop())&&o&&o.hasAttribute("data-bx-vote-answer")){r=e.findChild(o,{tagName:"A",attribute:{"data-bx-vote-result":"counter"}},true);if(r){if(t["app"]){e.bind(o,"click",e.proxy(this.checkMobileUsers,this))}else{e.bind(r,"click",e.proxy(this.checkUsers,this));e.adjust(r,{attrs:{"data-bx-vote-answer":o.getAttribute("data-bx-vote-answer")}})}}}this.onPullEvent=e.delegate((function(t,i){if(t=="voting"&&!!i&&i["VOTE_ID"]==this.voteId&&e(this.node)){this.adjustResults(i)}}),this);if(t["app"]){app.onCustomEvent("onPullExtendWatch",{id:"VOTE_"+this.voteId});e.addCustomEvent("onPull-vote",this.onPullEvent)}else if(e["PULL"]){e.PULL.extendWatch("VOTE_"+this.voteId);e.addCustomEvent("onPullEvent-vote",this.onPullEvent)}};a.prototype={buttons:{showVoteForm:null,showResults:null,actVoting:null,stopOrResume:null,exportXls:null},params:{},url:i,showVoteForm:function(t){if(this.node.getAttribute("data-bx-vote-lamp")=="green"){var i=e.proxy((function(t){if(t&&t.data&&t.data.event)this.adjustBallot(t.data.attach,t.data.event);this.node.setAttribute("data-bx-vote-form","shown")}),this),s=e.proxy((function(t){this.node.setAttribute("data-bx-vote-form","shown")}),this);this.send({action:"getBallot"},t.target,i,s)}e.eventCancelBubble(t);return e.PreventDefault(t)},showResults:function(t){this.node.setAttribute("data-bx-vote-result",this.node.getAttribute("data-bx-vote-result")=="shown"?"hidden":"shown");e.eventCancelBubble(t);return e.PreventDefault(t)},stopOrResume:function(t){this.send({action:this.node.getAttribute("data-bx-vote-lamp")=="red"?"resume":"stop"},t.target,e.proxy((function(t){if(t["action"]=="stop"){this.node.setAttribute("data-bx-vote-result","shown");this.node.setAttribute("data-bx-vote-form","hidden");this.node.setAttribute("data-bx-vote-lamp","red")}else{if(this.node.getAttribute("data-bx-vote-status")!=="voted")this.node.setAttribute("data-bx-vote-form","shown");this.node.setAttribute("data-bx-vote-lamp","green")}if(t["data"]&&t["data"]["attach"])this.adjustResults(t["data"]["attach"])}),this));e.eventCancelBubble(t);return e.PreventDefault(t)},exportXls:function(t){e.eventCancelBubble(t);top.location.href=e.util.add_url_param(this.url,{action:"exportXls",attachId:this.id,sessid:e.bitrix_sessid()});return e.PreventDefault(t)},actVoting:function(t){var i=e.ajax.prepareForm(this.form).data;i["action"]="vote";this.send(i,t.target,e.proxy((function(t){this.node.setAttribute("data-bx-vote-form","hidden");this.node.setAttribute("data-bx-vote-result","shown");this.adjustResults(t.data.attach)}),this),e.proxy((function(){this.node.setAttribute("data-bx-vote-form","shown")}),this));e.eventCancelBubble(t);return e.PreventDefault(t)},send:function(t,i,s,a){e.addClass(i,"ui-btn-clock");t["sessid"]=e.bitrix_sessid();t["attachId"]=this.id;e.ajax({method:"POST",url:e.util.add_url_param(this.url,{action:t["action"],attachId:this.id}),data:t,dataType:"json",onsuccess:e.proxy((function(t){e.removeClass(i,"ui-btn-clock");if(t.status=="success"){this.showError(null);if(e.type.isFunction(s))s.apply(this,arguments)}else{if(t.status=="error"&&t["errors"])this.showError(t["errors"]);if(e.type.isFunction(a))a.apply(this,arguments)}}),this),onfailure:e.proxy((function(){e.removeClass(i,"ui-btn-clock");if(e.type.isFunction(a))a.apply(this,arguments)}),this)})},adjustBallot:function(t,i){var s,a,o,r,n,u,l,h,p,d=t["QUESTIONS"],c=i["ballot"],f=i["extras"];for(s in d){if(d.hasOwnProperty(s)){l=d[s];o=[l["FIELD_NAME"],l["FIELD_NAME"]+"[]"];p=c[s]||{};while(r=o.shift()){if(this.form.elements[r]){u=e(this.form.elements[r])?[this.form.elements[r]]:this.form.elements[r];for(r=0;r<u.length;r++){if(p[u[r].value]){u[r].checked="checked"}else{delete u[r].checked}}}}for(a in d[s]["ANSWERS"]){if(d[s]["ANSWERS"].hasOwnProperty(a)){h=d[s]["ANSWERS"][a];if(h["FIELD_TYPE"]>=4){if(this.form.elements[h["MESSAGE_FIELD_NAME"]])this.form.elements[h["MESSAGE_FIELD_NAME"]].value=c[s]&&c[s][a]&&c[s][a]["MESSAGE"]?c[s][a]["MESSAGE"]:"";else this.form.elements[h["FIELD_NAME"]].value=c[s]&&c[s][a]&&c[s][a]["MESSAGE"]?c[s][a]["MESSAGE"]:""}}}}}for(r in f){if(f.hasOwnProperty(r)&&(s=e(this.form.elements[String(t["FIELD_NAME"]).replace("#ENTITY_ID#",r)]))){if(s.value==f[r])s.checked=true;else delete s.checked}}},adjustResults:function(t){var i=t["QUESTIONS"];e.onCustomEvent(this.node,"OnBeforeChangeData");var s,a,o,r,n,u;for(r in i){if(i.hasOwnProperty(r)){s=e.findChild(this.node,{attr:{id:"question"+r}},true);if(s){for(o in i[r]["ANSWERS"]){if(i[r]["ANSWERS"].hasOwnProperty(o)){a=e.findChild(s,{attr:{"data-bx-vote-answer":o}},true);if(!!a){n=parseInt(i[r]["ANSWERS"][o]["PERCENT"]);n=isNaN(n)?0:n;u=e.findChild(a,{attribute:{"data-bx-vote-result":"counter"}},true);e.adjust(u,{html:i[r]["ANSWERS"][o]["COUNTER"]+""});delete u["VOTED_USER_OBJ"];e.adjust(e.findChild(a,{tagName:"SPAN",attribute:{"data-bx-vote-result":"percent"}},true),{html:n+"%"});e.adjust(e.findChild(a,{tagName:"DIV",attribute:{"data-bx-vote-result":"bar"}},true),{style:{width:n+"%"}})}}}}}}u=e.findChild(this.node,{tagName:"DIV",attribute:{"data-bx-vote-result":"counter"}},true);e.adjust(u,{html:t["COUNTER"]+""});e.onCustomEvent(this.controller,"OnAfterChangeData")},checkUsers:function(t){var i=t?e(t.currentTarget):null;if(i.hasAttribute("data-bx-vote-answer")){if(!i["VOTED_USER_OBJ"]){i.VOTED_USER_OBJ=new s(i.getAttribute("data-bx-vote-answer"),i,{nameTemplate:this.params["nameTemplate"],urlTemplate:this.params["urlTemplate"],attachId:this.id})}i.VOTED_USER_OBJ.click()}},checkMobileUsers:function(t){if(this.node&&this.node.getAttribute("data-bx-vote-form")!=="shown"){var i=e.proxy_context,s=e.findChild(i,{tagName:"A",attribute:{"data-bx-vote-result":"counter"}},true);if(s&&parseInt(s.innerHTML)>0){e.PreventDefault(t);app.openBXTable({url:e.util.add_url_param(this.url,{action:"getMobileVoted",attachId:this.id,answerId:i.getAttribute("data-bx-vote-answer"),sessid:e.bitrix_sessid()}),TABLE_SETTINGS:{markmode:false,cache:false}});return false}}return true},showError:function(t){var i="";if(e.type.isArray(t)){var s=[];for(var a=0;a<t.length;a++){s.push(t[a]["message"])}s=s.join("<br />");i=s===""?"Unknown error":s;this.errorNode.innerHTML=i;this.node.setAttribute("data-bx-vote-error","shown")}else{this.errorNode.innerHTML="";this.node.setAttribute("data-bx-vote-error","hidden")}}};return a}();var s=function(){var t=function(t,e,i){this.id=["vote",t,(new Date).getTime()].join("-");this.answerId=t;this.node=e;this.status="ready";this.iNumPage=0;this.urlTemplate=i["urlTemplate"];this.nameTemplate=i["nameTemplate"];this.attachId=i["attachId"];this.data=[];this.queue=[];this.popup=null;this.popupScrollCheck=this.popupScrollCheck.bind(this)};t.prototype={url:i,click:function(){var t=parseInt(this.node.innerHTML);if(t>0){this.showPopup().then((()=>{if(this.data.length>0){this.buildVoters(this.data)}}))}},buildVoters:function(t){var i=this.popup?this.popup.getPopupContainer():null;if(i===null){return}var s=i.querySelector(".bx-ilike-popup");i.querySelector(".bx-ilike-wrap-block").removeAttribute("style");var a=false;t.forEach((t=>{var i=e.util.htmlspecialchars(t["ID"]);var o=e.util.htmlspecialchars(t["FULL_NAME"]);var r=e.type.isNotEmptyString(t["PHOTO_SRC"])?encodeURI(e.util.htmlspecialchars(t["PHOTO_SRC"])):null;var n=e.type.isNotEmptyString(t["TYPE"])?e.util.htmlspecialchars(t["TYPE"]):null;var u=["a",this.answerId,"u",i].join("");if(s.querySelector("a#"+u)===null){var l=['<span class="bx-ilike-popup-avatar-new">','<img src="',r??"/bitrix/images/main/blank.gif",'" class="bx-ilike-popup-avatar-img',r?"":" bx-ilike-popup-avatar-img-default",'" />','<span class="bx-ilike-popup-avatar-status-icon"></span>',"</span>",'<span class="bx-ilike-popup-name-new">',o,"</span>"].join("");s.appendChild(e.create(t["ID"]!=="HIDDEN"&&this.urlTemplate?"A":"SPAN",{attrs:{id:u},props:{href:this.urlTemplate.replace(/#(USER_ID|ID)#/i,i),target:"_blank",className:"bx-ilike-popup-img"+(n?" bx-ilike-popup-img-"+n:"")},html:l}))}a=true}));if(a){this.popup.adjustPosition({forceBindPosition:true});this.popupScrollCheck({currentTarget:s})}},makeError:function(t){var i=this.popup?this.popup.getPopupContainer():null;if(i===null){return}var s=(t||[{message:e.message("VOTE_ERROR_DEFAULT")}]).map((t=>t.message)).join("");i.innerHTML='<div class="bx-vote-popup-error-block">'+s+"</div>";this.popup.adjustPosition({forceBindPosition:true})},showPopup:function(){return new Promise((t=>{var e=this.getPopup();e.show();e.setAngle({position:"bottom"});e.adjustPosition({forceBindPosition:true});t(e)}))},getPopup:function(){if(this.popup){return this.popup}this.popup=new e.PopupWindow("bx-vote-popup-cont-"+this.id,this.node,{lightShadow:true,offsetTop:-2,offsetLeft:3,autoHide:true,closeByEsc:true,cacheable:false,bindOptions:{position:"top"},content:['<span class="bx-ilike-wrap-block" style="display: none;">'+'<span class="bx-ilike-popup"><span class="bx-ilike-bottom_scroll"></span></span>'+"</span>",'<span class="bx-ilike-wait"></span>'].join(""),events:{onFirstShow:()=>{this.send();e.bind(this.popup.contentContainer.querySelector(".bx-ilike-popup"),"scroll",this.popupScrollCheck)},onClose:()=>{this.popup=null}}});return this.popup},popupScrollCheck:function(){var t=this.popup?this.popup.contentContainer:null;if(t===null){return}var e=t.querySelector(".bx-ilike-popup");if(e.scrollTop>(e.scrollHeight-e.offsetHeight)/1.5||t.offsetHeight>e.offsetHeight){this.send()}},send:function(){if(this.status!=="ready"){if(this.status==="busy"){this.queue.push(this.send.bind(this))}else if(this.status==="done"){this.finalize()}return}this.status="busy";e.ajax({url:e.util.add_url_param(this.url,{action:"getVoted",attachId:this.attachId,answerId:this.answerId}),method:"POST",dataType:"json",data:{iNumPage:++this.iNumPage,nameTemplate:this.nameTemplate,sessid:e.bitrix_sessid()},onsuccess:function(t){if(t&&t.status==="success"){t=t.data;this.buildVoters(t.items);this.data=this.data.concat(t.items);if(t["statusPage"]==="done"||t.items.length<=0){this.status="done";this.finalize()}else{this.status="ready";var e=this.queue.shift();if(e){e.call(this)}}}else{this.status="error";this.makeError(t.errors);this.finalize()}}.bind(this),onfailure:function(){this.status="error";this.makeError();this.finalize()}.bind(this)})},finalize:function(){this.queue=[];var t=this.popup?this.popup.getPopupContainer():null;if(t===null){return}t.querySelector(".bx-ilike-wait").style.display="none";e.unbind(t.querySelector(".bx-ilike-popup"),"scroll",this.popupScrollCheck)}};return t}()})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:61:"/bitrix/templates/mobile_app/log_mobile.min.js?17287331802637";s:6:"source";s:42:"/bitrix/templates/mobile_app/log_mobile.js";s:3:"min";s:46:"/bitrix/templates/mobile_app/log_mobile.min.js";s:3:"map";s:46:"/bitrix/templates/mobile_app/log_mobile.map.js";}"*/
(function(){if(BX.MSL)return;BX.MobileSonetLog=function(){};BX.MobileSonetLog.prototype.DBCheck=function(e){if(app.db!=undefined){app.db.createTable({tableName:"b_default",fields:[{name:"KEY",unique:true},"VALUE"],success:function(t){e.success()},fail:function(t){e.fail()}})}else return false};BX.MobileSonetLog.prototype.DBDelete=function(e){if(parseInt(e)<=0){e=false}if(app.db!=undefined){var t=false;this.DBCheck({success:function(){app.db.deleteRows({tableName:"b_default",filter:{KEY:"post_unsent"+(e?"_"+e:"")},success:function(e){},fail:function(e){}})},fail:function(){}})}else return false};BX.MobileSonetLog.prototype.DBSave=function(e,t){if(parseInt(t)<=0){t=false}for(x in e){if(x==="sessid"){delete e[x];break}}if(app.db!=undefined){this.DBCheck({success:function(){app.db.getRows({tableName:"b_default",filter:{KEY:"post_unsent"+(t?"_"+t:"")},success:function(n){text=JSON.stringify(e);if(n.items.length>0){app.db.updateRows({tableName:"b_default",updateFields:{VALUE:text},filter:{KEY:"post_unsent"+(t?"_"+t:"")},success:function(e){},fail:function(e){}})}else{app.db.addRow({tableName:"b_default",insertFields:{KEY:"post_unsent"+(t?"_"+t:""),VALUE:text},success:function(e){},fail:function(e){}})}},fail:function(e){}})},fail:function(){}})}else return false};BX.MobileSonetLog.prototype.DBLoad=function(e,t){if(parseInt(t)<=0){t=false}if(app.db!=undefined){this.DBCheck({success:function(){app.db.getRows({tableName:"b_default",filter:{KEY:"post_unsent"+(t?"_"+t:"")},success:function(t){if(t.items.length>0&&t.items[0].VALUE.length>0){var n=JSON.parse(t.items[0].VALUE);if(typeof n=="object")e.onLoad(n);else e.onEmpty()}else e.onEmpty()},fail:function(t){e.onEmpty()}})},fail:function(){e.onEmpty()}})}else{e.onEmpty();return null}};BX.MobileSonetLog.prototype.viewImageBind=function(e,t){if(app.enableInVersion(6)){e=BX(e);if(!!e){BX.bindDelegate(e,"click",t,function(n){var i=BX.findChildren(e,t,true),o=[],a=false,f=false;var s=[];for(var l=0;l<i.length;l++){a=i[l].getAttribute("data-bx-image");if(!BX.util.in_array(a,o)){f=i[l].getAttribute("data-bx-preview");o[o.length]=i[l].getAttribute("data-bx-image");s[s.length]={url:a,preview:typeof f!="undefined"&&f!==null&&f.length>0?f:"",description:""}}}var u={photos:s};if(this.tagName.toUpperCase()=="IMG"){a=this.getAttribute("data-bx-image");if(typeof a!="undefined"&&a.length>0){u.default_photo=a}f=this.getAttribute("data-bx-preview");if(typeof f!="undefined"&&f!==null&&f.length>0){u.default_preview=f}}BXMobileApp.UI.Photo.show(u);return BX.PreventDefault(n)})}}};BX.MSL=new BX.MobileSonetLog;window.BX.MSL=BX.MSL})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:65:"/bitrix/templates/mobile_app/bizproc_mobile.min.js?17287331803876";s:6:"source";s:46:"/bitrix/templates/mobile_app/bizproc_mobile.js";s:3:"min";s:50:"/bitrix/templates/mobile_app/bizproc_mobile.min.js";s:3:"map";s:50:"/bitrix/templates/mobile_app/bizproc_mobile.map.js";}"*/
if(typeof BX.BizProcMobile==="undefined"){BX.BizProcMobile={};BX.BizProcMobile.doTask=function(e,a,t){var r=true;if(e instanceof FormData){r=false;e.append("sessid",BX.bitrix_sessid())}else{e["sessid"]=BX.bitrix_sessid()}app.showPopupLoader({text:"..."});var i=(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/?mobile_action=bp_do_task";BX.ajax({method:"POST",dataType:"json",url:i,data:e,preparePost:r,onsuccess:function(r){app.hidePopupLoader();if(r.ERROR){app.alert({text:r.ERROR,title:BX.message("MB_BP_DETAIL_ALERT")})}else{if(a){a(r,e)}if(!t){BXMobileApp.onCustomEvent("bpDoTaskComplete",e,true)}}},onfailure:function(e){console.error(e);app.hidePopupLoader()}});return false};BX.BizProcMobile.openTaskPage=function(e,a){if(typeof a!="undefined"&&a!=null&&a&&typeof a.target!="undefined"&&a.target!=null){if(typeof a.target.tagName!="undefined"&&a.target.tagName.toLowerCase()=="a"){return false}var t=BX.findParent(a.target,{tag:"A"},{tag:"div",className:"post-item-post-block"});if(t&&!BX.hasClass(t,"webform-small-button-blue")){return false}}app.loadPageBlank({url:(BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/")+"mobile/bp/detail.php?task_id="+e,unique:true});BX.PreventDefault(a);return false};BX.BizProcMobile.renderLogMessage=function(e,a,t){if(!e)return false;if(a!==null){var r=e.parentNode;if(!r)return false;r.innerHTML=a;e=r.querySelector('[data-role="mobile-log-bp-wf"]');if(!e)return false}var i=JSON.parse(e.getAttribute("data-tasks")),o=0,s="0",l="1",n="2",f="3",u="4",d=false,p=false;if(BX.message("USER_ID"))o=BX.message("USER_ID");var B=function(e,a){for(var t=0,r=e.USERS.length;t<r;++t){if(e.USERS[t]["USER_ID"]==a)return e.USERS[t]}return null};if(i.length){for(var c=0,b=i.length;c<b;++c){var g=i[c];var m=B(g,o);if(m){if(m.STATUS>s)d=m.STATUS;else{d=false;p=g.ID;var X=BX.findChild(e,{className:"task_buttons_"+g.ID},true);if(X)X.style.display="";var _=BX.findChild(e,{className:"task_block_"+g.ID},true);if(_)_.style.display="";break}}}}if(d!==false){var v="user_status_ok";if(d==l)v="user_status_yes";else if(d==n||d==u)v="user_status_no";var M=BX.findChild(e,{className:v},true);if(M)M.style.display=""}var D=BX.findChild(e,{className:"wf_status"},true);if(D)D.style.display=d||p?"none":"";e.setAttribute("data-rendered",t)};BX.BizProcMobile.renderLogMessages=function(e,a,t,r){var i=e.querySelectorAll('[data-role="mobile-log-bp-wf"]');if(!r)r="Y";if(i){for(var o=0;o<i.length;o++){var s=i[o].getAttribute("data-rendered"),l=i[o].getAttribute("data-workflow-id");if(s){if(s===r.toString())continue;if(a&&a!==l)continue}var n=a===l?t:null;BX.BizProcMobile.renderLogMessage(i[o],n,r)}BX.onCustomEvent("MobileBizProc:onRenderLogMessages",[])}};BX.BizProcMobile.loadLogMessageCallback=function(e,a){BX.ajax({method:"POST",dataType:"html",url:"/mobile/?mobile_action=bp_livefeed_action",data:{WORKFLOW_ID:a["WORKFLOW_ID"]},onsuccess:function(e){a["NEW_LOG_CONTENT"]=e;a["UPDATE_ID"]=parseInt(Math.random()*1e4);BX.BizProcMobile.renderLogMessages(document,a["WORKFLOW_ID"],e,a["UPDATE_ID"]);BXMobileApp.onCustomEvent("bpDoTaskComplete",a,true)}})};BX.BizProcMobile.renderFacePhoto=function(e,a){var t=BX.message("USER_ID"),r=a[0];if(t&&a.length>1){for(var i=0,o=a.length;i<o;++i){var s=a[i];if(s["USER_ID"]==t){r=s;break}}}if(r["PHOTO_SRC"]){e.onload=null;e.src=encodeURI(r["PHOTO_SRC"])}};BX.BizProcMobile.showDatePicker=function(e,a){var t="M/d/y H:m";var r=e.parentNode;var i=BX.findChild(r,{tag:"input"});var o=i.getAttribute("data-type")==="date"?"date":"datetime";var s={type:o,format:t,callback:function(a){var t=new Date(Date.parse(a));var r=o==="date"?BX.message("FORMAT_DATE"):BX.message("FORMAT_DATETIME");var s=BX.formatDate(t,r);i.value=s;e.innerHTML=s}};BXMobileApp.UI.DatePicker.setParams(s);BXMobileApp.UI.DatePicker.show();return BX.PreventDefault(a)}}
/* End */
;; /* /bitrix/components/bitrix/mobile.socialnetwork.log.ex/templates/.default/mobile_files.min.js?17287331851673*/
; /* /bitrix/components/bitrix/mobile.socialnetwork.log.ex/templates/.default/script_attached.min.js?172873318563383*/
; /* /bitrix/templates/mobile_app/components/bitrix/voting.current/.userfield/script.min.js?17287331806722*/
; /* /bitrix/components/bitrix/voting.uf/templates/.default/script.min.js?172873318511231*/
; /* /bitrix/templates/mobile_app/log_mobile.min.js?17287331802637*/
; /* /bitrix/templates/mobile_app/bizproc_mobile.min.js?17287331803876*/

//# sourceMappingURL=page_live_feed_mobile.map.js