jn.define("intranet/user-mini-profile-form",((e,t,i)=>{const{Color:o,Indent:s,Corner:n}=e("tokens");const{IconView:a,Icon:r}=e("ui-system/blocks/icon");const{FileConverter:l}=e("files/converter");const{getFile:d}=e("files/entry");const{Loc:h}=e("loc");const{isEmpty:m}=e("utils/object");const{PureComponent:c}=e("layout/pure-component");const{StringInput:u,InputSize:g,InputMode:E,InputDesign:I}=e("ui-system/form/inputs/string");const{EmailInput:p,InputDomainIconPlace:L}=e("ui-system/form/inputs/email");const{PhoneInput:f}=e("ui-system/form/inputs/phone");class F extends c{constructor(e){super(e);this.nameField=null;this.lastNameField=null;this.phoneField=null;this.emailField=null;this.profileData={};this.scrollToInput=e.scrollToInput;this.state={profileData:e.profileData}}componentDidMount(){this.onContinue()}componentWillUnmount(){super.componentWillUnmount();BX.postComponentEvent("userMiniProfileClosed",null)}getProfileData=()=>{const{profileData:e}=this.state;return e};getImageButton(){return View({style:{marginRight:s.XL3.toNumber(),width:84,height:84,borderRadius:42,backgroundColorGradient:{start:"#86ffc7",middle:"#279def",end:"#0175ff",angle:45},display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>this.showImagePicker()},this.props.photo||this.state.newPhoto?Image({resizeMode:"cover",uri:this.state.newPhoto??this.props.photo,style:{width:77,height:77,backgroundColor:o.accentSoftBlue3.toHex(),borderColor:o.bgSecondary.toHex(),borderWidth:3,borderRadius:39}}):View({style:{width:77,height:77,borderColor:o.bgSecondary.toHex(),borderWidth:3,borderRadius:39,backgroundColor:o.accentSoftBlue3.toHex(),display:"flex",alignItems:"center",justifyContent:"center"}},a({icon:r.CAMERA,size:47,color:o.accentMainPrimary})))}showImagePicker(){const e=[{id:"mediateka",name:BX.message("MOBILE_LAYOUT_UI_FIELDS_IMAGE_SELECT_MEDIATEKA")},{id:"camera",name:BX.message("MOBILE_LAYOUT_UI_FIELDS_IMAGE_SELECT_CAMERA")}];dialogs.showImagePicker({settings:{resize:{targetWidth:-1,targetHeight:-1,sourceType:1,encodingType:0,mediaType:0,allowsEdit:true,saveToPhotoAlbum:true,cameraDirection:1},maxAttachedFilesCount:1,previewMaxWidth:640,previewMaxHeight:640,attachButton:{items:e}}},(e=>this.onImageSelectFielded(e)))}onImageSelectFielded=e=>{const t=e[0];if(t){const e=new l;this.setState({newPhoto:t.previewUrl});(async()=>{try{const i=await e.resize("avatarResize",{url:t.previewUrl,width:1e3,height:1e3});const o=await d(i);o.readMode=BX.FileConst.READ_MODE.DATA_URL;const s=await o.readNext();if(s.content){const e=s.content;const t=["avatar.png",e.slice(e.indexOf("base64,")+7,e.length)];this.onChange("PERSONAL_PHOTO",t)}}catch(e){console.error(e)}})()}};onContinue=()=>{const e=[this.nameField,this.lastNameField,this.phoneField,this.emailField].find((e=>e&&(!e.getValue()||!e.isValid())));if(e){e.setFocused(true)}else{Keyboard.dismiss()}};submit(){const e=this.getProfileData();if(!e.ID){return}const t=[this.nameField,this.lastNameField,this.phoneField,this.emailField].find((e=>e&&!e.isValid()));if(t){t.setFocused(true)}else{this.updateUser(e)}}updateUser(e){BX.rest.callMethod("user.update",e).then((()=>{layout.close();BX.postComponentEvent("userMiniProfileClosed",null)})).catch((e=>{console.error(e);this.setState({emailFieldError:h.getMessage("INTRANETMOBILE_USER_MINI_PROFILE_EMAIL_EXIST")})}))}onChange(e,t){this.setState({profileData:{...this.getProfileData(),[e]:t}})}onChangeName=e=>{this.onChange("NAME",e)};onChangeLastName=e=>{this.onChange("LAST_NAME",e)};onChangeMobile=e=>{this.onChange("PERSONAL_MOBILE",e)};onChangeEmail=e=>{this.onChange("EMAIL",e)};setFocusPrimaryField=()=>{this.setState({primaryFieldSelected:true})};setBlurPrimaryField=()=>{this.setState({primaryFieldSelected:false})};getNameField(){const e="NAME";return u({size:g.L,mode:E.NAKED,ref:this.handleOnSetNameRef,testId:`USER_MINI_PROFILE_${e}`,showTitle:false,id:e,placeholder:h.getMessage("INTRANETMOBILE_USER_MINI_PROFILE_PLACEHOLDER_NAME")??"",value:this.getProfileData().NAME??"",readOnly:false,onFocus:this.setFocusPrimaryField,onBlur:this.setBlurPrimaryField,onChange:this.onChangeName})}handleOnSetNameRef=e=>{this.nameField=e};getLastNameField(){const e="LAST_NAME";return u({size:g.L,mode:E.NAKED,ref:this.handleOnSetLastNameRef,testId:`USER_MINI_PROFILE_${e}`,showTitle:false,id:e,placeholder:h.getMessage("INTRANETMOBILE_USER_MINI_PROFILE_PLACEHOLDER_LAST_NAME")??"",value:this.getProfileData().LAST_NAME??"",readOnly:false,onFocus:this.setFocusPrimaryField,onBlur:this.setBlurPrimaryField,onChange:this.onChangeLastName})}handleOnSetLastNameRef=e=>{this.lastNameField=e};getPhoneField(){const e="PERSONAL_MOBILE";return f({validation:true,id:e,size:g.L,design:I.LIGHT_GREY,ref:this.handleOnSetPhoneRef,testId:`USER_MINI_PROFILE_${e}`,showTitle:false,placeholder:h.getMessage("INTRANETMOBILE_USER_MINI_PROFILE_PLACEHOLDER_PHONE")??"",value:this.getProfileData().PERSONAL_MOBILE??"",onChange:this.onChangeMobile})}handleOnSetPhoneRef=e=>{this.phoneField=e};focusEmailField=()=>{this.setState({emailFieldError:null});this.scrollToInput(this.emailField)};getEmailField(){const e="EMAIL";return p({validation:true,size:g.L,design:I.LIGHT_GREY,ref:this.handleOnSetEmailRef,testId:`USER_MINI_PROFILE_${e}`,showTitle:false,id:e,placeholder:h.getMessage("INTRANETMOBILE_USER_MINI_PROFILE_PLACEHOLDER_EMAIL")??"",value:this.getProfileData().EMAIL??"",errorText:this.state.emailFieldError,error:!m(this.state.emailFieldError),onFocus:this.focusEmailField,domainIconPlace:L.LEFT,leftContent:r.MAIL,onChange:this.onChangeEmail})}handleOnSetEmailRef=e=>{this.emailField=e};getDivider(){return View({style:{height:1,backgroundColor:o.bgSeparatorPrimary.toHex(),marginLeft:g.L.getInput()?.paddingHorizontal?.toNumber()??s.XL.toNumber()}})}render(){return View({style:{paddingHorizontal:s.XL2.toNumber()}},View({style:{display:"flex",flexDirection:"row"}},this.getImageButton(),View({style:{flexGrow:1,borderWidth:1,borderColor:this.state.primaryFieldSelected?o.accentMainPrimary.toHex():o.bgSeparatorPrimary.toHex(),borderRadius:n.L.toNumber(),marginBottom:s.XL4.toNumber()}},this.getNameField(),this.getDivider(),this.getLastNameField())),View({style:{marginBottom:s.M.toNumber()}},this.getPhoneField()),View({style:{marginBottom:s.M.toNumber()}},this.getEmailField()))}}i.exports={UserMiniProfileForm:F}}));
//# sourceMappingURL=extension.map.js